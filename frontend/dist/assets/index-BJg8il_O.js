function Tee(o,c){for(var u=0;u<c.length;u++){const f=c[u];if(typeof f!="string"&&!Array.isArray(f)){for(const E in f)if(E!=="default"&&!(E in o)){const S=Object.getOwnPropertyDescriptor(f,E);S&&Object.defineProperty(o,E,S.get?S:{enumerable:!0,get:()=>f[E]})}}}return Object.freeze(Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}))}(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const E of document.querySelectorAll('link[rel="modulepreload"]'))f(E);new MutationObserver(E=>{for(const S of E)if(S.type==="childList")for(const C of S.addedNodes)C.tagName==="LINK"&&C.rel==="modulepreload"&&f(C)}).observe(document,{childList:!0,subtree:!0});function u(E){const S={};return E.integrity&&(S.integrity=E.integrity),E.referrerPolicy&&(S.referrerPolicy=E.referrerPolicy),E.crossOrigin==="use-credentials"?S.credentials="include":E.crossOrigin==="anonymous"?S.credentials="omit":S.credentials="same-origin",S}function f(E){if(E.ep)return;E.ep=!0;const S=u(E);fetch(E.href,S)}})();var sE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $F(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var eB={exports:{}},pg={},tB={exports:{}},xt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qp=Symbol.for("react.element"),vee=Symbol.for("react.portal"),Ree=Symbol.for("react.fragment"),yee=Symbol.for("react.strict_mode"),Cee=Symbol.for("react.profiler"),Iee=Symbol.for("react.provider"),wee=Symbol.for("react.context"),Aee=Symbol.for("react.forward_ref"),bee=Symbol.for("react.suspense"),Oee=Symbol.for("react.memo"),Nee=Symbol.for("react.lazy"),mV=Symbol.iterator;function Dee(o){return o===null||typeof o!="object"?null:(o=mV&&o[mV]||o["@@iterator"],typeof o=="function"?o:null)}var nB={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},rB=Object.assign,iB={};function wu(o,c,u){this.props=o,this.context=c,this.refs=iB,this.updater=u||nB}wu.prototype.isReactComponent={};wu.prototype.setState=function(o,c){if(typeof o!="object"&&typeof o!="function"&&o!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,o,c,"setState")};wu.prototype.forceUpdate=function(o){this.updater.enqueueForceUpdate(this,o,"forceUpdate")};function oB(){}oB.prototype=wu.prototype;function UI(o,c,u){this.props=o,this.context=c,this.refs=iB,this.updater=u||nB}var xI=UI.prototype=new oB;xI.constructor=UI;rB(xI,wu.prototype);xI.isPureReactComponent=!0;var EV=Array.isArray,sB=Object.prototype.hasOwnProperty,VI={current:null},aB={key:!0,ref:!0,__self:!0,__source:!0};function cB(o,c,u){var f,E={},S=null,C=null;if(c!=null)for(f in c.ref!==void 0&&(C=c.ref),c.key!==void 0&&(S=""+c.key),c)sB.call(c,f)&&!aB.hasOwnProperty(f)&&(E[f]=c[f]);var D=arguments.length-2;if(D===1)E.children=u;else if(1<D){for(var k=Array(D),V=0;V<D;V++)k[V]=arguments[V+2];E.children=k}if(o&&o.defaultProps)for(f in D=o.defaultProps,D)E[f]===void 0&&(E[f]=D[f]);return{$$typeof:qp,type:o,key:S,ref:C,props:E,_owner:VI.current}}function Pee(o,c){return{$$typeof:qp,type:o.type,key:c,ref:o.ref,props:o.props,_owner:o._owner}}function FI(o){return typeof o=="object"&&o!==null&&o.$$typeof===qp}function Lee(o){var c={"=":"=0",":":"=2"};return"$"+o.replace(/[=:]/g,function(u){return c[u]})}var gV=/\/+/g;function oC(o,c){return typeof o=="object"&&o!==null&&o.key!=null?Lee(""+o.key):c.toString(36)}function IE(o,c,u,f,E){var S=typeof o;(S==="undefined"||S==="boolean")&&(o=null);var C=!1;if(o===null)C=!0;else switch(S){case"string":case"number":C=!0;break;case"object":switch(o.$$typeof){case qp:case vee:C=!0}}if(C)return C=o,E=E(C),o=f===""?"."+oC(C,0):f,EV(E)?(u="",o!=null&&(u=o.replace(gV,"$&/")+"/"),IE(E,c,u,"",function(V){return V})):E!=null&&(FI(E)&&(E=Pee(E,u+(!E.key||C&&C.key===E.key?"":(""+E.key).replace(gV,"$&/")+"/")+o)),c.push(E)),1;if(C=0,f=f===""?".":f+":",EV(o))for(var D=0;D<o.length;D++){S=o[D];var k=f+oC(S,D);C+=IE(S,c,u,k,E)}else if(k=Dee(o),typeof k=="function")for(o=k.call(o),D=0;!(S=o.next()).done;)S=S.value,k=f+oC(S,D++),C+=IE(S,c,u,k,E);else if(S==="object")throw c=String(o),Error("Objects are not valid as a React child (found: "+(c==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":c)+"). If you meant to render a collection of children, use an array instead.");return C}function aE(o,c,u){if(o==null)return o;var f=[],E=0;return IE(o,f,"","",function(S){return c.call(u,S,E++)}),f}function kee(o){if(o._status===-1){var c=o._result;c=c(),c.then(function(u){(o._status===0||o._status===-1)&&(o._status=1,o._result=u)},function(u){(o._status===0||o._status===-1)&&(o._status=2,o._result=u)}),o._status===-1&&(o._status=0,o._result=c)}if(o._status===1)return o._result.default;throw o._result}var ri={current:null},wE={transition:null},Mee={ReactCurrentDispatcher:ri,ReactCurrentBatchConfig:wE,ReactCurrentOwner:VI};function dB(){throw Error("act(...) is not supported in production builds of React.")}xt.Children={map:aE,forEach:function(o,c,u){aE(o,function(){c.apply(this,arguments)},u)},count:function(o){var c=0;return aE(o,function(){c++}),c},toArray:function(o){return aE(o,function(c){return c})||[]},only:function(o){if(!FI(o))throw Error("React.Children.only expected to receive a single React element child.");return o}};xt.Component=wu;xt.Fragment=Ree;xt.Profiler=Cee;xt.PureComponent=UI;xt.StrictMode=yee;xt.Suspense=bee;xt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Mee;xt.act=dB;xt.cloneElement=function(o,c,u){if(o==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+o+".");var f=rB({},o.props),E=o.key,S=o.ref,C=o._owner;if(c!=null){if(c.ref!==void 0&&(S=c.ref,C=VI.current),c.key!==void 0&&(E=""+c.key),o.type&&o.type.defaultProps)var D=o.type.defaultProps;for(k in c)sB.call(c,k)&&!aB.hasOwnProperty(k)&&(f[k]=c[k]===void 0&&D!==void 0?D[k]:c[k])}var k=arguments.length-2;if(k===1)f.children=u;else if(1<k){D=Array(k);for(var V=0;V<k;V++)D[V]=arguments[V+2];f.children=D}return{$$typeof:qp,type:o.type,key:E,ref:S,props:f,_owner:C}};xt.createContext=function(o){return o={$$typeof:wee,_currentValue:o,_currentValue2:o,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},o.Provider={$$typeof:Iee,_context:o},o.Consumer=o};xt.createElement=cB;xt.createFactory=function(o){var c=cB.bind(null,o);return c.type=o,c};xt.createRef=function(){return{current:null}};xt.forwardRef=function(o){return{$$typeof:Aee,render:o}};xt.isValidElement=FI;xt.lazy=function(o){return{$$typeof:Nee,_payload:{_status:-1,_result:o},_init:kee}};xt.memo=function(o,c){return{$$typeof:Oee,type:o,compare:c===void 0?null:c}};xt.startTransition=function(o){var c=wE.transition;wE.transition={};try{o()}finally{wE.transition=c}};xt.unstable_act=dB;xt.useCallback=function(o,c){return ri.current.useCallback(o,c)};xt.useContext=function(o){return ri.current.useContext(o)};xt.useDebugValue=function(){};xt.useDeferredValue=function(o){return ri.current.useDeferredValue(o)};xt.useEffect=function(o,c){return ri.current.useEffect(o,c)};xt.useId=function(){return ri.current.useId()};xt.useImperativeHandle=function(o,c,u){return ri.current.useImperativeHandle(o,c,u)};xt.useInsertionEffect=function(o,c){return ri.current.useInsertionEffect(o,c)};xt.useLayoutEffect=function(o,c){return ri.current.useLayoutEffect(o,c)};xt.useMemo=function(o,c){return ri.current.useMemo(o,c)};xt.useReducer=function(o,c,u){return ri.current.useReducer(o,c,u)};xt.useRef=function(o){return ri.current.useRef(o)};xt.useState=function(o){return ri.current.useState(o)};xt.useSyncExternalStore=function(o,c,u){return ri.current.useSyncExternalStore(o,c,u)};xt.useTransition=function(){return ri.current.useTransition()};xt.version="18.3.1";tB.exports=xt;var Re=tB.exports;const BI=$F(Re),Uee=Tee({__proto__:null,default:BI},[Re]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xee=Re,Vee=Symbol.for("react.element"),Fee=Symbol.for("react.fragment"),Bee=Object.prototype.hasOwnProperty,jee=xee.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Gee={key:!0,ref:!0,__self:!0,__source:!0};function lB(o,c,u){var f,E={},S=null,C=null;u!==void 0&&(S=""+u),c.key!==void 0&&(S=""+c.key),c.ref!==void 0&&(C=c.ref);for(f in c)Bee.call(c,f)&&!Gee.hasOwnProperty(f)&&(E[f]=c[f]);if(o&&o.defaultProps)for(f in c=o.defaultProps,c)E[f]===void 0&&(E[f]=c[f]);return{$$typeof:Vee,type:o,key:S,ref:C,props:E,_owner:jee.current}}pg.Fragment=Fee;pg.jsx=lB;pg.jsxs=lB;eB.exports=pg;var se=eB.exports,MC={},uB={exports:{}},Ki={},hB={exports:{}},pB={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(o){function c(Le,ct){var gt=Le.length;Le.push(ct);e:for(;0<gt;){var zt=gt-1>>>1,jt=Le[zt];if(0<E(jt,ct))Le[zt]=ct,Le[gt]=jt,gt=zt;else break e}}function u(Le){return Le.length===0?null:Le[0]}function f(Le){if(Le.length===0)return null;var ct=Le[0],gt=Le.pop();if(gt!==ct){Le[0]=gt;e:for(var zt=0,jt=Le.length,Ai=jt>>>1;zt<Ai;){var Yn=2*(zt+1)-1,oa=Le[Yn],Ds=Yn+1,sa=Le[Ds];if(0>E(oa,gt))Ds<jt&&0>E(sa,oa)?(Le[zt]=sa,Le[Ds]=gt,zt=Ds):(Le[zt]=oa,Le[Yn]=gt,zt=Yn);else if(Ds<jt&&0>E(sa,gt))Le[zt]=sa,Le[Ds]=gt,zt=Ds;else break e}}return ct}function E(Le,ct){var gt=Le.sortIndex-ct.sortIndex;return gt!==0?gt:Le.id-ct.id}if(typeof performance=="object"&&typeof performance.now=="function"){var S=performance;o.unstable_now=function(){return S.now()}}else{var C=Date,D=C.now();o.unstable_now=function(){return C.now()-D}}var k=[],V=[],G=1,W=null,Q=3,me=!1,z=!1,de=!1,he=typeof setTimeout=="function"?setTimeout:null,q=typeof clearTimeout=="function"?clearTimeout:null,K=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function X(Le){for(var ct=u(V);ct!==null;){if(ct.callback===null)f(V);else if(ct.startTime<=Le)f(V),ct.sortIndex=ct.expirationTime,c(k,ct);else break;ct=u(V)}}function Ee(Le){if(de=!1,X(Le),!z)if(u(k)!==null)z=!0,ir(Oe);else{var ct=u(V);ct!==null&&en(Ee,ct.startTime-Le)}}function Oe(Le,ct){z=!1,de&&(de=!1,q(ze),ze=-1),me=!0;var gt=Q;try{for(X(ct),W=u(k);W!==null&&(!(W.expirationTime>ct)||Le&&!lr());){var zt=W.callback;if(typeof zt=="function"){W.callback=null,Q=W.priorityLevel;var jt=zt(W.expirationTime<=ct);ct=o.unstable_now(),typeof jt=="function"?W.callback=jt:W===u(k)&&f(k),X(ct)}else f(k);W=u(k)}if(W!==null)var Ai=!0;else{var Yn=u(V);Yn!==null&&en(Ee,Yn.startTime-ct),Ai=!1}return Ai}finally{W=null,Q=gt,me=!1}}var We=!1,De=null,ze=-1,an=5,_t=-1;function lr(){return!(o.unstable_now()-_t<an)}function Bt(){if(De!==null){var Le=o.unstable_now();_t=Le;var ct=!0;try{ct=De(!0,Le)}finally{ct?Mr():(We=!1,De=null)}}else We=!1}var Mr;if(typeof K=="function")Mr=function(){K(Bt)};else if(typeof MessageChannel<"u"){var hn=new MessageChannel,Ad=hn.port2;hn.port1.onmessage=Bt,Mr=function(){Ad.postMessage(null)}}else Mr=function(){he(Bt,0)};function ir(Le){De=Le,We||(We=!0,Mr())}function en(Le,ct){ze=he(function(){Le(o.unstable_now())},ct)}o.unstable_IdlePriority=5,o.unstable_ImmediatePriority=1,o.unstable_LowPriority=4,o.unstable_NormalPriority=3,o.unstable_Profiling=null,o.unstable_UserBlockingPriority=2,o.unstable_cancelCallback=function(Le){Le.callback=null},o.unstable_continueExecution=function(){z||me||(z=!0,ir(Oe))},o.unstable_forceFrameRate=function(Le){0>Le||125<Le?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):an=0<Le?Math.floor(1e3/Le):5},o.unstable_getCurrentPriorityLevel=function(){return Q},o.unstable_getFirstCallbackNode=function(){return u(k)},o.unstable_next=function(Le){switch(Q){case 1:case 2:case 3:var ct=3;break;default:ct=Q}var gt=Q;Q=ct;try{return Le()}finally{Q=gt}},o.unstable_pauseExecution=function(){},o.unstable_requestPaint=function(){},o.unstable_runWithPriority=function(Le,ct){switch(Le){case 1:case 2:case 3:case 4:case 5:break;default:Le=3}var gt=Q;Q=Le;try{return ct()}finally{Q=gt}},o.unstable_scheduleCallback=function(Le,ct,gt){var zt=o.unstable_now();switch(typeof gt=="object"&&gt!==null?(gt=gt.delay,gt=typeof gt=="number"&&0<gt?zt+gt:zt):gt=zt,Le){case 1:var jt=-1;break;case 2:jt=250;break;case 5:jt=1073741823;break;case 4:jt=1e4;break;default:jt=5e3}return jt=gt+jt,Le={id:G++,callback:ct,priorityLevel:Le,startTime:gt,expirationTime:jt,sortIndex:-1},gt>zt?(Le.sortIndex=gt,c(V,Le),u(k)===null&&Le===u(V)&&(de?(q(ze),ze=-1):de=!0,en(Ee,gt-zt))):(Le.sortIndex=jt,c(k,Le),z||me||(z=!0,ir(Oe))),Le},o.unstable_shouldYield=lr,o.unstable_wrapCallback=function(Le){var ct=Q;return function(){var gt=Q;Q=ct;try{return Le.apply(this,arguments)}finally{Q=gt}}}})(pB);hB.exports=pB;var Wee=hB.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hee=Re,Hi=Wee;function we(o){for(var c="https://reactjs.org/docs/error-decoder.html?invariant="+o,u=1;u<arguments.length;u++)c+="&args[]="+encodeURIComponent(arguments[u]);return"Minified React error #"+o+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var fB=new Set,Op={};function yd(o,c){gu(o,c),gu(o+"Capture",c)}function gu(o,c){for(Op[o]=c,o=0;o<c.length;o++)fB.add(c[o])}var $s=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),UC=Object.prototype.hasOwnProperty,Kee=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,SV={},TV={};function Yee(o){return UC.call(TV,o)?!0:UC.call(SV,o)?!1:Kee.test(o)?TV[o]=!0:(SV[o]=!0,!1)}function zee(o,c,u,f){if(u!==null&&u.type===0)return!1;switch(typeof c){case"function":case"symbol":return!0;case"boolean":return f?!1:u!==null?!u.acceptsBooleans:(o=o.toLowerCase().slice(0,5),o!=="data-"&&o!=="aria-");default:return!1}}function qee(o,c,u,f){if(c===null||typeof c>"u"||zee(o,c,u,f))return!0;if(f)return!1;if(u!==null)switch(u.type){case 3:return!c;case 4:return c===!1;case 5:return isNaN(c);case 6:return isNaN(c)||1>c}return!1}function ii(o,c,u,f,E,S,C){this.acceptsBooleans=c===2||c===3||c===4,this.attributeName=f,this.attributeNamespace=E,this.mustUseProperty=u,this.propertyName=o,this.type=c,this.sanitizeURL=S,this.removeEmptyString=C}var kr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(o){kr[o]=new ii(o,0,!1,o,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(o){var c=o[0];kr[c]=new ii(c,1,!1,o[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(o){kr[o]=new ii(o,2,!1,o.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(o){kr[o]=new ii(o,2,!1,o,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(o){kr[o]=new ii(o,3,!1,o.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(o){kr[o]=new ii(o,3,!0,o,null,!1,!1)});["capture","download"].forEach(function(o){kr[o]=new ii(o,4,!1,o,null,!1,!1)});["cols","rows","size","span"].forEach(function(o){kr[o]=new ii(o,6,!1,o,null,!1,!1)});["rowSpan","start"].forEach(function(o){kr[o]=new ii(o,5,!1,o.toLowerCase(),null,!1,!1)});var jI=/[\-:]([a-z])/g;function GI(o){return o[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(o){var c=o.replace(jI,GI);kr[c]=new ii(c,1,!1,o,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(o){var c=o.replace(jI,GI);kr[c]=new ii(c,1,!1,o,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(o){var c=o.replace(jI,GI);kr[c]=new ii(c,1,!1,o,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(o){kr[o]=new ii(o,1,!1,o.toLowerCase(),null,!1,!1)});kr.xlinkHref=new ii("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(o){kr[o]=new ii(o,1,!1,o.toLowerCase(),null,!0,!0)});function WI(o,c,u,f){var E=kr.hasOwnProperty(c)?kr[c]:null;(E!==null?E.type!==0:f||!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(qee(c,u,E,f)&&(u=null),f||E===null?Yee(c)&&(u===null?o.removeAttribute(c):o.setAttribute(c,""+u)):E.mustUseProperty?o[E.propertyName]=u===null?E.type===3?!1:"":u:(c=E.attributeName,f=E.attributeNamespace,u===null?o.removeAttribute(c):(E=E.type,u=E===3||E===4&&u===!0?"":""+u,f?o.setAttributeNS(f,c,u):o.setAttribute(c,u))))}var ra=Hee.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,cE=Symbol.for("react.element"),eu=Symbol.for("react.portal"),tu=Symbol.for("react.fragment"),HI=Symbol.for("react.strict_mode"),xC=Symbol.for("react.profiler"),_B=Symbol.for("react.provider"),mB=Symbol.for("react.context"),KI=Symbol.for("react.forward_ref"),VC=Symbol.for("react.suspense"),FC=Symbol.for("react.suspense_list"),YI=Symbol.for("react.memo"),Ga=Symbol.for("react.lazy"),EB=Symbol.for("react.offscreen"),vV=Symbol.iterator;function sp(o){return o===null||typeof o!="object"?null:(o=vV&&o[vV]||o["@@iterator"],typeof o=="function"?o:null)}var Bn=Object.assign,sC;function _p(o){if(sC===void 0)try{throw Error()}catch(u){var c=u.stack.trim().match(/\n( *(at )?)/);sC=c&&c[1]||""}return`
`+sC+o}var aC=!1;function cC(o,c){if(!o||aC)return"";aC=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(c)if(c=function(){throw Error()},Object.defineProperty(c.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(c,[])}catch(V){var f=V}Reflect.construct(o,[],c)}else{try{c.call()}catch(V){f=V}o.call(c.prototype)}else{try{throw Error()}catch(V){f=V}o()}}catch(V){if(V&&f&&typeof V.stack=="string"){for(var E=V.stack.split(`
`),S=f.stack.split(`
`),C=E.length-1,D=S.length-1;1<=C&&0<=D&&E[C]!==S[D];)D--;for(;1<=C&&0<=D;C--,D--)if(E[C]!==S[D]){if(C!==1||D!==1)do if(C--,D--,0>D||E[C]!==S[D]){var k=`
`+E[C].replace(" at new "," at ");return o.displayName&&k.includes("<anonymous>")&&(k=k.replace("<anonymous>",o.displayName)),k}while(1<=C&&0<=D);break}}}finally{aC=!1,Error.prepareStackTrace=u}return(o=o?o.displayName||o.name:"")?_p(o):""}function Xee(o){switch(o.tag){case 5:return _p(o.type);case 16:return _p("Lazy");case 13:return _p("Suspense");case 19:return _p("SuspenseList");case 0:case 2:case 15:return o=cC(o.type,!1),o;case 11:return o=cC(o.type.render,!1),o;case 1:return o=cC(o.type,!0),o;default:return""}}function BC(o){if(o==null)return null;if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case tu:return"Fragment";case eu:return"Portal";case xC:return"Profiler";case HI:return"StrictMode";case VC:return"Suspense";case FC:return"SuspenseList"}if(typeof o=="object")switch(o.$$typeof){case mB:return(o.displayName||"Context")+".Consumer";case _B:return(o._context.displayName||"Context")+".Provider";case KI:var c=o.render;return o=o.displayName,o||(o=c.displayName||c.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case YI:return c=o.displayName||null,c!==null?c:BC(o.type)||"Memo";case Ga:c=o._payload,o=o._init;try{return BC(o(c))}catch{}}return null}function Jee(o){var c=o.type;switch(o.tag){case 24:return"Cache";case 9:return(c.displayName||"Context")+".Consumer";case 10:return(c._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return o=c.render,o=o.displayName||o.name||"",c.displayName||(o!==""?"ForwardRef("+o+")":"ForwardRef");case 7:return"Fragment";case 5:return c;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return BC(c);case 8:return c===HI?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof c=="function")return c.displayName||c.name||null;if(typeof c=="string")return c}return null}function oc(o){switch(typeof o){case"boolean":case"number":case"string":case"undefined":return o;case"object":return o;default:return""}}function gB(o){var c=o.type;return(o=o.nodeName)&&o.toLowerCase()==="input"&&(c==="checkbox"||c==="radio")}function Qee(o){var c=gB(o)?"checked":"value",u=Object.getOwnPropertyDescriptor(o.constructor.prototype,c),f=""+o[c];if(!o.hasOwnProperty(c)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var E=u.get,S=u.set;return Object.defineProperty(o,c,{configurable:!0,get:function(){return E.call(this)},set:function(C){f=""+C,S.call(this,C)}}),Object.defineProperty(o,c,{enumerable:u.enumerable}),{getValue:function(){return f},setValue:function(C){f=""+C},stopTracking:function(){o._valueTracker=null,delete o[c]}}}}function dE(o){o._valueTracker||(o._valueTracker=Qee(o))}function SB(o){if(!o)return!1;var c=o._valueTracker;if(!c)return!0;var u=c.getValue(),f="";return o&&(f=gB(o)?o.checked?"true":"false":o.value),o=f,o!==u?(c.setValue(o),!0):!1}function jE(o){if(o=o||(typeof document<"u"?document:void 0),typeof o>"u")return null;try{return o.activeElement||o.body}catch{return o.body}}function jC(o,c){var u=c.checked;return Bn({},c,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:u??o._wrapperState.initialChecked})}function RV(o,c){var u=c.defaultValue==null?"":c.defaultValue,f=c.checked!=null?c.checked:c.defaultChecked;u=oc(c.value!=null?c.value:u),o._wrapperState={initialChecked:f,initialValue:u,controlled:c.type==="checkbox"||c.type==="radio"?c.checked!=null:c.value!=null}}function TB(o,c){c=c.checked,c!=null&&WI(o,"checked",c,!1)}function GC(o,c){TB(o,c);var u=oc(c.value),f=c.type;if(u!=null)f==="number"?(u===0&&o.value===""||o.value!=u)&&(o.value=""+u):o.value!==""+u&&(o.value=""+u);else if(f==="submit"||f==="reset"){o.removeAttribute("value");return}c.hasOwnProperty("value")?WC(o,c.type,u):c.hasOwnProperty("defaultValue")&&WC(o,c.type,oc(c.defaultValue)),c.checked==null&&c.defaultChecked!=null&&(o.defaultChecked=!!c.defaultChecked)}function yV(o,c,u){if(c.hasOwnProperty("value")||c.hasOwnProperty("defaultValue")){var f=c.type;if(!(f!=="submit"&&f!=="reset"||c.value!==void 0&&c.value!==null))return;c=""+o._wrapperState.initialValue,u||c===o.value||(o.value=c),o.defaultValue=c}u=o.name,u!==""&&(o.name=""),o.defaultChecked=!!o._wrapperState.initialChecked,u!==""&&(o.name=u)}function WC(o,c,u){(c!=="number"||jE(o.ownerDocument)!==o)&&(u==null?o.defaultValue=""+o._wrapperState.initialValue:o.defaultValue!==""+u&&(o.defaultValue=""+u))}var mp=Array.isArray;function hu(o,c,u,f){if(o=o.options,c){c={};for(var E=0;E<u.length;E++)c["$"+u[E]]=!0;for(u=0;u<o.length;u++)E=c.hasOwnProperty("$"+o[u].value),o[u].selected!==E&&(o[u].selected=E),E&&f&&(o[u].defaultSelected=!0)}else{for(u=""+oc(u),c=null,E=0;E<o.length;E++){if(o[E].value===u){o[E].selected=!0,f&&(o[E].defaultSelected=!0);return}c!==null||o[E].disabled||(c=o[E])}c!==null&&(c.selected=!0)}}function HC(o,c){if(c.dangerouslySetInnerHTML!=null)throw Error(we(91));return Bn({},c,{value:void 0,defaultValue:void 0,children:""+o._wrapperState.initialValue})}function CV(o,c){var u=c.value;if(u==null){if(u=c.children,c=c.defaultValue,u!=null){if(c!=null)throw Error(we(92));if(mp(u)){if(1<u.length)throw Error(we(93));u=u[0]}c=u}c==null&&(c=""),u=c}o._wrapperState={initialValue:oc(u)}}function vB(o,c){var u=oc(c.value),f=oc(c.defaultValue);u!=null&&(u=""+u,u!==o.value&&(o.value=u),c.defaultValue==null&&o.defaultValue!==u&&(o.defaultValue=u)),f!=null&&(o.defaultValue=""+f)}function IV(o){var c=o.textContent;c===o._wrapperState.initialValue&&c!==""&&c!==null&&(o.value=c)}function RB(o){switch(o){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function KC(o,c){return o==null||o==="http://www.w3.org/1999/xhtml"?RB(c):o==="http://www.w3.org/2000/svg"&&c==="foreignObject"?"http://www.w3.org/1999/xhtml":o}var lE,yB=function(o){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(c,u,f,E){MSApp.execUnsafeLocalFunction(function(){return o(c,u,f,E)})}:o}(function(o,c){if(o.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in o)o.innerHTML=c;else{for(lE=lE||document.createElement("div"),lE.innerHTML="<svg>"+c.valueOf().toString()+"</svg>",c=lE.firstChild;o.firstChild;)o.removeChild(o.firstChild);for(;c.firstChild;)o.appendChild(c.firstChild)}});function Np(o,c){if(c){var u=o.firstChild;if(u&&u===o.lastChild&&u.nodeType===3){u.nodeValue=c;return}}o.textContent=c}var Tp={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Zee=["Webkit","ms","Moz","O"];Object.keys(Tp).forEach(function(o){Zee.forEach(function(c){c=c+o.charAt(0).toUpperCase()+o.substring(1),Tp[c]=Tp[o]})});function CB(o,c,u){return c==null||typeof c=="boolean"||c===""?"":u||typeof c!="number"||c===0||Tp.hasOwnProperty(o)&&Tp[o]?(""+c).trim():c+"px"}function IB(o,c){o=o.style;for(var u in c)if(c.hasOwnProperty(u)){var f=u.indexOf("--")===0,E=CB(u,c[u],f);u==="float"&&(u="cssFloat"),f?o.setProperty(u,E):o[u]=E}}var $ee=Bn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function YC(o,c){if(c){if($ee[o]&&(c.children!=null||c.dangerouslySetInnerHTML!=null))throw Error(we(137,o));if(c.dangerouslySetInnerHTML!=null){if(c.children!=null)throw Error(we(60));if(typeof c.dangerouslySetInnerHTML!="object"||!("__html"in c.dangerouslySetInnerHTML))throw Error(we(61))}if(c.style!=null&&typeof c.style!="object")throw Error(we(62))}}function zC(o,c){if(o.indexOf("-")===-1)return typeof c.is=="string";switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var qC=null;function zI(o){return o=o.target||o.srcElement||window,o.correspondingUseElement&&(o=o.correspondingUseElement),o.nodeType===3?o.parentNode:o}var XC=null,pu=null,fu=null;function wV(o){if(o=Qp(o)){if(typeof XC!="function")throw Error(we(280));var c=o.stateNode;c&&(c=gg(c),XC(o.stateNode,o.type,c))}}function wB(o){pu?fu?fu.push(o):fu=[o]:pu=o}function AB(){if(pu){var o=pu,c=fu;if(fu=pu=null,wV(o),c)for(o=0;o<c.length;o++)wV(c[o])}}function bB(o,c){return o(c)}function OB(){}var dC=!1;function NB(o,c,u){if(dC)return o(c,u);dC=!0;try{return bB(o,c,u)}finally{dC=!1,(pu!==null||fu!==null)&&(OB(),AB())}}function Dp(o,c){var u=o.stateNode;if(u===null)return null;var f=gg(u);if(f===null)return null;u=f[c];e:switch(c){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(o=o.type,f=!(o==="button"||o==="input"||o==="select"||o==="textarea")),o=!f;break e;default:o=!1}if(o)return null;if(u&&typeof u!="function")throw Error(we(231,c,typeof u));return u}var JC=!1;if($s)try{var ap={};Object.defineProperty(ap,"passive",{get:function(){JC=!0}}),window.addEventListener("test",ap,ap),window.removeEventListener("test",ap,ap)}catch{JC=!1}function ete(o,c,u,f,E,S,C,D,k){var V=Array.prototype.slice.call(arguments,3);try{c.apply(u,V)}catch(G){this.onError(G)}}var vp=!1,GE=null,WE=!1,QC=null,tte={onError:function(o){vp=!0,GE=o}};function nte(o,c,u,f,E,S,C,D,k){vp=!1,GE=null,ete.apply(tte,arguments)}function rte(o,c,u,f,E,S,C,D,k){if(nte.apply(this,arguments),vp){if(vp){var V=GE;vp=!1,GE=null}else throw Error(we(198));WE||(WE=!0,QC=V)}}function Cd(o){var c=o,u=o;if(o.alternate)for(;c.return;)c=c.return;else{o=c;do c=o,c.flags&4098&&(u=c.return),o=c.return;while(o)}return c.tag===3?u:null}function DB(o){if(o.tag===13){var c=o.memoizedState;if(c===null&&(o=o.alternate,o!==null&&(c=o.memoizedState)),c!==null)return c.dehydrated}return null}function AV(o){if(Cd(o)!==o)throw Error(we(188))}function ite(o){var c=o.alternate;if(!c){if(c=Cd(o),c===null)throw Error(we(188));return c!==o?null:o}for(var u=o,f=c;;){var E=u.return;if(E===null)break;var S=E.alternate;if(S===null){if(f=E.return,f!==null){u=f;continue}break}if(E.child===S.child){for(S=E.child;S;){if(S===u)return AV(E),o;if(S===f)return AV(E),c;S=S.sibling}throw Error(we(188))}if(u.return!==f.return)u=E,f=S;else{for(var C=!1,D=E.child;D;){if(D===u){C=!0,u=E,f=S;break}if(D===f){C=!0,f=E,u=S;break}D=D.sibling}if(!C){for(D=S.child;D;){if(D===u){C=!0,u=S,f=E;break}if(D===f){C=!0,f=S,u=E;break}D=D.sibling}if(!C)throw Error(we(189))}}if(u.alternate!==f)throw Error(we(190))}if(u.tag!==3)throw Error(we(188));return u.stateNode.current===u?o:c}function PB(o){return o=ite(o),o!==null?LB(o):null}function LB(o){if(o.tag===5||o.tag===6)return o;for(o=o.child;o!==null;){var c=LB(o);if(c!==null)return c;o=o.sibling}return null}var kB=Hi.unstable_scheduleCallback,bV=Hi.unstable_cancelCallback,ote=Hi.unstable_shouldYield,ste=Hi.unstable_requestPaint,Jn=Hi.unstable_now,ate=Hi.unstable_getCurrentPriorityLevel,qI=Hi.unstable_ImmediatePriority,MB=Hi.unstable_UserBlockingPriority,HE=Hi.unstable_NormalPriority,cte=Hi.unstable_LowPriority,UB=Hi.unstable_IdlePriority,fg=null,Os=null;function dte(o){if(Os&&typeof Os.onCommitFiberRoot=="function")try{Os.onCommitFiberRoot(fg,o,void 0,(o.current.flags&128)===128)}catch{}}var Qo=Math.clz32?Math.clz32:hte,lte=Math.log,ute=Math.LN2;function hte(o){return o>>>=0,o===0?32:31-(lte(o)/ute|0)|0}var uE=64,hE=4194304;function Ep(o){switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return o&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return o}}function KE(o,c){var u=o.pendingLanes;if(u===0)return 0;var f=0,E=o.suspendedLanes,S=o.pingedLanes,C=u&268435455;if(C!==0){var D=C&~E;D!==0?f=Ep(D):(S&=C,S!==0&&(f=Ep(S)))}else C=u&~E,C!==0?f=Ep(C):S!==0&&(f=Ep(S));if(f===0)return 0;if(c!==0&&c!==f&&!(c&E)&&(E=f&-f,S=c&-c,E>=S||E===16&&(S&4194240)!==0))return c;if(f&4&&(f|=u&16),c=o.entangledLanes,c!==0)for(o=o.entanglements,c&=f;0<c;)u=31-Qo(c),E=1<<u,f|=o[u],c&=~E;return f}function pte(o,c){switch(o){case 1:case 2:case 4:return c+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function fte(o,c){for(var u=o.suspendedLanes,f=o.pingedLanes,E=o.expirationTimes,S=o.pendingLanes;0<S;){var C=31-Qo(S),D=1<<C,k=E[C];k===-1?(!(D&u)||D&f)&&(E[C]=pte(D,c)):k<=c&&(o.expiredLanes|=D),S&=~D}}function ZC(o){return o=o.pendingLanes&-1073741825,o!==0?o:o&1073741824?1073741824:0}function xB(){var o=uE;return uE<<=1,!(uE&4194240)&&(uE=64),o}function lC(o){for(var c=[],u=0;31>u;u++)c.push(o);return c}function Xp(o,c,u){o.pendingLanes|=c,c!==536870912&&(o.suspendedLanes=0,o.pingedLanes=0),o=o.eventTimes,c=31-Qo(c),o[c]=u}function _te(o,c){var u=o.pendingLanes&~c;o.pendingLanes=c,o.suspendedLanes=0,o.pingedLanes=0,o.expiredLanes&=c,o.mutableReadLanes&=c,o.entangledLanes&=c,c=o.entanglements;var f=o.eventTimes;for(o=o.expirationTimes;0<u;){var E=31-Qo(u),S=1<<E;c[E]=0,f[E]=-1,o[E]=-1,u&=~S}}function XI(o,c){var u=o.entangledLanes|=c;for(o=o.entanglements;u;){var f=31-Qo(u),E=1<<f;E&c|o[f]&c&&(o[f]|=c),u&=~E}}var sn=0;function VB(o){return o&=-o,1<o?4<o?o&268435455?16:536870912:4:1}var FB,JI,BB,jB,GB,$C=!1,pE=[],Xa=null,Ja=null,Qa=null,Pp=new Map,Lp=new Map,Ha=[],mte="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function OV(o,c){switch(o){case"focusin":case"focusout":Xa=null;break;case"dragenter":case"dragleave":Ja=null;break;case"mouseover":case"mouseout":Qa=null;break;case"pointerover":case"pointerout":Pp.delete(c.pointerId);break;case"gotpointercapture":case"lostpointercapture":Lp.delete(c.pointerId)}}function cp(o,c,u,f,E,S){return o===null||o.nativeEvent!==S?(o={blockedOn:c,domEventName:u,eventSystemFlags:f,nativeEvent:S,targetContainers:[E]},c!==null&&(c=Qp(c),c!==null&&JI(c)),o):(o.eventSystemFlags|=f,c=o.targetContainers,E!==null&&c.indexOf(E)===-1&&c.push(E),o)}function Ete(o,c,u,f,E){switch(c){case"focusin":return Xa=cp(Xa,o,c,u,f,E),!0;case"dragenter":return Ja=cp(Ja,o,c,u,f,E),!0;case"mouseover":return Qa=cp(Qa,o,c,u,f,E),!0;case"pointerover":var S=E.pointerId;return Pp.set(S,cp(Pp.get(S)||null,o,c,u,f,E)),!0;case"gotpointercapture":return S=E.pointerId,Lp.set(S,cp(Lp.get(S)||null,o,c,u,f,E)),!0}return!1}function WB(o){var c=ld(o.target);if(c!==null){var u=Cd(c);if(u!==null){if(c=u.tag,c===13){if(c=DB(u),c!==null){o.blockedOn=c,GB(o.priority,function(){BB(u)});return}}else if(c===3&&u.stateNode.current.memoizedState.isDehydrated){o.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}o.blockedOn=null}function AE(o){if(o.blockedOn!==null)return!1;for(var c=o.targetContainers;0<c.length;){var u=eI(o.domEventName,o.eventSystemFlags,c[0],o.nativeEvent);if(u===null){u=o.nativeEvent;var f=new u.constructor(u.type,u);qC=f,u.target.dispatchEvent(f),qC=null}else return c=Qp(u),c!==null&&JI(c),o.blockedOn=u,!1;c.shift()}return!0}function NV(o,c,u){AE(o)&&u.delete(c)}function gte(){$C=!1,Xa!==null&&AE(Xa)&&(Xa=null),Ja!==null&&AE(Ja)&&(Ja=null),Qa!==null&&AE(Qa)&&(Qa=null),Pp.forEach(NV),Lp.forEach(NV)}function dp(o,c){o.blockedOn===c&&(o.blockedOn=null,$C||($C=!0,Hi.unstable_scheduleCallback(Hi.unstable_NormalPriority,gte)))}function kp(o){function c(E){return dp(E,o)}if(0<pE.length){dp(pE[0],o);for(var u=1;u<pE.length;u++){var f=pE[u];f.blockedOn===o&&(f.blockedOn=null)}}for(Xa!==null&&dp(Xa,o),Ja!==null&&dp(Ja,o),Qa!==null&&dp(Qa,o),Pp.forEach(c),Lp.forEach(c),u=0;u<Ha.length;u++)f=Ha[u],f.blockedOn===o&&(f.blockedOn=null);for(;0<Ha.length&&(u=Ha[0],u.blockedOn===null);)WB(u),u.blockedOn===null&&Ha.shift()}var _u=ra.ReactCurrentBatchConfig,YE=!0;function Ste(o,c,u,f){var E=sn,S=_u.transition;_u.transition=null;try{sn=1,QI(o,c,u,f)}finally{sn=E,_u.transition=S}}function Tte(o,c,u,f){var E=sn,S=_u.transition;_u.transition=null;try{sn=4,QI(o,c,u,f)}finally{sn=E,_u.transition=S}}function QI(o,c,u,f){if(YE){var E=eI(o,c,u,f);if(E===null)TC(o,c,f,zE,u),OV(o,f);else if(Ete(E,o,c,u,f))f.stopPropagation();else if(OV(o,f),c&4&&-1<mte.indexOf(o)){for(;E!==null;){var S=Qp(E);if(S!==null&&FB(S),S=eI(o,c,u,f),S===null&&TC(o,c,f,zE,u),S===E)break;E=S}E!==null&&f.stopPropagation()}else TC(o,c,f,null,u)}}var zE=null;function eI(o,c,u,f){if(zE=null,o=zI(f),o=ld(o),o!==null)if(c=Cd(o),c===null)o=null;else if(u=c.tag,u===13){if(o=DB(c),o!==null)return o;o=null}else if(u===3){if(c.stateNode.current.memoizedState.isDehydrated)return c.tag===3?c.stateNode.containerInfo:null;o=null}else c!==o&&(o=null);return zE=o,null}function HB(o){switch(o){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ate()){case qI:return 1;case MB:return 4;case HE:case cte:return 16;case UB:return 536870912;default:return 16}default:return 16}}var Ya=null,ZI=null,bE=null;function KB(){if(bE)return bE;var o,c=ZI,u=c.length,f,E="value"in Ya?Ya.value:Ya.textContent,S=E.length;for(o=0;o<u&&c[o]===E[o];o++);var C=u-o;for(f=1;f<=C&&c[u-f]===E[S-f];f++);return bE=E.slice(o,1<f?1-f:void 0)}function OE(o){var c=o.keyCode;return"charCode"in o?(o=o.charCode,o===0&&c===13&&(o=13)):o=c,o===10&&(o=13),32<=o||o===13?o:0}function fE(){return!0}function DV(){return!1}function Yi(o){function c(u,f,E,S,C){this._reactName=u,this._targetInst=E,this.type=f,this.nativeEvent=S,this.target=C,this.currentTarget=null;for(var D in o)o.hasOwnProperty(D)&&(u=o[D],this[D]=u?u(S):S[D]);return this.isDefaultPrevented=(S.defaultPrevented!=null?S.defaultPrevented:S.returnValue===!1)?fE:DV,this.isPropagationStopped=DV,this}return Bn(c.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=fE)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=fE)},persist:function(){},isPersistent:fE}),c}var Au={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(o){return o.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},$I=Yi(Au),Jp=Bn({},Au,{view:0,detail:0}),vte=Yi(Jp),uC,hC,lp,_g=Bn({},Jp,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ew,button:0,buttons:0,relatedTarget:function(o){return o.relatedTarget===void 0?o.fromElement===o.srcElement?o.toElement:o.fromElement:o.relatedTarget},movementX:function(o){return"movementX"in o?o.movementX:(o!==lp&&(lp&&o.type==="mousemove"?(uC=o.screenX-lp.screenX,hC=o.screenY-lp.screenY):hC=uC=0,lp=o),uC)},movementY:function(o){return"movementY"in o?o.movementY:hC}}),PV=Yi(_g),Rte=Bn({},_g,{dataTransfer:0}),yte=Yi(Rte),Cte=Bn({},Jp,{relatedTarget:0}),pC=Yi(Cte),Ite=Bn({},Au,{animationName:0,elapsedTime:0,pseudoElement:0}),wte=Yi(Ite),Ate=Bn({},Au,{clipboardData:function(o){return"clipboardData"in o?o.clipboardData:window.clipboardData}}),bte=Yi(Ate),Ote=Bn({},Au,{data:0}),LV=Yi(Ote),Nte={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Dte={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Pte={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Lte(o){var c=this.nativeEvent;return c.getModifierState?c.getModifierState(o):(o=Pte[o])?!!c[o]:!1}function ew(){return Lte}var kte=Bn({},Jp,{key:function(o){if(o.key){var c=Nte[o.key]||o.key;if(c!=="Unidentified")return c}return o.type==="keypress"?(o=OE(o),o===13?"Enter":String.fromCharCode(o)):o.type==="keydown"||o.type==="keyup"?Dte[o.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ew,charCode:function(o){return o.type==="keypress"?OE(o):0},keyCode:function(o){return o.type==="keydown"||o.type==="keyup"?o.keyCode:0},which:function(o){return o.type==="keypress"?OE(o):o.type==="keydown"||o.type==="keyup"?o.keyCode:0}}),Mte=Yi(kte),Ute=Bn({},_g,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),kV=Yi(Ute),xte=Bn({},Jp,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ew}),Vte=Yi(xte),Fte=Bn({},Au,{propertyName:0,elapsedTime:0,pseudoElement:0}),Bte=Yi(Fte),jte=Bn({},_g,{deltaX:function(o){return"deltaX"in o?o.deltaX:"wheelDeltaX"in o?-o.wheelDeltaX:0},deltaY:function(o){return"deltaY"in o?o.deltaY:"wheelDeltaY"in o?-o.wheelDeltaY:"wheelDelta"in o?-o.wheelDelta:0},deltaZ:0,deltaMode:0}),Gte=Yi(jte),Wte=[9,13,27,32],tw=$s&&"CompositionEvent"in window,Rp=null;$s&&"documentMode"in document&&(Rp=document.documentMode);var Hte=$s&&"TextEvent"in window&&!Rp,YB=$s&&(!tw||Rp&&8<Rp&&11>=Rp),MV=" ",UV=!1;function zB(o,c){switch(o){case"keyup":return Wte.indexOf(c.keyCode)!==-1;case"keydown":return c.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function qB(o){return o=o.detail,typeof o=="object"&&"data"in o?o.data:null}var nu=!1;function Kte(o,c){switch(o){case"compositionend":return qB(c);case"keypress":return c.which!==32?null:(UV=!0,MV);case"textInput":return o=c.data,o===MV&&UV?null:o;default:return null}}function Yte(o,c){if(nu)return o==="compositionend"||!tw&&zB(o,c)?(o=KB(),bE=ZI=Ya=null,nu=!1,o):null;switch(o){case"paste":return null;case"keypress":if(!(c.ctrlKey||c.altKey||c.metaKey)||c.ctrlKey&&c.altKey){if(c.char&&1<c.char.length)return c.char;if(c.which)return String.fromCharCode(c.which)}return null;case"compositionend":return YB&&c.locale!=="ko"?null:c.data;default:return null}}var zte={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function xV(o){var c=o&&o.nodeName&&o.nodeName.toLowerCase();return c==="input"?!!zte[o.type]:c==="textarea"}function XB(o,c,u,f){wB(f),c=qE(c,"onChange"),0<c.length&&(u=new $I("onChange","change",null,u,f),o.push({event:u,listeners:c}))}var yp=null,Mp=null;function qte(o){sj(o,0)}function mg(o){var c=ou(o);if(SB(c))return o}function Xte(o,c){if(o==="change")return c}var JB=!1;if($s){var fC;if($s){var _C="oninput"in document;if(!_C){var VV=document.createElement("div");VV.setAttribute("oninput","return;"),_C=typeof VV.oninput=="function"}fC=_C}else fC=!1;JB=fC&&(!document.documentMode||9<document.documentMode)}function FV(){yp&&(yp.detachEvent("onpropertychange",QB),Mp=yp=null)}function QB(o){if(o.propertyName==="value"&&mg(Mp)){var c=[];XB(c,Mp,o,zI(o)),NB(qte,c)}}function Jte(o,c,u){o==="focusin"?(FV(),yp=c,Mp=u,yp.attachEvent("onpropertychange",QB)):o==="focusout"&&FV()}function Qte(o){if(o==="selectionchange"||o==="keyup"||o==="keydown")return mg(Mp)}function Zte(o,c){if(o==="click")return mg(c)}function $te(o,c){if(o==="input"||o==="change")return mg(c)}function ene(o,c){return o===c&&(o!==0||1/o===1/c)||o!==o&&c!==c}var $o=typeof Object.is=="function"?Object.is:ene;function Up(o,c){if($o(o,c))return!0;if(typeof o!="object"||o===null||typeof c!="object"||c===null)return!1;var u=Object.keys(o),f=Object.keys(c);if(u.length!==f.length)return!1;for(f=0;f<u.length;f++){var E=u[f];if(!UC.call(c,E)||!$o(o[E],c[E]))return!1}return!0}function BV(o){for(;o&&o.firstChild;)o=o.firstChild;return o}function jV(o,c){var u=BV(o);o=0;for(var f;u;){if(u.nodeType===3){if(f=o+u.textContent.length,o<=c&&f>=c)return{node:u,offset:c-o};o=f}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=BV(u)}}function ZB(o,c){return o&&c?o===c?!0:o&&o.nodeType===3?!1:c&&c.nodeType===3?ZB(o,c.parentNode):"contains"in o?o.contains(c):o.compareDocumentPosition?!!(o.compareDocumentPosition(c)&16):!1:!1}function $B(){for(var o=window,c=jE();c instanceof o.HTMLIFrameElement;){try{var u=typeof c.contentWindow.location.href=="string"}catch{u=!1}if(u)o=c.contentWindow;else break;c=jE(o.document)}return c}function nw(o){var c=o&&o.nodeName&&o.nodeName.toLowerCase();return c&&(c==="input"&&(o.type==="text"||o.type==="search"||o.type==="tel"||o.type==="url"||o.type==="password")||c==="textarea"||o.contentEditable==="true")}function tne(o){var c=$B(),u=o.focusedElem,f=o.selectionRange;if(c!==u&&u&&u.ownerDocument&&ZB(u.ownerDocument.documentElement,u)){if(f!==null&&nw(u)){if(c=f.start,o=f.end,o===void 0&&(o=c),"selectionStart"in u)u.selectionStart=c,u.selectionEnd=Math.min(o,u.value.length);else if(o=(c=u.ownerDocument||document)&&c.defaultView||window,o.getSelection){o=o.getSelection();var E=u.textContent.length,S=Math.min(f.start,E);f=f.end===void 0?S:Math.min(f.end,E),!o.extend&&S>f&&(E=f,f=S,S=E),E=jV(u,S);var C=jV(u,f);E&&C&&(o.rangeCount!==1||o.anchorNode!==E.node||o.anchorOffset!==E.offset||o.focusNode!==C.node||o.focusOffset!==C.offset)&&(c=c.createRange(),c.setStart(E.node,E.offset),o.removeAllRanges(),S>f?(o.addRange(c),o.extend(C.node,C.offset)):(c.setEnd(C.node,C.offset),o.addRange(c)))}}for(c=[],o=u;o=o.parentNode;)o.nodeType===1&&c.push({element:o,left:o.scrollLeft,top:o.scrollTop});for(typeof u.focus=="function"&&u.focus(),u=0;u<c.length;u++)o=c[u],o.element.scrollLeft=o.left,o.element.scrollTop=o.top}}var nne=$s&&"documentMode"in document&&11>=document.documentMode,ru=null,tI=null,Cp=null,nI=!1;function GV(o,c,u){var f=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;nI||ru==null||ru!==jE(f)||(f=ru,"selectionStart"in f&&nw(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),Cp&&Up(Cp,f)||(Cp=f,f=qE(tI,"onSelect"),0<f.length&&(c=new $I("onSelect","select",null,c,u),o.push({event:c,listeners:f}),c.target=ru)))}function _E(o,c){var u={};return u[o.toLowerCase()]=c.toLowerCase(),u["Webkit"+o]="webkit"+c,u["Moz"+o]="moz"+c,u}var iu={animationend:_E("Animation","AnimationEnd"),animationiteration:_E("Animation","AnimationIteration"),animationstart:_E("Animation","AnimationStart"),transitionend:_E("Transition","TransitionEnd")},mC={},ej={};$s&&(ej=document.createElement("div").style,"AnimationEvent"in window||(delete iu.animationend.animation,delete iu.animationiteration.animation,delete iu.animationstart.animation),"TransitionEvent"in window||delete iu.transitionend.transition);function Eg(o){if(mC[o])return mC[o];if(!iu[o])return o;var c=iu[o],u;for(u in c)if(c.hasOwnProperty(u)&&u in ej)return mC[o]=c[u];return o}var tj=Eg("animationend"),nj=Eg("animationiteration"),rj=Eg("animationstart"),ij=Eg("transitionend"),oj=new Map,WV="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ac(o,c){oj.set(o,c),yd(c,[o])}for(var EC=0;EC<WV.length;EC++){var gC=WV[EC],rne=gC.toLowerCase(),ine=gC[0].toUpperCase()+gC.slice(1);ac(rne,"on"+ine)}ac(tj,"onAnimationEnd");ac(nj,"onAnimationIteration");ac(rj,"onAnimationStart");ac("dblclick","onDoubleClick");ac("focusin","onFocus");ac("focusout","onBlur");ac(ij,"onTransitionEnd");gu("onMouseEnter",["mouseout","mouseover"]);gu("onMouseLeave",["mouseout","mouseover"]);gu("onPointerEnter",["pointerout","pointerover"]);gu("onPointerLeave",["pointerout","pointerover"]);yd("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));yd("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));yd("onBeforeInput",["compositionend","keypress","textInput","paste"]);yd("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));yd("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));yd("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var gp="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),one=new Set("cancel close invalid load scroll toggle".split(" ").concat(gp));function HV(o,c,u){var f=o.type||"unknown-event";o.currentTarget=u,rte(f,c,void 0,o),o.currentTarget=null}function sj(o,c){c=(c&4)!==0;for(var u=0;u<o.length;u++){var f=o[u],E=f.event;f=f.listeners;e:{var S=void 0;if(c)for(var C=f.length-1;0<=C;C--){var D=f[C],k=D.instance,V=D.currentTarget;if(D=D.listener,k!==S&&E.isPropagationStopped())break e;HV(E,D,V),S=k}else for(C=0;C<f.length;C++){if(D=f[C],k=D.instance,V=D.currentTarget,D=D.listener,k!==S&&E.isPropagationStopped())break e;HV(E,D,V),S=k}}}if(WE)throw o=QC,WE=!1,QC=null,o}function In(o,c){var u=c[aI];u===void 0&&(u=c[aI]=new Set);var f=o+"__bubble";u.has(f)||(aj(c,o,2,!1),u.add(f))}function SC(o,c,u){var f=0;c&&(f|=4),aj(u,o,f,c)}var mE="_reactListening"+Math.random().toString(36).slice(2);function xp(o){if(!o[mE]){o[mE]=!0,fB.forEach(function(u){u!=="selectionchange"&&(one.has(u)||SC(u,!1,o),SC(u,!0,o))});var c=o.nodeType===9?o:o.ownerDocument;c===null||c[mE]||(c[mE]=!0,SC("selectionchange",!1,c))}}function aj(o,c,u,f){switch(HB(c)){case 1:var E=Ste;break;case 4:E=Tte;break;default:E=QI}u=E.bind(null,c,u,o),E=void 0,!JC||c!=="touchstart"&&c!=="touchmove"&&c!=="wheel"||(E=!0),f?E!==void 0?o.addEventListener(c,u,{capture:!0,passive:E}):o.addEventListener(c,u,!0):E!==void 0?o.addEventListener(c,u,{passive:E}):o.addEventListener(c,u,!1)}function TC(o,c,u,f,E){var S=f;if(!(c&1)&&!(c&2)&&f!==null)e:for(;;){if(f===null)return;var C=f.tag;if(C===3||C===4){var D=f.stateNode.containerInfo;if(D===E||D.nodeType===8&&D.parentNode===E)break;if(C===4)for(C=f.return;C!==null;){var k=C.tag;if((k===3||k===4)&&(k=C.stateNode.containerInfo,k===E||k.nodeType===8&&k.parentNode===E))return;C=C.return}for(;D!==null;){if(C=ld(D),C===null)return;if(k=C.tag,k===5||k===6){f=S=C;continue e}D=D.parentNode}}f=f.return}NB(function(){var V=S,G=zI(u),W=[];e:{var Q=oj.get(o);if(Q!==void 0){var me=$I,z=o;switch(o){case"keypress":if(OE(u)===0)break e;case"keydown":case"keyup":me=Mte;break;case"focusin":z="focus",me=pC;break;case"focusout":z="blur",me=pC;break;case"beforeblur":case"afterblur":me=pC;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":me=PV;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":me=yte;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":me=Vte;break;case tj:case nj:case rj:me=wte;break;case ij:me=Bte;break;case"scroll":me=vte;break;case"wheel":me=Gte;break;case"copy":case"cut":case"paste":me=bte;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":me=kV}var de=(c&4)!==0,he=!de&&o==="scroll",q=de?Q!==null?Q+"Capture":null:Q;de=[];for(var K=V,X;K!==null;){X=K;var Ee=X.stateNode;if(X.tag===5&&Ee!==null&&(X=Ee,q!==null&&(Ee=Dp(K,q),Ee!=null&&de.push(Vp(K,Ee,X)))),he)break;K=K.return}0<de.length&&(Q=new me(Q,z,null,u,G),W.push({event:Q,listeners:de}))}}if(!(c&7)){e:{if(Q=o==="mouseover"||o==="pointerover",me=o==="mouseout"||o==="pointerout",Q&&u!==qC&&(z=u.relatedTarget||u.fromElement)&&(ld(z)||z[ea]))break e;if((me||Q)&&(Q=G.window===G?G:(Q=G.ownerDocument)?Q.defaultView||Q.parentWindow:window,me?(z=u.relatedTarget||u.toElement,me=V,z=z?ld(z):null,z!==null&&(he=Cd(z),z!==he||z.tag!==5&&z.tag!==6)&&(z=null)):(me=null,z=V),me!==z)){if(de=PV,Ee="onMouseLeave",q="onMouseEnter",K="mouse",(o==="pointerout"||o==="pointerover")&&(de=kV,Ee="onPointerLeave",q="onPointerEnter",K="pointer"),he=me==null?Q:ou(me),X=z==null?Q:ou(z),Q=new de(Ee,K+"leave",me,u,G),Q.target=he,Q.relatedTarget=X,Ee=null,ld(G)===V&&(de=new de(q,K+"enter",z,u,G),de.target=X,de.relatedTarget=he,Ee=de),he=Ee,me&&z)t:{for(de=me,q=z,K=0,X=de;X;X=Jl(X))K++;for(X=0,Ee=q;Ee;Ee=Jl(Ee))X++;for(;0<K-X;)de=Jl(de),K--;for(;0<X-K;)q=Jl(q),X--;for(;K--;){if(de===q||q!==null&&de===q.alternate)break t;de=Jl(de),q=Jl(q)}de=null}else de=null;me!==null&&KV(W,Q,me,de,!1),z!==null&&he!==null&&KV(W,he,z,de,!0)}}e:{if(Q=V?ou(V):window,me=Q.nodeName&&Q.nodeName.toLowerCase(),me==="select"||me==="input"&&Q.type==="file")var Oe=Xte;else if(xV(Q))if(JB)Oe=$te;else{Oe=Qte;var We=Jte}else(me=Q.nodeName)&&me.toLowerCase()==="input"&&(Q.type==="checkbox"||Q.type==="radio")&&(Oe=Zte);if(Oe&&(Oe=Oe(o,V))){XB(W,Oe,u,G);break e}We&&We(o,Q,V),o==="focusout"&&(We=Q._wrapperState)&&We.controlled&&Q.type==="number"&&WC(Q,"number",Q.value)}switch(We=V?ou(V):window,o){case"focusin":(xV(We)||We.contentEditable==="true")&&(ru=We,tI=V,Cp=null);break;case"focusout":Cp=tI=ru=null;break;case"mousedown":nI=!0;break;case"contextmenu":case"mouseup":case"dragend":nI=!1,GV(W,u,G);break;case"selectionchange":if(nne)break;case"keydown":case"keyup":GV(W,u,G)}var De;if(tw)e:{switch(o){case"compositionstart":var ze="onCompositionStart";break e;case"compositionend":ze="onCompositionEnd";break e;case"compositionupdate":ze="onCompositionUpdate";break e}ze=void 0}else nu?zB(o,u)&&(ze="onCompositionEnd"):o==="keydown"&&u.keyCode===229&&(ze="onCompositionStart");ze&&(YB&&u.locale!=="ko"&&(nu||ze!=="onCompositionStart"?ze==="onCompositionEnd"&&nu&&(De=KB()):(Ya=G,ZI="value"in Ya?Ya.value:Ya.textContent,nu=!0)),We=qE(V,ze),0<We.length&&(ze=new LV(ze,o,null,u,G),W.push({event:ze,listeners:We}),De?ze.data=De:(De=qB(u),De!==null&&(ze.data=De)))),(De=Hte?Kte(o,u):Yte(o,u))&&(V=qE(V,"onBeforeInput"),0<V.length&&(G=new LV("onBeforeInput","beforeinput",null,u,G),W.push({event:G,listeners:V}),G.data=De))}sj(W,c)})}function Vp(o,c,u){return{instance:o,listener:c,currentTarget:u}}function qE(o,c){for(var u=c+"Capture",f=[];o!==null;){var E=o,S=E.stateNode;E.tag===5&&S!==null&&(E=S,S=Dp(o,u),S!=null&&f.unshift(Vp(o,S,E)),S=Dp(o,c),S!=null&&f.push(Vp(o,S,E))),o=o.return}return f}function Jl(o){if(o===null)return null;do o=o.return;while(o&&o.tag!==5);return o||null}function KV(o,c,u,f,E){for(var S=c._reactName,C=[];u!==null&&u!==f;){var D=u,k=D.alternate,V=D.stateNode;if(k!==null&&k===f)break;D.tag===5&&V!==null&&(D=V,E?(k=Dp(u,S),k!=null&&C.unshift(Vp(u,k,D))):E||(k=Dp(u,S),k!=null&&C.push(Vp(u,k,D)))),u=u.return}C.length!==0&&o.push({event:c,listeners:C})}var sne=/\r\n?/g,ane=/\u0000|\uFFFD/g;function YV(o){return(typeof o=="string"?o:""+o).replace(sne,`
`).replace(ane,"")}function EE(o,c,u){if(c=YV(c),YV(o)!==c&&u)throw Error(we(425))}function XE(){}var rI=null,iI=null;function oI(o,c){return o==="textarea"||o==="noscript"||typeof c.children=="string"||typeof c.children=="number"||typeof c.dangerouslySetInnerHTML=="object"&&c.dangerouslySetInnerHTML!==null&&c.dangerouslySetInnerHTML.__html!=null}var sI=typeof setTimeout=="function"?setTimeout:void 0,cne=typeof clearTimeout=="function"?clearTimeout:void 0,zV=typeof Promise=="function"?Promise:void 0,dne=typeof queueMicrotask=="function"?queueMicrotask:typeof zV<"u"?function(o){return zV.resolve(null).then(o).catch(lne)}:sI;function lne(o){setTimeout(function(){throw o})}function vC(o,c){var u=c,f=0;do{var E=u.nextSibling;if(o.removeChild(u),E&&E.nodeType===8)if(u=E.data,u==="/$"){if(f===0){o.removeChild(E),kp(c);return}f--}else u!=="$"&&u!=="$?"&&u!=="$!"||f++;u=E}while(u);kp(c)}function Za(o){for(;o!=null;o=o.nextSibling){var c=o.nodeType;if(c===1||c===3)break;if(c===8){if(c=o.data,c==="$"||c==="$!"||c==="$?")break;if(c==="/$")return null}}return o}function qV(o){o=o.previousSibling;for(var c=0;o;){if(o.nodeType===8){var u=o.data;if(u==="$"||u==="$!"||u==="$?"){if(c===0)return o;c--}else u==="/$"&&c++}o=o.previousSibling}return null}var bu=Math.random().toString(36).slice(2),bs="__reactFiber$"+bu,Fp="__reactProps$"+bu,ea="__reactContainer$"+bu,aI="__reactEvents$"+bu,une="__reactListeners$"+bu,hne="__reactHandles$"+bu;function ld(o){var c=o[bs];if(c)return c;for(var u=o.parentNode;u;){if(c=u[ea]||u[bs]){if(u=c.alternate,c.child!==null||u!==null&&u.child!==null)for(o=qV(o);o!==null;){if(u=o[bs])return u;o=qV(o)}return c}o=u,u=o.parentNode}return null}function Qp(o){return o=o[bs]||o[ea],!o||o.tag!==5&&o.tag!==6&&o.tag!==13&&o.tag!==3?null:o}function ou(o){if(o.tag===5||o.tag===6)return o.stateNode;throw Error(we(33))}function gg(o){return o[Fp]||null}var cI=[],su=-1;function cc(o){return{current:o}}function wn(o){0>su||(o.current=cI[su],cI[su]=null,su--)}function gn(o,c){su++,cI[su]=o.current,o.current=c}var sc={},Yr=cc(sc),Ri=cc(!1),Ed=sc;function Su(o,c){var u=o.type.contextTypes;if(!u)return sc;var f=o.stateNode;if(f&&f.__reactInternalMemoizedUnmaskedChildContext===c)return f.__reactInternalMemoizedMaskedChildContext;var E={},S;for(S in u)E[S]=c[S];return f&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=c,o.__reactInternalMemoizedMaskedChildContext=E),E}function yi(o){return o=o.childContextTypes,o!=null}function JE(){wn(Ri),wn(Yr)}function XV(o,c,u){if(Yr.current!==sc)throw Error(we(168));gn(Yr,c),gn(Ri,u)}function cj(o,c,u){var f=o.stateNode;if(c=c.childContextTypes,typeof f.getChildContext!="function")return u;f=f.getChildContext();for(var E in f)if(!(E in c))throw Error(we(108,Jee(o)||"Unknown",E));return Bn({},u,f)}function QE(o){return o=(o=o.stateNode)&&o.__reactInternalMemoizedMergedChildContext||sc,Ed=Yr.current,gn(Yr,o),gn(Ri,Ri.current),!0}function JV(o,c,u){var f=o.stateNode;if(!f)throw Error(we(169));u?(o=cj(o,c,Ed),f.__reactInternalMemoizedMergedChildContext=o,wn(Ri),wn(Yr),gn(Yr,o)):wn(Ri),gn(Ri,u)}var Xs=null,Sg=!1,RC=!1;function dj(o){Xs===null?Xs=[o]:Xs.push(o)}function pne(o){Sg=!0,dj(o)}function dc(){if(!RC&&Xs!==null){RC=!0;var o=0,c=sn;try{var u=Xs;for(sn=1;o<u.length;o++){var f=u[o];do f=f(!0);while(f!==null)}Xs=null,Sg=!1}catch(E){throw Xs!==null&&(Xs=Xs.slice(o+1)),kB(qI,dc),E}finally{sn=c,RC=!1}}return null}var au=[],cu=0,ZE=null,$E=0,mo=[],Eo=0,gd=null,Js=1,Qs="";function ad(o,c){au[cu++]=$E,au[cu++]=ZE,ZE=o,$E=c}function lj(o,c,u){mo[Eo++]=Js,mo[Eo++]=Qs,mo[Eo++]=gd,gd=o;var f=Js;o=Qs;var E=32-Qo(f)-1;f&=~(1<<E),u+=1;var S=32-Qo(c)+E;if(30<S){var C=E-E%5;S=(f&(1<<C)-1).toString(32),f>>=C,E-=C,Js=1<<32-Qo(c)+E|u<<E|f,Qs=S+o}else Js=1<<S|u<<E|f,Qs=o}function rw(o){o.return!==null&&(ad(o,1),lj(o,1,0))}function iw(o){for(;o===ZE;)ZE=au[--cu],au[cu]=null,$E=au[--cu],au[cu]=null;for(;o===gd;)gd=mo[--Eo],mo[Eo]=null,Qs=mo[--Eo],mo[Eo]=null,Js=mo[--Eo],mo[Eo]=null}var Wi=null,Gi=null,Ln=!1,Jo=null;function uj(o,c){var u=go(5,null,null,0);u.elementType="DELETED",u.stateNode=c,u.return=o,c=o.deletions,c===null?(o.deletions=[u],o.flags|=16):c.push(u)}function QV(o,c){switch(o.tag){case 5:var u=o.type;return c=c.nodeType!==1||u.toLowerCase()!==c.nodeName.toLowerCase()?null:c,c!==null?(o.stateNode=c,Wi=o,Gi=Za(c.firstChild),!0):!1;case 6:return c=o.pendingProps===""||c.nodeType!==3?null:c,c!==null?(o.stateNode=c,Wi=o,Gi=null,!0):!1;case 13:return c=c.nodeType!==8?null:c,c!==null?(u=gd!==null?{id:Js,overflow:Qs}:null,o.memoizedState={dehydrated:c,treeContext:u,retryLane:1073741824},u=go(18,null,null,0),u.stateNode=c,u.return=o,o.child=u,Wi=o,Gi=null,!0):!1;default:return!1}}function dI(o){return(o.mode&1)!==0&&(o.flags&128)===0}function lI(o){if(Ln){var c=Gi;if(c){var u=c;if(!QV(o,c)){if(dI(o))throw Error(we(418));c=Za(u.nextSibling);var f=Wi;c&&QV(o,c)?uj(f,u):(o.flags=o.flags&-4097|2,Ln=!1,Wi=o)}}else{if(dI(o))throw Error(we(418));o.flags=o.flags&-4097|2,Ln=!1,Wi=o}}}function ZV(o){for(o=o.return;o!==null&&o.tag!==5&&o.tag!==3&&o.tag!==13;)o=o.return;Wi=o}function gE(o){if(o!==Wi)return!1;if(!Ln)return ZV(o),Ln=!0,!1;var c;if((c=o.tag!==3)&&!(c=o.tag!==5)&&(c=o.type,c=c!=="head"&&c!=="body"&&!oI(o.type,o.memoizedProps)),c&&(c=Gi)){if(dI(o))throw hj(),Error(we(418));for(;c;)uj(o,c),c=Za(c.nextSibling)}if(ZV(o),o.tag===13){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(we(317));e:{for(o=o.nextSibling,c=0;o;){if(o.nodeType===8){var u=o.data;if(u==="/$"){if(c===0){Gi=Za(o.nextSibling);break e}c--}else u!=="$"&&u!=="$!"&&u!=="$?"||c++}o=o.nextSibling}Gi=null}}else Gi=Wi?Za(o.stateNode.nextSibling):null;return!0}function hj(){for(var o=Gi;o;)o=Za(o.nextSibling)}function Tu(){Gi=Wi=null,Ln=!1}function ow(o){Jo===null?Jo=[o]:Jo.push(o)}var fne=ra.ReactCurrentBatchConfig;function up(o,c,u){if(o=u.ref,o!==null&&typeof o!="function"&&typeof o!="object"){if(u._owner){if(u=u._owner,u){if(u.tag!==1)throw Error(we(309));var f=u.stateNode}if(!f)throw Error(we(147,o));var E=f,S=""+o;return c!==null&&c.ref!==null&&typeof c.ref=="function"&&c.ref._stringRef===S?c.ref:(c=function(C){var D=E.refs;C===null?delete D[S]:D[S]=C},c._stringRef=S,c)}if(typeof o!="string")throw Error(we(284));if(!u._owner)throw Error(we(290,o))}return o}function SE(o,c){throw o=Object.prototype.toString.call(c),Error(we(31,o==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":o))}function $V(o){var c=o._init;return c(o._payload)}function pj(o){function c(q,K){if(o){var X=q.deletions;X===null?(q.deletions=[K],q.flags|=16):X.push(K)}}function u(q,K){if(!o)return null;for(;K!==null;)c(q,K),K=K.sibling;return null}function f(q,K){for(q=new Map;K!==null;)K.key!==null?q.set(K.key,K):q.set(K.index,K),K=K.sibling;return q}function E(q,K){return q=nc(q,K),q.index=0,q.sibling=null,q}function S(q,K,X){return q.index=X,o?(X=q.alternate,X!==null?(X=X.index,X<K?(q.flags|=2,K):X):(q.flags|=2,K)):(q.flags|=1048576,K)}function C(q){return o&&q.alternate===null&&(q.flags|=2),q}function D(q,K,X,Ee){return K===null||K.tag!==6?(K=OC(X,q.mode,Ee),K.return=q,K):(K=E(K,X),K.return=q,K)}function k(q,K,X,Ee){var Oe=X.type;return Oe===tu?G(q,K,X.props.children,Ee,X.key):K!==null&&(K.elementType===Oe||typeof Oe=="object"&&Oe!==null&&Oe.$$typeof===Ga&&$V(Oe)===K.type)?(Ee=E(K,X.props),Ee.ref=up(q,K,X),Ee.return=q,Ee):(Ee=UE(X.type,X.key,X.props,null,q.mode,Ee),Ee.ref=up(q,K,X),Ee.return=q,Ee)}function V(q,K,X,Ee){return K===null||K.tag!==4||K.stateNode.containerInfo!==X.containerInfo||K.stateNode.implementation!==X.implementation?(K=NC(X,q.mode,Ee),K.return=q,K):(K=E(K,X.children||[]),K.return=q,K)}function G(q,K,X,Ee,Oe){return K===null||K.tag!==7?(K=_d(X,q.mode,Ee,Oe),K.return=q,K):(K=E(K,X),K.return=q,K)}function W(q,K,X){if(typeof K=="string"&&K!==""||typeof K=="number")return K=OC(""+K,q.mode,X),K.return=q,K;if(typeof K=="object"&&K!==null){switch(K.$$typeof){case cE:return X=UE(K.type,K.key,K.props,null,q.mode,X),X.ref=up(q,null,K),X.return=q,X;case eu:return K=NC(K,q.mode,X),K.return=q,K;case Ga:var Ee=K._init;return W(q,Ee(K._payload),X)}if(mp(K)||sp(K))return K=_d(K,q.mode,X,null),K.return=q,K;SE(q,K)}return null}function Q(q,K,X,Ee){var Oe=K!==null?K.key:null;if(typeof X=="string"&&X!==""||typeof X=="number")return Oe!==null?null:D(q,K,""+X,Ee);if(typeof X=="object"&&X!==null){switch(X.$$typeof){case cE:return X.key===Oe?k(q,K,X,Ee):null;case eu:return X.key===Oe?V(q,K,X,Ee):null;case Ga:return Oe=X._init,Q(q,K,Oe(X._payload),Ee)}if(mp(X)||sp(X))return Oe!==null?null:G(q,K,X,Ee,null);SE(q,X)}return null}function me(q,K,X,Ee,Oe){if(typeof Ee=="string"&&Ee!==""||typeof Ee=="number")return q=q.get(X)||null,D(K,q,""+Ee,Oe);if(typeof Ee=="object"&&Ee!==null){switch(Ee.$$typeof){case cE:return q=q.get(Ee.key===null?X:Ee.key)||null,k(K,q,Ee,Oe);case eu:return q=q.get(Ee.key===null?X:Ee.key)||null,V(K,q,Ee,Oe);case Ga:var We=Ee._init;return me(q,K,X,We(Ee._payload),Oe)}if(mp(Ee)||sp(Ee))return q=q.get(X)||null,G(K,q,Ee,Oe,null);SE(K,Ee)}return null}function z(q,K,X,Ee){for(var Oe=null,We=null,De=K,ze=K=0,an=null;De!==null&&ze<X.length;ze++){De.index>ze?(an=De,De=null):an=De.sibling;var _t=Q(q,De,X[ze],Ee);if(_t===null){De===null&&(De=an);break}o&&De&&_t.alternate===null&&c(q,De),K=S(_t,K,ze),We===null?Oe=_t:We.sibling=_t,We=_t,De=an}if(ze===X.length)return u(q,De),Ln&&ad(q,ze),Oe;if(De===null){for(;ze<X.length;ze++)De=W(q,X[ze],Ee),De!==null&&(K=S(De,K,ze),We===null?Oe=De:We.sibling=De,We=De);return Ln&&ad(q,ze),Oe}for(De=f(q,De);ze<X.length;ze++)an=me(De,q,ze,X[ze],Ee),an!==null&&(o&&an.alternate!==null&&De.delete(an.key===null?ze:an.key),K=S(an,K,ze),We===null?Oe=an:We.sibling=an,We=an);return o&&De.forEach(function(lr){return c(q,lr)}),Ln&&ad(q,ze),Oe}function de(q,K,X,Ee){var Oe=sp(X);if(typeof Oe!="function")throw Error(we(150));if(X=Oe.call(X),X==null)throw Error(we(151));for(var We=Oe=null,De=K,ze=K=0,an=null,_t=X.next();De!==null&&!_t.done;ze++,_t=X.next()){De.index>ze?(an=De,De=null):an=De.sibling;var lr=Q(q,De,_t.value,Ee);if(lr===null){De===null&&(De=an);break}o&&De&&lr.alternate===null&&c(q,De),K=S(lr,K,ze),We===null?Oe=lr:We.sibling=lr,We=lr,De=an}if(_t.done)return u(q,De),Ln&&ad(q,ze),Oe;if(De===null){for(;!_t.done;ze++,_t=X.next())_t=W(q,_t.value,Ee),_t!==null&&(K=S(_t,K,ze),We===null?Oe=_t:We.sibling=_t,We=_t);return Ln&&ad(q,ze),Oe}for(De=f(q,De);!_t.done;ze++,_t=X.next())_t=me(De,q,ze,_t.value,Ee),_t!==null&&(o&&_t.alternate!==null&&De.delete(_t.key===null?ze:_t.key),K=S(_t,K,ze),We===null?Oe=_t:We.sibling=_t,We=_t);return o&&De.forEach(function(Bt){return c(q,Bt)}),Ln&&ad(q,ze),Oe}function he(q,K,X,Ee){if(typeof X=="object"&&X!==null&&X.type===tu&&X.key===null&&(X=X.props.children),typeof X=="object"&&X!==null){switch(X.$$typeof){case cE:e:{for(var Oe=X.key,We=K;We!==null;){if(We.key===Oe){if(Oe=X.type,Oe===tu){if(We.tag===7){u(q,We.sibling),K=E(We,X.props.children),K.return=q,q=K;break e}}else if(We.elementType===Oe||typeof Oe=="object"&&Oe!==null&&Oe.$$typeof===Ga&&$V(Oe)===We.type){u(q,We.sibling),K=E(We,X.props),K.ref=up(q,We,X),K.return=q,q=K;break e}u(q,We);break}else c(q,We);We=We.sibling}X.type===tu?(K=_d(X.props.children,q.mode,Ee,X.key),K.return=q,q=K):(Ee=UE(X.type,X.key,X.props,null,q.mode,Ee),Ee.ref=up(q,K,X),Ee.return=q,q=Ee)}return C(q);case eu:e:{for(We=X.key;K!==null;){if(K.key===We)if(K.tag===4&&K.stateNode.containerInfo===X.containerInfo&&K.stateNode.implementation===X.implementation){u(q,K.sibling),K=E(K,X.children||[]),K.return=q,q=K;break e}else{u(q,K);break}else c(q,K);K=K.sibling}K=NC(X,q.mode,Ee),K.return=q,q=K}return C(q);case Ga:return We=X._init,he(q,K,We(X._payload),Ee)}if(mp(X))return z(q,K,X,Ee);if(sp(X))return de(q,K,X,Ee);SE(q,X)}return typeof X=="string"&&X!==""||typeof X=="number"?(X=""+X,K!==null&&K.tag===6?(u(q,K.sibling),K=E(K,X),K.return=q,q=K):(u(q,K),K=OC(X,q.mode,Ee),K.return=q,q=K),C(q)):u(q,K)}return he}var vu=pj(!0),fj=pj(!1),eg=cc(null),tg=null,du=null,sw=null;function aw(){sw=du=tg=null}function cw(o){var c=eg.current;wn(eg),o._currentValue=c}function uI(o,c,u){for(;o!==null;){var f=o.alternate;if((o.childLanes&c)!==c?(o.childLanes|=c,f!==null&&(f.childLanes|=c)):f!==null&&(f.childLanes&c)!==c&&(f.childLanes|=c),o===u)break;o=o.return}}function mu(o,c){tg=o,sw=du=null,o=o.dependencies,o!==null&&o.firstContext!==null&&(o.lanes&c&&(vi=!0),o.firstContext=null)}function To(o){var c=o._currentValue;if(sw!==o)if(o={context:o,memoizedValue:c,next:null},du===null){if(tg===null)throw Error(we(308));du=o,tg.dependencies={lanes:0,firstContext:o}}else du=du.next=o;return c}var ud=null;function dw(o){ud===null?ud=[o]:ud.push(o)}function _j(o,c,u,f){var E=c.interleaved;return E===null?(u.next=u,dw(c)):(u.next=E.next,E.next=u),c.interleaved=u,ta(o,f)}function ta(o,c){o.lanes|=c;var u=o.alternate;for(u!==null&&(u.lanes|=c),u=o,o=o.return;o!==null;)o.childLanes|=c,u=o.alternate,u!==null&&(u.childLanes|=c),u=o,o=o.return;return u.tag===3?u.stateNode:null}var Wa=!1;function lw(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function mj(o,c){o=o.updateQueue,c.updateQueue===o&&(c.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,effects:o.effects})}function Zs(o,c){return{eventTime:o,lane:c,tag:0,payload:null,callback:null,next:null}}function $a(o,c,u){var f=o.updateQueue;if(f===null)return null;if(f=f.shared,Yt&2){var E=f.pending;return E===null?c.next=c:(c.next=E.next,E.next=c),f.pending=c,ta(o,u)}return E=f.interleaved,E===null?(c.next=c,dw(f)):(c.next=E.next,E.next=c),f.interleaved=c,ta(o,u)}function NE(o,c,u){if(c=c.updateQueue,c!==null&&(c=c.shared,(u&4194240)!==0)){var f=c.lanes;f&=o.pendingLanes,u|=f,c.lanes=u,XI(o,u)}}function eF(o,c){var u=o.updateQueue,f=o.alternate;if(f!==null&&(f=f.updateQueue,u===f)){var E=null,S=null;if(u=u.firstBaseUpdate,u!==null){do{var C={eventTime:u.eventTime,lane:u.lane,tag:u.tag,payload:u.payload,callback:u.callback,next:null};S===null?E=S=C:S=S.next=C,u=u.next}while(u!==null);S===null?E=S=c:S=S.next=c}else E=S=c;u={baseState:f.baseState,firstBaseUpdate:E,lastBaseUpdate:S,shared:f.shared,effects:f.effects},o.updateQueue=u;return}o=u.lastBaseUpdate,o===null?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=c}function ng(o,c,u,f){var E=o.updateQueue;Wa=!1;var S=E.firstBaseUpdate,C=E.lastBaseUpdate,D=E.shared.pending;if(D!==null){E.shared.pending=null;var k=D,V=k.next;k.next=null,C===null?S=V:C.next=V,C=k;var G=o.alternate;G!==null&&(G=G.updateQueue,D=G.lastBaseUpdate,D!==C&&(D===null?G.firstBaseUpdate=V:D.next=V,G.lastBaseUpdate=k))}if(S!==null){var W=E.baseState;C=0,G=V=k=null,D=S;do{var Q=D.lane,me=D.eventTime;if((f&Q)===Q){G!==null&&(G=G.next={eventTime:me,lane:0,tag:D.tag,payload:D.payload,callback:D.callback,next:null});e:{var z=o,de=D;switch(Q=c,me=u,de.tag){case 1:if(z=de.payload,typeof z=="function"){W=z.call(me,W,Q);break e}W=z;break e;case 3:z.flags=z.flags&-65537|128;case 0:if(z=de.payload,Q=typeof z=="function"?z.call(me,W,Q):z,Q==null)break e;W=Bn({},W,Q);break e;case 2:Wa=!0}}D.callback!==null&&D.lane!==0&&(o.flags|=64,Q=E.effects,Q===null?E.effects=[D]:Q.push(D))}else me={eventTime:me,lane:Q,tag:D.tag,payload:D.payload,callback:D.callback,next:null},G===null?(V=G=me,k=W):G=G.next=me,C|=Q;if(D=D.next,D===null){if(D=E.shared.pending,D===null)break;Q=D,D=Q.next,Q.next=null,E.lastBaseUpdate=Q,E.shared.pending=null}}while(!0);if(G===null&&(k=W),E.baseState=k,E.firstBaseUpdate=V,E.lastBaseUpdate=G,c=E.shared.interleaved,c!==null){E=c;do C|=E.lane,E=E.next;while(E!==c)}else S===null&&(E.shared.lanes=0);Td|=C,o.lanes=C,o.memoizedState=W}}function tF(o,c,u){if(o=c.effects,c.effects=null,o!==null)for(c=0;c<o.length;c++){var f=o[c],E=f.callback;if(E!==null){if(f.callback=null,f=u,typeof E!="function")throw Error(we(191,E));E.call(f)}}}var Zp={},Ns=cc(Zp),Bp=cc(Zp),jp=cc(Zp);function hd(o){if(o===Zp)throw Error(we(174));return o}function uw(o,c){switch(gn(jp,c),gn(Bp,o),gn(Ns,Zp),o=c.nodeType,o){case 9:case 11:c=(c=c.documentElement)?c.namespaceURI:KC(null,"");break;default:o=o===8?c.parentNode:c,c=o.namespaceURI||null,o=o.tagName,c=KC(c,o)}wn(Ns),gn(Ns,c)}function Ru(){wn(Ns),wn(Bp),wn(jp)}function Ej(o){hd(jp.current);var c=hd(Ns.current),u=KC(c,o.type);c!==u&&(gn(Bp,o),gn(Ns,u))}function hw(o){Bp.current===o&&(wn(Ns),wn(Bp))}var Vn=cc(0);function rg(o){for(var c=o;c!==null;){if(c.tag===13){var u=c.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||u.data==="$?"||u.data==="$!"))return c}else if(c.tag===19&&c.memoizedProps.revealOrder!==void 0){if(c.flags&128)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===o)break;for(;c.sibling===null;){if(c.return===null||c.return===o)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}var yC=[];function pw(){for(var o=0;o<yC.length;o++)yC[o]._workInProgressVersionPrimary=null;yC.length=0}var DE=ra.ReactCurrentDispatcher,CC=ra.ReactCurrentBatchConfig,Sd=0,Fn=null,cr=null,Tr=null,ig=!1,Ip=!1,Gp=0,_ne=0;function Gr(){throw Error(we(321))}function fw(o,c){if(c===null)return!1;for(var u=0;u<c.length&&u<o.length;u++)if(!$o(o[u],c[u]))return!1;return!0}function _w(o,c,u,f,E,S){if(Sd=S,Fn=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,DE.current=o===null||o.memoizedState===null?Sne:Tne,o=u(f,E),Ip){S=0;do{if(Ip=!1,Gp=0,25<=S)throw Error(we(301));S+=1,Tr=cr=null,c.updateQueue=null,DE.current=vne,o=u(f,E)}while(Ip)}if(DE.current=og,c=cr!==null&&cr.next!==null,Sd=0,Tr=cr=Fn=null,ig=!1,c)throw Error(we(300));return o}function mw(){var o=Gp!==0;return Gp=0,o}function As(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Tr===null?Fn.memoizedState=Tr=o:Tr=Tr.next=o,Tr}function vo(){if(cr===null){var o=Fn.alternate;o=o!==null?o.memoizedState:null}else o=cr.next;var c=Tr===null?Fn.memoizedState:Tr.next;if(c!==null)Tr=c,cr=o;else{if(o===null)throw Error(we(310));cr=o,o={memoizedState:cr.memoizedState,baseState:cr.baseState,baseQueue:cr.baseQueue,queue:cr.queue,next:null},Tr===null?Fn.memoizedState=Tr=o:Tr=Tr.next=o}return Tr}function Wp(o,c){return typeof c=="function"?c(o):c}function IC(o){var c=vo(),u=c.queue;if(u===null)throw Error(we(311));u.lastRenderedReducer=o;var f=cr,E=f.baseQueue,S=u.pending;if(S!==null){if(E!==null){var C=E.next;E.next=S.next,S.next=C}f.baseQueue=E=S,u.pending=null}if(E!==null){S=E.next,f=f.baseState;var D=C=null,k=null,V=S;do{var G=V.lane;if((Sd&G)===G)k!==null&&(k=k.next={lane:0,action:V.action,hasEagerState:V.hasEagerState,eagerState:V.eagerState,next:null}),f=V.hasEagerState?V.eagerState:o(f,V.action);else{var W={lane:G,action:V.action,hasEagerState:V.hasEagerState,eagerState:V.eagerState,next:null};k===null?(D=k=W,C=f):k=k.next=W,Fn.lanes|=G,Td|=G}V=V.next}while(V!==null&&V!==S);k===null?C=f:k.next=D,$o(f,c.memoizedState)||(vi=!0),c.memoizedState=f,c.baseState=C,c.baseQueue=k,u.lastRenderedState=f}if(o=u.interleaved,o!==null){E=o;do S=E.lane,Fn.lanes|=S,Td|=S,E=E.next;while(E!==o)}else E===null&&(u.lanes=0);return[c.memoizedState,u.dispatch]}function wC(o){var c=vo(),u=c.queue;if(u===null)throw Error(we(311));u.lastRenderedReducer=o;var f=u.dispatch,E=u.pending,S=c.memoizedState;if(E!==null){u.pending=null;var C=E=E.next;do S=o(S,C.action),C=C.next;while(C!==E);$o(S,c.memoizedState)||(vi=!0),c.memoizedState=S,c.baseQueue===null&&(c.baseState=S),u.lastRenderedState=S}return[S,f]}function gj(){}function Sj(o,c){var u=Fn,f=vo(),E=c(),S=!$o(f.memoizedState,E);if(S&&(f.memoizedState=E,vi=!0),f=f.queue,Ew(Rj.bind(null,u,f,o),[o]),f.getSnapshot!==c||S||Tr!==null&&Tr.memoizedState.tag&1){if(u.flags|=2048,Hp(9,vj.bind(null,u,f,E,c),void 0,null),vr===null)throw Error(we(349));Sd&30||Tj(u,c,E)}return E}function Tj(o,c,u){o.flags|=16384,o={getSnapshot:c,value:u},c=Fn.updateQueue,c===null?(c={lastEffect:null,stores:null},Fn.updateQueue=c,c.stores=[o]):(u=c.stores,u===null?c.stores=[o]:u.push(o))}function vj(o,c,u,f){c.value=u,c.getSnapshot=f,yj(c)&&Cj(o)}function Rj(o,c,u){return u(function(){yj(c)&&Cj(o)})}function yj(o){var c=o.getSnapshot;o=o.value;try{var u=c();return!$o(o,u)}catch{return!0}}function Cj(o){var c=ta(o,1);c!==null&&Zo(c,o,1,-1)}function nF(o){var c=As();return typeof o=="function"&&(o=o()),c.memoizedState=c.baseState=o,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Wp,lastRenderedState:o},c.queue=o,o=o.dispatch=gne.bind(null,Fn,o),[c.memoizedState,o]}function Hp(o,c,u,f){return o={tag:o,create:c,destroy:u,deps:f,next:null},c=Fn.updateQueue,c===null?(c={lastEffect:null,stores:null},Fn.updateQueue=c,c.lastEffect=o.next=o):(u=c.lastEffect,u===null?c.lastEffect=o.next=o:(f=u.next,u.next=o,o.next=f,c.lastEffect=o)),o}function Ij(){return vo().memoizedState}function PE(o,c,u,f){var E=As();Fn.flags|=o,E.memoizedState=Hp(1|c,u,void 0,f===void 0?null:f)}function Tg(o,c,u,f){var E=vo();f=f===void 0?null:f;var S=void 0;if(cr!==null){var C=cr.memoizedState;if(S=C.destroy,f!==null&&fw(f,C.deps)){E.memoizedState=Hp(c,u,S,f);return}}Fn.flags|=o,E.memoizedState=Hp(1|c,u,S,f)}function rF(o,c){return PE(8390656,8,o,c)}function Ew(o,c){return Tg(2048,8,o,c)}function wj(o,c){return Tg(4,2,o,c)}function Aj(o,c){return Tg(4,4,o,c)}function bj(o,c){if(typeof c=="function")return o=o(),c(o),function(){c(null)};if(c!=null)return o=o(),c.current=o,function(){c.current=null}}function Oj(o,c,u){return u=u!=null?u.concat([o]):null,Tg(4,4,bj.bind(null,c,o),u)}function gw(){}function Nj(o,c){var u=vo();c=c===void 0?null:c;var f=u.memoizedState;return f!==null&&c!==null&&fw(c,f[1])?f[0]:(u.memoizedState=[o,c],o)}function Dj(o,c){var u=vo();c=c===void 0?null:c;var f=u.memoizedState;return f!==null&&c!==null&&fw(c,f[1])?f[0]:(o=o(),u.memoizedState=[o,c],o)}function Pj(o,c,u){return Sd&21?($o(u,c)||(u=xB(),Fn.lanes|=u,Td|=u,o.baseState=!0),c):(o.baseState&&(o.baseState=!1,vi=!0),o.memoizedState=u)}function mne(o,c){var u=sn;sn=u!==0&&4>u?u:4,o(!0);var f=CC.transition;CC.transition={};try{o(!1),c()}finally{sn=u,CC.transition=f}}function Lj(){return vo().memoizedState}function Ene(o,c,u){var f=tc(o);if(u={lane:f,action:u,hasEagerState:!1,eagerState:null,next:null},kj(o))Mj(c,u);else if(u=_j(o,c,u,f),u!==null){var E=ni();Zo(u,o,f,E),Uj(u,c,f)}}function gne(o,c,u){var f=tc(o),E={lane:f,action:u,hasEagerState:!1,eagerState:null,next:null};if(kj(o))Mj(c,E);else{var S=o.alternate;if(o.lanes===0&&(S===null||S.lanes===0)&&(S=c.lastRenderedReducer,S!==null))try{var C=c.lastRenderedState,D=S(C,u);if(E.hasEagerState=!0,E.eagerState=D,$o(D,C)){var k=c.interleaved;k===null?(E.next=E,dw(c)):(E.next=k.next,k.next=E),c.interleaved=E;return}}catch{}finally{}u=_j(o,c,E,f),u!==null&&(E=ni(),Zo(u,o,f,E),Uj(u,c,f))}}function kj(o){var c=o.alternate;return o===Fn||c!==null&&c===Fn}function Mj(o,c){Ip=ig=!0;var u=o.pending;u===null?c.next=c:(c.next=u.next,u.next=c),o.pending=c}function Uj(o,c,u){if(u&4194240){var f=c.lanes;f&=o.pendingLanes,u|=f,c.lanes=u,XI(o,u)}}var og={readContext:To,useCallback:Gr,useContext:Gr,useEffect:Gr,useImperativeHandle:Gr,useInsertionEffect:Gr,useLayoutEffect:Gr,useMemo:Gr,useReducer:Gr,useRef:Gr,useState:Gr,useDebugValue:Gr,useDeferredValue:Gr,useTransition:Gr,useMutableSource:Gr,useSyncExternalStore:Gr,useId:Gr,unstable_isNewReconciler:!1},Sne={readContext:To,useCallback:function(o,c){return As().memoizedState=[o,c===void 0?null:c],o},useContext:To,useEffect:rF,useImperativeHandle:function(o,c,u){return u=u!=null?u.concat([o]):null,PE(4194308,4,bj.bind(null,c,o),u)},useLayoutEffect:function(o,c){return PE(4194308,4,o,c)},useInsertionEffect:function(o,c){return PE(4,2,o,c)},useMemo:function(o,c){var u=As();return c=c===void 0?null:c,o=o(),u.memoizedState=[o,c],o},useReducer:function(o,c,u){var f=As();return c=u!==void 0?u(c):c,f.memoizedState=f.baseState=c,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:c},f.queue=o,o=o.dispatch=Ene.bind(null,Fn,o),[f.memoizedState,o]},useRef:function(o){var c=As();return o={current:o},c.memoizedState=o},useState:nF,useDebugValue:gw,useDeferredValue:function(o){return As().memoizedState=o},useTransition:function(){var o=nF(!1),c=o[0];return o=mne.bind(null,o[1]),As().memoizedState=o,[c,o]},useMutableSource:function(){},useSyncExternalStore:function(o,c,u){var f=Fn,E=As();if(Ln){if(u===void 0)throw Error(we(407));u=u()}else{if(u=c(),vr===null)throw Error(we(349));Sd&30||Tj(f,c,u)}E.memoizedState=u;var S={value:u,getSnapshot:c};return E.queue=S,rF(Rj.bind(null,f,S,o),[o]),f.flags|=2048,Hp(9,vj.bind(null,f,S,u,c),void 0,null),u},useId:function(){var o=As(),c=vr.identifierPrefix;if(Ln){var u=Qs,f=Js;u=(f&~(1<<32-Qo(f)-1)).toString(32)+u,c=":"+c+"R"+u,u=Gp++,0<u&&(c+="H"+u.toString(32)),c+=":"}else u=_ne++,c=":"+c+"r"+u.toString(32)+":";return o.memoizedState=c},unstable_isNewReconciler:!1},Tne={readContext:To,useCallback:Nj,useContext:To,useEffect:Ew,useImperativeHandle:Oj,useInsertionEffect:wj,useLayoutEffect:Aj,useMemo:Dj,useReducer:IC,useRef:Ij,useState:function(){return IC(Wp)},useDebugValue:gw,useDeferredValue:function(o){var c=vo();return Pj(c,cr.memoizedState,o)},useTransition:function(){var o=IC(Wp)[0],c=vo().memoizedState;return[o,c]},useMutableSource:gj,useSyncExternalStore:Sj,useId:Lj,unstable_isNewReconciler:!1},vne={readContext:To,useCallback:Nj,useContext:To,useEffect:Ew,useImperativeHandle:Oj,useInsertionEffect:wj,useLayoutEffect:Aj,useMemo:Dj,useReducer:wC,useRef:Ij,useState:function(){return wC(Wp)},useDebugValue:gw,useDeferredValue:function(o){var c=vo();return cr===null?c.memoizedState=o:Pj(c,cr.memoizedState,o)},useTransition:function(){var o=wC(Wp)[0],c=vo().memoizedState;return[o,c]},useMutableSource:gj,useSyncExternalStore:Sj,useId:Lj,unstable_isNewReconciler:!1};function qo(o,c){if(o&&o.defaultProps){c=Bn({},c),o=o.defaultProps;for(var u in o)c[u]===void 0&&(c[u]=o[u]);return c}return c}function hI(o,c,u,f){c=o.memoizedState,u=u(f,c),u=u==null?c:Bn({},c,u),o.memoizedState=u,o.lanes===0&&(o.updateQueue.baseState=u)}var vg={isMounted:function(o){return(o=o._reactInternals)?Cd(o)===o:!1},enqueueSetState:function(o,c,u){o=o._reactInternals;var f=ni(),E=tc(o),S=Zs(f,E);S.payload=c,u!=null&&(S.callback=u),c=$a(o,S,E),c!==null&&(Zo(c,o,E,f),NE(c,o,E))},enqueueReplaceState:function(o,c,u){o=o._reactInternals;var f=ni(),E=tc(o),S=Zs(f,E);S.tag=1,S.payload=c,u!=null&&(S.callback=u),c=$a(o,S,E),c!==null&&(Zo(c,o,E,f),NE(c,o,E))},enqueueForceUpdate:function(o,c){o=o._reactInternals;var u=ni(),f=tc(o),E=Zs(u,f);E.tag=2,c!=null&&(E.callback=c),c=$a(o,E,f),c!==null&&(Zo(c,o,f,u),NE(c,o,f))}};function iF(o,c,u,f,E,S,C){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(f,S,C):c.prototype&&c.prototype.isPureReactComponent?!Up(u,f)||!Up(E,S):!0}function xj(o,c,u){var f=!1,E=sc,S=c.contextType;return typeof S=="object"&&S!==null?S=To(S):(E=yi(c)?Ed:Yr.current,f=c.contextTypes,S=(f=f!=null)?Su(o,E):sc),c=new c(u,S),o.memoizedState=c.state!==null&&c.state!==void 0?c.state:null,c.updater=vg,o.stateNode=c,c._reactInternals=o,f&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=E,o.__reactInternalMemoizedMaskedChildContext=S),c}function oF(o,c,u,f){o=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(u,f),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(u,f),c.state!==o&&vg.enqueueReplaceState(c,c.state,null)}function pI(o,c,u,f){var E=o.stateNode;E.props=u,E.state=o.memoizedState,E.refs={},lw(o);var S=c.contextType;typeof S=="object"&&S!==null?E.context=To(S):(S=yi(c)?Ed:Yr.current,E.context=Su(o,S)),E.state=o.memoizedState,S=c.getDerivedStateFromProps,typeof S=="function"&&(hI(o,c,S,u),E.state=o.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof E.getSnapshotBeforeUpdate=="function"||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(c=E.state,typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount(),c!==E.state&&vg.enqueueReplaceState(E,E.state,null),ng(o,u,E,f),E.state=o.memoizedState),typeof E.componentDidMount=="function"&&(o.flags|=4194308)}function yu(o,c){try{var u="",f=c;do u+=Xee(f),f=f.return;while(f);var E=u}catch(S){E=`
Error generating stack: `+S.message+`
`+S.stack}return{value:o,source:c,stack:E,digest:null}}function AC(o,c,u){return{value:o,source:null,stack:u??null,digest:c??null}}function fI(o,c){try{console.error(c.value)}catch(u){setTimeout(function(){throw u})}}var Rne=typeof WeakMap=="function"?WeakMap:Map;function Vj(o,c,u){u=Zs(-1,u),u.tag=3,u.payload={element:null};var f=c.value;return u.callback=function(){ag||(ag=!0,CI=f),fI(o,c)},u}function Fj(o,c,u){u=Zs(-1,u),u.tag=3;var f=o.type.getDerivedStateFromError;if(typeof f=="function"){var E=c.value;u.payload=function(){return f(E)},u.callback=function(){fI(o,c)}}var S=o.stateNode;return S!==null&&typeof S.componentDidCatch=="function"&&(u.callback=function(){fI(o,c),typeof f!="function"&&(ec===null?ec=new Set([this]):ec.add(this));var C=c.stack;this.componentDidCatch(c.value,{componentStack:C!==null?C:""})}),u}function sF(o,c,u){var f=o.pingCache;if(f===null){f=o.pingCache=new Rne;var E=new Set;f.set(c,E)}else E=f.get(c),E===void 0&&(E=new Set,f.set(c,E));E.has(u)||(E.add(u),o=Une.bind(null,o,c,u),c.then(o,o))}function aF(o){do{var c;if((c=o.tag===13)&&(c=o.memoizedState,c=c!==null?c.dehydrated!==null:!0),c)return o;o=o.return}while(o!==null);return null}function cF(o,c,u,f,E){return o.mode&1?(o.flags|=65536,o.lanes=E,o):(o===c?o.flags|=65536:(o.flags|=128,u.flags|=131072,u.flags&=-52805,u.tag===1&&(u.alternate===null?u.tag=17:(c=Zs(-1,1),c.tag=2,$a(u,c,1))),u.lanes|=1),o)}var yne=ra.ReactCurrentOwner,vi=!1;function ti(o,c,u,f){c.child=o===null?fj(c,null,u,f):vu(c,o.child,u,f)}function dF(o,c,u,f,E){u=u.render;var S=c.ref;return mu(c,E),f=_w(o,c,u,f,S,E),u=mw(),o!==null&&!vi?(c.updateQueue=o.updateQueue,c.flags&=-2053,o.lanes&=~E,na(o,c,E)):(Ln&&u&&rw(c),c.flags|=1,ti(o,c,f,E),c.child)}function lF(o,c,u,f,E){if(o===null){var S=u.type;return typeof S=="function"&&!ww(S)&&S.defaultProps===void 0&&u.compare===null&&u.defaultProps===void 0?(c.tag=15,c.type=S,Bj(o,c,S,f,E)):(o=UE(u.type,null,f,c,c.mode,E),o.ref=c.ref,o.return=c,c.child=o)}if(S=o.child,!(o.lanes&E)){var C=S.memoizedProps;if(u=u.compare,u=u!==null?u:Up,u(C,f)&&o.ref===c.ref)return na(o,c,E)}return c.flags|=1,o=nc(S,f),o.ref=c.ref,o.return=c,c.child=o}function Bj(o,c,u,f,E){if(o!==null){var S=o.memoizedProps;if(Up(S,f)&&o.ref===c.ref)if(vi=!1,c.pendingProps=f=S,(o.lanes&E)!==0)o.flags&131072&&(vi=!0);else return c.lanes=o.lanes,na(o,c,E)}return _I(o,c,u,f,E)}function jj(o,c,u){var f=c.pendingProps,E=f.children,S=o!==null?o.memoizedState:null;if(f.mode==="hidden")if(!(c.mode&1))c.memoizedState={baseLanes:0,cachePool:null,transitions:null},gn(uu,ji),ji|=u;else{if(!(u&1073741824))return o=S!==null?S.baseLanes|u:u,c.lanes=c.childLanes=1073741824,c.memoizedState={baseLanes:o,cachePool:null,transitions:null},c.updateQueue=null,gn(uu,ji),ji|=o,null;c.memoizedState={baseLanes:0,cachePool:null,transitions:null},f=S!==null?S.baseLanes:u,gn(uu,ji),ji|=f}else S!==null?(f=S.baseLanes|u,c.memoizedState=null):f=u,gn(uu,ji),ji|=f;return ti(o,c,E,u),c.child}function Gj(o,c){var u=c.ref;(o===null&&u!==null||o!==null&&o.ref!==u)&&(c.flags|=512,c.flags|=2097152)}function _I(o,c,u,f,E){var S=yi(u)?Ed:Yr.current;return S=Su(c,S),mu(c,E),u=_w(o,c,u,f,S,E),f=mw(),o!==null&&!vi?(c.updateQueue=o.updateQueue,c.flags&=-2053,o.lanes&=~E,na(o,c,E)):(Ln&&f&&rw(c),c.flags|=1,ti(o,c,u,E),c.child)}function uF(o,c,u,f,E){if(yi(u)){var S=!0;QE(c)}else S=!1;if(mu(c,E),c.stateNode===null)LE(o,c),xj(c,u,f),pI(c,u,f,E),f=!0;else if(o===null){var C=c.stateNode,D=c.memoizedProps;C.props=D;var k=C.context,V=u.contextType;typeof V=="object"&&V!==null?V=To(V):(V=yi(u)?Ed:Yr.current,V=Su(c,V));var G=u.getDerivedStateFromProps,W=typeof G=="function"||typeof C.getSnapshotBeforeUpdate=="function";W||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(D!==f||k!==V)&&oF(c,C,f,V),Wa=!1;var Q=c.memoizedState;C.state=Q,ng(c,f,C,E),k=c.memoizedState,D!==f||Q!==k||Ri.current||Wa?(typeof G=="function"&&(hI(c,u,G,f),k=c.memoizedState),(D=Wa||iF(c,u,D,f,Q,k,V))?(W||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount()),typeof C.componentDidMount=="function"&&(c.flags|=4194308)):(typeof C.componentDidMount=="function"&&(c.flags|=4194308),c.memoizedProps=f,c.memoizedState=k),C.props=f,C.state=k,C.context=V,f=D):(typeof C.componentDidMount=="function"&&(c.flags|=4194308),f=!1)}else{C=c.stateNode,mj(o,c),D=c.memoizedProps,V=c.type===c.elementType?D:qo(c.type,D),C.props=V,W=c.pendingProps,Q=C.context,k=u.contextType,typeof k=="object"&&k!==null?k=To(k):(k=yi(u)?Ed:Yr.current,k=Su(c,k));var me=u.getDerivedStateFromProps;(G=typeof me=="function"||typeof C.getSnapshotBeforeUpdate=="function")||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(D!==W||Q!==k)&&oF(c,C,f,k),Wa=!1,Q=c.memoizedState,C.state=Q,ng(c,f,C,E);var z=c.memoizedState;D!==W||Q!==z||Ri.current||Wa?(typeof me=="function"&&(hI(c,u,me,f),z=c.memoizedState),(V=Wa||iF(c,u,V,f,Q,z,k)||!1)?(G||typeof C.UNSAFE_componentWillUpdate!="function"&&typeof C.componentWillUpdate!="function"||(typeof C.componentWillUpdate=="function"&&C.componentWillUpdate(f,z,k),typeof C.UNSAFE_componentWillUpdate=="function"&&C.UNSAFE_componentWillUpdate(f,z,k)),typeof C.componentDidUpdate=="function"&&(c.flags|=4),typeof C.getSnapshotBeforeUpdate=="function"&&(c.flags|=1024)):(typeof C.componentDidUpdate!="function"||D===o.memoizedProps&&Q===o.memoizedState||(c.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||D===o.memoizedProps&&Q===o.memoizedState||(c.flags|=1024),c.memoizedProps=f,c.memoizedState=z),C.props=f,C.state=z,C.context=k,f=V):(typeof C.componentDidUpdate!="function"||D===o.memoizedProps&&Q===o.memoizedState||(c.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||D===o.memoizedProps&&Q===o.memoizedState||(c.flags|=1024),f=!1)}return mI(o,c,u,f,S,E)}function mI(o,c,u,f,E,S){Gj(o,c);var C=(c.flags&128)!==0;if(!f&&!C)return E&&JV(c,u,!1),na(o,c,S);f=c.stateNode,yne.current=c;var D=C&&typeof u.getDerivedStateFromError!="function"?null:f.render();return c.flags|=1,o!==null&&C?(c.child=vu(c,o.child,null,S),c.child=vu(c,null,D,S)):ti(o,c,D,S),c.memoizedState=f.state,E&&JV(c,u,!0),c.child}function Wj(o){var c=o.stateNode;c.pendingContext?XV(o,c.pendingContext,c.pendingContext!==c.context):c.context&&XV(o,c.context,!1),uw(o,c.containerInfo)}function hF(o,c,u,f,E){return Tu(),ow(E),c.flags|=256,ti(o,c,u,f),c.child}var EI={dehydrated:null,treeContext:null,retryLane:0};function gI(o){return{baseLanes:o,cachePool:null,transitions:null}}function Hj(o,c,u){var f=c.pendingProps,E=Vn.current,S=!1,C=(c.flags&128)!==0,D;if((D=C)||(D=o!==null&&o.memoizedState===null?!1:(E&2)!==0),D?(S=!0,c.flags&=-129):(o===null||o.memoizedState!==null)&&(E|=1),gn(Vn,E&1),o===null)return lI(c),o=c.memoizedState,o!==null&&(o=o.dehydrated,o!==null)?(c.mode&1?o.data==="$!"?c.lanes=8:c.lanes=1073741824:c.lanes=1,null):(C=f.children,o=f.fallback,S?(f=c.mode,S=c.child,C={mode:"hidden",children:C},!(f&1)&&S!==null?(S.childLanes=0,S.pendingProps=C):S=Cg(C,f,0,null),o=_d(o,f,u,null),S.return=c,o.return=c,S.sibling=o,c.child=S,c.child.memoizedState=gI(u),c.memoizedState=EI,o):Sw(c,C));if(E=o.memoizedState,E!==null&&(D=E.dehydrated,D!==null))return Cne(o,c,C,f,D,E,u);if(S){S=f.fallback,C=c.mode,E=o.child,D=E.sibling;var k={mode:"hidden",children:f.children};return!(C&1)&&c.child!==E?(f=c.child,f.childLanes=0,f.pendingProps=k,c.deletions=null):(f=nc(E,k),f.subtreeFlags=E.subtreeFlags&14680064),D!==null?S=nc(D,S):(S=_d(S,C,u,null),S.flags|=2),S.return=c,f.return=c,f.sibling=S,c.child=f,f=S,S=c.child,C=o.child.memoizedState,C=C===null?gI(u):{baseLanes:C.baseLanes|u,cachePool:null,transitions:C.transitions},S.memoizedState=C,S.childLanes=o.childLanes&~u,c.memoizedState=EI,f}return S=o.child,o=S.sibling,f=nc(S,{mode:"visible",children:f.children}),!(c.mode&1)&&(f.lanes=u),f.return=c,f.sibling=null,o!==null&&(u=c.deletions,u===null?(c.deletions=[o],c.flags|=16):u.push(o)),c.child=f,c.memoizedState=null,f}function Sw(o,c){return c=Cg({mode:"visible",children:c},o.mode,0,null),c.return=o,o.child=c}function TE(o,c,u,f){return f!==null&&ow(f),vu(c,o.child,null,u),o=Sw(c,c.pendingProps.children),o.flags|=2,c.memoizedState=null,o}function Cne(o,c,u,f,E,S,C){if(u)return c.flags&256?(c.flags&=-257,f=AC(Error(we(422))),TE(o,c,C,f)):c.memoizedState!==null?(c.child=o.child,c.flags|=128,null):(S=f.fallback,E=c.mode,f=Cg({mode:"visible",children:f.children},E,0,null),S=_d(S,E,C,null),S.flags|=2,f.return=c,S.return=c,f.sibling=S,c.child=f,c.mode&1&&vu(c,o.child,null,C),c.child.memoizedState=gI(C),c.memoizedState=EI,S);if(!(c.mode&1))return TE(o,c,C,null);if(E.data==="$!"){if(f=E.nextSibling&&E.nextSibling.dataset,f)var D=f.dgst;return f=D,S=Error(we(419)),f=AC(S,f,void 0),TE(o,c,C,f)}if(D=(C&o.childLanes)!==0,vi||D){if(f=vr,f!==null){switch(C&-C){case 4:E=2;break;case 16:E=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:E=32;break;case 536870912:E=268435456;break;default:E=0}E=E&(f.suspendedLanes|C)?0:E,E!==0&&E!==S.retryLane&&(S.retryLane=E,ta(o,E),Zo(f,o,E,-1))}return Iw(),f=AC(Error(we(421))),TE(o,c,C,f)}return E.data==="$?"?(c.flags|=128,c.child=o.child,c=xne.bind(null,o),E._reactRetry=c,null):(o=S.treeContext,Gi=Za(E.nextSibling),Wi=c,Ln=!0,Jo=null,o!==null&&(mo[Eo++]=Js,mo[Eo++]=Qs,mo[Eo++]=gd,Js=o.id,Qs=o.overflow,gd=c),c=Sw(c,f.children),c.flags|=4096,c)}function pF(o,c,u){o.lanes|=c;var f=o.alternate;f!==null&&(f.lanes|=c),uI(o.return,c,u)}function bC(o,c,u,f,E){var S=o.memoizedState;S===null?o.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:f,tail:u,tailMode:E}:(S.isBackwards=c,S.rendering=null,S.renderingStartTime=0,S.last=f,S.tail=u,S.tailMode=E)}function Kj(o,c,u){var f=c.pendingProps,E=f.revealOrder,S=f.tail;if(ti(o,c,f.children,u),f=Vn.current,f&2)f=f&1|2,c.flags|=128;else{if(o!==null&&o.flags&128)e:for(o=c.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&pF(o,u,c);else if(o.tag===19)pF(o,u,c);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===c)break e;for(;o.sibling===null;){if(o.return===null||o.return===c)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}f&=1}if(gn(Vn,f),!(c.mode&1))c.memoizedState=null;else switch(E){case"forwards":for(u=c.child,E=null;u!==null;)o=u.alternate,o!==null&&rg(o)===null&&(E=u),u=u.sibling;u=E,u===null?(E=c.child,c.child=null):(E=u.sibling,u.sibling=null),bC(c,!1,E,u,S);break;case"backwards":for(u=null,E=c.child,c.child=null;E!==null;){if(o=E.alternate,o!==null&&rg(o)===null){c.child=E;break}o=E.sibling,E.sibling=u,u=E,E=o}bC(c,!0,u,null,S);break;case"together":bC(c,!1,null,null,void 0);break;default:c.memoizedState=null}return c.child}function LE(o,c){!(c.mode&1)&&o!==null&&(o.alternate=null,c.alternate=null,c.flags|=2)}function na(o,c,u){if(o!==null&&(c.dependencies=o.dependencies),Td|=c.lanes,!(u&c.childLanes))return null;if(o!==null&&c.child!==o.child)throw Error(we(153));if(c.child!==null){for(o=c.child,u=nc(o,o.pendingProps),c.child=u,u.return=c;o.sibling!==null;)o=o.sibling,u=u.sibling=nc(o,o.pendingProps),u.return=c;u.sibling=null}return c.child}function Ine(o,c,u){switch(c.tag){case 3:Wj(c),Tu();break;case 5:Ej(c);break;case 1:yi(c.type)&&QE(c);break;case 4:uw(c,c.stateNode.containerInfo);break;case 10:var f=c.type._context,E=c.memoizedProps.value;gn(eg,f._currentValue),f._currentValue=E;break;case 13:if(f=c.memoizedState,f!==null)return f.dehydrated!==null?(gn(Vn,Vn.current&1),c.flags|=128,null):u&c.child.childLanes?Hj(o,c,u):(gn(Vn,Vn.current&1),o=na(o,c,u),o!==null?o.sibling:null);gn(Vn,Vn.current&1);break;case 19:if(f=(u&c.childLanes)!==0,o.flags&128){if(f)return Kj(o,c,u);c.flags|=128}if(E=c.memoizedState,E!==null&&(E.rendering=null,E.tail=null,E.lastEffect=null),gn(Vn,Vn.current),f)break;return null;case 22:case 23:return c.lanes=0,jj(o,c,u)}return na(o,c,u)}var Yj,SI,zj,qj;Yj=function(o,c){for(var u=c.child;u!==null;){if(u.tag===5||u.tag===6)o.appendChild(u.stateNode);else if(u.tag!==4&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===c)break;for(;u.sibling===null;){if(u.return===null||u.return===c)return;u=u.return}u.sibling.return=u.return,u=u.sibling}};SI=function(){};zj=function(o,c,u,f){var E=o.memoizedProps;if(E!==f){o=c.stateNode,hd(Ns.current);var S=null;switch(u){case"input":E=jC(o,E),f=jC(o,f),S=[];break;case"select":E=Bn({},E,{value:void 0}),f=Bn({},f,{value:void 0}),S=[];break;case"textarea":E=HC(o,E),f=HC(o,f),S=[];break;default:typeof E.onClick!="function"&&typeof f.onClick=="function"&&(o.onclick=XE)}YC(u,f);var C;u=null;for(V in E)if(!f.hasOwnProperty(V)&&E.hasOwnProperty(V)&&E[V]!=null)if(V==="style"){var D=E[V];for(C in D)D.hasOwnProperty(C)&&(u||(u={}),u[C]="")}else V!=="dangerouslySetInnerHTML"&&V!=="children"&&V!=="suppressContentEditableWarning"&&V!=="suppressHydrationWarning"&&V!=="autoFocus"&&(Op.hasOwnProperty(V)?S||(S=[]):(S=S||[]).push(V,null));for(V in f){var k=f[V];if(D=E!=null?E[V]:void 0,f.hasOwnProperty(V)&&k!==D&&(k!=null||D!=null))if(V==="style")if(D){for(C in D)!D.hasOwnProperty(C)||k&&k.hasOwnProperty(C)||(u||(u={}),u[C]="");for(C in k)k.hasOwnProperty(C)&&D[C]!==k[C]&&(u||(u={}),u[C]=k[C])}else u||(S||(S=[]),S.push(V,u)),u=k;else V==="dangerouslySetInnerHTML"?(k=k?k.__html:void 0,D=D?D.__html:void 0,k!=null&&D!==k&&(S=S||[]).push(V,k)):V==="children"?typeof k!="string"&&typeof k!="number"||(S=S||[]).push(V,""+k):V!=="suppressContentEditableWarning"&&V!=="suppressHydrationWarning"&&(Op.hasOwnProperty(V)?(k!=null&&V==="onScroll"&&In("scroll",o),S||D===k||(S=[])):(S=S||[]).push(V,k))}u&&(S=S||[]).push("style",u);var V=S;(c.updateQueue=V)&&(c.flags|=4)}};qj=function(o,c,u,f){u!==f&&(c.flags|=4)};function hp(o,c){if(!Ln)switch(o.tailMode){case"hidden":c=o.tail;for(var u=null;c!==null;)c.alternate!==null&&(u=c),c=c.sibling;u===null?o.tail=null:u.sibling=null;break;case"collapsed":u=o.tail;for(var f=null;u!==null;)u.alternate!==null&&(f=u),u=u.sibling;f===null?c||o.tail===null?o.tail=null:o.tail.sibling=null:f.sibling=null}}function Wr(o){var c=o.alternate!==null&&o.alternate.child===o.child,u=0,f=0;if(c)for(var E=o.child;E!==null;)u|=E.lanes|E.childLanes,f|=E.subtreeFlags&14680064,f|=E.flags&14680064,E.return=o,E=E.sibling;else for(E=o.child;E!==null;)u|=E.lanes|E.childLanes,f|=E.subtreeFlags,f|=E.flags,E.return=o,E=E.sibling;return o.subtreeFlags|=f,o.childLanes=u,c}function wne(o,c,u){var f=c.pendingProps;switch(iw(c),c.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Wr(c),null;case 1:return yi(c.type)&&JE(),Wr(c),null;case 3:return f=c.stateNode,Ru(),wn(Ri),wn(Yr),pw(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(o===null||o.child===null)&&(gE(c)?c.flags|=4:o===null||o.memoizedState.isDehydrated&&!(c.flags&256)||(c.flags|=1024,Jo!==null&&(AI(Jo),Jo=null))),SI(o,c),Wr(c),null;case 5:hw(c);var E=hd(jp.current);if(u=c.type,o!==null&&c.stateNode!=null)zj(o,c,u,f,E),o.ref!==c.ref&&(c.flags|=512,c.flags|=2097152);else{if(!f){if(c.stateNode===null)throw Error(we(166));return Wr(c),null}if(o=hd(Ns.current),gE(c)){f=c.stateNode,u=c.type;var S=c.memoizedProps;switch(f[bs]=c,f[Fp]=S,o=(c.mode&1)!==0,u){case"dialog":In("cancel",f),In("close",f);break;case"iframe":case"object":case"embed":In("load",f);break;case"video":case"audio":for(E=0;E<gp.length;E++)In(gp[E],f);break;case"source":In("error",f);break;case"img":case"image":case"link":In("error",f),In("load",f);break;case"details":In("toggle",f);break;case"input":RV(f,S),In("invalid",f);break;case"select":f._wrapperState={wasMultiple:!!S.multiple},In("invalid",f);break;case"textarea":CV(f,S),In("invalid",f)}YC(u,S),E=null;for(var C in S)if(S.hasOwnProperty(C)){var D=S[C];C==="children"?typeof D=="string"?f.textContent!==D&&(S.suppressHydrationWarning!==!0&&EE(f.textContent,D,o),E=["children",D]):typeof D=="number"&&f.textContent!==""+D&&(S.suppressHydrationWarning!==!0&&EE(f.textContent,D,o),E=["children",""+D]):Op.hasOwnProperty(C)&&D!=null&&C==="onScroll"&&In("scroll",f)}switch(u){case"input":dE(f),yV(f,S,!0);break;case"textarea":dE(f),IV(f);break;case"select":case"option":break;default:typeof S.onClick=="function"&&(f.onclick=XE)}f=E,c.updateQueue=f,f!==null&&(c.flags|=4)}else{C=E.nodeType===9?E:E.ownerDocument,o==="http://www.w3.org/1999/xhtml"&&(o=RB(u)),o==="http://www.w3.org/1999/xhtml"?u==="script"?(o=C.createElement("div"),o.innerHTML="<script><\/script>",o=o.removeChild(o.firstChild)):typeof f.is=="string"?o=C.createElement(u,{is:f.is}):(o=C.createElement(u),u==="select"&&(C=o,f.multiple?C.multiple=!0:f.size&&(C.size=f.size))):o=C.createElementNS(o,u),o[bs]=c,o[Fp]=f,Yj(o,c,!1,!1),c.stateNode=o;e:{switch(C=zC(u,f),u){case"dialog":In("cancel",o),In("close",o),E=f;break;case"iframe":case"object":case"embed":In("load",o),E=f;break;case"video":case"audio":for(E=0;E<gp.length;E++)In(gp[E],o);E=f;break;case"source":In("error",o),E=f;break;case"img":case"image":case"link":In("error",o),In("load",o),E=f;break;case"details":In("toggle",o),E=f;break;case"input":RV(o,f),E=jC(o,f),In("invalid",o);break;case"option":E=f;break;case"select":o._wrapperState={wasMultiple:!!f.multiple},E=Bn({},f,{value:void 0}),In("invalid",o);break;case"textarea":CV(o,f),E=HC(o,f),In("invalid",o);break;default:E=f}YC(u,E),D=E;for(S in D)if(D.hasOwnProperty(S)){var k=D[S];S==="style"?IB(o,k):S==="dangerouslySetInnerHTML"?(k=k?k.__html:void 0,k!=null&&yB(o,k)):S==="children"?typeof k=="string"?(u!=="textarea"||k!=="")&&Np(o,k):typeof k=="number"&&Np(o,""+k):S!=="suppressContentEditableWarning"&&S!=="suppressHydrationWarning"&&S!=="autoFocus"&&(Op.hasOwnProperty(S)?k!=null&&S==="onScroll"&&In("scroll",o):k!=null&&WI(o,S,k,C))}switch(u){case"input":dE(o),yV(o,f,!1);break;case"textarea":dE(o),IV(o);break;case"option":f.value!=null&&o.setAttribute("value",""+oc(f.value));break;case"select":o.multiple=!!f.multiple,S=f.value,S!=null?hu(o,!!f.multiple,S,!1):f.defaultValue!=null&&hu(o,!!f.multiple,f.defaultValue,!0);break;default:typeof E.onClick=="function"&&(o.onclick=XE)}switch(u){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}}f&&(c.flags|=4)}c.ref!==null&&(c.flags|=512,c.flags|=2097152)}return Wr(c),null;case 6:if(o&&c.stateNode!=null)qj(o,c,o.memoizedProps,f);else{if(typeof f!="string"&&c.stateNode===null)throw Error(we(166));if(u=hd(jp.current),hd(Ns.current),gE(c)){if(f=c.stateNode,u=c.memoizedProps,f[bs]=c,(S=f.nodeValue!==u)&&(o=Wi,o!==null))switch(o.tag){case 3:EE(f.nodeValue,u,(o.mode&1)!==0);break;case 5:o.memoizedProps.suppressHydrationWarning!==!0&&EE(f.nodeValue,u,(o.mode&1)!==0)}S&&(c.flags|=4)}else f=(u.nodeType===9?u:u.ownerDocument).createTextNode(f),f[bs]=c,c.stateNode=f}return Wr(c),null;case 13:if(wn(Vn),f=c.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(Ln&&Gi!==null&&c.mode&1&&!(c.flags&128))hj(),Tu(),c.flags|=98560,S=!1;else if(S=gE(c),f!==null&&f.dehydrated!==null){if(o===null){if(!S)throw Error(we(318));if(S=c.memoizedState,S=S!==null?S.dehydrated:null,!S)throw Error(we(317));S[bs]=c}else Tu(),!(c.flags&128)&&(c.memoizedState=null),c.flags|=4;Wr(c),S=!1}else Jo!==null&&(AI(Jo),Jo=null),S=!0;if(!S)return c.flags&65536?c:null}return c.flags&128?(c.lanes=u,c):(f=f!==null,f!==(o!==null&&o.memoizedState!==null)&&f&&(c.child.flags|=8192,c.mode&1&&(o===null||Vn.current&1?dr===0&&(dr=3):Iw())),c.updateQueue!==null&&(c.flags|=4),Wr(c),null);case 4:return Ru(),SI(o,c),o===null&&xp(c.stateNode.containerInfo),Wr(c),null;case 10:return cw(c.type._context),Wr(c),null;case 17:return yi(c.type)&&JE(),Wr(c),null;case 19:if(wn(Vn),S=c.memoizedState,S===null)return Wr(c),null;if(f=(c.flags&128)!==0,C=S.rendering,C===null)if(f)hp(S,!1);else{if(dr!==0||o!==null&&o.flags&128)for(o=c.child;o!==null;){if(C=rg(o),C!==null){for(c.flags|=128,hp(S,!1),f=C.updateQueue,f!==null&&(c.updateQueue=f,c.flags|=4),c.subtreeFlags=0,f=u,u=c.child;u!==null;)S=u,o=f,S.flags&=14680066,C=S.alternate,C===null?(S.childLanes=0,S.lanes=o,S.child=null,S.subtreeFlags=0,S.memoizedProps=null,S.memoizedState=null,S.updateQueue=null,S.dependencies=null,S.stateNode=null):(S.childLanes=C.childLanes,S.lanes=C.lanes,S.child=C.child,S.subtreeFlags=0,S.deletions=null,S.memoizedProps=C.memoizedProps,S.memoizedState=C.memoizedState,S.updateQueue=C.updateQueue,S.type=C.type,o=C.dependencies,S.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),u=u.sibling;return gn(Vn,Vn.current&1|2),c.child}o=o.sibling}S.tail!==null&&Jn()>Cu&&(c.flags|=128,f=!0,hp(S,!1),c.lanes=4194304)}else{if(!f)if(o=rg(C),o!==null){if(c.flags|=128,f=!0,u=o.updateQueue,u!==null&&(c.updateQueue=u,c.flags|=4),hp(S,!0),S.tail===null&&S.tailMode==="hidden"&&!C.alternate&&!Ln)return Wr(c),null}else 2*Jn()-S.renderingStartTime>Cu&&u!==1073741824&&(c.flags|=128,f=!0,hp(S,!1),c.lanes=4194304);S.isBackwards?(C.sibling=c.child,c.child=C):(u=S.last,u!==null?u.sibling=C:c.child=C,S.last=C)}return S.tail!==null?(c=S.tail,S.rendering=c,S.tail=c.sibling,S.renderingStartTime=Jn(),c.sibling=null,u=Vn.current,gn(Vn,f?u&1|2:u&1),c):(Wr(c),null);case 22:case 23:return Cw(),f=c.memoizedState!==null,o!==null&&o.memoizedState!==null!==f&&(c.flags|=8192),f&&c.mode&1?ji&1073741824&&(Wr(c),c.subtreeFlags&6&&(c.flags|=8192)):Wr(c),null;case 24:return null;case 25:return null}throw Error(we(156,c.tag))}function Ane(o,c){switch(iw(c),c.tag){case 1:return yi(c.type)&&JE(),o=c.flags,o&65536?(c.flags=o&-65537|128,c):null;case 3:return Ru(),wn(Ri),wn(Yr),pw(),o=c.flags,o&65536&&!(o&128)?(c.flags=o&-65537|128,c):null;case 5:return hw(c),null;case 13:if(wn(Vn),o=c.memoizedState,o!==null&&o.dehydrated!==null){if(c.alternate===null)throw Error(we(340));Tu()}return o=c.flags,o&65536?(c.flags=o&-65537|128,c):null;case 19:return wn(Vn),null;case 4:return Ru(),null;case 10:return cw(c.type._context),null;case 22:case 23:return Cw(),null;case 24:return null;default:return null}}var vE=!1,Hr=!1,bne=typeof WeakSet=="function"?WeakSet:Set,Ke=null;function lu(o,c){var u=o.ref;if(u!==null)if(typeof u=="function")try{u(null)}catch(f){Kn(o,c,f)}else u.current=null}function TI(o,c,u){try{u()}catch(f){Kn(o,c,f)}}var fF=!1;function One(o,c){if(rI=YE,o=$B(),nw(o)){if("selectionStart"in o)var u={start:o.selectionStart,end:o.selectionEnd};else e:{u=(u=o.ownerDocument)&&u.defaultView||window;var f=u.getSelection&&u.getSelection();if(f&&f.rangeCount!==0){u=f.anchorNode;var E=f.anchorOffset,S=f.focusNode;f=f.focusOffset;try{u.nodeType,S.nodeType}catch{u=null;break e}var C=0,D=-1,k=-1,V=0,G=0,W=o,Q=null;t:for(;;){for(var me;W!==u||E!==0&&W.nodeType!==3||(D=C+E),W!==S||f!==0&&W.nodeType!==3||(k=C+f),W.nodeType===3&&(C+=W.nodeValue.length),(me=W.firstChild)!==null;)Q=W,W=me;for(;;){if(W===o)break t;if(Q===u&&++V===E&&(D=C),Q===S&&++G===f&&(k=C),(me=W.nextSibling)!==null)break;W=Q,Q=W.parentNode}W=me}u=D===-1||k===-1?null:{start:D,end:k}}else u=null}u=u||{start:0,end:0}}else u=null;for(iI={focusedElem:o,selectionRange:u},YE=!1,Ke=c;Ke!==null;)if(c=Ke,o=c.child,(c.subtreeFlags&1028)!==0&&o!==null)o.return=c,Ke=o;else for(;Ke!==null;){c=Ke;try{var z=c.alternate;if(c.flags&1024)switch(c.tag){case 0:case 11:case 15:break;case 1:if(z!==null){var de=z.memoizedProps,he=z.memoizedState,q=c.stateNode,K=q.getSnapshotBeforeUpdate(c.elementType===c.type?de:qo(c.type,de),he);q.__reactInternalSnapshotBeforeUpdate=K}break;case 3:var X=c.stateNode.containerInfo;X.nodeType===1?X.textContent="":X.nodeType===9&&X.documentElement&&X.removeChild(X.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(we(163))}}catch(Ee){Kn(c,c.return,Ee)}if(o=c.sibling,o!==null){o.return=c.return,Ke=o;break}Ke=c.return}return z=fF,fF=!1,z}function wp(o,c,u){var f=c.updateQueue;if(f=f!==null?f.lastEffect:null,f!==null){var E=f=f.next;do{if((E.tag&o)===o){var S=E.destroy;E.destroy=void 0,S!==void 0&&TI(c,u,S)}E=E.next}while(E!==f)}}function Rg(o,c){if(c=c.updateQueue,c=c!==null?c.lastEffect:null,c!==null){var u=c=c.next;do{if((u.tag&o)===o){var f=u.create;u.destroy=f()}u=u.next}while(u!==c)}}function vI(o){var c=o.ref;if(c!==null){var u=o.stateNode;switch(o.tag){case 5:o=u;break;default:o=u}typeof c=="function"?c(o):c.current=o}}function Xj(o){var c=o.alternate;c!==null&&(o.alternate=null,Xj(c)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(c=o.stateNode,c!==null&&(delete c[bs],delete c[Fp],delete c[aI],delete c[une],delete c[hne])),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}function Jj(o){return o.tag===5||o.tag===3||o.tag===4}function _F(o){e:for(;;){for(;o.sibling===null;){if(o.return===null||Jj(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==18;){if(o.flags&2||o.child===null||o.tag===4)continue e;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function RI(o,c,u){var f=o.tag;if(f===5||f===6)o=o.stateNode,c?u.nodeType===8?u.parentNode.insertBefore(o,c):u.insertBefore(o,c):(u.nodeType===8?(c=u.parentNode,c.insertBefore(o,u)):(c=u,c.appendChild(o)),u=u._reactRootContainer,u!=null||c.onclick!==null||(c.onclick=XE));else if(f!==4&&(o=o.child,o!==null))for(RI(o,c,u),o=o.sibling;o!==null;)RI(o,c,u),o=o.sibling}function yI(o,c,u){var f=o.tag;if(f===5||f===6)o=o.stateNode,c?u.insertBefore(o,c):u.appendChild(o);else if(f!==4&&(o=o.child,o!==null))for(yI(o,c,u),o=o.sibling;o!==null;)yI(o,c,u),o=o.sibling}var Pr=null,Xo=!1;function ja(o,c,u){for(u=u.child;u!==null;)Qj(o,c,u),u=u.sibling}function Qj(o,c,u){if(Os&&typeof Os.onCommitFiberUnmount=="function")try{Os.onCommitFiberUnmount(fg,u)}catch{}switch(u.tag){case 5:Hr||lu(u,c);case 6:var f=Pr,E=Xo;Pr=null,ja(o,c,u),Pr=f,Xo=E,Pr!==null&&(Xo?(o=Pr,u=u.stateNode,o.nodeType===8?o.parentNode.removeChild(u):o.removeChild(u)):Pr.removeChild(u.stateNode));break;case 18:Pr!==null&&(Xo?(o=Pr,u=u.stateNode,o.nodeType===8?vC(o.parentNode,u):o.nodeType===1&&vC(o,u),kp(o)):vC(Pr,u.stateNode));break;case 4:f=Pr,E=Xo,Pr=u.stateNode.containerInfo,Xo=!0,ja(o,c,u),Pr=f,Xo=E;break;case 0:case 11:case 14:case 15:if(!Hr&&(f=u.updateQueue,f!==null&&(f=f.lastEffect,f!==null))){E=f=f.next;do{var S=E,C=S.destroy;S=S.tag,C!==void 0&&(S&2||S&4)&&TI(u,c,C),E=E.next}while(E!==f)}ja(o,c,u);break;case 1:if(!Hr&&(lu(u,c),f=u.stateNode,typeof f.componentWillUnmount=="function"))try{f.props=u.memoizedProps,f.state=u.memoizedState,f.componentWillUnmount()}catch(D){Kn(u,c,D)}ja(o,c,u);break;case 21:ja(o,c,u);break;case 22:u.mode&1?(Hr=(f=Hr)||u.memoizedState!==null,ja(o,c,u),Hr=f):ja(o,c,u);break;default:ja(o,c,u)}}function mF(o){var c=o.updateQueue;if(c!==null){o.updateQueue=null;var u=o.stateNode;u===null&&(u=o.stateNode=new bne),c.forEach(function(f){var E=Vne.bind(null,o,f);u.has(f)||(u.add(f),f.then(E,E))})}}function zo(o,c){var u=c.deletions;if(u!==null)for(var f=0;f<u.length;f++){var E=u[f];try{var S=o,C=c,D=C;e:for(;D!==null;){switch(D.tag){case 5:Pr=D.stateNode,Xo=!1;break e;case 3:Pr=D.stateNode.containerInfo,Xo=!0;break e;case 4:Pr=D.stateNode.containerInfo,Xo=!0;break e}D=D.return}if(Pr===null)throw Error(we(160));Qj(S,C,E),Pr=null,Xo=!1;var k=E.alternate;k!==null&&(k.return=null),E.return=null}catch(V){Kn(E,c,V)}}if(c.subtreeFlags&12854)for(c=c.child;c!==null;)Zj(c,o),c=c.sibling}function Zj(o,c){var u=o.alternate,f=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:if(zo(c,o),Cs(o),f&4){try{wp(3,o,o.return),Rg(3,o)}catch(de){Kn(o,o.return,de)}try{wp(5,o,o.return)}catch(de){Kn(o,o.return,de)}}break;case 1:zo(c,o),Cs(o),f&512&&u!==null&&lu(u,u.return);break;case 5:if(zo(c,o),Cs(o),f&512&&u!==null&&lu(u,u.return),o.flags&32){var E=o.stateNode;try{Np(E,"")}catch(de){Kn(o,o.return,de)}}if(f&4&&(E=o.stateNode,E!=null)){var S=o.memoizedProps,C=u!==null?u.memoizedProps:S,D=o.type,k=o.updateQueue;if(o.updateQueue=null,k!==null)try{D==="input"&&S.type==="radio"&&S.name!=null&&TB(E,S),zC(D,C);var V=zC(D,S);for(C=0;C<k.length;C+=2){var G=k[C],W=k[C+1];G==="style"?IB(E,W):G==="dangerouslySetInnerHTML"?yB(E,W):G==="children"?Np(E,W):WI(E,G,W,V)}switch(D){case"input":GC(E,S);break;case"textarea":vB(E,S);break;case"select":var Q=E._wrapperState.wasMultiple;E._wrapperState.wasMultiple=!!S.multiple;var me=S.value;me!=null?hu(E,!!S.multiple,me,!1):Q!==!!S.multiple&&(S.defaultValue!=null?hu(E,!!S.multiple,S.defaultValue,!0):hu(E,!!S.multiple,S.multiple?[]:"",!1))}E[Fp]=S}catch(de){Kn(o,o.return,de)}}break;case 6:if(zo(c,o),Cs(o),f&4){if(o.stateNode===null)throw Error(we(162));E=o.stateNode,S=o.memoizedProps;try{E.nodeValue=S}catch(de){Kn(o,o.return,de)}}break;case 3:if(zo(c,o),Cs(o),f&4&&u!==null&&u.memoizedState.isDehydrated)try{kp(c.containerInfo)}catch(de){Kn(o,o.return,de)}break;case 4:zo(c,o),Cs(o);break;case 13:zo(c,o),Cs(o),E=o.child,E.flags&8192&&(S=E.memoizedState!==null,E.stateNode.isHidden=S,!S||E.alternate!==null&&E.alternate.memoizedState!==null||(Rw=Jn())),f&4&&mF(o);break;case 22:if(G=u!==null&&u.memoizedState!==null,o.mode&1?(Hr=(V=Hr)||G,zo(c,o),Hr=V):zo(c,o),Cs(o),f&8192){if(V=o.memoizedState!==null,(o.stateNode.isHidden=V)&&!G&&o.mode&1)for(Ke=o,G=o.child;G!==null;){for(W=Ke=G;Ke!==null;){switch(Q=Ke,me=Q.child,Q.tag){case 0:case 11:case 14:case 15:wp(4,Q,Q.return);break;case 1:lu(Q,Q.return);var z=Q.stateNode;if(typeof z.componentWillUnmount=="function"){f=Q,u=Q.return;try{c=f,z.props=c.memoizedProps,z.state=c.memoizedState,z.componentWillUnmount()}catch(de){Kn(f,u,de)}}break;case 5:lu(Q,Q.return);break;case 22:if(Q.memoizedState!==null){gF(W);continue}}me!==null?(me.return=Q,Ke=me):gF(W)}G=G.sibling}e:for(G=null,W=o;;){if(W.tag===5){if(G===null){G=W;try{E=W.stateNode,V?(S=E.style,typeof S.setProperty=="function"?S.setProperty("display","none","important"):S.display="none"):(D=W.stateNode,k=W.memoizedProps.style,C=k!=null&&k.hasOwnProperty("display")?k.display:null,D.style.display=CB("display",C))}catch(de){Kn(o,o.return,de)}}}else if(W.tag===6){if(G===null)try{W.stateNode.nodeValue=V?"":W.memoizedProps}catch(de){Kn(o,o.return,de)}}else if((W.tag!==22&&W.tag!==23||W.memoizedState===null||W===o)&&W.child!==null){W.child.return=W,W=W.child;continue}if(W===o)break e;for(;W.sibling===null;){if(W.return===null||W.return===o)break e;G===W&&(G=null),W=W.return}G===W&&(G=null),W.sibling.return=W.return,W=W.sibling}}break;case 19:zo(c,o),Cs(o),f&4&&mF(o);break;case 21:break;default:zo(c,o),Cs(o)}}function Cs(o){var c=o.flags;if(c&2){try{e:{for(var u=o.return;u!==null;){if(Jj(u)){var f=u;break e}u=u.return}throw Error(we(160))}switch(f.tag){case 5:var E=f.stateNode;f.flags&32&&(Np(E,""),f.flags&=-33);var S=_F(o);yI(o,S,E);break;case 3:case 4:var C=f.stateNode.containerInfo,D=_F(o);RI(o,D,C);break;default:throw Error(we(161))}}catch(k){Kn(o,o.return,k)}o.flags&=-3}c&4096&&(o.flags&=-4097)}function Nne(o,c,u){Ke=o,$j(o)}function $j(o,c,u){for(var f=(o.mode&1)!==0;Ke!==null;){var E=Ke,S=E.child;if(E.tag===22&&f){var C=E.memoizedState!==null||vE;if(!C){var D=E.alternate,k=D!==null&&D.memoizedState!==null||Hr;D=vE;var V=Hr;if(vE=C,(Hr=k)&&!V)for(Ke=E;Ke!==null;)C=Ke,k=C.child,C.tag===22&&C.memoizedState!==null?SF(E):k!==null?(k.return=C,Ke=k):SF(E);for(;S!==null;)Ke=S,$j(S),S=S.sibling;Ke=E,vE=D,Hr=V}EF(o)}else E.subtreeFlags&8772&&S!==null?(S.return=E,Ke=S):EF(o)}}function EF(o){for(;Ke!==null;){var c=Ke;if(c.flags&8772){var u=c.alternate;try{if(c.flags&8772)switch(c.tag){case 0:case 11:case 15:Hr||Rg(5,c);break;case 1:var f=c.stateNode;if(c.flags&4&&!Hr)if(u===null)f.componentDidMount();else{var E=c.elementType===c.type?u.memoizedProps:qo(c.type,u.memoizedProps);f.componentDidUpdate(E,u.memoizedState,f.__reactInternalSnapshotBeforeUpdate)}var S=c.updateQueue;S!==null&&tF(c,S,f);break;case 3:var C=c.updateQueue;if(C!==null){if(u=null,c.child!==null)switch(c.child.tag){case 5:u=c.child.stateNode;break;case 1:u=c.child.stateNode}tF(c,C,u)}break;case 5:var D=c.stateNode;if(u===null&&c.flags&4){u=D;var k=c.memoizedProps;switch(c.type){case"button":case"input":case"select":case"textarea":k.autoFocus&&u.focus();break;case"img":k.src&&(u.src=k.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(c.memoizedState===null){var V=c.alternate;if(V!==null){var G=V.memoizedState;if(G!==null){var W=G.dehydrated;W!==null&&kp(W)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(we(163))}Hr||c.flags&512&&vI(c)}catch(Q){Kn(c,c.return,Q)}}if(c===o){Ke=null;break}if(u=c.sibling,u!==null){u.return=c.return,Ke=u;break}Ke=c.return}}function gF(o){for(;Ke!==null;){var c=Ke;if(c===o){Ke=null;break}var u=c.sibling;if(u!==null){u.return=c.return,Ke=u;break}Ke=c.return}}function SF(o){for(;Ke!==null;){var c=Ke;try{switch(c.tag){case 0:case 11:case 15:var u=c.return;try{Rg(4,c)}catch(k){Kn(c,u,k)}break;case 1:var f=c.stateNode;if(typeof f.componentDidMount=="function"){var E=c.return;try{f.componentDidMount()}catch(k){Kn(c,E,k)}}var S=c.return;try{vI(c)}catch(k){Kn(c,S,k)}break;case 5:var C=c.return;try{vI(c)}catch(k){Kn(c,C,k)}}}catch(k){Kn(c,c.return,k)}if(c===o){Ke=null;break}var D=c.sibling;if(D!==null){D.return=c.return,Ke=D;break}Ke=c.return}}var Dne=Math.ceil,sg=ra.ReactCurrentDispatcher,Tw=ra.ReactCurrentOwner,So=ra.ReactCurrentBatchConfig,Yt=0,vr=null,rr=null,Lr=0,ji=0,uu=cc(0),dr=0,Kp=null,Td=0,yg=0,vw=0,Ap=null,Ti=null,Rw=0,Cu=1/0,qs=null,ag=!1,CI=null,ec=null,RE=!1,za=null,cg=0,bp=0,II=null,kE=-1,ME=0;function ni(){return Yt&6?Jn():kE!==-1?kE:kE=Jn()}function tc(o){return o.mode&1?Yt&2&&Lr!==0?Lr&-Lr:fne.transition!==null?(ME===0&&(ME=xB()),ME):(o=sn,o!==0||(o=window.event,o=o===void 0?16:HB(o.type)),o):1}function Zo(o,c,u,f){if(50<bp)throw bp=0,II=null,Error(we(185));Xp(o,u,f),(!(Yt&2)||o!==vr)&&(o===vr&&(!(Yt&2)&&(yg|=u),dr===4&&Ka(o,Lr)),Ci(o,f),u===1&&Yt===0&&!(c.mode&1)&&(Cu=Jn()+500,Sg&&dc()))}function Ci(o,c){var u=o.callbackNode;fte(o,c);var f=KE(o,o===vr?Lr:0);if(f===0)u!==null&&bV(u),o.callbackNode=null,o.callbackPriority=0;else if(c=f&-f,o.callbackPriority!==c){if(u!=null&&bV(u),c===1)o.tag===0?pne(TF.bind(null,o)):dj(TF.bind(null,o)),dne(function(){!(Yt&6)&&dc()}),u=null;else{switch(VB(f)){case 1:u=qI;break;case 4:u=MB;break;case 16:u=HE;break;case 536870912:u=UB;break;default:u=HE}u=a3(u,e3.bind(null,o))}o.callbackPriority=c,o.callbackNode=u}}function e3(o,c){if(kE=-1,ME=0,Yt&6)throw Error(we(327));var u=o.callbackNode;if(Eu()&&o.callbackNode!==u)return null;var f=KE(o,o===vr?Lr:0);if(f===0)return null;if(f&30||f&o.expiredLanes||c)c=dg(o,f);else{c=f;var E=Yt;Yt|=2;var S=n3();(vr!==o||Lr!==c)&&(qs=null,Cu=Jn()+500,fd(o,c));do try{kne();break}catch(D){t3(o,D)}while(!0);aw(),sg.current=S,Yt=E,rr!==null?c=0:(vr=null,Lr=0,c=dr)}if(c!==0){if(c===2&&(E=ZC(o),E!==0&&(f=E,c=wI(o,E))),c===1)throw u=Kp,fd(o,0),Ka(o,f),Ci(o,Jn()),u;if(c===6)Ka(o,f);else{if(E=o.current.alternate,!(f&30)&&!Pne(E)&&(c=dg(o,f),c===2&&(S=ZC(o),S!==0&&(f=S,c=wI(o,S))),c===1))throw u=Kp,fd(o,0),Ka(o,f),Ci(o,Jn()),u;switch(o.finishedWork=E,o.finishedLanes=f,c){case 0:case 1:throw Error(we(345));case 2:cd(o,Ti,qs);break;case 3:if(Ka(o,f),(f&130023424)===f&&(c=Rw+500-Jn(),10<c)){if(KE(o,0)!==0)break;if(E=o.suspendedLanes,(E&f)!==f){ni(),o.pingedLanes|=o.suspendedLanes&E;break}o.timeoutHandle=sI(cd.bind(null,o,Ti,qs),c);break}cd(o,Ti,qs);break;case 4:if(Ka(o,f),(f&4194240)===f)break;for(c=o.eventTimes,E=-1;0<f;){var C=31-Qo(f);S=1<<C,C=c[C],C>E&&(E=C),f&=~S}if(f=E,f=Jn()-f,f=(120>f?120:480>f?480:1080>f?1080:1920>f?1920:3e3>f?3e3:4320>f?4320:1960*Dne(f/1960))-f,10<f){o.timeoutHandle=sI(cd.bind(null,o,Ti,qs),f);break}cd(o,Ti,qs);break;case 5:cd(o,Ti,qs);break;default:throw Error(we(329))}}}return Ci(o,Jn()),o.callbackNode===u?e3.bind(null,o):null}function wI(o,c){var u=Ap;return o.current.memoizedState.isDehydrated&&(fd(o,c).flags|=256),o=dg(o,c),o!==2&&(c=Ti,Ti=u,c!==null&&AI(c)),o}function AI(o){Ti===null?Ti=o:Ti.push.apply(Ti,o)}function Pne(o){for(var c=o;;){if(c.flags&16384){var u=c.updateQueue;if(u!==null&&(u=u.stores,u!==null))for(var f=0;f<u.length;f++){var E=u[f],S=E.getSnapshot;E=E.value;try{if(!$o(S(),E))return!1}catch{return!1}}}if(u=c.child,c.subtreeFlags&16384&&u!==null)u.return=c,c=u;else{if(c===o)break;for(;c.sibling===null;){if(c.return===null||c.return===o)return!0;c=c.return}c.sibling.return=c.return,c=c.sibling}}return!0}function Ka(o,c){for(c&=~vw,c&=~yg,o.suspendedLanes|=c,o.pingedLanes&=~c,o=o.expirationTimes;0<c;){var u=31-Qo(c),f=1<<u;o[u]=-1,c&=~f}}function TF(o){if(Yt&6)throw Error(we(327));Eu();var c=KE(o,0);if(!(c&1))return Ci(o,Jn()),null;var u=dg(o,c);if(o.tag!==0&&u===2){var f=ZC(o);f!==0&&(c=f,u=wI(o,f))}if(u===1)throw u=Kp,fd(o,0),Ka(o,c),Ci(o,Jn()),u;if(u===6)throw Error(we(345));return o.finishedWork=o.current.alternate,o.finishedLanes=c,cd(o,Ti,qs),Ci(o,Jn()),null}function yw(o,c){var u=Yt;Yt|=1;try{return o(c)}finally{Yt=u,Yt===0&&(Cu=Jn()+500,Sg&&dc())}}function vd(o){za!==null&&za.tag===0&&!(Yt&6)&&Eu();var c=Yt;Yt|=1;var u=So.transition,f=sn;try{if(So.transition=null,sn=1,o)return o()}finally{sn=f,So.transition=u,Yt=c,!(Yt&6)&&dc()}}function Cw(){ji=uu.current,wn(uu)}function fd(o,c){o.finishedWork=null,o.finishedLanes=0;var u=o.timeoutHandle;if(u!==-1&&(o.timeoutHandle=-1,cne(u)),rr!==null)for(u=rr.return;u!==null;){var f=u;switch(iw(f),f.tag){case 1:f=f.type.childContextTypes,f!=null&&JE();break;case 3:Ru(),wn(Ri),wn(Yr),pw();break;case 5:hw(f);break;case 4:Ru();break;case 13:wn(Vn);break;case 19:wn(Vn);break;case 10:cw(f.type._context);break;case 22:case 23:Cw()}u=u.return}if(vr=o,rr=o=nc(o.current,null),Lr=ji=c,dr=0,Kp=null,vw=yg=Td=0,Ti=Ap=null,ud!==null){for(c=0;c<ud.length;c++)if(u=ud[c],f=u.interleaved,f!==null){u.interleaved=null;var E=f.next,S=u.pending;if(S!==null){var C=S.next;S.next=E,f.next=C}u.pending=f}ud=null}return o}function t3(o,c){do{var u=rr;try{if(aw(),DE.current=og,ig){for(var f=Fn.memoizedState;f!==null;){var E=f.queue;E!==null&&(E.pending=null),f=f.next}ig=!1}if(Sd=0,Tr=cr=Fn=null,Ip=!1,Gp=0,Tw.current=null,u===null||u.return===null){dr=1,Kp=c,rr=null;break}e:{var S=o,C=u.return,D=u,k=c;if(c=Lr,D.flags|=32768,k!==null&&typeof k=="object"&&typeof k.then=="function"){var V=k,G=D,W=G.tag;if(!(G.mode&1)&&(W===0||W===11||W===15)){var Q=G.alternate;Q?(G.updateQueue=Q.updateQueue,G.memoizedState=Q.memoizedState,G.lanes=Q.lanes):(G.updateQueue=null,G.memoizedState=null)}var me=aF(C);if(me!==null){me.flags&=-257,cF(me,C,D,S,c),me.mode&1&&sF(S,V,c),c=me,k=V;var z=c.updateQueue;if(z===null){var de=new Set;de.add(k),c.updateQueue=de}else z.add(k);break e}else{if(!(c&1)){sF(S,V,c),Iw();break e}k=Error(we(426))}}else if(Ln&&D.mode&1){var he=aF(C);if(he!==null){!(he.flags&65536)&&(he.flags|=256),cF(he,C,D,S,c),ow(yu(k,D));break e}}S=k=yu(k,D),dr!==4&&(dr=2),Ap===null?Ap=[S]:Ap.push(S),S=C;do{switch(S.tag){case 3:S.flags|=65536,c&=-c,S.lanes|=c;var q=Vj(S,k,c);eF(S,q);break e;case 1:D=k;var K=S.type,X=S.stateNode;if(!(S.flags&128)&&(typeof K.getDerivedStateFromError=="function"||X!==null&&typeof X.componentDidCatch=="function"&&(ec===null||!ec.has(X)))){S.flags|=65536,c&=-c,S.lanes|=c;var Ee=Fj(S,D,c);eF(S,Ee);break e}}S=S.return}while(S!==null)}i3(u)}catch(Oe){c=Oe,rr===u&&u!==null&&(rr=u=u.return);continue}break}while(!0)}function n3(){var o=sg.current;return sg.current=og,o===null?og:o}function Iw(){(dr===0||dr===3||dr===2)&&(dr=4),vr===null||!(Td&268435455)&&!(yg&268435455)||Ka(vr,Lr)}function dg(o,c){var u=Yt;Yt|=2;var f=n3();(vr!==o||Lr!==c)&&(qs=null,fd(o,c));do try{Lne();break}catch(E){t3(o,E)}while(!0);if(aw(),Yt=u,sg.current=f,rr!==null)throw Error(we(261));return vr=null,Lr=0,dr}function Lne(){for(;rr!==null;)r3(rr)}function kne(){for(;rr!==null&&!ote();)r3(rr)}function r3(o){var c=s3(o.alternate,o,ji);o.memoizedProps=o.pendingProps,c===null?i3(o):rr=c,Tw.current=null}function i3(o){var c=o;do{var u=c.alternate;if(o=c.return,c.flags&32768){if(u=Ane(u,c),u!==null){u.flags&=32767,rr=u;return}if(o!==null)o.flags|=32768,o.subtreeFlags=0,o.deletions=null;else{dr=6,rr=null;return}}else if(u=wne(u,c,ji),u!==null){rr=u;return}if(c=c.sibling,c!==null){rr=c;return}rr=c=o}while(c!==null);dr===0&&(dr=5)}function cd(o,c,u){var f=sn,E=So.transition;try{So.transition=null,sn=1,Mne(o,c,u,f)}finally{So.transition=E,sn=f}return null}function Mne(o,c,u,f){do Eu();while(za!==null);if(Yt&6)throw Error(we(327));u=o.finishedWork;var E=o.finishedLanes;if(u===null)return null;if(o.finishedWork=null,o.finishedLanes=0,u===o.current)throw Error(we(177));o.callbackNode=null,o.callbackPriority=0;var S=u.lanes|u.childLanes;if(_te(o,S),o===vr&&(rr=vr=null,Lr=0),!(u.subtreeFlags&2064)&&!(u.flags&2064)||RE||(RE=!0,a3(HE,function(){return Eu(),null})),S=(u.flags&15990)!==0,u.subtreeFlags&15990||S){S=So.transition,So.transition=null;var C=sn;sn=1;var D=Yt;Yt|=4,Tw.current=null,One(o,u),Zj(u,o),tne(iI),YE=!!rI,iI=rI=null,o.current=u,Nne(u),ste(),Yt=D,sn=C,So.transition=S}else o.current=u;if(RE&&(RE=!1,za=o,cg=E),S=o.pendingLanes,S===0&&(ec=null),dte(u.stateNode),Ci(o,Jn()),c!==null)for(f=o.onRecoverableError,u=0;u<c.length;u++)E=c[u],f(E.value,{componentStack:E.stack,digest:E.digest});if(ag)throw ag=!1,o=CI,CI=null,o;return cg&1&&o.tag!==0&&Eu(),S=o.pendingLanes,S&1?o===II?bp++:(bp=0,II=o):bp=0,dc(),null}function Eu(){if(za!==null){var o=VB(cg),c=So.transition,u=sn;try{if(So.transition=null,sn=16>o?16:o,za===null)var f=!1;else{if(o=za,za=null,cg=0,Yt&6)throw Error(we(331));var E=Yt;for(Yt|=4,Ke=o.current;Ke!==null;){var S=Ke,C=S.child;if(Ke.flags&16){var D=S.deletions;if(D!==null){for(var k=0;k<D.length;k++){var V=D[k];for(Ke=V;Ke!==null;){var G=Ke;switch(G.tag){case 0:case 11:case 15:wp(8,G,S)}var W=G.child;if(W!==null)W.return=G,Ke=W;else for(;Ke!==null;){G=Ke;var Q=G.sibling,me=G.return;if(Xj(G),G===V){Ke=null;break}if(Q!==null){Q.return=me,Ke=Q;break}Ke=me}}}var z=S.alternate;if(z!==null){var de=z.child;if(de!==null){z.child=null;do{var he=de.sibling;de.sibling=null,de=he}while(de!==null)}}Ke=S}}if(S.subtreeFlags&2064&&C!==null)C.return=S,Ke=C;else e:for(;Ke!==null;){if(S=Ke,S.flags&2048)switch(S.tag){case 0:case 11:case 15:wp(9,S,S.return)}var q=S.sibling;if(q!==null){q.return=S.return,Ke=q;break e}Ke=S.return}}var K=o.current;for(Ke=K;Ke!==null;){C=Ke;var X=C.child;if(C.subtreeFlags&2064&&X!==null)X.return=C,Ke=X;else e:for(C=K;Ke!==null;){if(D=Ke,D.flags&2048)try{switch(D.tag){case 0:case 11:case 15:Rg(9,D)}}catch(Oe){Kn(D,D.return,Oe)}if(D===C){Ke=null;break e}var Ee=D.sibling;if(Ee!==null){Ee.return=D.return,Ke=Ee;break e}Ke=D.return}}if(Yt=E,dc(),Os&&typeof Os.onPostCommitFiberRoot=="function")try{Os.onPostCommitFiberRoot(fg,o)}catch{}f=!0}return f}finally{sn=u,So.transition=c}}return!1}function vF(o,c,u){c=yu(u,c),c=Vj(o,c,1),o=$a(o,c,1),c=ni(),o!==null&&(Xp(o,1,c),Ci(o,c))}function Kn(o,c,u){if(o.tag===3)vF(o,o,u);else for(;c!==null;){if(c.tag===3){vF(c,o,u);break}else if(c.tag===1){var f=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(ec===null||!ec.has(f))){o=yu(u,o),o=Fj(c,o,1),c=$a(c,o,1),o=ni(),c!==null&&(Xp(c,1,o),Ci(c,o));break}}c=c.return}}function Une(o,c,u){var f=o.pingCache;f!==null&&f.delete(c),c=ni(),o.pingedLanes|=o.suspendedLanes&u,vr===o&&(Lr&u)===u&&(dr===4||dr===3&&(Lr&130023424)===Lr&&500>Jn()-Rw?fd(o,0):vw|=u),Ci(o,c)}function o3(o,c){c===0&&(o.mode&1?(c=hE,hE<<=1,!(hE&130023424)&&(hE=4194304)):c=1);var u=ni();o=ta(o,c),o!==null&&(Xp(o,c,u),Ci(o,u))}function xne(o){var c=o.memoizedState,u=0;c!==null&&(u=c.retryLane),o3(o,u)}function Vne(o,c){var u=0;switch(o.tag){case 13:var f=o.stateNode,E=o.memoizedState;E!==null&&(u=E.retryLane);break;case 19:f=o.stateNode;break;default:throw Error(we(314))}f!==null&&f.delete(c),o3(o,u)}var s3;s3=function(o,c,u){if(o!==null)if(o.memoizedProps!==c.pendingProps||Ri.current)vi=!0;else{if(!(o.lanes&u)&&!(c.flags&128))return vi=!1,Ine(o,c,u);vi=!!(o.flags&131072)}else vi=!1,Ln&&c.flags&1048576&&lj(c,$E,c.index);switch(c.lanes=0,c.tag){case 2:var f=c.type;LE(o,c),o=c.pendingProps;var E=Su(c,Yr.current);mu(c,u),E=_w(null,c,f,o,E,u);var S=mw();return c.flags|=1,typeof E=="object"&&E!==null&&typeof E.render=="function"&&E.$$typeof===void 0?(c.tag=1,c.memoizedState=null,c.updateQueue=null,yi(f)?(S=!0,QE(c)):S=!1,c.memoizedState=E.state!==null&&E.state!==void 0?E.state:null,lw(c),E.updater=vg,c.stateNode=E,E._reactInternals=c,pI(c,f,o,u),c=mI(null,c,f,!0,S,u)):(c.tag=0,Ln&&S&&rw(c),ti(null,c,E,u),c=c.child),c;case 16:f=c.elementType;e:{switch(LE(o,c),o=c.pendingProps,E=f._init,f=E(f._payload),c.type=f,E=c.tag=Bne(f),o=qo(f,o),E){case 0:c=_I(null,c,f,o,u);break e;case 1:c=uF(null,c,f,o,u);break e;case 11:c=dF(null,c,f,o,u);break e;case 14:c=lF(null,c,f,qo(f.type,o),u);break e}throw Error(we(306,f,""))}return c;case 0:return f=c.type,E=c.pendingProps,E=c.elementType===f?E:qo(f,E),_I(o,c,f,E,u);case 1:return f=c.type,E=c.pendingProps,E=c.elementType===f?E:qo(f,E),uF(o,c,f,E,u);case 3:e:{if(Wj(c),o===null)throw Error(we(387));f=c.pendingProps,S=c.memoizedState,E=S.element,mj(o,c),ng(c,f,null,u);var C=c.memoizedState;if(f=C.element,S.isDehydrated)if(S={element:f,isDehydrated:!1,cache:C.cache,pendingSuspenseBoundaries:C.pendingSuspenseBoundaries,transitions:C.transitions},c.updateQueue.baseState=S,c.memoizedState=S,c.flags&256){E=yu(Error(we(423)),c),c=hF(o,c,f,u,E);break e}else if(f!==E){E=yu(Error(we(424)),c),c=hF(o,c,f,u,E);break e}else for(Gi=Za(c.stateNode.containerInfo.firstChild),Wi=c,Ln=!0,Jo=null,u=fj(c,null,f,u),c.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling;else{if(Tu(),f===E){c=na(o,c,u);break e}ti(o,c,f,u)}c=c.child}return c;case 5:return Ej(c),o===null&&lI(c),f=c.type,E=c.pendingProps,S=o!==null?o.memoizedProps:null,C=E.children,oI(f,E)?C=null:S!==null&&oI(f,S)&&(c.flags|=32),Gj(o,c),ti(o,c,C,u),c.child;case 6:return o===null&&lI(c),null;case 13:return Hj(o,c,u);case 4:return uw(c,c.stateNode.containerInfo),f=c.pendingProps,o===null?c.child=vu(c,null,f,u):ti(o,c,f,u),c.child;case 11:return f=c.type,E=c.pendingProps,E=c.elementType===f?E:qo(f,E),dF(o,c,f,E,u);case 7:return ti(o,c,c.pendingProps,u),c.child;case 8:return ti(o,c,c.pendingProps.children,u),c.child;case 12:return ti(o,c,c.pendingProps.children,u),c.child;case 10:e:{if(f=c.type._context,E=c.pendingProps,S=c.memoizedProps,C=E.value,gn(eg,f._currentValue),f._currentValue=C,S!==null)if($o(S.value,C)){if(S.children===E.children&&!Ri.current){c=na(o,c,u);break e}}else for(S=c.child,S!==null&&(S.return=c);S!==null;){var D=S.dependencies;if(D!==null){C=S.child;for(var k=D.firstContext;k!==null;){if(k.context===f){if(S.tag===1){k=Zs(-1,u&-u),k.tag=2;var V=S.updateQueue;if(V!==null){V=V.shared;var G=V.pending;G===null?k.next=k:(k.next=G.next,G.next=k),V.pending=k}}S.lanes|=u,k=S.alternate,k!==null&&(k.lanes|=u),uI(S.return,u,c),D.lanes|=u;break}k=k.next}}else if(S.tag===10)C=S.type===c.type?null:S.child;else if(S.tag===18){if(C=S.return,C===null)throw Error(we(341));C.lanes|=u,D=C.alternate,D!==null&&(D.lanes|=u),uI(C,u,c),C=S.sibling}else C=S.child;if(C!==null)C.return=S;else for(C=S;C!==null;){if(C===c){C=null;break}if(S=C.sibling,S!==null){S.return=C.return,C=S;break}C=C.return}S=C}ti(o,c,E.children,u),c=c.child}return c;case 9:return E=c.type,f=c.pendingProps.children,mu(c,u),E=To(E),f=f(E),c.flags|=1,ti(o,c,f,u),c.child;case 14:return f=c.type,E=qo(f,c.pendingProps),E=qo(f.type,E),lF(o,c,f,E,u);case 15:return Bj(o,c,c.type,c.pendingProps,u);case 17:return f=c.type,E=c.pendingProps,E=c.elementType===f?E:qo(f,E),LE(o,c),c.tag=1,yi(f)?(o=!0,QE(c)):o=!1,mu(c,u),xj(c,f,E),pI(c,f,E,u),mI(null,c,f,!0,o,u);case 19:return Kj(o,c,u);case 22:return jj(o,c,u)}throw Error(we(156,c.tag))};function a3(o,c){return kB(o,c)}function Fne(o,c,u,f){this.tag=o,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function go(o,c,u,f){return new Fne(o,c,u,f)}function ww(o){return o=o.prototype,!(!o||!o.isReactComponent)}function Bne(o){if(typeof o=="function")return ww(o)?1:0;if(o!=null){if(o=o.$$typeof,o===KI)return 11;if(o===YI)return 14}return 2}function nc(o,c){var u=o.alternate;return u===null?(u=go(o.tag,c,o.key,o.mode),u.elementType=o.elementType,u.type=o.type,u.stateNode=o.stateNode,u.alternate=o,o.alternate=u):(u.pendingProps=c,u.type=o.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=o.flags&14680064,u.childLanes=o.childLanes,u.lanes=o.lanes,u.child=o.child,u.memoizedProps=o.memoizedProps,u.memoizedState=o.memoizedState,u.updateQueue=o.updateQueue,c=o.dependencies,u.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},u.sibling=o.sibling,u.index=o.index,u.ref=o.ref,u}function UE(o,c,u,f,E,S){var C=2;if(f=o,typeof o=="function")ww(o)&&(C=1);else if(typeof o=="string")C=5;else e:switch(o){case tu:return _d(u.children,E,S,c);case HI:C=8,E|=8;break;case xC:return o=go(12,u,c,E|2),o.elementType=xC,o.lanes=S,o;case VC:return o=go(13,u,c,E),o.elementType=VC,o.lanes=S,o;case FC:return o=go(19,u,c,E),o.elementType=FC,o.lanes=S,o;case EB:return Cg(u,E,S,c);default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case _B:C=10;break e;case mB:C=9;break e;case KI:C=11;break e;case YI:C=14;break e;case Ga:C=16,f=null;break e}throw Error(we(130,o==null?o:typeof o,""))}return c=go(C,u,c,E),c.elementType=o,c.type=f,c.lanes=S,c}function _d(o,c,u,f){return o=go(7,o,f,c),o.lanes=u,o}function Cg(o,c,u,f){return o=go(22,o,f,c),o.elementType=EB,o.lanes=u,o.stateNode={isHidden:!1},o}function OC(o,c,u){return o=go(6,o,null,c),o.lanes=u,o}function NC(o,c,u){return c=go(4,o.children!==null?o.children:[],o.key,c),c.lanes=u,c.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},c}function jne(o,c,u,f,E){this.tag=c,this.containerInfo=o,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=lC(0),this.expirationTimes=lC(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=lC(0),this.identifierPrefix=f,this.onRecoverableError=E,this.mutableSourceEagerHydrationData=null}function Aw(o,c,u,f,E,S,C,D,k){return o=new jne(o,c,u,D,k),c===1?(c=1,S===!0&&(c|=8)):c=0,S=go(3,null,null,c),o.current=S,S.stateNode=o,S.memoizedState={element:f,isDehydrated:u,cache:null,transitions:null,pendingSuspenseBoundaries:null},lw(S),o}function Gne(o,c,u){var f=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:eu,key:f==null?null:""+f,children:o,containerInfo:c,implementation:u}}function c3(o){if(!o)return sc;o=o._reactInternals;e:{if(Cd(o)!==o||o.tag!==1)throw Error(we(170));var c=o;do{switch(c.tag){case 3:c=c.stateNode.context;break e;case 1:if(yi(c.type)){c=c.stateNode.__reactInternalMemoizedMergedChildContext;break e}}c=c.return}while(c!==null);throw Error(we(171))}if(o.tag===1){var u=o.type;if(yi(u))return cj(o,u,c)}return c}function d3(o,c,u,f,E,S,C,D,k){return o=Aw(u,f,!0,o,E,S,C,D,k),o.context=c3(null),u=o.current,f=ni(),E=tc(u),S=Zs(f,E),S.callback=c??null,$a(u,S,E),o.current.lanes=E,Xp(o,E,f),Ci(o,f),o}function Ig(o,c,u,f){var E=c.current,S=ni(),C=tc(E);return u=c3(u),c.context===null?c.context=u:c.pendingContext=u,c=Zs(S,C),c.payload={element:o},f=f===void 0?null:f,f!==null&&(c.callback=f),o=$a(E,c,C),o!==null&&(Zo(o,E,C,S),NE(o,E,C)),C}function lg(o){if(o=o.current,!o.child)return null;switch(o.child.tag){case 5:return o.child.stateNode;default:return o.child.stateNode}}function RF(o,c){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var u=o.retryLane;o.retryLane=u!==0&&u<c?u:c}}function bw(o,c){RF(o,c),(o=o.alternate)&&RF(o,c)}function Wne(){return null}var l3=typeof reportError=="function"?reportError:function(o){console.error(o)};function Ow(o){this._internalRoot=o}wg.prototype.render=Ow.prototype.render=function(o){var c=this._internalRoot;if(c===null)throw Error(we(409));Ig(o,c,null,null)};wg.prototype.unmount=Ow.prototype.unmount=function(){var o=this._internalRoot;if(o!==null){this._internalRoot=null;var c=o.containerInfo;vd(function(){Ig(null,o,null,null)}),c[ea]=null}};function wg(o){this._internalRoot=o}wg.prototype.unstable_scheduleHydration=function(o){if(o){var c=jB();o={blockedOn:null,target:o,priority:c};for(var u=0;u<Ha.length&&c!==0&&c<Ha[u].priority;u++);Ha.splice(u,0,o),u===0&&WB(o)}};function Nw(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11)}function Ag(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11&&(o.nodeType!==8||o.nodeValue!==" react-mount-point-unstable "))}function yF(){}function Hne(o,c,u,f,E){if(E){if(typeof f=="function"){var S=f;f=function(){var V=lg(C);S.call(V)}}var C=d3(c,f,o,0,null,!1,!1,"",yF);return o._reactRootContainer=C,o[ea]=C.current,xp(o.nodeType===8?o.parentNode:o),vd(),C}for(;E=o.lastChild;)o.removeChild(E);if(typeof f=="function"){var D=f;f=function(){var V=lg(k);D.call(V)}}var k=Aw(o,0,!1,null,null,!1,!1,"",yF);return o._reactRootContainer=k,o[ea]=k.current,xp(o.nodeType===8?o.parentNode:o),vd(function(){Ig(c,k,u,f)}),k}function bg(o,c,u,f,E){var S=u._reactRootContainer;if(S){var C=S;if(typeof E=="function"){var D=E;E=function(){var k=lg(C);D.call(k)}}Ig(c,C,o,E)}else C=Hne(u,c,o,E,f);return lg(C)}FB=function(o){switch(o.tag){case 3:var c=o.stateNode;if(c.current.memoizedState.isDehydrated){var u=Ep(c.pendingLanes);u!==0&&(XI(c,u|1),Ci(c,Jn()),!(Yt&6)&&(Cu=Jn()+500,dc()))}break;case 13:vd(function(){var f=ta(o,1);if(f!==null){var E=ni();Zo(f,o,1,E)}}),bw(o,1)}};JI=function(o){if(o.tag===13){var c=ta(o,134217728);if(c!==null){var u=ni();Zo(c,o,134217728,u)}bw(o,134217728)}};BB=function(o){if(o.tag===13){var c=tc(o),u=ta(o,c);if(u!==null){var f=ni();Zo(u,o,c,f)}bw(o,c)}};jB=function(){return sn};GB=function(o,c){var u=sn;try{return sn=o,c()}finally{sn=u}};XC=function(o,c,u){switch(c){case"input":if(GC(o,u),c=u.name,u.type==="radio"&&c!=null){for(u=o;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll("input[name="+JSON.stringify(""+c)+'][type="radio"]'),c=0;c<u.length;c++){var f=u[c];if(f!==o&&f.form===o.form){var E=gg(f);if(!E)throw Error(we(90));SB(f),GC(f,E)}}}break;case"textarea":vB(o,u);break;case"select":c=u.value,c!=null&&hu(o,!!u.multiple,c,!1)}};bB=yw;OB=vd;var Kne={usingClientEntryPoint:!1,Events:[Qp,ou,gg,wB,AB,yw]},pp={findFiberByHostInstance:ld,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Yne={bundleType:pp.bundleType,version:pp.version,rendererPackageName:pp.rendererPackageName,rendererConfig:pp.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ra.ReactCurrentDispatcher,findHostInstanceByFiber:function(o){return o=PB(o),o===null?null:o.stateNode},findFiberByHostInstance:pp.findFiberByHostInstance||Wne,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var yE=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!yE.isDisabled&&yE.supportsFiber)try{fg=yE.inject(Yne),Os=yE}catch{}}Ki.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Kne;Ki.createPortal=function(o,c){var u=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Nw(c))throw Error(we(200));return Gne(o,c,null,u)};Ki.createRoot=function(o,c){if(!Nw(o))throw Error(we(299));var u=!1,f="",E=l3;return c!=null&&(c.unstable_strictMode===!0&&(u=!0),c.identifierPrefix!==void 0&&(f=c.identifierPrefix),c.onRecoverableError!==void 0&&(E=c.onRecoverableError)),c=Aw(o,1,!1,null,null,u,!1,f,E),o[ea]=c.current,xp(o.nodeType===8?o.parentNode:o),new Ow(c)};Ki.findDOMNode=function(o){if(o==null)return null;if(o.nodeType===1)return o;var c=o._reactInternals;if(c===void 0)throw typeof o.render=="function"?Error(we(188)):(o=Object.keys(o).join(","),Error(we(268,o)));return o=PB(c),o=o===null?null:o.stateNode,o};Ki.flushSync=function(o){return vd(o)};Ki.hydrate=function(o,c,u){if(!Ag(c))throw Error(we(200));return bg(null,o,c,!0,u)};Ki.hydrateRoot=function(o,c,u){if(!Nw(o))throw Error(we(405));var f=u!=null&&u.hydratedSources||null,E=!1,S="",C=l3;if(u!=null&&(u.unstable_strictMode===!0&&(E=!0),u.identifierPrefix!==void 0&&(S=u.identifierPrefix),u.onRecoverableError!==void 0&&(C=u.onRecoverableError)),c=d3(c,null,o,1,u??null,E,!1,S,C),o[ea]=c.current,xp(o),f)for(o=0;o<f.length;o++)u=f[o],E=u._getVersion,E=E(u._source),c.mutableSourceEagerHydrationData==null?c.mutableSourceEagerHydrationData=[u,E]:c.mutableSourceEagerHydrationData.push(u,E);return new wg(c)};Ki.render=function(o,c,u){if(!Ag(c))throw Error(we(200));return bg(null,o,c,!1,u)};Ki.unmountComponentAtNode=function(o){if(!Ag(o))throw Error(we(40));return o._reactRootContainer?(vd(function(){bg(null,null,o,!1,function(){o._reactRootContainer=null,o[ea]=null})}),!0):!1};Ki.unstable_batchedUpdates=yw;Ki.unstable_renderSubtreeIntoContainer=function(o,c,u,f){if(!Ag(u))throw Error(we(200));if(o==null||o._reactInternals===void 0)throw Error(we(38));return bg(o,c,u,!1,f)};Ki.version="18.3.1-next-f1338f8080-20240426";function u3(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(u3)}catch(o){console.error(o)}}u3(),uB.exports=Ki;var zne=uB.exports,CF=zne;MC.createRoot=CF.createRoot,MC.hydrateRoot=CF.hydrateRoot;/**
 * @remix-run/router v1.23.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Yp(){return Yp=Object.assign?Object.assign.bind():function(o){for(var c=1;c<arguments.length;c++){var u=arguments[c];for(var f in u)Object.prototype.hasOwnProperty.call(u,f)&&(o[f]=u[f])}return o},Yp.apply(this,arguments)}var qa;(function(o){o.Pop="POP",o.Push="PUSH",o.Replace="REPLACE"})(qa||(qa={}));const IF="popstate";function qne(o){o===void 0&&(o={});function c(f,E){let{pathname:S,search:C,hash:D}=f.location;return bI("",{pathname:S,search:C,hash:D},E.state&&E.state.usr||null,E.state&&E.state.key||"default")}function u(f,E){return typeof E=="string"?E:ug(E)}return Jne(c,u,null,o)}function Qn(o,c){if(o===!1||o===null||typeof o>"u")throw new Error(c)}function Dw(o,c){if(!o){typeof console<"u"&&console.warn(c);try{throw new Error(c)}catch{}}}function Xne(){return Math.random().toString(36).substr(2,8)}function wF(o,c){return{usr:o.state,key:o.key,idx:c}}function bI(o,c,u,f){return u===void 0&&(u=null),Yp({pathname:typeof o=="string"?o:o.pathname,search:"",hash:""},typeof c=="string"?Ou(c):c,{state:u,key:c&&c.key||f||Xne()})}function ug(o){let{pathname:c="/",search:u="",hash:f=""}=o;return u&&u!=="?"&&(c+=u.charAt(0)==="?"?u:"?"+u),f&&f!=="#"&&(c+=f.charAt(0)==="#"?f:"#"+f),c}function Ou(o){let c={};if(o){let u=o.indexOf("#");u>=0&&(c.hash=o.substr(u),o=o.substr(0,u));let f=o.indexOf("?");f>=0&&(c.search=o.substr(f),o=o.substr(0,f)),o&&(c.pathname=o)}return c}function Jne(o,c,u,f){f===void 0&&(f={});let{window:E=document.defaultView,v5Compat:S=!1}=f,C=E.history,D=qa.Pop,k=null,V=G();V==null&&(V=0,C.replaceState(Yp({},C.state,{idx:V}),""));function G(){return(C.state||{idx:null}).idx}function W(){D=qa.Pop;let he=G(),q=he==null?null:he-V;V=he,k&&k({action:D,location:de.location,delta:q})}function Q(he,q){D=qa.Push;let K=bI(de.location,he,q);V=G()+1;let X=wF(K,V),Ee=de.createHref(K);try{C.pushState(X,"",Ee)}catch(Oe){if(Oe instanceof DOMException&&Oe.name==="DataCloneError")throw Oe;E.location.assign(Ee)}S&&k&&k({action:D,location:de.location,delta:1})}function me(he,q){D=qa.Replace;let K=bI(de.location,he,q);V=G();let X=wF(K,V),Ee=de.createHref(K);C.replaceState(X,"",Ee),S&&k&&k({action:D,location:de.location,delta:0})}function z(he){let q=E.location.origin!=="null"?E.location.origin:E.location.href,K=typeof he=="string"?he:ug(he);return K=K.replace(/ $/,"%20"),Qn(q,"No window.location.(origin|href) available to create URL for href: "+K),new URL(K,q)}let de={get action(){return D},get location(){return o(E,C)},listen(he){if(k)throw new Error("A history only accepts one active listener");return E.addEventListener(IF,W),k=he,()=>{E.removeEventListener(IF,W),k=null}},createHref(he){return c(E,he)},createURL:z,encodeLocation(he){let q=z(he);return{pathname:q.pathname,search:q.search,hash:q.hash}},push:Q,replace:me,go(he){return C.go(he)}};return de}var AF;(function(o){o.data="data",o.deferred="deferred",o.redirect="redirect",o.error="error"})(AF||(AF={}));function Qne(o,c,u){return u===void 0&&(u="/"),Zne(o,c,u)}function Zne(o,c,u,f){let E=typeof c=="string"?Ou(c):c,S=Pw(E.pathname||"/",u);if(S==null)return null;let C=h3(o);$ne(C);let D=null;for(let k=0;D==null&&k<C.length;++k){let V=ure(S);D=cre(C[k],V)}return D}function h3(o,c,u,f){c===void 0&&(c=[]),u===void 0&&(u=[]),f===void 0&&(f="");let E=(S,C,D)=>{let k={relativePath:D===void 0?S.path||"":D,caseSensitive:S.caseSensitive===!0,childrenIndex:C,route:S};k.relativePath.startsWith("/")&&(Qn(k.relativePath.startsWith(f),'Absolute route path "'+k.relativePath+'" nested under path '+('"'+f+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),k.relativePath=k.relativePath.slice(f.length));let V=rc([f,k.relativePath]),G=u.concat(k);S.children&&S.children.length>0&&(Qn(S.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+V+'".')),h3(S.children,c,G,V)),!(S.path==null&&!S.index)&&c.push({path:V,score:sre(V,S.index),routesMeta:G})};return o.forEach((S,C)=>{var D;if(S.path===""||!((D=S.path)!=null&&D.includes("?")))E(S,C);else for(let k of p3(S.path))E(S,C,k)}),c}function p3(o){let c=o.split("/");if(c.length===0)return[];let[u,...f]=c,E=u.endsWith("?"),S=u.replace(/\?$/,"");if(f.length===0)return E?[S,""]:[S];let C=p3(f.join("/")),D=[];return D.push(...C.map(k=>k===""?S:[S,k].join("/"))),E&&D.push(...C),D.map(k=>o.startsWith("/")&&k===""?"/":k)}function $ne(o){o.sort((c,u)=>c.score!==u.score?u.score-c.score:are(c.routesMeta.map(f=>f.childrenIndex),u.routesMeta.map(f=>f.childrenIndex)))}const ere=/^:[\w-]+$/,tre=3,nre=2,rre=1,ire=10,ore=-2,bF=o=>o==="*";function sre(o,c){let u=o.split("/"),f=u.length;return u.some(bF)&&(f+=ore),c&&(f+=nre),u.filter(E=>!bF(E)).reduce((E,S)=>E+(ere.test(S)?tre:S===""?rre:ire),f)}function are(o,c){return o.length===c.length&&o.slice(0,-1).every((f,E)=>f===c[E])?o[o.length-1]-c[c.length-1]:0}function cre(o,c,u){let{routesMeta:f}=o,E={},S="/",C=[];for(let D=0;D<f.length;++D){let k=f[D],V=D===f.length-1,G=S==="/"?c:c.slice(S.length)||"/",W=dre({path:k.relativePath,caseSensitive:k.caseSensitive,end:V},G),Q=k.route;if(!W)return null;Object.assign(E,W.params),C.push({params:E,pathname:rc([S,W.pathname]),pathnameBase:mre(rc([S,W.pathnameBase])),route:Q}),W.pathnameBase!=="/"&&(S=rc([S,W.pathnameBase]))}return C}function dre(o,c){typeof o=="string"&&(o={path:o,caseSensitive:!1,end:!0});let[u,f]=lre(o.path,o.caseSensitive,o.end),E=c.match(u);if(!E)return null;let S=E[0],C=S.replace(/(.)\/+$/,"$1"),D=E.slice(1);return{params:f.reduce((V,G,W)=>{let{paramName:Q,isOptional:me}=G;if(Q==="*"){let de=D[W]||"";C=S.slice(0,S.length-de.length).replace(/(.)\/+$/,"$1")}const z=D[W];return me&&!z?V[Q]=void 0:V[Q]=(z||"").replace(/%2F/g,"/"),V},{}),pathname:S,pathnameBase:C,pattern:o}}function lre(o,c,u){c===void 0&&(c=!1),u===void 0&&(u=!0),Dw(o==="*"||!o.endsWith("*")||o.endsWith("/*"),'Route path "'+o+'" will be treated as if it were '+('"'+o.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+o.replace(/\*$/,"/*")+'".'));let f=[],E="^"+o.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(C,D,k)=>(f.push({paramName:D,isOptional:k!=null}),k?"/?([^\\/]+)?":"/([^\\/]+)"));return o.endsWith("*")?(f.push({paramName:"*"}),E+=o==="*"||o==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):u?E+="\\/*$":o!==""&&o!=="/"&&(E+="(?:(?=\\/|$))"),[new RegExp(E,c?void 0:"i"),f]}function ure(o){try{return o.split("/").map(c=>decodeURIComponent(c).replace(/\//g,"%2F")).join("/")}catch(c){return Dw(!1,'The URL path "'+o+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+c+").")),o}}function Pw(o,c){if(c==="/")return o;if(!o.toLowerCase().startsWith(c.toLowerCase()))return null;let u=c.endsWith("/")?c.length-1:c.length,f=o.charAt(u);return f&&f!=="/"?null:o.slice(u)||"/"}const hre=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,pre=o=>hre.test(o);function fre(o,c){c===void 0&&(c="/");let{pathname:u,search:f="",hash:E=""}=typeof o=="string"?Ou(o):o,S;if(u)if(pre(u))S=u;else{if(u.includes("//")){let C=u;u=u.replace(/\/\/+/g,"/"),Dw(!1,"Pathnames cannot have embedded double slashes - normalizing "+(C+" -> "+u))}u.startsWith("/")?S=OF(u.substring(1),"/"):S=OF(u,c)}else S=c;return{pathname:S,search:Ere(f),hash:gre(E)}}function OF(o,c){let u=c.replace(/\/+$/,"").split("/");return o.split("/").forEach(E=>{E===".."?u.length>1&&u.pop():E!=="."&&u.push(E)}),u.length>1?u.join("/"):"/"}function DC(o,c,u,f){return"Cannot include a '"+o+"' character in a manually specified "+("`to."+c+"` field ["+JSON.stringify(f)+"].  Please separate it out to the ")+("`to."+u+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function _re(o){return o.filter((c,u)=>u===0||c.route.path&&c.route.path.length>0)}function Lw(o,c){let u=_re(o);return c?u.map((f,E)=>E===u.length-1?f.pathname:f.pathnameBase):u.map(f=>f.pathnameBase)}function kw(o,c,u,f){f===void 0&&(f=!1);let E;typeof o=="string"?E=Ou(o):(E=Yp({},o),Qn(!E.pathname||!E.pathname.includes("?"),DC("?","pathname","search",E)),Qn(!E.pathname||!E.pathname.includes("#"),DC("#","pathname","hash",E)),Qn(!E.search||!E.search.includes("#"),DC("#","search","hash",E)));let S=o===""||E.pathname==="",C=S?"/":E.pathname,D;if(C==null)D=u;else{let W=c.length-1;if(!f&&C.startsWith("..")){let Q=C.split("/");for(;Q[0]==="..";)Q.shift(),W-=1;E.pathname=Q.join("/")}D=W>=0?c[W]:"/"}let k=fre(E,D),V=C&&C!=="/"&&C.endsWith("/"),G=(S||C===".")&&u.endsWith("/");return!k.pathname.endsWith("/")&&(V||G)&&(k.pathname+="/"),k}const rc=o=>o.join("/").replace(/\/\/+/g,"/"),mre=o=>o.replace(/\/+$/,"").replace(/^\/*/,"/"),Ere=o=>!o||o==="?"?"":o.startsWith("?")?o:"?"+o,gre=o=>!o||o==="#"?"":o.startsWith("#")?o:"#"+o;function Sre(o){return o!=null&&typeof o.status=="number"&&typeof o.statusText=="string"&&typeof o.internal=="boolean"&&"data"in o}const f3=["post","put","patch","delete"];new Set(f3);const Tre=["get",...f3];new Set(Tre);/**
 * React Router v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function zp(){return zp=Object.assign?Object.assign.bind():function(o){for(var c=1;c<arguments.length;c++){var u=arguments[c];for(var f in u)Object.prototype.hasOwnProperty.call(u,f)&&(o[f]=u[f])}return o},zp.apply(this,arguments)}const Mw=Re.createContext(null),vre=Re.createContext(null),lc=Re.createContext(null),Og=Re.createContext(null),ia=Re.createContext({outlet:null,matches:[],isDataRoute:!1}),_3=Re.createContext(null);function Rre(o,c){let{relative:u}=c===void 0?{}:c;Nu()||Qn(!1);let{basename:f,navigator:E}=Re.useContext(lc),{hash:S,pathname:C,search:D}=g3(o,{relative:u}),k=C;return f!=="/"&&(k=C==="/"?f:rc([f,C])),E.createHref({pathname:k,search:D,hash:S})}function Nu(){return Re.useContext(Og)!=null}function $p(){return Nu()||Qn(!1),Re.useContext(Og).location}function m3(o){Re.useContext(lc).static||Re.useLayoutEffect(o)}function Id(){let{isDataRoute:o}=Re.useContext(ia);return o?Mre():yre()}function yre(){Nu()||Qn(!1);let o=Re.useContext(Mw),{basename:c,future:u,navigator:f}=Re.useContext(lc),{matches:E}=Re.useContext(ia),{pathname:S}=$p(),C=JSON.stringify(Lw(E,u.v7_relativeSplatPath)),D=Re.useRef(!1);return m3(()=>{D.current=!0}),Re.useCallback(function(V,G){if(G===void 0&&(G={}),!D.current)return;if(typeof V=="number"){f.go(V);return}let W=kw(V,JSON.parse(C),S,G.relative==="path");o==null&&c!=="/"&&(W.pathname=W.pathname==="/"?c:rc([c,W.pathname])),(G.replace?f.replace:f.push)(W,G.state,G)},[c,f,C,S,o])}function E3(){let{matches:o}=Re.useContext(ia),c=o[o.length-1];return c?c.params:{}}function g3(o,c){let{relative:u}=c===void 0?{}:c,{future:f}=Re.useContext(lc),{matches:E}=Re.useContext(ia),{pathname:S}=$p(),C=JSON.stringify(Lw(E,f.v7_relativeSplatPath));return Re.useMemo(()=>kw(o,JSON.parse(C),S,u==="path"),[o,C,S,u])}function Cre(o,c){return Ire(o,c)}function Ire(o,c,u,f){Nu()||Qn(!1);let{navigator:E}=Re.useContext(lc),{matches:S}=Re.useContext(ia),C=S[S.length-1],D=C?C.params:{};C&&C.pathname;let k=C?C.pathnameBase:"/";C&&C.route;let V=$p(),G;if(c){var W;let he=typeof c=="string"?Ou(c):c;k==="/"||(W=he.pathname)!=null&&W.startsWith(k)||Qn(!1),G=he}else G=V;let Q=G.pathname||"/",me=Q;if(k!=="/"){let he=k.replace(/^\//,"").split("/");me="/"+Q.replace(/^\//,"").split("/").slice(he.length).join("/")}let z=Qne(o,{pathname:me}),de=Nre(z&&z.map(he=>Object.assign({},he,{params:Object.assign({},D,he.params),pathname:rc([k,E.encodeLocation?E.encodeLocation(he.pathname).pathname:he.pathname]),pathnameBase:he.pathnameBase==="/"?k:rc([k,E.encodeLocation?E.encodeLocation(he.pathnameBase).pathname:he.pathnameBase])})),S,u,f);return c&&de?Re.createElement(Og.Provider,{value:{location:zp({pathname:"/",search:"",hash:"",state:null,key:"default"},G),navigationType:qa.Pop}},de):de}function wre(){let o=kre(),c=Sre(o)?o.status+" "+o.statusText:o instanceof Error?o.message:JSON.stringify(o),u=o instanceof Error?o.stack:null,E={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return Re.createElement(Re.Fragment,null,Re.createElement("h2",null,"Unexpected Application Error!"),Re.createElement("h3",{style:{fontStyle:"italic"}},c),u?Re.createElement("pre",{style:E},u):null,null)}const Are=Re.createElement(wre,null);class bre extends Re.Component{constructor(c){super(c),this.state={location:c.location,revalidation:c.revalidation,error:c.error}}static getDerivedStateFromError(c){return{error:c}}static getDerivedStateFromProps(c,u){return u.location!==c.location||u.revalidation!=="idle"&&c.revalidation==="idle"?{error:c.error,location:c.location,revalidation:c.revalidation}:{error:c.error!==void 0?c.error:u.error,location:u.location,revalidation:c.revalidation||u.revalidation}}componentDidCatch(c,u){console.error("React Router caught the following error during render",c,u)}render(){return this.state.error!==void 0?Re.createElement(ia.Provider,{value:this.props.routeContext},Re.createElement(_3.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Ore(o){let{routeContext:c,match:u,children:f}=o,E=Re.useContext(Mw);return E&&E.static&&E.staticContext&&(u.route.errorElement||u.route.ErrorBoundary)&&(E.staticContext._deepestRenderedBoundaryId=u.route.id),Re.createElement(ia.Provider,{value:c},f)}function Nre(o,c,u,f){var E;if(c===void 0&&(c=[]),u===void 0&&(u=null),f===void 0&&(f=null),o==null){var S;if(!u)return null;if(u.errors)o=u.matches;else if((S=f)!=null&&S.v7_partialHydration&&c.length===0&&!u.initialized&&u.matches.length>0)o=u.matches;else return null}let C=o,D=(E=u)==null?void 0:E.errors;if(D!=null){let G=C.findIndex(W=>W.route.id&&(D==null?void 0:D[W.route.id])!==void 0);G>=0||Qn(!1),C=C.slice(0,Math.min(C.length,G+1))}let k=!1,V=-1;if(u&&f&&f.v7_partialHydration)for(let G=0;G<C.length;G++){let W=C[G];if((W.route.HydrateFallback||W.route.hydrateFallbackElement)&&(V=G),W.route.id){let{loaderData:Q,errors:me}=u,z=W.route.loader&&Q[W.route.id]===void 0&&(!me||me[W.route.id]===void 0);if(W.route.lazy||z){k=!0,V>=0?C=C.slice(0,V+1):C=[C[0]];break}}}return C.reduceRight((G,W,Q)=>{let me,z=!1,de=null,he=null;u&&(me=D&&W.route.id?D[W.route.id]:void 0,de=W.route.errorElement||Are,k&&(V<0&&Q===0?(Ure("route-fallback"),z=!0,he=null):V===Q&&(z=!0,he=W.route.hydrateFallbackElement||null)));let q=c.concat(C.slice(0,Q+1)),K=()=>{let X;return me?X=de:z?X=he:W.route.Component?X=Re.createElement(W.route.Component,null):W.route.element?X=W.route.element:X=G,Re.createElement(Ore,{match:W,routeContext:{outlet:G,matches:q,isDataRoute:u!=null},children:X})};return u&&(W.route.ErrorBoundary||W.route.errorElement||Q===0)?Re.createElement(bre,{location:u.location,revalidation:u.revalidation,component:de,error:me,children:K(),routeContext:{outlet:null,matches:q,isDataRoute:!0}}):K()},null)}var S3=function(o){return o.UseBlocker="useBlocker",o.UseRevalidator="useRevalidator",o.UseNavigateStable="useNavigate",o}(S3||{}),T3=function(o){return o.UseBlocker="useBlocker",o.UseLoaderData="useLoaderData",o.UseActionData="useActionData",o.UseRouteError="useRouteError",o.UseNavigation="useNavigation",o.UseRouteLoaderData="useRouteLoaderData",o.UseMatches="useMatches",o.UseRevalidator="useRevalidator",o.UseNavigateStable="useNavigate",o.UseRouteId="useRouteId",o}(T3||{});function Dre(o){let c=Re.useContext(Mw);return c||Qn(!1),c}function Pre(o){let c=Re.useContext(vre);return c||Qn(!1),c}function Lre(o){let c=Re.useContext(ia);return c||Qn(!1),c}function v3(o){let c=Lre(),u=c.matches[c.matches.length-1];return u.route.id||Qn(!1),u.route.id}function kre(){var o;let c=Re.useContext(_3),u=Pre(),f=v3();return c!==void 0?c:(o=u.errors)==null?void 0:o[f]}function Mre(){let{router:o}=Dre(S3.UseNavigateStable),c=v3(T3.UseNavigateStable),u=Re.useRef(!1);return m3(()=>{u.current=!0}),Re.useCallback(function(E,S){S===void 0&&(S={}),u.current&&(typeof E=="number"?o.navigate(E):o.navigate(E,zp({fromRouteId:c},S)))},[o,c])}const NF={};function Ure(o,c,u){NF[o]||(NF[o]=!0)}function xre(o,c){o==null||o.v7_startTransition,o==null||o.v7_relativeSplatPath}function OI(o){let{to:c,replace:u,state:f,relative:E}=o;Nu()||Qn(!1);let{future:S,static:C}=Re.useContext(lc),{matches:D}=Re.useContext(ia),{pathname:k}=$p(),V=Id(),G=kw(c,Lw(D,S.v7_relativeSplatPath),k,E==="path"),W=JSON.stringify(G);return Re.useEffect(()=>V(JSON.parse(W),{replace:u,state:f,relative:E}),[V,W,E,u,f]),null}function ws(o){Qn(!1)}function Vre(o){let{basename:c="/",children:u=null,location:f,navigationType:E=qa.Pop,navigator:S,static:C=!1,future:D}=o;Nu()&&Qn(!1);let k=c.replace(/^\/*/,"/"),V=Re.useMemo(()=>({basename:k,navigator:S,static:C,future:zp({v7_relativeSplatPath:!1},D)}),[k,D,S,C]);typeof f=="string"&&(f=Ou(f));let{pathname:G="/",search:W="",hash:Q="",state:me=null,key:z="default"}=f,de=Re.useMemo(()=>{let he=Pw(G,k);return he==null?null:{location:{pathname:he,search:W,hash:Q,state:me,key:z},navigationType:E}},[k,G,W,Q,me,z,E]);return de==null?null:Re.createElement(lc.Provider,{value:V},Re.createElement(Og.Provider,{children:u,value:de}))}function Fre(o){let{children:c,location:u}=o;return Cre(NI(c),u)}new Promise(()=>{});function NI(o,c){c===void 0&&(c=[]);let u=[];return Re.Children.forEach(o,(f,E)=>{if(!Re.isValidElement(f))return;let S=[...c,E];if(f.type===Re.Fragment){u.push.apply(u,NI(f.props.children,S));return}f.type!==ws&&Qn(!1),!f.props.index||!f.props.children||Qn(!1);let C={id:f.props.id||S.join("-"),caseSensitive:f.props.caseSensitive,element:f.props.element,Component:f.props.Component,index:f.props.index,path:f.props.path,loader:f.props.loader,action:f.props.action,errorElement:f.props.errorElement,ErrorBoundary:f.props.ErrorBoundary,hasErrorBoundary:f.props.ErrorBoundary!=null||f.props.errorElement!=null,shouldRevalidate:f.props.shouldRevalidate,handle:f.props.handle,lazy:f.props.lazy};f.props.children&&(C.children=NI(f.props.children,S)),u.push(C)}),u}/**
 * React Router DOM v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function DI(){return DI=Object.assign?Object.assign.bind():function(o){for(var c=1;c<arguments.length;c++){var u=arguments[c];for(var f in u)Object.prototype.hasOwnProperty.call(u,f)&&(o[f]=u[f])}return o},DI.apply(this,arguments)}function Bre(o,c){if(o==null)return{};var u={},f=Object.keys(o),E,S;for(S=0;S<f.length;S++)E=f[S],!(c.indexOf(E)>=0)&&(u[E]=o[E]);return u}function jre(o){return!!(o.metaKey||o.altKey||o.ctrlKey||o.shiftKey)}function Gre(o,c){return o.button===0&&(!c||c==="_self")&&!jre(o)}const Wre=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],Hre="6";try{window.__reactRouterVersion=Hre}catch{}const Kre="startTransition",DF=Uee[Kre];function Yre(o){let{basename:c,children:u,future:f,window:E}=o,S=Re.useRef();S.current==null&&(S.current=qne({window:E,v5Compat:!0}));let C=S.current,[D,k]=Re.useState({action:C.action,location:C.location}),{v7_startTransition:V}=f||{},G=Re.useCallback(W=>{V&&DF?DF(()=>k(W)):k(W)},[k,V]);return Re.useLayoutEffect(()=>C.listen(G),[C,G]),Re.useEffect(()=>xre(f),[f]),Re.createElement(Vre,{basename:c,children:u,location:D.location,navigationType:D.action,navigator:C,future:f})}const zre=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",qre=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ic=Re.forwardRef(function(c,u){let{onClick:f,relative:E,reloadDocument:S,replace:C,state:D,target:k,to:V,preventScrollReset:G,viewTransition:W}=c,Q=Bre(c,Wre),{basename:me}=Re.useContext(lc),z,de=!1;if(typeof V=="string"&&qre.test(V)&&(z=V,zre))try{let X=new URL(window.location.href),Ee=V.startsWith("//")?new URL(X.protocol+V):new URL(V),Oe=Pw(Ee.pathname,me);Ee.origin===X.origin&&Oe!=null?V=Oe+Ee.search+Ee.hash:de=!0}catch{}let he=Rre(V,{relative:E}),q=Xre(V,{replace:C,state:D,target:k,preventScrollReset:G,relative:E,viewTransition:W});function K(X){f&&f(X),X.defaultPrevented||q(X)}return Re.createElement("a",DI({},Q,{href:z||he,onClick:de||S?f:K,ref:u,target:k}))});var PF;(function(o){o.UseScrollRestoration="useScrollRestoration",o.UseSubmit="useSubmit",o.UseSubmitFetcher="useSubmitFetcher",o.UseFetcher="useFetcher",o.useViewTransitionState="useViewTransitionState"})(PF||(PF={}));var LF;(function(o){o.UseFetcher="useFetcher",o.UseFetchers="useFetchers",o.UseScrollRestoration="useScrollRestoration"})(LF||(LF={}));function Xre(o,c){let{target:u,replace:f,state:E,preventScrollReset:S,relative:C,viewTransition:D}=c===void 0?{}:c,k=Id(),V=$p(),G=g3(o,{relative:C});return Re.useCallback(W=>{if(Gre(W,u)){W.preventDefault();let Q=f!==void 0?f:ug(V)===ug(G);k(o,{replace:Q,state:E,preventScrollReset:S,relative:C,viewTransition:D})}},[V,k,G,f,E,u,o,S,C,D])}function R3(o,c){return function(){return o.apply(c,arguments)}}const{toString:Jre}=Object.prototype,{getPrototypeOf:Uw}=Object,{iterator:Ng,toStringTag:y3}=Symbol,Dg=(o=>c=>{const u=Jre.call(c);return o[u]||(o[u]=u.slice(8,-1).toLowerCase())})(Object.create(null)),es=o=>(o=o.toLowerCase(),c=>Dg(c)===o),Pg=o=>c=>typeof c===o,{isArray:Du}=Array,Iu=Pg("undefined");function ef(o){return o!==null&&!Iu(o)&&o.constructor!==null&&!Iu(o.constructor)&&Ii(o.constructor.isBuffer)&&o.constructor.isBuffer(o)}const C3=es("ArrayBuffer");function Qre(o){let c;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?c=ArrayBuffer.isView(o):c=o&&o.buffer&&C3(o.buffer),c}const Zre=Pg("string"),Ii=Pg("function"),I3=Pg("number"),tf=o=>o!==null&&typeof o=="object",$re=o=>o===!0||o===!1,xE=o=>{if(Dg(o)!=="object")return!1;const c=Uw(o);return(c===null||c===Object.prototype||Object.getPrototypeOf(c)===null)&&!(y3 in o)&&!(Ng in o)},eie=o=>{if(!tf(o)||ef(o))return!1;try{return Object.keys(o).length===0&&Object.getPrototypeOf(o)===Object.prototype}catch{return!1}},tie=es("Date"),nie=es("File"),rie=es("Blob"),iie=es("FileList"),oie=o=>tf(o)&&Ii(o.pipe),sie=o=>{let c;return o&&(typeof FormData=="function"&&o instanceof FormData||Ii(o.append)&&((c=Dg(o))==="formdata"||c==="object"&&Ii(o.toString)&&o.toString()==="[object FormData]"))},aie=es("URLSearchParams"),[cie,die,lie,uie]=["ReadableStream","Request","Response","Headers"].map(es),hie=o=>o.trim?o.trim():o.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function nf(o,c,{allOwnKeys:u=!1}={}){if(o===null||typeof o>"u")return;let f,E;if(typeof o!="object"&&(o=[o]),Du(o))for(f=0,E=o.length;f<E;f++)c.call(null,o[f],f,o);else{if(ef(o))return;const S=u?Object.getOwnPropertyNames(o):Object.keys(o),C=S.length;let D;for(f=0;f<C;f++)D=S[f],c.call(null,o[D],D,o)}}function w3(o,c){if(ef(o))return null;c=c.toLowerCase();const u=Object.keys(o);let f=u.length,E;for(;f-- >0;)if(E=u[f],c===E.toLowerCase())return E;return null}const pd=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,A3=o=>!Iu(o)&&o!==pd;function PI(){const{caseless:o,skipUndefined:c}=A3(this)&&this||{},u={},f=(E,S)=>{const C=o&&w3(u,S)||S;xE(u[C])&&xE(E)?u[C]=PI(u[C],E):xE(E)?u[C]=PI({},E):Du(E)?u[C]=E.slice():(!c||!Iu(E))&&(u[C]=E)};for(let E=0,S=arguments.length;E<S;E++)arguments[E]&&nf(arguments[E],f);return u}const pie=(o,c,u,{allOwnKeys:f}={})=>(nf(c,(E,S)=>{u&&Ii(E)?o[S]=R3(E,u):o[S]=E},{allOwnKeys:f}),o),fie=o=>(o.charCodeAt(0)===65279&&(o=o.slice(1)),o),_ie=(o,c,u,f)=>{o.prototype=Object.create(c.prototype,f),o.prototype.constructor=o,Object.defineProperty(o,"super",{value:c.prototype}),u&&Object.assign(o.prototype,u)},mie=(o,c,u,f)=>{let E,S,C;const D={};if(c=c||{},o==null)return c;do{for(E=Object.getOwnPropertyNames(o),S=E.length;S-- >0;)C=E[S],(!f||f(C,o,c))&&!D[C]&&(c[C]=o[C],D[C]=!0);o=u!==!1&&Uw(o)}while(o&&(!u||u(o,c))&&o!==Object.prototype);return c},Eie=(o,c,u)=>{o=String(o),(u===void 0||u>o.length)&&(u=o.length),u-=c.length;const f=o.indexOf(c,u);return f!==-1&&f===u},gie=o=>{if(!o)return null;if(Du(o))return o;let c=o.length;if(!I3(c))return null;const u=new Array(c);for(;c-- >0;)u[c]=o[c];return u},Sie=(o=>c=>o&&c instanceof o)(typeof Uint8Array<"u"&&Uw(Uint8Array)),Tie=(o,c)=>{const f=(o&&o[Ng]).call(o);let E;for(;(E=f.next())&&!E.done;){const S=E.value;c.call(o,S[0],S[1])}},vie=(o,c)=>{let u;const f=[];for(;(u=o.exec(c))!==null;)f.push(u);return f},Rie=es("HTMLFormElement"),yie=o=>o.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(u,f,E){return f.toUpperCase()+E}),kF=(({hasOwnProperty:o})=>(c,u)=>o.call(c,u))(Object.prototype),Cie=es("RegExp"),b3=(o,c)=>{const u=Object.getOwnPropertyDescriptors(o),f={};nf(u,(E,S)=>{let C;(C=c(E,S,o))!==!1&&(f[S]=C||E)}),Object.defineProperties(o,f)},Iie=o=>{b3(o,(c,u)=>{if(Ii(o)&&["arguments","caller","callee"].indexOf(u)!==-1)return!1;const f=o[u];if(Ii(f)){if(c.enumerable=!1,"writable"in c){c.writable=!1;return}c.set||(c.set=()=>{throw Error("Can not rewrite read-only method '"+u+"'")})}})},wie=(o,c)=>{const u={},f=E=>{E.forEach(S=>{u[S]=!0})};return Du(o)?f(o):f(String(o).split(c)),u},Aie=()=>{},bie=(o,c)=>o!=null&&Number.isFinite(o=+o)?o:c;function Oie(o){return!!(o&&Ii(o.append)&&o[y3]==="FormData"&&o[Ng])}const Nie=o=>{const c=new Array(10),u=(f,E)=>{if(tf(f)){if(c.indexOf(f)>=0)return;if(ef(f))return f;if(!("toJSON"in f)){c[E]=f;const S=Du(f)?[]:{};return nf(f,(C,D)=>{const k=u(C,E+1);!Iu(k)&&(S[D]=k)}),c[E]=void 0,S}}return f};return u(o,0)},Die=es("AsyncFunction"),Pie=o=>o&&(tf(o)||Ii(o))&&Ii(o.then)&&Ii(o.catch),O3=((o,c)=>o?setImmediate:c?((u,f)=>(pd.addEventListener("message",({source:E,data:S})=>{E===pd&&S===u&&f.length&&f.shift()()},!1),E=>{f.push(E),pd.postMessage(u,"*")}))(`axios@${Math.random()}`,[]):u=>setTimeout(u))(typeof setImmediate=="function",Ii(pd.postMessage)),Lie=typeof queueMicrotask<"u"?queueMicrotask.bind(pd):typeof process<"u"&&process.nextTick||O3,kie=o=>o!=null&&Ii(o[Ng]),ue={isArray:Du,isArrayBuffer:C3,isBuffer:ef,isFormData:sie,isArrayBufferView:Qre,isString:Zre,isNumber:I3,isBoolean:$re,isObject:tf,isPlainObject:xE,isEmptyObject:eie,isReadableStream:cie,isRequest:die,isResponse:lie,isHeaders:uie,isUndefined:Iu,isDate:tie,isFile:nie,isBlob:rie,isRegExp:Cie,isFunction:Ii,isStream:oie,isURLSearchParams:aie,isTypedArray:Sie,isFileList:iie,forEach:nf,merge:PI,extend:pie,trim:hie,stripBOM:fie,inherits:_ie,toFlatObject:mie,kindOf:Dg,kindOfTest:es,endsWith:Eie,toArray:gie,forEachEntry:Tie,matchAll:vie,isHTMLForm:Rie,hasOwnProperty:kF,hasOwnProp:kF,reduceDescriptors:b3,freezeMethods:Iie,toObjectSet:wie,toCamelCase:yie,noop:Aie,toFiniteNumber:bie,findKey:w3,global:pd,isContextDefined:A3,isSpecCompliantForm:Oie,toJSONObject:Nie,isAsyncFn:Die,isThenable:Pie,setImmediate:O3,asap:Lie,isIterable:kie};function It(o,c,u,f,E){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=o,this.name="AxiosError",c&&(this.code=c),u&&(this.config=u),f&&(this.request=f),E&&(this.response=E,this.status=E.status?E.status:null)}ue.inherits(It,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ue.toJSONObject(this.config),code:this.code,status:this.status}}});const N3=It.prototype,D3={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(o=>{D3[o]={value:o}});Object.defineProperties(It,D3);Object.defineProperty(N3,"isAxiosError",{value:!0});It.from=(o,c,u,f,E,S)=>{const C=Object.create(N3);ue.toFlatObject(o,C,function(G){return G!==Error.prototype},V=>V!=="isAxiosError");const D=o&&o.message?o.message:"Error",k=c==null&&o?o.code:c;return It.call(C,D,k,u,f,E),o&&C.cause==null&&Object.defineProperty(C,"cause",{value:o,configurable:!0}),C.name=o&&o.name||"Error",S&&Object.assign(C,S),C};const Mie=null;function LI(o){return ue.isPlainObject(o)||ue.isArray(o)}function P3(o){return ue.endsWith(o,"[]")?o.slice(0,-2):o}function MF(o,c,u){return o?o.concat(c).map(function(E,S){return E=P3(E),!u&&S?"["+E+"]":E}).join(u?".":""):c}function Uie(o){return ue.isArray(o)&&!o.some(LI)}const xie=ue.toFlatObject(ue,{},null,function(c){return/^is[A-Z]/.test(c)});function Lg(o,c,u){if(!ue.isObject(o))throw new TypeError("target must be an object");c=c||new FormData,u=ue.toFlatObject(u,{metaTokens:!0,dots:!1,indexes:!1},!1,function(de,he){return!ue.isUndefined(he[de])});const f=u.metaTokens,E=u.visitor||G,S=u.dots,C=u.indexes,k=(u.Blob||typeof Blob<"u"&&Blob)&&ue.isSpecCompliantForm(c);if(!ue.isFunction(E))throw new TypeError("visitor must be a function");function V(z){if(z===null)return"";if(ue.isDate(z))return z.toISOString();if(ue.isBoolean(z))return z.toString();if(!k&&ue.isBlob(z))throw new It("Blob is not supported. Use a Buffer instead.");return ue.isArrayBuffer(z)||ue.isTypedArray(z)?k&&typeof Blob=="function"?new Blob([z]):Buffer.from(z):z}function G(z,de,he){let q=z;if(z&&!he&&typeof z=="object"){if(ue.endsWith(de,"{}"))de=f?de:de.slice(0,-2),z=JSON.stringify(z);else if(ue.isArray(z)&&Uie(z)||(ue.isFileList(z)||ue.endsWith(de,"[]"))&&(q=ue.toArray(z)))return de=P3(de),q.forEach(function(X,Ee){!(ue.isUndefined(X)||X===null)&&c.append(C===!0?MF([de],Ee,S):C===null?de:de+"[]",V(X))}),!1}return LI(z)?!0:(c.append(MF(he,de,S),V(z)),!1)}const W=[],Q=Object.assign(xie,{defaultVisitor:G,convertValue:V,isVisitable:LI});function me(z,de){if(!ue.isUndefined(z)){if(W.indexOf(z)!==-1)throw Error("Circular reference detected in "+de.join("."));W.push(z),ue.forEach(z,function(q,K){(!(ue.isUndefined(q)||q===null)&&E.call(c,q,ue.isString(K)?K.trim():K,de,Q))===!0&&me(q,de?de.concat(K):[K])}),W.pop()}}if(!ue.isObject(o))throw new TypeError("data must be an object");return me(o),c}function UF(o){const c={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(o).replace(/[!'()~]|%20|%00/g,function(f){return c[f]})}function xw(o,c){this._pairs=[],o&&Lg(o,this,c)}const L3=xw.prototype;L3.append=function(c,u){this._pairs.push([c,u])};L3.toString=function(c){const u=c?function(f){return c.call(this,f,UF)}:UF;return this._pairs.map(function(E){return u(E[0])+"="+u(E[1])},"").join("&")};function Vie(o){return encodeURIComponent(o).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function k3(o,c,u){if(!c)return o;const f=u&&u.encode||Vie;ue.isFunction(u)&&(u={serialize:u});const E=u&&u.serialize;let S;if(E?S=E(c,u):S=ue.isURLSearchParams(c)?c.toString():new xw(c,u).toString(f),S){const C=o.indexOf("#");C!==-1&&(o=o.slice(0,C)),o+=(o.indexOf("?")===-1?"?":"&")+S}return o}class xF{constructor(){this.handlers=[]}use(c,u,f){return this.handlers.push({fulfilled:c,rejected:u,synchronous:f?f.synchronous:!1,runWhen:f?f.runWhen:null}),this.handlers.length-1}eject(c){this.handlers[c]&&(this.handlers[c]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(c){ue.forEach(this.handlers,function(f){f!==null&&c(f)})}}const M3={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Fie=typeof URLSearchParams<"u"?URLSearchParams:xw,Bie=typeof FormData<"u"?FormData:null,jie=typeof Blob<"u"?Blob:null,Gie={isBrowser:!0,classes:{URLSearchParams:Fie,FormData:Bie,Blob:jie},protocols:["http","https","file","blob","url","data"]},Vw=typeof window<"u"&&typeof document<"u",kI=typeof navigator=="object"&&navigator||void 0,Wie=Vw&&(!kI||["ReactNative","NativeScript","NS"].indexOf(kI.product)<0),Hie=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Kie=Vw&&window.location.href||"http://localhost",Yie=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Vw,hasStandardBrowserEnv:Wie,hasStandardBrowserWebWorkerEnv:Hie,navigator:kI,origin:Kie},Symbol.toStringTag,{value:"Module"})),Kr={...Yie,...Gie};function zie(o,c){return Lg(o,new Kr.classes.URLSearchParams,{visitor:function(u,f,E,S){return Kr.isNode&&ue.isBuffer(u)?(this.append(f,u.toString("base64")),!1):S.defaultVisitor.apply(this,arguments)},...c})}function qie(o){return ue.matchAll(/\w+|\[(\w*)]/g,o).map(c=>c[0]==="[]"?"":c[1]||c[0])}function Xie(o){const c={},u=Object.keys(o);let f;const E=u.length;let S;for(f=0;f<E;f++)S=u[f],c[S]=o[S];return c}function U3(o){function c(u,f,E,S){let C=u[S++];if(C==="__proto__")return!0;const D=Number.isFinite(+C),k=S>=u.length;return C=!C&&ue.isArray(E)?E.length:C,k?(ue.hasOwnProp(E,C)?E[C]=[E[C],f]:E[C]=f,!D):((!E[C]||!ue.isObject(E[C]))&&(E[C]=[]),c(u,f,E[C],S)&&ue.isArray(E[C])&&(E[C]=Xie(E[C])),!D)}if(ue.isFormData(o)&&ue.isFunction(o.entries)){const u={};return ue.forEachEntry(o,(f,E)=>{c(qie(f),E,u,0)}),u}return null}function Jie(o,c,u){if(ue.isString(o))try{return(c||JSON.parse)(o),ue.trim(o)}catch(f){if(f.name!=="SyntaxError")throw f}return(u||JSON.stringify)(o)}const rf={transitional:M3,adapter:["xhr","http","fetch"],transformRequest:[function(c,u){const f=u.getContentType()||"",E=f.indexOf("application/json")>-1,S=ue.isObject(c);if(S&&ue.isHTMLForm(c)&&(c=new FormData(c)),ue.isFormData(c))return E?JSON.stringify(U3(c)):c;if(ue.isArrayBuffer(c)||ue.isBuffer(c)||ue.isStream(c)||ue.isFile(c)||ue.isBlob(c)||ue.isReadableStream(c))return c;if(ue.isArrayBufferView(c))return c.buffer;if(ue.isURLSearchParams(c))return u.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),c.toString();let D;if(S){if(f.indexOf("application/x-www-form-urlencoded")>-1)return zie(c,this.formSerializer).toString();if((D=ue.isFileList(c))||f.indexOf("multipart/form-data")>-1){const k=this.env&&this.env.FormData;return Lg(D?{"files[]":c}:c,k&&new k,this.formSerializer)}}return S||E?(u.setContentType("application/json",!1),Jie(c)):c}],transformResponse:[function(c){const u=this.transitional||rf.transitional,f=u&&u.forcedJSONParsing,E=this.responseType==="json";if(ue.isResponse(c)||ue.isReadableStream(c))return c;if(c&&ue.isString(c)&&(f&&!this.responseType||E)){const C=!(u&&u.silentJSONParsing)&&E;try{return JSON.parse(c,this.parseReviver)}catch(D){if(C)throw D.name==="SyntaxError"?It.from(D,It.ERR_BAD_RESPONSE,this,null,this.response):D}}return c}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Kr.classes.FormData,Blob:Kr.classes.Blob},validateStatus:function(c){return c>=200&&c<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ue.forEach(["delete","get","head","post","put","patch"],o=>{rf.headers[o]={}});const Qie=ue.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Zie=o=>{const c={};let u,f,E;return o&&o.split(`
`).forEach(function(C){E=C.indexOf(":"),u=C.substring(0,E).trim().toLowerCase(),f=C.substring(E+1).trim(),!(!u||c[u]&&Qie[u])&&(u==="set-cookie"?c[u]?c[u].push(f):c[u]=[f]:c[u]=c[u]?c[u]+", "+f:f)}),c},VF=Symbol("internals");function fp(o){return o&&String(o).trim().toLowerCase()}function VE(o){return o===!1||o==null?o:ue.isArray(o)?o.map(VE):String(o)}function $ie(o){const c=Object.create(null),u=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let f;for(;f=u.exec(o);)c[f[1]]=f[2];return c}const eoe=o=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(o.trim());function PC(o,c,u,f,E){if(ue.isFunction(f))return f.call(this,c,u);if(E&&(c=u),!!ue.isString(c)){if(ue.isString(f))return c.indexOf(f)!==-1;if(ue.isRegExp(f))return f.test(c)}}function toe(o){return o.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(c,u,f)=>u.toUpperCase()+f)}function noe(o,c){const u=ue.toCamelCase(" "+c);["get","set","has"].forEach(f=>{Object.defineProperty(o,f+u,{value:function(E,S,C){return this[f].call(this,c,E,S,C)},configurable:!0})})}let wi=class{constructor(c){c&&this.set(c)}set(c,u,f){const E=this;function S(D,k,V){const G=fp(k);if(!G)throw new Error("header name must be a non-empty string");const W=ue.findKey(E,G);(!W||E[W]===void 0||V===!0||V===void 0&&E[W]!==!1)&&(E[W||k]=VE(D))}const C=(D,k)=>ue.forEach(D,(V,G)=>S(V,G,k));if(ue.isPlainObject(c)||c instanceof this.constructor)C(c,u);else if(ue.isString(c)&&(c=c.trim())&&!eoe(c))C(Zie(c),u);else if(ue.isObject(c)&&ue.isIterable(c)){let D={},k,V;for(const G of c){if(!ue.isArray(G))throw TypeError("Object iterator must return a key-value pair");D[V=G[0]]=(k=D[V])?ue.isArray(k)?[...k,G[1]]:[k,G[1]]:G[1]}C(D,u)}else c!=null&&S(u,c,f);return this}get(c,u){if(c=fp(c),c){const f=ue.findKey(this,c);if(f){const E=this[f];if(!u)return E;if(u===!0)return $ie(E);if(ue.isFunction(u))return u.call(this,E,f);if(ue.isRegExp(u))return u.exec(E);throw new TypeError("parser must be boolean|regexp|function")}}}has(c,u){if(c=fp(c),c){const f=ue.findKey(this,c);return!!(f&&this[f]!==void 0&&(!u||PC(this,this[f],f,u)))}return!1}delete(c,u){const f=this;let E=!1;function S(C){if(C=fp(C),C){const D=ue.findKey(f,C);D&&(!u||PC(f,f[D],D,u))&&(delete f[D],E=!0)}}return ue.isArray(c)?c.forEach(S):S(c),E}clear(c){const u=Object.keys(this);let f=u.length,E=!1;for(;f--;){const S=u[f];(!c||PC(this,this[S],S,c,!0))&&(delete this[S],E=!0)}return E}normalize(c){const u=this,f={};return ue.forEach(this,(E,S)=>{const C=ue.findKey(f,S);if(C){u[C]=VE(E),delete u[S];return}const D=c?toe(S):String(S).trim();D!==S&&delete u[S],u[D]=VE(E),f[D]=!0}),this}concat(...c){return this.constructor.concat(this,...c)}toJSON(c){const u=Object.create(null);return ue.forEach(this,(f,E)=>{f!=null&&f!==!1&&(u[E]=c&&ue.isArray(f)?f.join(", "):f)}),u}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([c,u])=>c+": "+u).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(c){return c instanceof this?c:new this(c)}static concat(c,...u){const f=new this(c);return u.forEach(E=>f.set(E)),f}static accessor(c){const f=(this[VF]=this[VF]={accessors:{}}).accessors,E=this.prototype;function S(C){const D=fp(C);f[D]||(noe(E,C),f[D]=!0)}return ue.isArray(c)?c.forEach(S):S(c),this}};wi.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);ue.reduceDescriptors(wi.prototype,({value:o},c)=>{let u=c[0].toUpperCase()+c.slice(1);return{get:()=>o,set(f){this[u]=f}}});ue.freezeMethods(wi);function LC(o,c){const u=this||rf,f=c||u,E=wi.from(f.headers);let S=f.data;return ue.forEach(o,function(D){S=D.call(u,S,E.normalize(),c?c.status:void 0)}),E.normalize(),S}function x3(o){return!!(o&&o.__CANCEL__)}function Pu(o,c,u){It.call(this,o??"canceled",It.ERR_CANCELED,c,u),this.name="CanceledError"}ue.inherits(Pu,It,{__CANCEL__:!0});function V3(o,c,u){const f=u.config.validateStatus;!u.status||!f||f(u.status)?o(u):c(new It("Request failed with status code "+u.status,[It.ERR_BAD_REQUEST,It.ERR_BAD_RESPONSE][Math.floor(u.status/100)-4],u.config,u.request,u))}function roe(o){const c=/^([-+\w]{1,25})(:?\/\/|:)/.exec(o);return c&&c[1]||""}function ioe(o,c){o=o||10;const u=new Array(o),f=new Array(o);let E=0,S=0,C;return c=c!==void 0?c:1e3,function(k){const V=Date.now(),G=f[S];C||(C=V),u[E]=k,f[E]=V;let W=S,Q=0;for(;W!==E;)Q+=u[W++],W=W%o;if(E=(E+1)%o,E===S&&(S=(S+1)%o),V-C<c)return;const me=G&&V-G;return me?Math.round(Q*1e3/me):void 0}}function ooe(o,c){let u=0,f=1e3/c,E,S;const C=(V,G=Date.now())=>{u=G,E=null,S&&(clearTimeout(S),S=null),o(...V)};return[(...V)=>{const G=Date.now(),W=G-u;W>=f?C(V,G):(E=V,S||(S=setTimeout(()=>{S=null,C(E)},f-W)))},()=>E&&C(E)]}const hg=(o,c,u=3)=>{let f=0;const E=ioe(50,250);return ooe(S=>{const C=S.loaded,D=S.lengthComputable?S.total:void 0,k=C-f,V=E(k),G=C<=D;f=C;const W={loaded:C,total:D,progress:D?C/D:void 0,bytes:k,rate:V||void 0,estimated:V&&D&&G?(D-C)/V:void 0,event:S,lengthComputable:D!=null,[c?"download":"upload"]:!0};o(W)},u)},FF=(o,c)=>{const u=o!=null;return[f=>c[0]({lengthComputable:u,total:o,loaded:f}),c[1]]},BF=o=>(...c)=>ue.asap(()=>o(...c)),soe=Kr.hasStandardBrowserEnv?((o,c)=>u=>(u=new URL(u,Kr.origin),o.protocol===u.protocol&&o.host===u.host&&(c||o.port===u.port)))(new URL(Kr.origin),Kr.navigator&&/(msie|trident)/i.test(Kr.navigator.userAgent)):()=>!0,aoe=Kr.hasStandardBrowserEnv?{write(o,c,u,f,E,S,C){if(typeof document>"u")return;const D=[`${o}=${encodeURIComponent(c)}`];ue.isNumber(u)&&D.push(`expires=${new Date(u).toUTCString()}`),ue.isString(f)&&D.push(`path=${f}`),ue.isString(E)&&D.push(`domain=${E}`),S===!0&&D.push("secure"),ue.isString(C)&&D.push(`SameSite=${C}`),document.cookie=D.join("; ")},read(o){if(typeof document>"u")return null;const c=document.cookie.match(new RegExp("(?:^|; )"+o+"=([^;]*)"));return c?decodeURIComponent(c[1]):null},remove(o){this.write(o,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function coe(o){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(o)}function doe(o,c){return c?o.replace(/\/?\/$/,"")+"/"+c.replace(/^\/+/,""):o}function F3(o,c,u){let f=!coe(c);return o&&(f||u==!1)?doe(o,c):c}const jF=o=>o instanceof wi?{...o}:o;function Rd(o,c){c=c||{};const u={};function f(V,G,W,Q){return ue.isPlainObject(V)&&ue.isPlainObject(G)?ue.merge.call({caseless:Q},V,G):ue.isPlainObject(G)?ue.merge({},G):ue.isArray(G)?G.slice():G}function E(V,G,W,Q){if(ue.isUndefined(G)){if(!ue.isUndefined(V))return f(void 0,V,W,Q)}else return f(V,G,W,Q)}function S(V,G){if(!ue.isUndefined(G))return f(void 0,G)}function C(V,G){if(ue.isUndefined(G)){if(!ue.isUndefined(V))return f(void 0,V)}else return f(void 0,G)}function D(V,G,W){if(W in c)return f(V,G);if(W in o)return f(void 0,V)}const k={url:S,method:S,data:S,baseURL:C,transformRequest:C,transformResponse:C,paramsSerializer:C,timeout:C,timeoutMessage:C,withCredentials:C,withXSRFToken:C,adapter:C,responseType:C,xsrfCookieName:C,xsrfHeaderName:C,onUploadProgress:C,onDownloadProgress:C,decompress:C,maxContentLength:C,maxBodyLength:C,beforeRedirect:C,transport:C,httpAgent:C,httpsAgent:C,cancelToken:C,socketPath:C,responseEncoding:C,validateStatus:D,headers:(V,G,W)=>E(jF(V),jF(G),W,!0)};return ue.forEach(Object.keys({...o,...c}),function(G){const W=k[G]||E,Q=W(o[G],c[G],G);ue.isUndefined(Q)&&W!==D||(u[G]=Q)}),u}const B3=o=>{const c=Rd({},o);let{data:u,withXSRFToken:f,xsrfHeaderName:E,xsrfCookieName:S,headers:C,auth:D}=c;if(c.headers=C=wi.from(C),c.url=k3(F3(c.baseURL,c.url,c.allowAbsoluteUrls),o.params,o.paramsSerializer),D&&C.set("Authorization","Basic "+btoa((D.username||"")+":"+(D.password?unescape(encodeURIComponent(D.password)):""))),ue.isFormData(u)){if(Kr.hasStandardBrowserEnv||Kr.hasStandardBrowserWebWorkerEnv)C.setContentType(void 0);else if(ue.isFunction(u.getHeaders)){const k=u.getHeaders(),V=["content-type","content-length"];Object.entries(k).forEach(([G,W])=>{V.includes(G.toLowerCase())&&C.set(G,W)})}}if(Kr.hasStandardBrowserEnv&&(f&&ue.isFunction(f)&&(f=f(c)),f||f!==!1&&soe(c.url))){const k=E&&S&&aoe.read(S);k&&C.set(E,k)}return c},loe=typeof XMLHttpRequest<"u",uoe=loe&&function(o){return new Promise(function(u,f){const E=B3(o);let S=E.data;const C=wi.from(E.headers).normalize();let{responseType:D,onUploadProgress:k,onDownloadProgress:V}=E,G,W,Q,me,z;function de(){me&&me(),z&&z(),E.cancelToken&&E.cancelToken.unsubscribe(G),E.signal&&E.signal.removeEventListener("abort",G)}let he=new XMLHttpRequest;he.open(E.method.toUpperCase(),E.url,!0),he.timeout=E.timeout;function q(){if(!he)return;const X=wi.from("getAllResponseHeaders"in he&&he.getAllResponseHeaders()),Oe={data:!D||D==="text"||D==="json"?he.responseText:he.response,status:he.status,statusText:he.statusText,headers:X,config:o,request:he};V3(function(De){u(De),de()},function(De){f(De),de()},Oe),he=null}"onloadend"in he?he.onloadend=q:he.onreadystatechange=function(){!he||he.readyState!==4||he.status===0&&!(he.responseURL&&he.responseURL.indexOf("file:")===0)||setTimeout(q)},he.onabort=function(){he&&(f(new It("Request aborted",It.ECONNABORTED,o,he)),he=null)},he.onerror=function(Ee){const Oe=Ee&&Ee.message?Ee.message:"Network Error",We=new It(Oe,It.ERR_NETWORK,o,he);We.event=Ee||null,f(We),he=null},he.ontimeout=function(){let Ee=E.timeout?"timeout of "+E.timeout+"ms exceeded":"timeout exceeded";const Oe=E.transitional||M3;E.timeoutErrorMessage&&(Ee=E.timeoutErrorMessage),f(new It(Ee,Oe.clarifyTimeoutError?It.ETIMEDOUT:It.ECONNABORTED,o,he)),he=null},S===void 0&&C.setContentType(null),"setRequestHeader"in he&&ue.forEach(C.toJSON(),function(Ee,Oe){he.setRequestHeader(Oe,Ee)}),ue.isUndefined(E.withCredentials)||(he.withCredentials=!!E.withCredentials),D&&D!=="json"&&(he.responseType=E.responseType),V&&([Q,z]=hg(V,!0),he.addEventListener("progress",Q)),k&&he.upload&&([W,me]=hg(k),he.upload.addEventListener("progress",W),he.upload.addEventListener("loadend",me)),(E.cancelToken||E.signal)&&(G=X=>{he&&(f(!X||X.type?new Pu(null,o,he):X),he.abort(),he=null)},E.cancelToken&&E.cancelToken.subscribe(G),E.signal&&(E.signal.aborted?G():E.signal.addEventListener("abort",G)));const K=roe(E.url);if(K&&Kr.protocols.indexOf(K)===-1){f(new It("Unsupported protocol "+K+":",It.ERR_BAD_REQUEST,o));return}he.send(S||null)})},hoe=(o,c)=>{const{length:u}=o=o?o.filter(Boolean):[];if(c||u){let f=new AbortController,E;const S=function(V){if(!E){E=!0,D();const G=V instanceof Error?V:this.reason;f.abort(G instanceof It?G:new Pu(G instanceof Error?G.message:G))}};let C=c&&setTimeout(()=>{C=null,S(new It(`timeout ${c} of ms exceeded`,It.ETIMEDOUT))},c);const D=()=>{o&&(C&&clearTimeout(C),C=null,o.forEach(V=>{V.unsubscribe?V.unsubscribe(S):V.removeEventListener("abort",S)}),o=null)};o.forEach(V=>V.addEventListener("abort",S));const{signal:k}=f;return k.unsubscribe=()=>ue.asap(D),k}},poe=function*(o,c){let u=o.byteLength;if(u<c){yield o;return}let f=0,E;for(;f<u;)E=f+c,yield o.slice(f,E),f=E},foe=async function*(o,c){for await(const u of _oe(o))yield*poe(u,c)},_oe=async function*(o){if(o[Symbol.asyncIterator]){yield*o;return}const c=o.getReader();try{for(;;){const{done:u,value:f}=await c.read();if(u)break;yield f}}finally{await c.cancel()}},GF=(o,c,u,f)=>{const E=foe(o,c);let S=0,C,D=k=>{C||(C=!0,f&&f(k))};return new ReadableStream({async pull(k){try{const{done:V,value:G}=await E.next();if(V){D(),k.close();return}let W=G.byteLength;if(u){let Q=S+=W;u(Q)}k.enqueue(new Uint8Array(G))}catch(V){throw D(V),V}},cancel(k){return D(k),E.return()}},{highWaterMark:2})},WF=64*1024,{isFunction:CE}=ue,moe=(({Request:o,Response:c})=>({Request:o,Response:c}))(ue.global),{ReadableStream:HF,TextEncoder:KF}=ue.global,YF=(o,...c)=>{try{return!!o(...c)}catch{return!1}},Eoe=o=>{o=ue.merge.call({skipUndefined:!0},moe,o);const{fetch:c,Request:u,Response:f}=o,E=c?CE(c):typeof fetch=="function",S=CE(u),C=CE(f);if(!E)return!1;const D=E&&CE(HF),k=E&&(typeof KF=="function"?(z=>de=>z.encode(de))(new KF):async z=>new Uint8Array(await new u(z).arrayBuffer())),V=S&&D&&YF(()=>{let z=!1;const de=new u(Kr.origin,{body:new HF,method:"POST",get duplex(){return z=!0,"half"}}).headers.has("Content-Type");return z&&!de}),G=C&&D&&YF(()=>ue.isReadableStream(new f("").body)),W={stream:G&&(z=>z.body)};E&&["text","arrayBuffer","blob","formData","stream"].forEach(z=>{!W[z]&&(W[z]=(de,he)=>{let q=de&&de[z];if(q)return q.call(de);throw new It(`Response type '${z}' is not supported`,It.ERR_NOT_SUPPORT,he)})});const Q=async z=>{if(z==null)return 0;if(ue.isBlob(z))return z.size;if(ue.isSpecCompliantForm(z))return(await new u(Kr.origin,{method:"POST",body:z}).arrayBuffer()).byteLength;if(ue.isArrayBufferView(z)||ue.isArrayBuffer(z))return z.byteLength;if(ue.isURLSearchParams(z)&&(z=z+""),ue.isString(z))return(await k(z)).byteLength},me=async(z,de)=>{const he=ue.toFiniteNumber(z.getContentLength());return he??Q(de)};return async z=>{let{url:de,method:he,data:q,signal:K,cancelToken:X,timeout:Ee,onDownloadProgress:Oe,onUploadProgress:We,responseType:De,headers:ze,withCredentials:an="same-origin",fetchOptions:_t}=B3(z),lr=c||fetch;De=De?(De+"").toLowerCase():"text";let Bt=hoe([K,X&&X.toAbortSignal()],Ee),Mr=null;const hn=Bt&&Bt.unsubscribe&&(()=>{Bt.unsubscribe()});let Ad;try{if(We&&V&&he!=="get"&&he!=="head"&&(Ad=await me(ze,q))!==0){let zt=new u(de,{method:"POST",body:q,duplex:"half"}),jt;if(ue.isFormData(q)&&(jt=zt.headers.get("content-type"))&&ze.setContentType(jt),zt.body){const[Ai,Yn]=FF(Ad,hg(BF(We)));q=GF(zt.body,WF,Ai,Yn)}}ue.isString(an)||(an=an?"include":"omit");const ir=S&&"credentials"in u.prototype,en={..._t,signal:Bt,method:he.toUpperCase(),headers:ze.normalize().toJSON(),body:q,duplex:"half",credentials:ir?an:void 0};Mr=S&&new u(de,en);let Le=await(S?lr(Mr,_t):lr(de,en));const ct=G&&(De==="stream"||De==="response");if(G&&(Oe||ct&&hn)){const zt={};["status","statusText","headers"].forEach(oa=>{zt[oa]=Le[oa]});const jt=ue.toFiniteNumber(Le.headers.get("content-length")),[Ai,Yn]=Oe&&FF(jt,hg(BF(Oe),!0))||[];Le=new f(GF(Le.body,WF,Ai,()=>{Yn&&Yn(),hn&&hn()}),zt)}De=De||"text";let gt=await W[ue.findKey(W,De)||"text"](Le,z);return!ct&&hn&&hn(),await new Promise((zt,jt)=>{V3(zt,jt,{data:gt,headers:wi.from(Le.headers),status:Le.status,statusText:Le.statusText,config:z,request:Mr})})}catch(ir){throw hn&&hn(),ir&&ir.name==="TypeError"&&/Load failed|fetch/i.test(ir.message)?Object.assign(new It("Network Error",It.ERR_NETWORK,z,Mr),{cause:ir.cause||ir}):It.from(ir,ir&&ir.code,z,Mr)}}},goe=new Map,j3=o=>{let c=o&&o.env||{};const{fetch:u,Request:f,Response:E}=c,S=[f,E,u];let C=S.length,D=C,k,V,G=goe;for(;D--;)k=S[D],V=G.get(k),V===void 0&&G.set(k,V=D?new Map:Eoe(c)),G=V;return V};j3();const Fw={http:Mie,xhr:uoe,fetch:{get:j3}};ue.forEach(Fw,(o,c)=>{if(o){try{Object.defineProperty(o,"name",{value:c})}catch{}Object.defineProperty(o,"adapterName",{value:c})}});const zF=o=>`- ${o}`,Soe=o=>ue.isFunction(o)||o===null||o===!1;function Toe(o,c){o=ue.isArray(o)?o:[o];const{length:u}=o;let f,E;const S={};for(let C=0;C<u;C++){f=o[C];let D;if(E=f,!Soe(f)&&(E=Fw[(D=String(f)).toLowerCase()],E===void 0))throw new It(`Unknown adapter '${D}'`);if(E&&(ue.isFunction(E)||(E=E.get(c))))break;S[D||"#"+C]=E}if(!E){const C=Object.entries(S).map(([k,V])=>`adapter ${k} `+(V===!1?"is not supported by the environment":"is not available in the build"));let D=u?C.length>1?`since :
`+C.map(zF).join(`
`):" "+zF(C[0]):"as no adapter specified";throw new It("There is no suitable adapter to dispatch the request "+D,"ERR_NOT_SUPPORT")}return E}const G3={getAdapter:Toe,adapters:Fw};function kC(o){if(o.cancelToken&&o.cancelToken.throwIfRequested(),o.signal&&o.signal.aborted)throw new Pu(null,o)}function qF(o){return kC(o),o.headers=wi.from(o.headers),o.data=LC.call(o,o.transformRequest),["post","put","patch"].indexOf(o.method)!==-1&&o.headers.setContentType("application/x-www-form-urlencoded",!1),G3.getAdapter(o.adapter||rf.adapter,o)(o).then(function(f){return kC(o),f.data=LC.call(o,o.transformResponse,f),f.headers=wi.from(f.headers),f},function(f){return x3(f)||(kC(o),f&&f.response&&(f.response.data=LC.call(o,o.transformResponse,f.response),f.response.headers=wi.from(f.response.headers))),Promise.reject(f)})}const W3="1.13.2",kg={};["object","boolean","number","function","string","symbol"].forEach((o,c)=>{kg[o]=function(f){return typeof f===o||"a"+(c<1?"n ":" ")+o}});const XF={};kg.transitional=function(c,u,f){function E(S,C){return"[Axios v"+W3+"] Transitional option '"+S+"'"+C+(f?". "+f:"")}return(S,C,D)=>{if(c===!1)throw new It(E(C," has been removed"+(u?" in "+u:"")),It.ERR_DEPRECATED);return u&&!XF[C]&&(XF[C]=!0,console.warn(E(C," has been deprecated since v"+u+" and will be removed in the near future"))),c?c(S,C,D):!0}};kg.spelling=function(c){return(u,f)=>(console.warn(`${f} is likely a misspelling of ${c}`),!0)};function voe(o,c,u){if(typeof o!="object")throw new It("options must be an object",It.ERR_BAD_OPTION_VALUE);const f=Object.keys(o);let E=f.length;for(;E-- >0;){const S=f[E],C=c[S];if(C){const D=o[S],k=D===void 0||C(D,S,o);if(k!==!0)throw new It("option "+S+" must be "+k,It.ERR_BAD_OPTION_VALUE);continue}if(u!==!0)throw new It("Unknown option "+S,It.ERR_BAD_OPTION)}}const FE={assertOptions:voe,validators:kg},Is=FE.validators;let md=class{constructor(c){this.defaults=c||{},this.interceptors={request:new xF,response:new xF}}async request(c,u){try{return await this._request(c,u)}catch(f){if(f instanceof Error){let E={};Error.captureStackTrace?Error.captureStackTrace(E):E=new Error;const S=E.stack?E.stack.replace(/^.+\n/,""):"";try{f.stack?S&&!String(f.stack).endsWith(S.replace(/^.+\n.+\n/,""))&&(f.stack+=`
`+S):f.stack=S}catch{}}throw f}}_request(c,u){typeof c=="string"?(u=u||{},u.url=c):u=c||{},u=Rd(this.defaults,u);const{transitional:f,paramsSerializer:E,headers:S}=u;f!==void 0&&FE.assertOptions(f,{silentJSONParsing:Is.transitional(Is.boolean),forcedJSONParsing:Is.transitional(Is.boolean),clarifyTimeoutError:Is.transitional(Is.boolean)},!1),E!=null&&(ue.isFunction(E)?u.paramsSerializer={serialize:E}:FE.assertOptions(E,{encode:Is.function,serialize:Is.function},!0)),u.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?u.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:u.allowAbsoluteUrls=!0),FE.assertOptions(u,{baseUrl:Is.spelling("baseURL"),withXsrfToken:Is.spelling("withXSRFToken")},!0),u.method=(u.method||this.defaults.method||"get").toLowerCase();let C=S&&ue.merge(S.common,S[u.method]);S&&ue.forEach(["delete","get","head","post","put","patch","common"],z=>{delete S[z]}),u.headers=wi.concat(C,S);const D=[];let k=!0;this.interceptors.request.forEach(function(de){typeof de.runWhen=="function"&&de.runWhen(u)===!1||(k=k&&de.synchronous,D.unshift(de.fulfilled,de.rejected))});const V=[];this.interceptors.response.forEach(function(de){V.push(de.fulfilled,de.rejected)});let G,W=0,Q;if(!k){const z=[qF.bind(this),void 0];for(z.unshift(...D),z.push(...V),Q=z.length,G=Promise.resolve(u);W<Q;)G=G.then(z[W++],z[W++]);return G}Q=D.length;let me=u;for(;W<Q;){const z=D[W++],de=D[W++];try{me=z(me)}catch(he){de.call(this,he);break}}try{G=qF.call(this,me)}catch(z){return Promise.reject(z)}for(W=0,Q=V.length;W<Q;)G=G.then(V[W++],V[W++]);return G}getUri(c){c=Rd(this.defaults,c);const u=F3(c.baseURL,c.url,c.allowAbsoluteUrls);return k3(u,c.params,c.paramsSerializer)}};ue.forEach(["delete","get","head","options"],function(c){md.prototype[c]=function(u,f){return this.request(Rd(f||{},{method:c,url:u,data:(f||{}).data}))}});ue.forEach(["post","put","patch"],function(c){function u(f){return function(S,C,D){return this.request(Rd(D||{},{method:c,headers:f?{"Content-Type":"multipart/form-data"}:{},url:S,data:C}))}}md.prototype[c]=u(),md.prototype[c+"Form"]=u(!0)});let Roe=class H3{constructor(c){if(typeof c!="function")throw new TypeError("executor must be a function.");let u;this.promise=new Promise(function(S){u=S});const f=this;this.promise.then(E=>{if(!f._listeners)return;let S=f._listeners.length;for(;S-- >0;)f._listeners[S](E);f._listeners=null}),this.promise.then=E=>{let S;const C=new Promise(D=>{f.subscribe(D),S=D}).then(E);return C.cancel=function(){f.unsubscribe(S)},C},c(function(S,C,D){f.reason||(f.reason=new Pu(S,C,D),u(f.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(c){if(this.reason){c(this.reason);return}this._listeners?this._listeners.push(c):this._listeners=[c]}unsubscribe(c){if(!this._listeners)return;const u=this._listeners.indexOf(c);u!==-1&&this._listeners.splice(u,1)}toAbortSignal(){const c=new AbortController,u=f=>{c.abort(f)};return this.subscribe(u),c.signal.unsubscribe=()=>this.unsubscribe(u),c.signal}static source(){let c;return{token:new H3(function(E){c=E}),cancel:c}}};function yoe(o){return function(u){return o.apply(null,u)}}function Coe(o){return ue.isObject(o)&&o.isAxiosError===!0}const MI={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(MI).forEach(([o,c])=>{MI[c]=o});function K3(o){const c=new md(o),u=R3(md.prototype.request,c);return ue.extend(u,md.prototype,c,{allOwnKeys:!0}),ue.extend(u,c,null,{allOwnKeys:!0}),u.create=function(E){return K3(Rd(o,E))},u}const Zn=K3(rf);Zn.Axios=md;Zn.CanceledError=Pu;Zn.CancelToken=Roe;Zn.isCancel=x3;Zn.VERSION=W3;Zn.toFormData=Lg;Zn.AxiosError=It;Zn.Cancel=Zn.CanceledError;Zn.all=function(c){return Promise.all(c)};Zn.spread=yoe;Zn.isAxiosError=Coe;Zn.mergeConfig=Rd;Zn.AxiosHeaders=wi;Zn.formToJSON=o=>U3(ue.isHTMLForm(o)?new FormData(o):o);Zn.getAdapter=G3.getAdapter;Zn.HttpStatusCode=MI;Zn.default=Zn;const{Axios:Woe,AxiosError:Hoe,CanceledError:Koe,isCancel:Yoe,CancelToken:zoe,VERSION:qoe,all:Xoe,Cancel:Joe,isAxiosError:Qoe,spread:Zoe,toFormData:$oe,AxiosHeaders:ese,HttpStatusCode:tse,formToJSON:nse,getAdapter:rse,mergeConfig:ise}=Zn,Ioe=void 0,Ro=Zn.create({baseURL:Ioe});Ro.interceptors.request.use(o=>{const c=localStorage.getItem("pnptv.accessToken");return c&&(o.headers.Authorization=`Bearer ${c}`),o});Ro.interceptors.response.use(o=>o,o=>{var c;return((c=o.response)==null?void 0:c.status)===401&&(localStorage.removeItem("pnptv.accessToken"),localStorage.removeItem("pnptv.expiresAt")),Promise.reject(o)});const Y3=Re.createContext(void 0),JF=o=>({displayName:o.username||o.first_name||`Papi #${o.id.slice(-4)}`,avatarSeed:o.id,createdAt:new Date().toISOString()}),woe=({children:o})=>{const[c,u]=BI.useState({accessToken:localStorage.getItem("pnptv.accessToken"),expiresAt:localStorage.getItem("pnptv.expiresAt"),role:null,telegramUser:null,termsAccepted:!1,sessionProfile:null}),f=Re.useCallback(async D=>{const k=await Ro.post("/auth/telegram",D),{accessToken:V,expiresAt:G,role:W,telegramUser:Q,termsAccepted:me}=k.data;localStorage.setItem("pnptv.accessToken",V),localStorage.setItem("pnptv.expiresAt",G),u({accessToken:V,expiresAt:G,role:W,telegramUser:Q,termsAccepted:me,sessionProfile:JF(D)})},[]),E=Re.useCallback(async()=>{if(!c.accessToken)return;const D=await Ro.get("/auth/me"),{role:k,telegramUser:V,termsAccepted:G}=D.data;u(W=>({...W,role:k,telegramUser:V,termsAccepted:G,sessionProfile:W.sessionProfile??(V?JF(V):null)}))},[c.accessToken]),S=Re.useCallback(()=>{localStorage.removeItem("pnptv.accessToken"),localStorage.removeItem("pnptv.expiresAt"),u({accessToken:null,expiresAt:null,role:null,telegramUser:null,termsAccepted:!1,sessionProfile:null})},[]),C=Re.useMemo(()=>({...c,loginWithTelegram:f,logout:S,refreshMe:E}),[c,f,S,E]);return se.jsx(Y3.Provider,{value:C,children:o})},wd=()=>{const o=Re.useContext(Y3);if(!o)throw new Error("useAuth must be used within AuthProvider");return o},Aoe=()=>se.jsxs("div",{children:[se.jsx("h2",{children:"No autorizado"}),se.jsx("p",{children:"Tu rol actual no permite esta accin."}),se.jsx(ic,{to:"/hangouts",children:"Volver"})]}),Ql=({children:o,requireRole:c})=>{const{accessToken:u,termsAccepted:f,role:E}=wd();return u?f?c&&E&&!c.includes(E)?se.jsx(Aoe,{}):se.jsx(se.Fragment,{children:o}):se.jsx(OI,{to:"/terms",replace:!0}):se.jsx(OI,{to:"/login",replace:!0})},boe=({children:o})=>{const{accessToken:c,logout:u,sessionProfile:f}=wd();return se.jsxs("div",{children:[se.jsxs("header",{style:{display:"flex",justifyContent:"space-between",padding:"1rem"},children:[se.jsxs("nav",{style:{display:"flex",gap:"1rem"},children:[se.jsx(ic,{to:"/hangouts",children:"Hangouts"}),se.jsx(ic,{to:"/videorama",children:"Videorama"})]}),se.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"center"},children:[f&&se.jsx("span",{children:f.displayName}),c?se.jsx("button",{onClick:u,children:"Salir"}):se.jsx(ic,{to:"/login",children:"Login"})]})]}),se.jsx("main",{style:{padding:"1rem"},children:o})]})},Ooe=()=>{const o=Re.useRef(null),c=Id(),{loginWithTelegram:u,accessToken:f}=wd();return Re.useEffect(()=>{f&&c("/hangouts")},[f,c]),Re.useEffect(()=>{if(window.onTelegramAuth=async S=>{await u({id:String(S.id),username:S.username?String(S.username):void 0,first_name:S.first_name?String(S.first_name):void 0,photo_url:S.photo_url?String(S.photo_url):void 0,auth_date:Number(S.auth_date),hash:String(S.hash)}),c("/hangouts")},!o.current)return;const E=document.createElement("script");return E.src="https://telegram.org/js/telegram-widget.js?22",E.async=!0,E.setAttribute("data-telegram-login","pnptv_bot"),E.setAttribute("data-size","large"),E.setAttribute("data-userpic","false"),E.setAttribute("data-request-access","write"),E.setAttribute("data-onauth","onTelegramAuth(user)"),o.current.appendChild(E),()=>{var S;(S=o.current)==null||S.removeChild(E)}},[u,c]),se.jsxs("div",{children:[se.jsx("h1",{children:"Login"}),se.jsx("p",{children:"Accede con tu cuenta de Telegram para continuar."}),se.jsx("div",{ref:o})]})},Noe="https://pnptv.app/terms",Doe=()=>{const[o,c]=Re.useState(!1),[u,f]=Re.useState(!1),{refreshMe:E}=wd(),S=Id(),C=async()=>{f(!0),await Ro.post("/auth/accept-terms"),await E(),f(!1),S("/hangouts")};return se.jsxs("div",{children:[se.jsx("h1",{children:"Reglas bsicas de uso  PNPtv"}),se.jsxs("p",{children:["Consulta el texto completo aqu: ",se.jsx("a",{href:Noe,children:"Trminos y Condiciones"})]}),se.jsxs("section",{children:[se.jsx("h2",{children:"Hangouts (Video Calls)"}),se.jsxs("ul",{children:[se.jsx("li",{children:"Las salas son espacios sociales entre adultos verificados."}),se.jsx("li",{children:"No se permite grabar pantalla, audio ni redistribuir contenido."}),se.jsx("li",{children:"Cada usuario es responsable de su comportamiento y de lo que comparte."}),se.jsx("li",{children:"El host de cada sala es responsable de su sala."}),se.jsx("li",{children:"PNPtv y PNP Latino TV no se hacen responsables por acciones de terceros."}),se.jsx("li",{children:"Abusos pueden resultar en expulsin o bloqueo de acceso."})]})]}),se.jsxs("section",{children:[se.jsx("h2",{children:"Videorama (Playlists & Podcasts)"}),se.jsxs("ul",{children:[se.jsx("li",{children:"Listas/podcasts pueden ser creados por usuarios PRIME."}),se.jsx("li",{children:"Cada creador es responsable del contenido que publica."}),se.jsx("li",{children:"El contenido es solo para adultos."}),se.jsx("li",{children:"ADMIN puede editar o eliminar contenido cuando sea necesario."})]})]}),se.jsxs("section",{children:[se.jsx("h2",{children:"Responsabilidad (Liability Release)"}),se.jsxs("ul",{children:[se.jsx("li",{children:"PNPtv y PNP Latino TV son plataformas tecnolgicas."}),se.jsx("li",{children:"No somos responsables por acciones, palabras, contenido o conductas de los usuarios."}),se.jsx("li",{children:"Cada usuario participa bajo su propia responsabilidad."}),se.jsx("li",{children:"El uso de la plataforma implica aceptacin total de estas condiciones."})]})]}),se.jsxs("label",{style:{display:"block",marginTop:"1rem"},children:[se.jsx("input",{type:"checkbox",checked:o,onChange:D=>c(D.target.checked)}),"Acepto los Trminos y Condiciones y las reglas anteriores."]}),se.jsx("button",{disabled:!o||u,onClick:C,style:{marginTop:"1rem"},children:u?"Guardando...":"Aceptar y continuar"})]})},Poe=()=>{const[o,c]=Re.useState([]),{role:u}=wd();return Re.useEffect(()=>{(async()=>{const E=await Ro.get("/hangouts/public?status=OPEN");c(E.data.rooms)})()},[]),se.jsxs("div",{children:[se.jsx("h1",{children:"Hangouts abiertos"}),u&&(u==="PRIME"||u==="ADMIN")&&se.jsx(ic,{to:"/hangouts/create",children:"Crear sala"}),se.jsx("ul",{children:o.map(f=>se.jsxs("li",{children:[se.jsx("strong",{children:f.title})," (",f.visibility,")",se.jsx(ic,{to:`/hangouts/room/${f.id}`,style:{marginLeft:"1rem"},children:"Join"})]},f.id))})]})},Loe=()=>{const[o,c]=Re.useState(""),[u,f]=Re.useState("PUBLIC"),[E,S]=Re.useState(null),C=Id(),D=async k=>{k.preventDefault();const V=await Ro.post("/hangouts",{title:o,visibility:u});S(V.data.joinLink??null),C(`/hangouts/room/${V.data.room.id}`)};return se.jsxs("div",{children:[se.jsx("h1",{children:"Crear sala"}),se.jsxs("form",{onSubmit:D,children:[se.jsxs("label",{children:["Ttulo",se.jsx("input",{value:o,onChange:k=>c(k.target.value),required:!0})]}),se.jsxs("label",{children:["Visibilidad",se.jsxs("select",{value:u,onChange:k=>f(k.target.value),children:[se.jsx("option",{value:"PUBLIC",children:"Public"}),se.jsx("option",{value:"PRIVATE",children:"Private"})]})]}),se.jsx("button",{type:"submit",children:"Crear"})]}),E&&se.jsxs("p",{children:["Link privado: ",se.jsx("code",{children:E})]})]})};var z3={exports:{}};(function(o,c){(function(u,f){o.exports=f()})(sE,function(){function u(e,t){return t.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(r){if(r!=="default"&&!(r in e)){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(e,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}})}),Object.freeze(e)}var f=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof sE<"u"?sE:typeof self<"u"?self:{};function E(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var S=function(e){try{return!!e()}catch{return!0}},C=!S(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),D=C,k=Function.prototype,V=k.call,G=D&&k.bind.bind(V,V),W=D?G:function(e){return function(){return V.apply(e,arguments)}},Q=W({}.isPrototypeOf),me=function(e){return e&&e.Math===Math&&e},z=me(typeof globalThis=="object"&&globalThis)||me(typeof window=="object"&&window)||me(typeof self=="object"&&self)||me(typeof f=="object"&&f)||me(typeof f=="object"&&f)||function(){return this}()||Function("return this")(),de=C,he=Function.prototype,q=he.apply,K=he.call,X=typeof Reflect=="object"&&Reflect.apply||(de?K.bind(q):function(){return K.apply(q,arguments)}),Ee=W,Oe=Ee({}.toString),We=Ee("".slice),De=function(e){return We(Oe(e),8,-1)},ze=De,an=W,_t=function(e){if(ze(e)==="Function")return an(e)},lr=typeof document=="object"&&document.all,Bt=lr===void 0&&lr!==void 0?function(e){return typeof e=="function"||e===lr}:function(e){return typeof e=="function"},Mr={},hn=!S(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),Ad=C,ir=Function.prototype.call,en=Ad?ir.bind(ir):function(){return ir.apply(ir,arguments)},Le={},ct={}.propertyIsEnumerable,gt=Object.getOwnPropertyDescriptor,zt=gt&&!ct.call({1:2},1);Le.f=zt?function(e){var t=gt(this,e);return!!t&&t.enumerable}:ct;var jt,Ai,Yn=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},oa=S,Ds=De,sa=Object,J3=W("".split),of=oa(function(){return!sa("z").propertyIsEnumerable(0)})?function(e){return Ds(e)==="String"?J3(e,""):sa(e)}:sa,sf=function(e){return e==null},Q3=sf,Z3=TypeError,aa=function(e){if(Q3(e))throw new Z3("Can't call method on "+e);return e},$3=of,e4=aa,ca=function(e){return $3(e4(e))},t4=Bt,ur=function(e){return typeof e=="object"?e!==null:t4(e)},oi={},Mg=oi,Ug=z,n4=Bt,Bw=function(e){return n4(e)?e:void 0},Rr=function(e,t){return arguments.length<2?Bw(Mg[e])||Bw(Ug[e]):Mg[e]&&Mg[e][t]||Ug[e]&&Ug[e][t]},jw=z.navigator,Gw=jw&&jw.userAgent,Ps=Gw?String(Gw):"",Ww=z,xg=Ps,Hw=Ww.process,Kw=Ww.Deno,Yw=Hw&&Hw.versions||Kw&&Kw.version,zw=Yw&&Yw.v8;zw&&(Ai=(jt=zw.split("."))[0]>0&&jt[0]<4?1:+(jt[0]+jt[1])),!Ai&&xg&&(!(jt=xg.match(/Edge\/(\d+)/))||jt[1]>=74)&&(jt=xg.match(/Chrome\/(\d+)/))&&(Ai=+jt[1]);var uc=Ai,qw=uc,r4=S,i4=z.String,bd=!!Object.getOwnPropertySymbols&&!r4(function(){var e=Symbol("symbol detection");return!i4(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&qw&&qw<41}),Xw=bd&&!Symbol.sham&&typeof Symbol.iterator=="symbol",o4=Rr,s4=Bt,a4=Q,c4=Object,Lu=Xw?function(e){return typeof e=="symbol"}:function(e){var t=o4("Symbol");return s4(t)&&a4(t.prototype,c4(e))},d4=String,Od=function(e){try{return d4(e)}catch{return"Object"}},l4=Bt,u4=Od,h4=TypeError,si=function(e){if(l4(e))return e;throw new h4(u4(e)+" is not a function")},p4=si,f4=sf,ku=function(e,t){var n=e[t];return f4(n)?void 0:p4(n)},Jw=en,Qw=Bt,Zw=ur,_4=TypeError,$w={exports:{}},eA=z,m4=Object.defineProperty,E4=z,g4=function(e,t){try{m4(eA,e,{value:t,configurable:!0,writable:!0})}catch{eA[e]=t}return t},tA="__core-js_shared__",nA=$w.exports=E4[tA]||g4(tA,{});(nA.versions||(nA.versions=[])).push({version:"3.46.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru), 2025 CoreJS Company (core-js.io)",license:"https://github.com/zloirock/core-js/blob/v3.46.0/LICENSE",source:"https://github.com/zloirock/core-js"});var Vg=$w.exports,rA=Vg,Nd=function(e,t){return rA[e]||(rA[e]=t||{})},S4=aa,T4=Object,ts=function(e){return T4(S4(e))},v4=ts,R4=W({}.hasOwnProperty),$n=Object.hasOwn||function(e,t){return R4(v4(e),t)},y4=W,C4=0,I4=Math.random(),w4=y4(1.1.toString),Fg=function(e){return"Symbol("+(e===void 0?"":e)+")_"+w4(++C4+I4,36)},A4=Nd,iA=$n,b4=Fg,O4=bd,N4=Xw,Dd=z.Symbol,Bg=A4("wks"),D4=N4?Dd.for||Dd:Dd&&Dd.withoutSetter||b4,cn=function(e){return iA(Bg,e)||(Bg[e]=O4&&iA(Dd,e)?Dd[e]:D4("Symbol."+e)),Bg[e]},P4=en,oA=ur,sA=Lu,L4=ku,k4=function(e,t){var n,r;if(Qw(n=e.toString)&&!Zw(r=Jw(n,e))||Qw(n=e.valueOf)&&!Zw(r=Jw(n,e)))return r;throw new _4("Can't convert object to primitive value")},M4=TypeError,U4=cn("toPrimitive"),x4=function(e,t){if(!oA(e)||sA(e))return e;var n,r=L4(e,U4);if(r){if(n=P4(r,e,t),!oA(n)||sA(n))return n;throw new M4("Can't convert object to primitive value")}return k4(e)},V4=Lu,jg=function(e){var t=x4(e,"string");return V4(t)?t:t+""},aA=ur,Gg=z.document,F4=aA(Gg)&&aA(Gg.createElement),Wg=function(e){return F4?Gg.createElement(e):{}},B4=Wg,cA=!hn&&!S(function(){return Object.defineProperty(B4("div"),"a",{get:function(){return 7}}).a!==7}),j4=hn,G4=en,W4=Le,H4=Yn,K4=ca,Y4=jg,z4=$n,q4=cA,dA=Object.getOwnPropertyDescriptor;Mr.f=j4?dA:function(e,t){if(e=K4(e),t=Y4(t),q4)try{return dA(e,t)}catch{}if(z4(e,t))return H4(!G4(W4.f,e,t),e[t])};var X4=S,J4=Bt,Q4=/#|\.prototype\./,Mu=function(e,t){var n=$4[Z4(e)];return n===tG||n!==eG&&(J4(t)?X4(t):!!t)},Z4=Mu.normalize=function(e){return String(e).replace(Q4,".").toLowerCase()},$4=Mu.data={},eG=Mu.NATIVE="N",tG=Mu.POLYFILL="P",lA=Mu,nG=si,rG=C,iG=_t(_t.bind),da=function(e,t){return nG(e),t===void 0?e:rG?iG(e,t):function(){return e.apply(t,arguments)}},zi={},uA=hn&&S(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),oG=ur,sG=String,aG=TypeError,zr=function(e){if(oG(e))return e;throw new aG(sG(e)+" is not an object")},cG=hn,dG=cA,lG=uA,af=zr,hA=jg,uG=TypeError,Hg=Object.defineProperty,hG=Object.getOwnPropertyDescriptor,Kg="enumerable",Yg="configurable",zg="writable";zi.f=cG?lG?function(e,t,n){if(af(e),t=hA(t),af(n),typeof e=="function"&&t==="prototype"&&"value"in n&&zg in n&&!n[zg]){var r=hG(e,t);r&&r[zg]&&(e[t]=n.value,n={configurable:Yg in n?n[Yg]:r[Yg],enumerable:Kg in n?n[Kg]:r[Kg],writable:!1})}return Hg(e,t,n)}:Hg:function(e,t,n){if(af(e),t=hA(t),af(n),dG)try{return Hg(e,t,n)}catch{}if("get"in n||"set"in n)throw new uG("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var pG=zi,fG=Yn,hc=hn?function(e,t,n){return pG.f(e,t,fG(1,n))}:function(e,t,n){return e[t]=n,e},Uu=z,_G=X,mG=_t,EG=Bt,gG=Mr.f,SG=lA,Pd=oi,TG=da,Ld=hc,pA=$n,vG=function(e){var t=function(n,r,i){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,r)}return new e(n,r,i)}return _G(e,this,arguments)};return t.prototype=e.prototype,t},ut=function(e,t){var n,r,i,s,a,d,l,h,p,_=e.target,m=e.global,g=e.stat,w=e.proto,R=m?Uu:g?Uu[_]:Uu[_]&&Uu[_].prototype,y=m?Pd:Pd[_]||Ld(Pd,_,{})[_],b=y.prototype;for(s in t)r=!(n=SG(m?s:_+(g?".":"#")+s,e.forced))&&R&&pA(R,s),d=y[s],r&&(l=e.dontCallGetSet?(p=gG(R,s))&&p.value:R[s]),a=r&&l?l:t[s],(n||w||typeof d!=typeof a)&&(h=e.bind&&r?TG(a,Uu):e.wrap&&r?vG(a):w&&EG(a)?mG(a):a,(e.sham||a&&a.sham||d&&d.sham)&&Ld(h,"sham",!0),Ld(y,s,h),w&&(pA(Pd,i=_+"Prototype")||Ld(Pd,i,{}),Ld(Pd[i],s,a),e.real&&b&&(n||!b[s])&&Ld(b,s,a)))},RG=Math.ceil,yG=Math.floor,CG=Math.trunc||function(e){var t=+e;return(t>0?yG:RG)(t)},IG=CG,qg=function(e){var t=+e;return t!=t||t===0?0:IG(t)},wG=qg,AG=Math.max,bG=Math.min,Xg=function(e,t){var n=wG(e);return n<0?AG(n+t,0):bG(n,t)},OG=qg,NG=Math.min,fA=function(e){var t=OG(e);return t>0?NG(t,9007199254740991):0},DG=fA,la=function(e){return DG(e.length)},PG=ca,LG=Xg,kG=la,_A=function(e){return function(t,n,r){var i=PG(t),s=kG(i);if(s===0)return!e&&-1;var a,d=LG(r,s);if(e&&n!=n){for(;s>d;)if((a=i[d++])!=a)return!0}else for(;s>d;d++)if((e||d in i)&&i[d]===n)return e||d||0;return!e&&-1}},Jg={includes:_A(!0),indexOf:_A(!1)},MG=Jg.includes;ut({target:"Array",proto:!0,forced:S(function(){return!Array(1).includes()})},{includes:function(e){return MG(this,e,arguments.length>1?arguments[1]:void 0)}});var UG=z,xG=oi,bi=function(e,t){var n=xG[e+"Prototype"],r=n&&n[t];if(r)return r;var i=UG[e],s=i&&i.prototype;return s&&s[t]},VG=bi("Array","includes"),FG=ur,BG=De,jG=cn("match"),Qg=function(e){var t;return FG(e)&&((t=e[jG])!==void 0?!!t:BG(e)==="RegExp")},GG=Qg,WG=TypeError,mA={};mA[cn("toStringTag")]="z";var Zg=String(mA)==="[object z]",HG=Zg,KG=Bt,cf=De,YG=cn("toStringTag"),zG=Object,qG=cf(function(){return arguments}())==="Arguments",ua=HG?cf:function(e){var t,n,r;return e===void 0?"Undefined":e===null?"Null":typeof(n=function(i,s){try{return i[s]}catch{}}(t=zG(e),YG))=="string"?n:qG?cf(t):(r=cf(t))==="Object"&&KG(t.callee)?"Arguments":r},XG=ua,JG=String,qr=function(e){if(XG(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return JG(e)},QG=cn("match"),ZG=ut,$G=function(e){if(GG(e))throw new WG("The method doesn't accept regular expressions");return e},e5=aa,EA=qr,t5=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[QG]=!1,"/./"[e](t)}catch{}}return!1},n5=W("".indexOf);ZG({target:"String",proto:!0,forced:!t5("includes")},{includes:function(e){return!!~n5(EA(e5(this)),EA($G(e)),arguments.length>1?arguments[1]:void 0)}});var r5=bi("String","includes"),gA=Q,i5=VG,o5=r5,$g=Array.prototype,eS=String.prototype,s5=function(e){var t=e.includes;return e===$g||gA($g,e)&&t===$g.includes?i5:typeof e=="string"||e===eS||gA(eS,e)&&t===eS.includes?o5:t},te=E(s5),a5=si,c5=ts,d5=of,l5=la,SA=TypeError,TA="Reduce of empty array with no initial value",u5=function(e){return function(t,n,r,i){var s=c5(t),a=d5(s),d=l5(s);if(a5(n),d===0&&r<2)throw new SA(TA);var l=e?d-1:0,h=e?-1:1;if(r<2)for(;;){if(l in a){i=a[l],l+=h;break}if(l+=h,e?l<0:d<=l)throw new SA(TA)}for(;e?l>=0:d>l;l+=h)l in a&&(i=n(i,a[l],l,s));return i}},h5={left:u5(!1)},p5=S,df=function(e,t){var n=[][e];return!!n&&p5(function(){n.call(null,t||function(){return 1},1)})},xu=z,f5=Ps,_5=De,lf=function(e){return f5.slice(0,e.length)===e},tS=lf("Bun/")?"BUN":lf("Cloudflare-Workers")?"CLOUDFLARE":lf("Deno/")?"DENO":lf("Node.js/")?"NODE":xu.Bun&&typeof Bun.version=="string"?"BUN":xu.Deno&&typeof Deno.version=="object"?"DENO":_5(xu.process)==="process"?"NODE":xu.window&&xu.document?"BROWSER":"REST",uf=tS==="NODE",m5=h5.left;ut({target:"Array",proto:!0,forced:!uf&&uc>79&&uc<83||!df("reduce")},{reduce:function(e){var t=arguments.length;return m5(this,e,t,t>1?arguments[1]:void 0)}});var E5=bi("Array","reduce"),g5=Q,S5=E5,nS=Array.prototype,T5=function(e){var t=e.reduce;return e===nS||g5(nS,e)&&t===nS.reduce?S5:t},vA=T5,Oi=E(vA),v5=De,Vu=Array.isArray||function(e){return v5(e)==="Array"},R5=ut,y5=Vu,C5=W([].reverse),RA=[1,2];R5({target:"Array",proto:!0,forced:String(RA)===String(RA.reverse())},{reverse:function(){return y5(this)&&(this.length=this.length),C5(this)}});var I5=bi("Array","reverse"),w5=Q,A5=I5,rS=Array.prototype,b5=function(e){var t=e.reverse;return e===rS||w5(rS,e)&&t===rS.reverse?A5:t},yA=b5,CA=E(yA),O5=Fg,IA=Nd("keys"),hf=function(e){return IA[e]||(IA[e]=O5(e))},N5=!S(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),D5=$n,P5=Bt,L5=ts,k5=N5,wA=hf("IE_PROTO"),iS=Object,M5=iS.prototype,oS=k5?iS.getPrototypeOf:function(e){var t=L5(e);if(D5(t,wA))return t[wA];var n=t.constructor;return P5(n)&&t instanceof n?n.prototype:t instanceof iS?M5:null},U5=W,x5=si,V5=ur,F5=function(e){return V5(e)||e===null},B5=String,j5=TypeError,G5=function(e,t,n){try{return U5(x5(Object.getOwnPropertyDescriptor(e,t)[n]))}catch{}},W5=ur,H5=aa,K5=function(e){if(F5(e))return e;throw new j5("Can't set "+B5(e)+" as a prototype")},Y5=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=G5(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(r,i){return H5(r),K5(i),W5(r)&&(t?e(r,i):r.__proto__=i),r}}():void 0),pf={},ff={},sS=$n,z5=ca,q5=Jg.indexOf,X5=ff,AA=W([].push),bA=function(e,t){var n,r=z5(e),i=0,s=[];for(n in r)!sS(X5,n)&&sS(r,n)&&AA(s,n);for(;t.length>i;)sS(r,n=t[i++])&&(~q5(s,n)||AA(s,n));return s},aS=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],J5=bA,Q5=aS.concat("length","prototype");pf.f=Object.getOwnPropertyNames||function(e){return J5(e,Q5)};var Fu={};Fu.f=Object.getOwnPropertySymbols;var Z5=Rr,$5=pf,eW=Fu,tW=zr,nW=W([].concat),rW=Z5("Reflect","ownKeys")||function(e){var t=$5.f(tW(e)),n=eW.f;return n?nW(t,n(e)):t},OA=$n,iW=rW,oW=Mr,sW=zi,cS={},aW=bA,cW=aS,_f=Object.keys||function(e){return aW(e,cW)},dW=hn,lW=uA,uW=zi,hW=zr,pW=ca,fW=_f;cS.f=dW&&!lW?Object.defineProperties:function(e,t){hW(e);for(var n,r=pW(t),i=fW(t),s=i.length,a=0;s>a;)uW.f(e,n=i[a++],r[n]);return e};var mf,NA=Rr("document","documentElement"),_W=zr,mW=cS,DA=aS,EW=ff,gW=NA,SW=Wg,dS="prototype",lS="script",PA=hf("IE_PROTO"),uS=function(){},LA=function(e){return"<"+lS+">"+e+"</"+lS+">"},kA=function(e){e.write(LA("")),e.close();var t=e.parentWindow.Object;return e=null,t},Ef=function(){try{mf=new ActiveXObject("htmlfile")}catch{}var e,t,n;Ef=typeof document<"u"?document.domain&&mf?kA(mf):(t=SW("iframe"),n="java"+lS+":",t.style.display="none",gW.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(LA("document.F=Object")),e.close(),e.F):kA(mf);for(var r=DA.length;r--;)delete Ef[dS][DA[r]];return Ef()};EW[PA]=!0;var Bu=Object.create||function(e,t){var n;return e!==null?(uS[dS]=_W(e),n=new uS,uS[dS]=null,n[PA]=e):n=Ef(),t===void 0?n:mW.f(n,t)},TW=ur,vW=hc,MA=Error,RW=W("".replace),yW=String(new MA("zxcasd").stack),UA=/\n\s*at [^:]*:[^\n]*/,CW=UA.test(yW),IW=Yn,wW=!S(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",IW(1,7)),e.stack!==7)}),AW=hc,bW=function(e,t){if(CW&&typeof e=="string"&&!MA.prepareStackTrace)for(;t--;)e=RW(e,UA,"");return e},OW=wW,xA=Error.captureStackTrace,kd={},NW=kd,DW=cn("iterator"),PW=Array.prototype,VA=function(e){return e!==void 0&&(NW.Array===e||PW[DW]===e)},LW=ua,FA=ku,kW=sf,MW=kd,UW=cn("iterator"),gf=function(e){if(!kW(e))return FA(e,UW)||FA(e,"@@iterator")||MW[LW(e)]},xW=en,VW=si,FW=zr,BW=Od,jW=gf,GW=TypeError,hS=function(e,t){var n=arguments.length<2?jW(e):t;if(VW(n))return FW(xW(n,e));throw new GW(BW(e)+" is not iterable")},WW=en,BA=zr,HW=ku,jA=function(e,t,n){var r,i;BA(e);try{if(!(r=HW(e,"return"))){if(t==="throw")throw n;return n}r=WW(r,e)}catch(s){i=!0,r=s}if(t==="throw")throw n;if(i)throw r;return BA(r),n},KW=da,YW=en,zW=zr,qW=Od,XW=VA,JW=la,GA=Q,QW=hS,ZW=gf,WA=jA,$W=TypeError,Sf=function(e,t){this.stopped=e,this.result=t},HA=Sf.prototype,ju=function(e,t,n){var r,i,s,a,d,l,h,p=n&&n.that,_=!(!n||!n.AS_ENTRIES),m=!(!n||!n.IS_RECORD),g=!(!n||!n.IS_ITERATOR),w=!(!n||!n.INTERRUPTED),R=KW(t,p),y=function(N){return r&&WA(r,"normal"),new Sf(!0,N)},b=function(N){return _?(zW(N),w?R(N[0],N[1],y):R(N[0],N[1])):w?R(N,y):R(N)};if(m)r=e.iterator;else if(g)r=e;else{if(!(i=ZW(e)))throw new $W(qW(e)+" is not iterable");if(XW(i)){for(s=0,a=JW(e);a>s;s++)if((d=b(e[s]))&&GA(HA,d))return d;return new Sf(!1)}r=QW(e,i)}for(l=m?e.next:r.next;!(h=YW(l,r)).done;){try{d=b(h.value)}catch(N){WA(r,"throw",N)}if(typeof d=="object"&&d&&GA(HA,d))return d}return new Sf(!1)},e6=qr,t6=ut,n6=Q,r6=oS,Tf=Y5,i6=function(e,t,n){for(var r=iW(t),i=sW.f,s=oW.f,a=0;a<r.length;a++){var d=r[a];OA(e,d)||n&&OA(n,d)||i(e,d,s(t,d))}},KA=Bu,pS=hc,fS=Yn,o6=function(e,t){TW(t)&&"cause"in t&&vW(e,"cause",t.cause)},s6=function(e,t,n,r){OW&&(xA?xA(e,t):AW(e,"stack",bW(n,r)))},a6=ju,c6=function(e,t){return e===void 0?arguments.length<2?"":t:e6(e)},d6=cn("toStringTag"),vf=Error,l6=[].push,Md=function(e,t){var n,r=n6(_S,this);Tf?n=Tf(new vf,r?r6(this):_S):(n=r?this:KA(_S),pS(n,d6,"Error")),t!==void 0&&pS(n,"message",c6(t)),s6(n,Md,n.stack,1),arguments.length>2&&o6(n,arguments[2]);var i=[];return a6(e,l6,{that:i}),pS(n,"errors",i),n};Tf?Tf(Md,vf):i6(Md,vf,{name:!0});var _S=Md.prototype=KA(vf.prototype,{constructor:fS(1,Md),message:fS(1,""),name:fS(1,"AggregateError")});t6({global:!0},{AggregateError:Md});var Rf,Gu,yf,u6=Bt,YA=z.WeakMap,h6=u6(YA)&&/native code/.test(String(YA)),zA=z,p6=ur,f6=hc,mS=$n,ES=Vg,_6=hf,m6=ff,qA="Object already initialized",gS=zA.TypeError,E6=zA.WeakMap;if(h6||ES.state){var ns=ES.state||(ES.state=new E6);ns.get=ns.get,ns.has=ns.has,ns.set=ns.set,Rf=function(e,t){if(ns.has(e))throw new gS(qA);return t.facade=e,ns.set(e,t),t},Gu=function(e){return ns.get(e)||{}},yf=function(e){return ns.has(e)}}else{var Ud=_6("state");m6[Ud]=!0,Rf=function(e,t){if(mS(e,Ud))throw new gS(qA);return t.facade=e,f6(e,Ud,t),t},Gu=function(e){return mS(e,Ud)?e[Ud]:{}},yf=function(e){return mS(e,Ud)}}var pc,XA,JA,fc={set:Rf,get:Gu,has:yf,enforce:function(e){return yf(e)?Gu(e):Rf(e,{})},getterFor:function(e){return function(t){var n;if(!p6(t)||(n=Gu(t)).type!==e)throw new gS("Incompatible receiver, "+e+" required");return n}}},SS=hn,g6=$n,QA=Function.prototype,S6=SS&&Object.getOwnPropertyDescriptor,ZA=g6(QA,"name"),$A={PROPER:ZA&&(function(){}).name==="something",CONFIGURABLE:ZA&&(!SS||SS&&S6(QA,"name").configurable)},T6=hc,ha=function(e,t,n,r){return r&&r.enumerable?e[t]=n:T6(e,t,n),e},v6=S,R6=Bt,y6=ur,C6=Bu,e0=oS,I6=ha,TS=cn("iterator"),t0=!1;[].keys&&("next"in(JA=[].keys())?(XA=e0(e0(JA)))!==Object.prototype&&(pc=XA):t0=!0);var w6=!y6(pc)||v6(function(){var e={};return pc[TS].call(e)!==e});R6((pc=w6?{}:C6(pc))[TS])||I6(pc,TS,function(){return this});var n0={IteratorPrototype:pc,BUGGY_SAFARI_ITERATORS:t0},A6=ua,b6=Zg?{}.toString:function(){return"[object "+A6(this)+"]"},O6=Zg,N6=zi.f,D6=hc,P6=$n,L6=b6,r0=cn("toStringTag"),Ls=function(e,t,n,r){var i=n?e:e&&e.prototype;i&&(P6(i,r0)||N6(i,r0,{configurable:!0,value:t}),r&&!O6&&D6(i,"toString",L6))},k6=n0.IteratorPrototype,M6=Bu,U6=Yn,x6=Ls,V6=kd,F6=function(){return this},vS=function(e,t,n,r){var i=t+" Iterator";return e.prototype=M6(k6,{next:U6(+!r,n)}),x6(e,i,!1,!0),V6[i]=F6,e},B6=ut,j6=en,G6=$A,W6=vS,H6=oS,K6=Ls,i0=ha,o0=kd,Y6=n0,z6=G6.PROPER,Cf=Y6.BUGGY_SAFARI_ITERATORS,RS=cn("iterator"),s0="keys",If="values",a0="entries",q6=function(){return this},c0=function(e,t,n,r,i,s,a){W6(n,t,r);var d,l,h,p=function(b){if(b===i&&R)return R;if(!Cf&&b&&b in g)return g[b];switch(b){case s0:case If:case a0:return function(){return new n(this,b)}}return function(){return new n(this)}},_=t+" Iterator",m=!1,g=e.prototype,w=g[RS]||g["@@iterator"]||i&&g[i],R=!Cf&&w||p(i),y=t==="Array"&&g.entries||w;if(y&&(d=H6(y.call(new e)))!==Object.prototype&&d.next&&(K6(d,_,!0,!0),o0[_]=q6),z6&&i===If&&w&&w.name!==If&&(m=!0,R=function(){return j6(w,this)}),i)if(l={values:p(If),keys:s?R:p(s0),entries:p(a0)},a)for(h in l)(Cf||m||!(h in g))&&i0(g,h,l[h]);else B6({target:t,proto:!0,forced:Cf||m},l);return a&&g[RS]!==R&&i0(g,RS,R,{}),o0[t]=R,l},wf=function(e,t){return{value:e,done:t}},X6=ca,d0=kd,l0=fc;zi.f;var J6=c0,Af=wf,u0="Array Iterator",Q6=l0.set,Z6=l0.getterFor(u0);J6(Array,"Array",function(e,t){Q6(this,{type:u0,target:X6(e),index:0,kind:t})},function(){var e=Z6(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,Af(void 0,!0);switch(e.kind){case"keys":return Af(n,!1);case"values":return Af(t[n],!1)}return Af([n,t[n]],!1)},"values"),d0.Arguments=d0.Array;var $6=zi,bf=function(e,t,n){return $6.f(e,t,n)},eH=Rr,tH=bf,nH=hn,h0=cn("species"),rH=Q,iH=TypeError,yS=function(e,t){if(rH(t,e))return e;throw new iH("Incorrect invocation")},oH=Bt,CS=Vg,sH=W(Function.toString);oH(CS.inspectSource)||(CS.inspectSource=function(e){return sH(e)});var p0=CS.inspectSource,aH=W,cH=S,f0=Bt,dH=ua,lH=p0,_0=function(){},m0=Rr("Reflect","construct"),IS=/^\s*(?:class|function)\b/,uH=aH(IS.exec),hH=!IS.test(_0),Wu=function(e){if(!f0(e))return!1;try{return m0(_0,[],e),!0}catch{return!1}},E0=function(e){if(!f0(e))return!1;switch(dH(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return hH||!!uH(IS,lH(e))}catch{return!0}};E0.sham=!0;var Hu,xd,g0,wS,Of=!m0||cH(function(){var e;return Wu(Wu.call)||!Wu(Object)||!Wu(function(){e=!0})||e})?E0:Wu,pH=Of,fH=Od,_H=TypeError,S0=zr,mH=function(e){if(pH(e))return e;throw new _H(fH(e)+" is not a constructor")},EH=sf,gH=cn("species"),AS=function(e,t){var n,r=S0(e).constructor;return r===void 0||EH(n=S0(r)[gH])?t:mH(n)},pa=W([].slice),SH=TypeError,_c=function(e,t){if(e<t)throw new SH("Not enough arguments");return e},T0=/(?:ipad|iphone|ipod).*applewebkit/i.test(Ps),Ni=z,TH=X,vH=da,v0=Bt,RH=$n,R0=S,y0=NA,yH=pa,C0=Wg,CH=_c,IH=T0,wH=uf,bS=Ni.setImmediate,OS=Ni.clearImmediate,AH=Ni.process,NS=Ni.Dispatch,bH=Ni.Function,I0=Ni.MessageChannel,OH=Ni.String,DS=0,Ku={},w0="onreadystatechange";R0(function(){Hu=Ni.location});var PS=function(e){if(RH(Ku,e)){var t=Ku[e];delete Ku[e],t()}},LS=function(e){return function(){PS(e)}},A0=function(e){PS(e.data)},b0=function(e){Ni.postMessage(OH(e),Hu.protocol+"//"+Hu.host)};bS&&OS||(bS=function(e){CH(arguments.length,1);var t=v0(e)?e:bH(e),n=yH(arguments,1);return Ku[++DS]=function(){TH(t,void 0,n)},xd(DS),DS},OS=function(e){delete Ku[e]},wH?xd=function(e){AH.nextTick(LS(e))}:NS&&NS.now?xd=function(e){NS.now(LS(e))}:I0&&!IH?(wS=(g0=new I0).port2,g0.port1.onmessage=A0,xd=vH(wS.postMessage,wS)):Ni.addEventListener&&v0(Ni.postMessage)&&!Ni.importScripts&&Hu&&Hu.protocol!=="file:"&&!R0(b0)?(xd=b0,Ni.addEventListener("message",A0,!1)):xd=w0 in C0("script")?function(e){y0.appendChild(C0("script"))[w0]=function(){y0.removeChild(this),PS(e)}}:function(e){setTimeout(LS(e),0)});var Nf={set:bS,clear:OS},O0=z,NH=hn,DH=Object.getOwnPropertyDescriptor,N0=function(e){if(!NH)return O0[e];var t=DH(O0,e);return t&&t.value},D0=function(){this.head=null,this.tail=null};D0.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Vd,kS,MS,US,P0,L0=D0,PH=/ipad|iphone|ipod/i.test(Ps)&&typeof Pebble<"u",LH=/web0s(?!.*chrome)/i.test(Ps),Fd=z,kH=N0,k0=da,xS=Nf.set,MH=L0,UH=T0,xH=PH,VH=LH,VS=uf,M0=Fd.MutationObserver||Fd.WebKitMutationObserver,U0=Fd.document,x0=Fd.process,Df=Fd.Promise,FS=kH("queueMicrotask");if(!FS){var Pf=new MH,Lf=function(){var e,t;for(VS&&(e=x0.domain)&&e.exit();t=Pf.get();)try{t()}catch(n){throw Pf.head&&Vd(),n}e&&e.enter()};UH||VS||VH||!M0||!U0?!xH&&Df&&Df.resolve?((US=Df.resolve(void 0)).constructor=Df,P0=k0(US.then,US),Vd=function(){P0(Lf)}):VS?Vd=function(){x0.nextTick(Lf)}:(xS=k0(xS,Fd),Vd=function(){xS(Lf)}):(kS=!0,MS=U0.createTextNode(""),new M0(Lf).observe(MS,{characterData:!0}),Vd=function(){MS.data=kS=!kS}),FS=function(e){Pf.head||Vd(),Pf.add(e)}}var V0=FS,Bd=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},mc=z.Promise,FH=z,Yu=mc,BH=Bt,jH=lA,GH=p0,WH=cn,F0=tS,BS=uc,B0=Yu&&Yu.prototype,HH=WH("species"),j0=BH(FH.PromiseRejectionEvent),KH=jH("Promise",function(){var e=GH(Yu),t=e!==String(Yu);if(!t&&BS===66||!B0.catch||!B0.finally)return!0;if(!BS||BS<51||!/native code/.test(e)){var n=new Yu(function(i){i(1)}),r=function(i){i(function(){},function(){})};if((n.constructor={})[HH]=r,!(n.then(function(){})instanceof r))return!0}return!(t||F0!=="BROWSER"&&F0!=="DENO"||j0)}),zu={CONSTRUCTOR:KH,REJECTION_EVENT:j0},rs={},G0=si,YH=TypeError,zH=function(e){var t,n;this.promise=new e(function(r,i){if(t!==void 0||n!==void 0)throw new YH("Bad Promise constructor");t=r,n=i}),this.resolve=G0(t),this.reject=G0(n)};rs.f=function(e){return new zH(e)};var jS,W0,H0,qH=ut,kf=uf,fa=z,XH=oi,qu=en,JH=ha,QH=Ls,ZH=function(e){var t=eH(e);nH&&t&&!t[h0]&&tH(t,h0,{configurable:!0,get:function(){return this}})},$H=si,GS=Bt,eK=ur,tK=yS,nK=AS,K0=Nf.set,WS=V0,rK=function(e,t){try{arguments.length===1?console.error(e):console.error(e,t)}catch{}},iK=Bd,oK=L0,Y0=fc,HS=mc,z0=zu,q0=rs,Mf="Promise",X0=z0.CONSTRUCTOR,sK=z0.REJECTION_EVENT,KS=Y0.getterFor(Mf),aK=Y0.set,cK=HS&&HS.prototype,Xu=HS,YS=cK,J0=fa.TypeError,zS=fa.document,qS=fa.process,XS=q0.f,dK=XS,lK=!!(zS&&zS.createEvent&&fa.dispatchEvent),Q0="unhandledrejection",Z0=function(e){var t;return!(!eK(e)||!GS(t=e.then))&&t},$0=function(e,t){var n,r,i,s=t.value,a=t.state===1,d=a?e.ok:e.fail,l=e.resolve,h=e.reject,p=e.domain;try{d?(a||(t.rejection===2&&hK(t),t.rejection=1),d===!0?n=s:(p&&p.enter(),n=d(s),p&&(p.exit(),i=!0)),n===e.promise?h(new J0("Promise-chain cycle")):(r=Z0(n))?qu(r,n,l,h):l(n)):h(s)}catch(_){p&&!i&&p.exit(),h(_)}},eb=function(e,t){e.notified||(e.notified=!0,WS(function(){for(var n,r=e.reactions;n=r.get();)$0(n,e);e.notified=!1,t&&!e.rejection&&uK(e)}))},tb=function(e,t,n){var r,i;lK?((r=zS.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),fa.dispatchEvent(r)):r={promise:t,reason:n},!sK&&(i=fa["on"+e])?i(r):e===Q0&&rK("Unhandled promise rejection",n)},uK=function(e){qu(K0,fa,function(){var t,n=e.facade,r=e.value;if(nb(e)&&(t=iK(function(){kf?qS.emit("unhandledRejection",r,n):tb(Q0,n,r)}),e.rejection=kf||nb(e)?2:1,t.error))throw t.value})},nb=function(e){return e.rejection!==1&&!e.parent},hK=function(e){qu(K0,fa,function(){var t=e.facade;kf?qS.emit("rejectionHandled",t):tb("rejectionhandled",t,e.value)})},jd=function(e,t,n){return function(r){e(t,r,n)}},Gd=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,eb(e,!0))},JS=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw new J0("Promise can't be resolved itself");var r=Z0(t);r?WS(function(){var i={done:!1};try{qu(r,t,jd(JS,i,e),jd(Gd,i,e))}catch(s){Gd(i,s,e)}}):(e.value=t,e.state=1,eb(e,!1))}catch(i){Gd({done:!1},i,e)}}};X0&&(YS=(Xu=function(e){tK(this,YS),$H(e),qu(jS,this);var t=KS(this);try{e(jd(JS,t),jd(Gd,t))}catch(n){Gd(t,n)}}).prototype,(jS=function(e){aK(this,{type:Mf,done:!1,notified:!1,parent:!1,reactions:new oK,rejection:!1,state:0,value:null})}).prototype=JH(YS,"then",function(e,t){var n=KS(this),r=XS(nK(this,Xu));return n.parent=!0,r.ok=!GS(e)||e,r.fail=GS(t)&&t,r.domain=kf?qS.domain:void 0,n.state===0?n.reactions.add(r):WS(function(){$0(r,n)}),r.promise}),W0=function(){var e=new jS,t=KS(e);this.promise=e,this.resolve=jd(JS,t),this.reject=jd(Gd,t)},q0.f=XS=function(e){return e===Xu||e===H0?new W0(e):dK(e)}),qH({global:!0,wrap:!0,forced:X0},{Promise:Xu}),H0=XH.Promise,QH(Xu,Mf,!1,!0),ZH(Mf);var rb=cn("iterator"),ib=!1;try{var pK=0,ob={next:function(){return{done:!!pK++}},return:function(){ib=!0}};ob[rb]=function(){return this},Array.from(ob,function(){throw 2})}catch{}var fK=mc,_K=function(e,t){try{if(!t&&!ib)return!1}catch{return!1}var n=!1;try{var r={};r[rb]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch{}return n},Uf=zu.CONSTRUCTOR||!_K(function(e){fK.all(e).then(void 0,function(){})}),mK=en,EK=si,gK=rs,SK=Bd,TK=ju;ut({target:"Promise",stat:!0,forced:Uf},{all:function(e){var t=this,n=gK.f(t),r=n.resolve,i=n.reject,s=SK(function(){var a=EK(t.resolve),d=[],l=0,h=1;TK(e,function(p){var _=l++,m=!1;h++,mK(a,t,p).then(function(g){m||(m=!0,d[_]=g,--h||r(d))},i)}),--h||r(d)});return s.error&&i(s.value),n.promise}});var vK=ut,RK=zu.CONSTRUCTOR;mc&&mc.prototype,vK({target:"Promise",proto:!0,forced:RK,real:!0},{catch:function(e){return this.then(void 0,e)}});var yK=en,CK=si,IK=rs,wK=Bd,AK=ju;ut({target:"Promise",stat:!0,forced:Uf},{race:function(e){var t=this,n=IK.f(t),r=n.reject,i=wK(function(){var s=CK(t.resolve);AK(e,function(a){yK(s,t,a).then(n.resolve,r)})});return i.error&&r(i.value),n.promise}});var bK=rs;ut({target:"Promise",stat:!0,forced:zu.CONSTRUCTOR},{reject:function(e){var t=bK.f(this);return(0,t.reject)(e),t.promise}});var OK=zr,NK=ur,DK=rs,sb=function(e,t){if(OK(e),NK(t)&&t.constructor===e)return t;var n=DK.f(e);return(0,n.resolve)(t),n.promise},PK=ut,LK=mc,kK=zu.CONSTRUCTOR,MK=sb,UK=Rr("Promise"),xK=!kK;PK({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return MK(xK&&this===UK?LK:this,e)}});var VK=en,FK=si,BK=rs,jK=Bd,GK=ju;ut({target:"Promise",stat:!0,forced:Uf},{allSettled:function(e){var t=this,n=BK.f(t),r=n.resolve,i=n.reject,s=jK(function(){var a=FK(t.resolve),d=[],l=0,h=1;GK(e,function(p){var _=l++,m=!1;h++,VK(a,t,p).then(function(g){m||(m=!0,d[_]={status:"fulfilled",value:g},--h||r(d))},function(g){m||(m=!0,d[_]={status:"rejected",reason:g},--h||r(d))})}),--h||r(d)});return s.error&&i(s.value),n.promise}});var WK=en,HK=si,KK=Rr,YK=rs,zK=Bd,qK=ju,ab="No one promise resolved";ut({target:"Promise",stat:!0,forced:Uf},{any:function(e){var t=this,n=KK("AggregateError"),r=YK.f(t),i=r.resolve,s=r.reject,a=zK(function(){var d=HK(t.resolve),l=[],h=0,p=1,_=!1;qK(e,function(m){var g=h++,w=!1;p++,WK(d,t,m).then(function(R){w||_||(_=!0,i(R))},function(R){w||_||(w=!0,l[g]=R,--p||s(new n(l,ab)))})}),--p||s(new n(l,ab))});return a.error&&s(a.value),r.promise}});var XK=ut,JK=X,QK=pa,ZK=rs,$K=si,cb=Bd,QS=z.Promise,db=!1;XK({target:"Promise",stat:!0,forced:!QS||!QS.try||cb(function(){QS.try(function(e){db=e===8},8)}).error||!db},{try:function(e){var t=arguments.length>1?QK(arguments,1):[],n=ZK.f(this),r=cb(function(){return JK($K(e),void 0,t)});return(r.error?n.reject:n.resolve)(r.value),n.promise}});var e8=rs;ut({target:"Promise",stat:!0},{withResolvers:function(){var e=e8.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var t8=ut,ZS=mc,n8=S,r8=Rr,i8=Bt,o8=AS,lb=sb,s8=ZS&&ZS.prototype;t8({target:"Promise",proto:!0,real:!0,forced:!!ZS&&n8(function(){s8.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=o8(this,r8("Promise")),n=i8(e);return this.then(n?function(r){return lb(t,e()).then(function(){return r})}:e,n?function(r){return lb(t,e()).then(function(){throw r})}:e)}});var $S=W,a8=qg,c8=qr,d8=aa,l8=$S("".charAt),ub=$S("".charCodeAt),u8=$S("".slice),hb=function(e){return function(t,n){var r,i,s=c8(d8(t)),a=a8(n),d=s.length;return a<0||a>=d?e?"":void 0:(r=ub(s,a))<55296||r>56319||a+1===d||(i=ub(s,a+1))<56320||i>57343?e?l8(s,a):r:e?u8(s,a,a+2):i-56320+(r-55296<<10)+65536}},eT={codeAt:hb(!1),charAt:hb(!0)},h8=eT.charAt,p8=qr,pb=fc,f8=c0,fb=wf,_b="String Iterator",_8=pb.set,m8=pb.getterFor(_b);f8(String,"String",function(e){_8(this,{type:_b,string:p8(e),index:0})},function(){var e,t=m8(this),n=t.string,r=t.index;return r>=n.length?fb(void 0,!0):(e=h8(n,r),t.index+=e.length,fb(e,!1))});var E8=oi.Promise,g8={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},S8=z,T8=Ls,mb=kd;for(var tT in g8)T8(S8[tT],tT),mb[tT]=mb.Array;var Eb=E8,ae=E(Eb),v8=bi("Array","values"),R8=ua,y8=$n,C8=Q,I8=v8,nT=Array.prototype,w8={DOMTokenList:!0,NodeList:!0},A8=function(e){var t=e.values;return e===nT||C8(nT,e)&&t===nT.values||y8(w8,R8(e))?I8:t},Xr=E(A8),gb=Od,b8=TypeError,Sb=pa,O8=Math.floor,rT=function(e,t){var n=e.length;if(n<8)for(var r,i,s=1;s<n;){for(i=s,r=e[s];i&&t(e[i-1],r)>0;)e[i]=e[--i];i!==s++&&(e[i]=r)}else for(var a=O8(n/2),d=rT(Sb(e,0,a),t),l=rT(Sb(e,a),t),h=d.length,p=l.length,_=0,m=0;_<h||m<p;)e[_+m]=_<h&&m<p?t(d[_],l[m])<=0?d[_++]:l[m++]:_<h?d[_++]:l[m++];return e},Tb=rT,vb=Ps.match(/firefox\/(\d+)/i),N8=!!vb&&+vb[1],D8=/MSIE|Trident/.test(Ps),Rb=Ps.match(/AppleWebKit\/(\d+)\./),P8=!!Rb&&+Rb[1],L8=ut,yb=W,k8=si,M8=ts,Cb=la,U8=function(e,t){if(!delete e[t])throw new b8("Cannot delete property "+gb(t)+" of "+gb(e))},Ib=qr,iT=S,x8=Tb,V8=df,wb=N8,F8=D8,Ab=uc,bb=P8,_a=[],Ob=yb(_a.sort),B8=yb(_a.push),j8=iT(function(){_a.sort(void 0)}),G8=iT(function(){_a.sort(null)}),W8=V8("sort"),Nb=!iT(function(){if(Ab)return Ab<70;if(!(wb&&wb>3)){if(F8)return!0;if(bb)return bb<603;var e,t,n,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)_a.push({k:t+r,v:n})}for(_a.sort(function(s,a){return a.v-s.v}),r=0;r<_a.length;r++)t=_a[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return i!=="DGBEFHACIJK"}});L8({target:"Array",proto:!0,forced:j8||!G8||!W8||!Nb},{sort:function(e){e!==void 0&&k8(e);var t=M8(this);if(Nb)return e===void 0?Ob(t):Ob(t,e);var n,r,i=[],s=Cb(t);for(r=0;r<s;r++)r in t&&B8(i,t[r]);for(x8(i,function(a){return function(d,l){return l===void 0?-1:d===void 0?1:a!==void 0?+a(d,l)||0:Ib(d)>Ib(l)?1:-1}}(e)),n=Cb(i),r=0;r<n;)t[r]=i[r++];for(;r<s;)U8(t,r++);return t}});var H8=bi("Array","sort"),K8=Q,Y8=H8,oT=Array.prototype,z8=function(e){var t=e.sort;return e===oT||K8(oT,e)&&t===oT.sort?Y8:t},Ec=E(z8),q8=ut,X8=W,J8=Xg,Q8=RangeError,Db=String.fromCharCode,Pb=String.fromCodePoint,Z8=X8([].join);q8({target:"String",stat:!0,forced:!!Pb&&Pb.length!==1},{fromCodePoint:function(e){for(var t,n=[],r=arguments.length,i=0;r>i;){if(t=+arguments[i++],J8(t,1114111)!==t)throw new Q8(t+" is not a valid code point");n[i]=t<65536?Db(t):Db(55296+((t-=65536)>>10),t%1024+56320)}return Z8(n,"")}});var $8=S,eY=cn("iterator"),xf=!$8(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),r="";return e.pathname="c%20d",t.forEach(function(i,s){t.delete("b"),r+=s+i}),n.delete("a",2),n.delete("b",void 0),!e.toJSON||!n.has("a",1)||n.has("a",2)||!n.has("a",void 0)||n.has("b")||!t.size&&!0||!t.sort||e.href!=="https://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[eY]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||r!=="a1c3"||new URL("https://x",void 0).host!=="x"}),tY=ha,sT=ut,Lb=z,aT=N0,nY=Rr,Vf=en,yo=W,Ju=hn,kb=xf,Mb=ha,rY=bf,iY=function(e,t,n){for(var r in t)n&&n.unsafe&&e[r]?e[r]=t[r]:tY(e,r,t[r],n);return e},oY=Ls,sY=vS,cT=fc,Ub=yS,dT=Bt,aY=$n,cY=da,dY=ua,lY=zr,xb=ur,Jr=qr,uY=Bu,Vb=Yn,Fb=hS,hY=gf,Ff=wf,Wd=_c,pY=Tb,fY=cn("iterator"),Hd="URLSearchParams",Bb=Hd+"Iterator",jb=cT.set,qi=cT.getterFor(Hd),_Y=cT.getterFor(Bb),Gb=aT("fetch"),Bf=aT("Request"),Qu=aT("Headers"),lT=Bf&&Bf.prototype,Wb=Qu&&Qu.prototype,mY=Lb.TypeError,EY=Lb.encodeURIComponent,gY=String.fromCharCode,SY=nY("String","fromCodePoint"),TY=parseInt,jf=yo("".charAt),Hb=yo([].join),ma=yo([].push),Kb=yo("".replace),vY=yo([].shift),Yb=yo([].splice),zb=yo("".split),qb=yo("".slice),RY=yo(/./.exec),yY=/\+/g,CY=/^[0-9a-f]+$/i,Xb=function(e,t){var n=qb(e,t,t+2);return RY(CY,n)?TY(n,16):NaN},IY=function(e){for(var t=0,n=128;n>0&&e&n;n>>=1)t++;return t},wY=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},Jb=function(e){for(var t=(e=Kb(e,yY," ")).length,n="",r=0;r<t;){var i=jf(e,r);if(i==="%"){if(jf(e,r+1)==="%"||r+3>t){n+="%",r++;continue}var s=Xb(e,r+1);if(s!=s){n+=i,r++;continue}r+=2;var a=IY(s);if(a===0)i=gY(s);else{if(a===1||a>4){n+="",r++;continue}for(var d=[s],l=1;l<a&&!(++r+3>t||jf(e,r)!=="%");){var h=Xb(e,r+1);if(h!=h){r+=3;break}if(h>191||h<128)break;ma(d,h),r+=2,l++}if(d.length!==a){n+="";continue}var p=wY(d);p===null?n+="":i=SY(p)}}n+=i,r++}return n},AY=/[!'()~]|%20/g,bY={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},OY=function(e){return bY[e]},Qb=function(e){return Kb(EY(e),AY,OY)},uT=sY(function(e,t){jb(this,{type:Bb,target:qi(e).entries,index:0,kind:t})},Hd,function(){var e=_Y(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,Ff(void 0,!0);var r=t[n];switch(e.kind){case"keys":return Ff(r.key,!1);case"values":return Ff(r.value,!1)}return Ff([r.key,r.value],!1)},!0),Zb=function(e){this.entries=[],this.url=null,e!==void 0&&(xb(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?jf(e,0)==="?"?qb(e,1):e:Jr(e)))};Zb.prototype={type:Hd,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,r,i,s,a,d,l=this.entries,h=hY(e);if(h)for(n=(t=Fb(e,h)).next;!(r=Vf(n,t)).done;){if(s=(i=Fb(lY(r.value))).next,(a=Vf(s,i)).done||(d=Vf(s,i)).done||!Vf(s,i).done)throw new mY("Expected sequence with length 2");ma(l,{key:Jr(a.value),value:Jr(d.value)})}else for(var p in e)aY(e,p)&&ma(l,{key:p,value:Jr(e[p])})},parseQuery:function(e){if(e)for(var t,n,r=this.entries,i=zb(e,"&"),s=0;s<i.length;)(t=i[s++]).length&&(n=zb(t,"="),ma(r,{key:Jb(vY(n)),value:Jb(Hb(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],r=0;r<t.length;)e=t[r++],ma(n,Qb(e.key)+"="+Qb(e.value));return Hb(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var Gf=function(){Ub(this,Kd);var e=jb(this,new Zb(arguments.length>0?arguments[0]:void 0));Ju||(this.size=e.entries.length)},Kd=Gf.prototype;if(iY(Kd,{append:function(e,t){var n=qi(this);Wd(arguments.length,2),ma(n.entries,{key:Jr(e),value:Jr(t)}),Ju||this.length++,n.updateURL()},delete:function(e){for(var t=qi(this),n=Wd(arguments.length,1),r=t.entries,i=Jr(e),s=n<2?void 0:arguments[1],a=s===void 0?s:Jr(s),d=0;d<r.length;){var l=r[d];if(l.key!==i||a!==void 0&&l.value!==a)d++;else if(Yb(r,d,1),a!==void 0)break}Ju||(this.size=r.length),t.updateURL()},get:function(e){var t=qi(this).entries;Wd(arguments.length,1);for(var n=Jr(e),r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){var t=qi(this).entries;Wd(arguments.length,1);for(var n=Jr(e),r=[],i=0;i<t.length;i++)t[i].key===n&&ma(r,t[i].value);return r},has:function(e){for(var t=qi(this).entries,n=Wd(arguments.length,1),r=Jr(e),i=n<2?void 0:arguments[1],s=i===void 0?i:Jr(i),a=0;a<t.length;){var d=t[a++];if(d.key===r&&(s===void 0||d.value===s))return!0}return!1},set:function(e,t){var n=qi(this);Wd(arguments.length,1);for(var r,i=n.entries,s=!1,a=Jr(e),d=Jr(t),l=0;l<i.length;l++)(r=i[l]).key===a&&(s?Yb(i,l--,1):(s=!0,r.value=d));s||ma(i,{key:a,value:d}),Ju||(this.size=i.length),n.updateURL()},sort:function(){var e=qi(this);pY(e.entries,function(t,n){return t.key>n.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,n=qi(this).entries,r=cY(e,arguments.length>1?arguments[1]:void 0),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new uT(this,"keys")},values:function(){return new uT(this,"values")},entries:function(){return new uT(this,"entries")}},{enumerable:!0}),Mb(Kd,fY,Kd.entries,{}),Mb(Kd,"toString",function(){return qi(this).serialize()},{enumerable:!0}),Ju&&rY(Kd,"size",{get:function(){return qi(this).entries.length},configurable:!0,enumerable:!0}),oY(Gf,Hd),sT({global:!0,forced:!kb},{URLSearchParams:Gf}),!kb&&dT(Qu)){var NY=yo(Wb.has),DY=yo(Wb.set),$b=function(e){if(xb(e)){var t,n=e.body;if(dY(n)===Hd)return t=e.headers?new Qu(e.headers):new Qu,NY(t,"content-type")||DY(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),uY(e,{body:Vb(0,Jr(n)),headers:Vb(0,t)})}return e};if(dT(Gb)&&sT({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return Gb(e,arguments.length>1?$b(arguments[1]):{})}}),dT(Bf)){var hT=function(e){return Ub(this,lT),new Bf(e,arguments.length>1?$b(arguments[1]):{})};lT.constructor=hT,hT.prototype=lT,sT({global:!0,dontCallGetSet:!0,forced:!0},{Request:hT})}}var Xi,PY={URLSearchParams:Gf,getState:qi},LY=oi.URLSearchParams,eO=hn,kY=W,MY=en,UY=S,pT=_f,xY=Fu,VY=Le,FY=ts,BY=of,Yd=Object.assign,tO=Object.defineProperty,jY=kY([].concat),GY=!Yd||UY(function(){if(eO&&Yd({b:1},Yd(tO({},"a",{enumerable:!0,get:function(){tO(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},n=Symbol("assign detection"),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(i){t[i]=i}),Yd({},e)[n]!==7||pT(Yd({},t)).join("")!==r})?function(e,t){for(var n=FY(e),r=arguments.length,i=1,s=xY.f,a=VY.f;r>i;)for(var d,l=BY(arguments[i++]),h=s?jY(pT(l),s(l)):pT(l),p=h.length,_=0;p>_;)d=h[_++],eO&&!MY(a,l,d)||(n[d]=l[d]);return n}:Yd,WY=zr,HY=jA,KY=hn,YY=zi,zY=Yn,fT=function(e,t,n){KY?YY.f(e,t,zY(0,n)):e[t]=n},qY=da,XY=en,JY=ts,QY=function(e,t,n,r){try{return r?t(WY(n)[0],n[1]):t(n)}catch(i){HY(e,"throw",i)}},ZY=VA,$Y=Of,ez=la,nO=fT,tz=hS,nz=gf,rO=Array,gc=W,_T=2147483647,rz=/[^\0-\u007E]/,iO=/[.\u3002\uFF0E\uFF61]/g,oO="Overflow: input needs wider integers to process",sO=RangeError,iz=gc(iO.exec),zd=Math.floor,mT=String.fromCharCode,aO=gc("".charCodeAt),cO=gc([].join),Ea=gc([].push),oz=gc("".replace),sz=gc("".split),az=gc("".toLowerCase),dO=function(e){return e+22+75*(e<26)},cz=function(e,t,n){var r=0;for(e=n?zd(e/700):e>>1,e+=zd(e/t);e>455;)e=zd(e/35),r+=36;return zd(r+36*e/(e+38))},dz=function(e){var t=[];e=function(b){for(var N=[],L=0,x=b.length;L<x;){var F=aO(b,L++);if(F>=55296&&F<=56319&&L<x){var M=aO(b,L++);(64512&M)==56320?Ea(N,((1023&F)<<10)+(1023&M)+65536):(Ea(N,F),L--)}else Ea(N,F)}return N}(e);var n,r,i=e.length,s=128,a=0,d=72;for(n=0;n<e.length;n++)(r=e[n])<128&&Ea(t,mT(r));var l=t.length,h=l;for(l&&Ea(t,"-");h<i;){var p=_T;for(n=0;n<e.length;n++)(r=e[n])>=s&&r<p&&(p=r);var _=h+1;if(p-s>zd((_T-a)/_))throw new sO(oO);for(a+=(p-s)*_,s=p,n=0;n<e.length;n++){if((r=e[n])<s&&++a>_T)throw new sO(oO);if(r===s){for(var m=a,g=36;;){var w=g<=d?1:g>=d+26?26:g-d;if(m<w)break;var R=m-w,y=36-w;Ea(t,mT(dO(w+R%y))),m=zd(R/y),g+=36}Ea(t,mT(dO(m))),d=cz(a,_,h===l),a=0,h++}}a++,s++}return cO(t,"")},lz=ut,ET=hn,uz=xf,gT=z,lO=da,Ji=W,Wf=ha,Qi=bf,hz=yS,ST=$n,TT=GY,qd=function(e){var t=JY(e),n=$Y(this),r=arguments.length,i=r>1?arguments[1]:void 0,s=i!==void 0;s&&(i=qY(i,r>2?arguments[2]:void 0));var a,d,l,h,p,_,m=nz(t),g=0;if(!m||this===rO&&ZY(m))for(a=ez(t),d=n?new this(a):rO(a);a>g;g++)_=s?i(t[g],g):t[g],nO(d,g,_);else for(d=n?new this:[],p=(h=tz(t,m)).next;!(l=XY(p,h)).done;g++)_=s?QY(h,i,[l.value,g],!0):l.value,nO(d,g,_);return d.length=g,d},Co=pa,pz=eT.codeAt,fz=function(e){var t,n,r=[],i=sz(oz(az(e),iO,"."),".");for(t=0;t<i.length;t++)n=i[t],Ea(r,iz(rz,n)?"xn--"+dz(n):n);return cO(r,".")},ks=qr,_z=Ls,mz=_c,uO=PY,hO=fc,Ez=hO.set,Hf=hO.getterFor("URL"),gz=uO.URLSearchParams,Sz=uO.getState,Zu=gT.URL,vT=gT.TypeError,Kf=gT.parseInt,Tz=Math.floor,pO=Math.pow,Zi=Ji("".charAt),Io=Ji(/./.exec),$u=Ji([].join),vz=Ji(1.1.toString),Rz=Ji([].pop),Xd=Ji([].push),RT=Ji("".replace),yz=Ji([].shift),Cz=Ji("".split),eh=Ji("".slice),Yf=Ji("".toLowerCase),Iz=Ji([].unshift),yT="Invalid scheme",Sc="Invalid host",fO="Invalid port",_O=/[a-z]/i,wz=/[\d+-.a-z]/i,CT=/\d/,Az=/^0x/i,bz=/^[0-7]+$/,Oz=/^\d+$/,mO=/^[\da-f]+$/i,Nz=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Dz=/[\0\t\n\r #/:<>?@[\\\]^|]/,Pz=/^[\u0000-\u0020]+/,Lz=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,kz=/[\t\n\r]/g,th=function(e){var t,n,r,i;if(typeof e=="number"){for(t=[],n=0;n<4;n++)Iz(t,e%256),e=Tz(e/256);return $u(t,".")}if(typeof e=="object"){for(t="",r=function(s){for(var a=null,d=1,l=null,h=0,p=0;p<8;p++)s[p]!==0?(h>d&&(a=l,d=h),l=null,h=0):(l===null&&(l=p),++h);return h>d?l:a}(e),n=0;n<8;n++)i&&e[n]===0||(i&&(i=!1),r===n?(t+=n?":":"::",i=!0):(t+=vz(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},zf={},EO=TT({},zf,{" ":1,'"':1,"<":1,">":1,"`":1}),gO=TT({},EO,{"#":1,"?":1,"{":1,"}":1}),IT=TT({},gO,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),ga=function(e,t){var n=pz(e,0);return n>32&&n<127&&!ST(t,e)?e:encodeURIComponent(e)},qf={ftp:21,file:null,http:80,https:443,ws:80,wss:443},nh=function(e,t){var n;return e.length===2&&Io(_O,Zi(e,0))&&((n=Zi(e,1))===":"||!t&&n==="|")},SO=function(e){var t;return e.length>1&&nh(eh(e,0,2))&&(e.length===2||(t=Zi(e,2))==="/"||t==="\\"||t==="?"||t==="#")},Mz=function(e){return e==="."||Yf(e)==="%2e"},wT={},TO={},AT={},vO={},RO={},bT={},yO={},CO={},Xf={},Jf={},OT={},NT={},DT={},PT={},IO={},LT={},Jd={},is={},wO={},Tc={},Ms={},kT=function(e,t,n){var r,i,s,a=ks(e);if(t){if(i=this.parse(a))throw new vT(i);this.searchParams=null}else{if(n!==void 0&&(r=new kT(n,!0)),i=this.parse(a,null,r))throw new vT(i);(s=Sz(new gz)).bindURL(this),this.searchParams=s}};kT.prototype={type:"URL",parse:function(e,t,n){var r,i,s,a,d,l=this,h=t||wT,p=0,_="",m=!1,g=!1,w=!1;for(e=ks(e),t||(l.scheme="",l.username="",l.password="",l.host=null,l.port=null,l.path=[],l.query=null,l.fragment=null,l.cannotBeABaseURL=!1,e=RT(e,Pz,""),e=RT(e,Lz,"$1")),e=RT(e,kz,""),r=qd(e);p<=r.length;){switch(i=r[p],h){case wT:if(!i||!Io(_O,i)){if(t)return yT;h=AT;continue}_+=Yf(i),h=TO;break;case TO:if(i&&(Io(wz,i)||i==="+"||i==="-"||i==="."))_+=Yf(i);else{if(i!==":"){if(t)return yT;_="",h=AT,p=0;continue}if(t&&(l.isSpecial()!==ST(qf,_)||_==="file"&&(l.includesCredentials()||l.port!==null)||l.scheme==="file"&&!l.host))return;if(l.scheme=_,t)return void(l.isSpecial()&&qf[l.scheme]===l.port&&(l.port=null));_="",l.scheme==="file"?h=PT:l.isSpecial()&&n&&n.scheme===l.scheme?h=vO:l.isSpecial()?h=CO:r[p+1]==="/"?(h=RO,p++):(l.cannotBeABaseURL=!0,Xd(l.path,""),h=wO)}break;case AT:if(!n||n.cannotBeABaseURL&&i!=="#")return yT;if(n.cannotBeABaseURL&&i==="#"){l.scheme=n.scheme,l.path=Co(n.path),l.query=n.query,l.fragment="",l.cannotBeABaseURL=!0,h=Ms;break}h=n.scheme==="file"?PT:bT;continue;case vO:if(i!=="/"||r[p+1]!=="/"){h=bT;continue}h=Xf,p++;break;case RO:if(i==="/"){h=Jf;break}h=is;continue;case bT:if(l.scheme=n.scheme,i===Xi)l.username=n.username,l.password=n.password,l.host=n.host,l.port=n.port,l.path=Co(n.path),l.query=n.query;else if(i==="/"||i==="\\"&&l.isSpecial())h=yO;else if(i==="?")l.username=n.username,l.password=n.password,l.host=n.host,l.port=n.port,l.path=Co(n.path),l.query="",h=Tc;else{if(i!=="#"){l.username=n.username,l.password=n.password,l.host=n.host,l.port=n.port,l.path=Co(n.path),l.path.length--,h=is;continue}l.username=n.username,l.password=n.password,l.host=n.host,l.port=n.port,l.path=Co(n.path),l.query=n.query,l.fragment="",h=Ms}break;case yO:if(!l.isSpecial()||i!=="/"&&i!=="\\"){if(i!=="/"){l.username=n.username,l.password=n.password,l.host=n.host,l.port=n.port,h=is;continue}h=Jf}else h=Xf;break;case CO:if(h=Xf,i!=="/"||Zi(_,p+1)!=="/")continue;p++;break;case Xf:if(i!=="/"&&i!=="\\"){h=Jf;continue}break;case Jf:if(i==="@"){m&&(_="%40"+_),m=!0,s=qd(_);for(var R=0;R<s.length;R++){var y=s[R];if(y!==":"||w){var b=ga(y,IT);w?l.password+=b:l.username+=b}else w=!0}_=""}else if(i===Xi||i==="/"||i==="?"||i==="#"||i==="\\"&&l.isSpecial()){if(m&&_==="")return"Invalid authority";p-=qd(_).length+1,_="",h=OT}else _+=i;break;case OT:case NT:if(t&&l.scheme==="file"){h=LT;continue}if(i!==":"||g){if(i===Xi||i==="/"||i==="?"||i==="#"||i==="\\"&&l.isSpecial()){if(l.isSpecial()&&_==="")return Sc;if(t&&_===""&&(l.includesCredentials()||l.port!==null))return;if(a=l.parseHost(_))return a;if(_="",h=Jd,t)return;continue}i==="["?g=!0:i==="]"&&(g=!1),_+=i}else{if(_==="")return Sc;if(a=l.parseHost(_))return a;if(_="",h=DT,t===NT)return}break;case DT:if(!Io(CT,i)){if(i===Xi||i==="/"||i==="?"||i==="#"||i==="\\"&&l.isSpecial()||t){if(_!==""){var N=Kf(_,10);if(N>65535)return fO;l.port=l.isSpecial()&&N===qf[l.scheme]?null:N,_=""}if(t)return;h=Jd;continue}return fO}_+=i;break;case PT:if(l.scheme="file",i==="/"||i==="\\")h=IO;else{if(!n||n.scheme!=="file"){h=is;continue}switch(i){case Xi:l.host=n.host,l.path=Co(n.path),l.query=n.query;break;case"?":l.host=n.host,l.path=Co(n.path),l.query="",h=Tc;break;case"#":l.host=n.host,l.path=Co(n.path),l.query=n.query,l.fragment="",h=Ms;break;default:SO($u(Co(r,p),""))||(l.host=n.host,l.path=Co(n.path),l.shortenPath()),h=is;continue}}break;case IO:if(i==="/"||i==="\\"){h=LT;break}n&&n.scheme==="file"&&!SO($u(Co(r,p),""))&&(nh(n.path[0],!0)?Xd(l.path,n.path[0]):l.host=n.host),h=is;continue;case LT:if(i===Xi||i==="/"||i==="\\"||i==="?"||i==="#"){if(!t&&nh(_))h=is;else if(_===""){if(l.host="",t)return;h=Jd}else{if(a=l.parseHost(_))return a;if(l.host==="localhost"&&(l.host=""),t)return;_="",h=Jd}continue}_+=i;break;case Jd:if(l.isSpecial()){if(h=is,i!=="/"&&i!=="\\")continue}else if(t||i!=="?")if(t||i!=="#"){if(i!==Xi&&(h=is,i!=="/"))continue}else l.fragment="",h=Ms;else l.query="",h=Tc;break;case is:if(i===Xi||i==="/"||i==="\\"&&l.isSpecial()||!t&&(i==="?"||i==="#")){if((d=Yf(d=_))===".."||d==="%2e."||d===".%2e"||d==="%2e%2e"?(l.shortenPath(),i==="/"||i==="\\"&&l.isSpecial()||Xd(l.path,"")):Mz(_)?i==="/"||i==="\\"&&l.isSpecial()||Xd(l.path,""):(l.scheme==="file"&&!l.path.length&&nh(_)&&(l.host&&(l.host=""),_=Zi(_,0)+":"),Xd(l.path,_)),_="",l.scheme==="file"&&(i===Xi||i==="?"||i==="#"))for(;l.path.length>1&&l.path[0]==="";)yz(l.path);i==="?"?(l.query="",h=Tc):i==="#"&&(l.fragment="",h=Ms)}else _+=ga(i,gO);break;case wO:i==="?"?(l.query="",h=Tc):i==="#"?(l.fragment="",h=Ms):i!==Xi&&(l.path[0]+=ga(i,zf));break;case Tc:t||i!=="#"?i!==Xi&&(i==="'"&&l.isSpecial()?l.query+="%27":l.query+=i==="#"?"%23":ga(i,zf)):(l.fragment="",h=Ms);break;case Ms:i!==Xi&&(l.fragment+=ga(i,EO))}p++}},parseHost:function(e){var t,n,r;if(Zi(e,0)==="["){if(Zi(e,e.length-1)!=="]"||(t=function(i){var s,a,d,l,h,p,_,m=[0,0,0,0,0,0,0,0],g=0,w=null,R=0,y=function(){return Zi(i,R)};if(y()===":"){if(Zi(i,1)!==":")return;R+=2,w=++g}for(;y();){if(g===8)return;if(y()!==":"){for(s=a=0;a<4&&Io(mO,y());)s=16*s+Kf(y(),16),R++,a++;if(y()==="."){if(a===0||(R-=a,g>6))return;for(d=0;y();){if(l=null,d>0){if(!(y()==="."&&d<4))return;R++}if(!Io(CT,y()))return;for(;Io(CT,y());){if(h=Kf(y(),10),l===null)l=h;else{if(l===0)return;l=10*l+h}if(l>255)return;R++}m[g]=256*m[g]+l,++d!=2&&d!==4||g++}if(d!==4)return;break}if(y()===":"){if(R++,!y())return}else if(y())return;m[g++]=s}else{if(w!==null)return;R++,w=++g}}if(w!==null)for(p=g-w,g=7;g!==0&&p>0;)_=m[g],m[g--]=m[w+p-1],m[w+--p]=_;else if(g!==8)return;return m}(eh(e,1,-1)),!t))return Sc;this.host=t}else if(this.isSpecial()){if(e=fz(e),Io(Nz,e)||(t=function(i){var s,a,d,l,h,p,_,m=Cz(i,".");if(m.length&&m[m.length-1]===""&&m.length--,(s=m.length)>4)return i;for(a=[],d=0;d<s;d++){if((l=m[d])==="")return i;if(h=10,l.length>1&&Zi(l,0)==="0"&&(h=Io(Az,l)?16:8,l=eh(l,h===8?1:2)),l==="")p=0;else{if(!Io(h===10?Oz:h===8?bz:mO,l))return i;p=Kf(l,h)}Xd(a,p)}for(d=0;d<s;d++)if(p=a[d],d===s-1){if(p>=pO(256,5-s))return null}else if(p>255)return null;for(_=Rz(a),d=0;d<a.length;d++)_+=a[d]*pO(256,3-d);return _}(e),t===null))return Sc;this.host=t}else{if(Io(Dz,e))return Sc;for(t="",n=qd(e),r=0;r<n.length;r++)t+=ga(n[r],zf);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return ST(qf,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme==="file"&&t===1&&nh(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,r=e.password,i=e.host,s=e.port,a=e.path,d=e.query,l=e.fragment,h=t+":";return i!==null?(h+="//",e.includesCredentials()&&(h+=n+(r?":"+r:"")+"@"),h+=th(i),s!==null&&(h+=":"+s)):t==="file"&&(h+="//"),h+=e.cannotBeABaseURL?a[0]:a.length?"/"+$u(a,"/"):"",d!==null&&(h+="?"+d),l!==null&&(h+="#"+l),h},setHref:function(e){var t=this.parse(e);if(t)throw new vT(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e==="blob")try{return new Qd(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+th(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(ks(e)+":",wT)},getUsername:function(){return this.username},setUsername:function(e){var t=qd(ks(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=ga(t[n],IT)}},getPassword:function(){return this.password},setPassword:function(e){var t=qd(ks(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=ga(t[n],IT)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?th(e):th(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,OT)},getHostname:function(){var e=this.host;return e===null?"":th(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,NT)},getPort:function(){var e=this.port;return e===null?"":ks(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=ks(e))===""?this.port=null:this.parse(e,DT))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+$u(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Jd))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=ks(e))===""?this.query=null:(Zi(e,0)==="?"&&(e=eh(e,1)),this.query="",this.parse(e,Tc)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=ks(e))!==""?(Zi(e,0)==="#"&&(e=eh(e,1)),this.fragment="",this.parse(e,Ms)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Qd=function(e){var t=hz(this,Qr),n=mz(arguments.length,1)>1?arguments[1]:void 0,r=Ez(t,new kT(e,!1,n));ET||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},Qr=Qd.prototype,$i=function(e,t){return{get:function(){return Hf(this)[e]()},set:t&&function(n){return Hf(this)[t](n)},configurable:!0,enumerable:!0}};if(ET&&(Qi(Qr,"href",$i("serialize","setHref")),Qi(Qr,"origin",$i("getOrigin")),Qi(Qr,"protocol",$i("getProtocol","setProtocol")),Qi(Qr,"username",$i("getUsername","setUsername")),Qi(Qr,"password",$i("getPassword","setPassword")),Qi(Qr,"host",$i("getHost","setHost")),Qi(Qr,"hostname",$i("getHostname","setHostname")),Qi(Qr,"port",$i("getPort","setPort")),Qi(Qr,"pathname",$i("getPathname","setPathname")),Qi(Qr,"search",$i("getSearch","setSearch")),Qi(Qr,"searchParams",$i("getSearchParams")),Qi(Qr,"hash",$i("getHash","setHash"))),Wf(Qr,"toJSON",function(){return Hf(this).serialize()},{enumerable:!0}),Wf(Qr,"toString",function(){return Hf(this).serialize()},{enumerable:!0}),Zu){var AO=Zu.createObjectURL,bO=Zu.revokeObjectURL;AO&&Wf(Qd,"createObjectURL",lO(AO,Zu)),bO&&Wf(Qd,"revokeObjectURL",lO(bO,Zu))}_z(Qd,"URL"),lz({global:!0,forced:!uz,sham:!ET},{URL:Qd});var Uz=ut,OO=S,xz=_c,NO=qr,Vz=xf,MT=Rr("URL"),Fz=Vz&&OO(function(){MT.canParse()}),Bz=OO(function(){return MT.canParse.length!==1});Uz({target:"URL",stat:!0,forced:!Fz||Bz},{canParse:function(e){var t=xz(arguments.length,1),n=NO(e),r=t<2||arguments[1]===void 0?void 0:NO(arguments[1]);try{return!!new MT(n,r)}catch{return!1}}});var jz=ut,Gz=_c,DO=qr,Wz=xf,Hz=Rr("URL");jz({target:"URL",stat:!0,forced:!Wz},{parse:function(e){var t=Gz(arguments.length,1),n=DO(e),r=t<2||arguments[1]===void 0?void 0:DO(arguments[1]);try{return new Hz(n,r)}catch{return null}}});var Qf=E(oi.URL);let PO=!0,LO=!0;function Zf(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function vc(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(a,d){if(a!==t)return i.apply(this,arguments);const l=h=>{const p=n(h);p&&(d.handleEvent?d.handleEvent(p):d(p))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(d,l),i.apply(this,[a,l])};const s=r.removeEventListener;r.removeEventListener=function(a,d){if(a!==t||!this._eventMap||!this._eventMap[t])return s.apply(this,arguments);if(!this._eventMap[t].has(d))return s.apply(this,arguments);const l=this._eventMap[t].get(d);return this._eventMap[t].delete(d),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[a,l])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(a){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),a&&this.addEventListener(t,this["_on"+t]=a)},enumerable:!0,configurable:!0})}function Kz(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(PO=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Yz(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(LO=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function kO(){if(typeof window=="object"){if(PO)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function UT(e,t){LO&&console.warn(e+" is deprecated, please use "+t+" instead.")}function MO(e){return Object.prototype.toString.call(e)==="[object Object]"}function UO(e){var t;return MO(e)?Oi(t=Object.keys(e)).call(t,function(n,r){const i=MO(e[r]),s=i?UO(e[r]):e[r],a=i&&!Object.keys(s).length;return s===void 0||a?n:Object.assign(n,{[r]:s})},{}):e}function xT(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(r=>{r.endsWith("Id")?xT(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach(i=>{xT(e,e.get(i),n)})}))}function xO(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(t===null)return i;const s=[];return e.forEach(a=>{a.type==="track"&&a.trackIdentifier===t.id&&s.push(a)}),s.forEach(a=>{e.forEach(d=>{d.type===r&&d.trackId===a.id&&xT(e,d,i)})}),i}const VO=kO;function FO(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const d={};return Object.keys(a).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const h=typeof a[l]=="object"?a[l]:{ideal:a[l]};h.exact!==void 0&&typeof h.exact=="number"&&(h.min=h.max=h.exact);const p=function(_,m){return _?_+m.charAt(0).toUpperCase()+m.slice(1):m==="deviceId"?"sourceId":m};if(h.ideal!==void 0){d.optional=d.optional||[];let _={};typeof h.ideal=="number"?(_[p("min",l)]=h.ideal,d.optional.push(_),_={},_[p("max",l)]=h.ideal,d.optional.push(_)):(_[p("",l)]=h.ideal,d.optional.push(_))}h.exact!==void 0&&typeof h.exact!="number"?(d.mandatory=d.mandatory||{},d.mandatory[p("",l)]=h.exact):["min","max"].forEach(_=>{h[_]!==void 0&&(d.mandatory=d.mandatory||{},d.mandatory[p(_,l)]=h[_])})}),a.advanced&&(d.optional=(d.optional||[]).concat(a.advanced)),d},i=function(a,d){if(t.version>=61)return d(a);if((a=JSON.parse(JSON.stringify(a)))&&typeof a.audio=="object"){const l=function(h,p,_){p in h&&!(_ in h)&&(h[_]=h[p],delete h[p])};l((a=JSON.parse(JSON.stringify(a))).audio,"autoGainControl","googAutoGainControl"),l(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=r(a.audio)}if(a&&typeof a.video=="object"){let l=a.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const h=t.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||h)){let p;if(delete a.video.facingMode,l.exact==="environment"||l.ideal==="environment"?p=["back","rear"]:l.exact!=="user"&&l.ideal!=="user"||(p=["front"]),p)return n.mediaDevices.enumerateDevices().then(_=>{_=_.filter(g=>g.kind==="videoinput");let m=_.find(g=>p.some(w=>{var R;return te(R=g.label.toLowerCase()).call(R,w)}));return!m&&_.length&&te(p).call(p,"back")&&(m=_[_.length-1]),m&&(a.video.deviceId=l.exact?{exact:m.deviceId}:{ideal:m.deviceId}),a.video=r(a.video),VO("chrome: "+JSON.stringify(a)),d(a)})}a.video=r(a.video)}return VO("chrome: "+JSON.stringify(a)),d(a)},s=function(a){return t.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(a,d,l){i(a,h=>{n.webkitGetUserMedia(h,d,p=>{l&&l(s(p))})})}).bind(n),n.mediaDevices.getUserMedia){const a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(d){return i(d,l=>a(l).then(h=>{if(l.audio&&!h.getAudioTracks().length||l.video&&!h.getVideoTracks().length)throw h.getTracks().forEach(p=>{p.stop()}),new DOMException("","NotFoundError");return h},h=>ae.reject(s(h))))}}}function BO(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function jO(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",r=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(a=>a.track&&a.track.id===r.track.id):{track:r.track};const s=new Event("track");s.track=r.track,s.receiver=i,s.transceiver={receiver:i},s.streams=[n.stream],this.dispatchEvent(s)}),n.stream.getTracks().forEach(r=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(a=>a.track&&a.track.id===r.id):{track:r};const s=new Event("track");s.track=r,s.receiver=i,s.transceiver={receiver:i},s.streams=[n.stream],this.dispatchEvent(s)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else vc(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function GO(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(i,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=i.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:i}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(a,d){let l=i.apply(this,arguments);return l||(l=t(this,a),this._senders.push(l)),l};const s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(a){s.apply(this,arguments);const d=this._senders.indexOf(a);d!==-1&&this._senders.splice(d,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],n.apply(this,[i]),i.getTracks().forEach(s=>{this._senders.push(t(this,s))})};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(s=>{const a=this._senders.find(d=>d.track===s);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach(r=>r._pc=this),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function WO(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[n,r,i]=arguments;if(arguments.length>0&&typeof n=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof n!="function"))return t.apply(this,[]);const s=function(d){const l={};return d.result().forEach(h=>{const p={id:h.id,timestamp:h.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[h.type]||h.type};h.names().forEach(_=>{p[_]=h.stat(_)}),l[p.id]=p}),l},a=function(d){return new Map(Object.keys(d).map(l=>[l,d[l]]))};if(arguments.length>=2){const d=function(l){r(a(s(l)))};return t.apply(this,[d,n])}return new ae((d,l)=>{t.apply(this,[function(h){d(a(s(h)))},l])}).then(r,i)}}function HO(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const i=n.apply(this,[]);return i.forEach(s=>s._pc=this),i});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(s=>xO(s,i.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(i=>i._pc=this),r}),vc(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(i=>xO(i,r.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const n=arguments[0];let r,i,s;return this.getSenders().forEach(a=>{a.track===n&&(r?s=!0:r=a)}),this.getReceivers().forEach(a=>(a.track===n&&(i?s=!0:i=a),a.track===n)),s||r&&i?ae.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():i?i.getStats():ae.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function KO(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(s=>this._shimmedLocalStreams[s][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(s,a){if(!a)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const d=t.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(d)===-1&&this._shimmedLocalStreams[a.id].push(d):this._shimmedLocalStreams[a.id]=[a,d],d};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(s){this._shimmedLocalStreams=this._shimmedLocalStreams||{},s.getTracks().forEach(l=>{if(this.getSenders().find(p=>p.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();n.apply(this,arguments);const d=this.getSenders().filter(l=>a.indexOf(l)===-1);this._shimmedLocalStreams[s.id]=[s].concat(d)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[s.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},s&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const d=this._shimmedLocalStreams[a].indexOf(s);d!==-1&&this._shimmedLocalStreams[a].splice(d,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),i.apply(this,arguments)}}function YO(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return KO(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const l=n.apply(this);return this._reverseStreams=this._reverseStreams||{},l.map(h=>this._reverseStreams[h.id])};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(l){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},l.getTracks().forEach(h=>{if(this.getSenders().find(_=>_.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[l.id]){const h=new e.MediaStream(l.getTracks());this._streams[l.id]=h,this._reverseStreams[h.id]=l,l=h}r.apply(this,[l])};const i=e.RTCPeerConnection.prototype.removeStream;function s(l,h){let p=h.sdp;return Object.keys(l._reverseStreams||[]).forEach(_=>{const m=l._reverseStreams[_],g=l._streams[m.id];p=p.replace(new RegExp(g.id,"g"),m.id)}),new RTCSessionDescription({type:h.type,sdp:p})}e.RTCPeerConnection.prototype.removeStream=function(l){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[l.id]||l]),delete this._reverseStreams[this._streams[l.id]?this._streams[l.id].id:l.id],delete this._streams[l.id]},e.RTCPeerConnection.prototype.addTrack=function(l,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const p=[].slice.call(arguments,1);if(p.length!==1||!p[0].getTracks().find(g=>g===l))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(g=>g.track===l))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const m=this._streams[h.id];if(m)m.addTrack(l),ae.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const g=new e.MediaStream([l]);this._streams[h.id]=g,this._reverseStreams[g.id]=h,this.addStream(g)}return this.getSenders().find(g=>g.track===l)},["createOffer","createAnswer"].forEach(function(l){const h=e.RTCPeerConnection.prototype[l],p={[l](){const _=arguments;return arguments.length&&typeof arguments[0]=="function"?h.apply(this,[m=>{const g=s(this,m);_[0].apply(null,[g])},m=>{_[1]&&_[1].apply(null,m)},arguments[2]]):h.apply(this,arguments).then(m=>s(this,m))}};e.RTCPeerConnection.prototype[l]=p[l]});const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(l,h){let p=h.sdp;return Object.keys(l._reverseStreams||[]).forEach(_=>{const m=l._reverseStreams[_],g=l._streams[m.id];p=p.replace(new RegExp(m.id,"g"),g.id)}),new RTCSessionDescription({type:h.type,sdp:p})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};const d=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const l=d.get.apply(this);return l.type===""?l:s(this,l)}}),e.RTCPeerConnection.prototype.removeTrack=function(l){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!l._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(l._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let h;this._streams=this._streams||{},Object.keys(this._streams).forEach(p=>{this._streams[p].getTracks().find(_=>l.track===_)&&(h=this._streams[p])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(l.track),this.dispatchEvent(new Event("negotiationneeded")))}}function VT(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=e.RTCPeerConnection.prototype[n],i={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=i[n]})}function zO(e,t){vc(e,"negotiationneeded",n=>{const r=n.target;if(!(t.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")||r.signalingState==="stable")return n})}var qO=Object.freeze({__proto__:null,fixNegotiationNeeded:zO,shimAddTrackRemoveTrack:YO,shimAddTrackRemoveTrackWithNative:KO,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(r=>{const i=n.video&&n.video.width,s=n.video&&n.video.height,a=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxFrameRate:a||3}},i&&(n.video.mandatory.maxWidth=i),s&&(n.video.mandatory.maxHeight=s),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:GO,shimGetStats:WO,shimGetUserMedia:FO,shimMediaStream:BO,shimOnTrack:jO,shimPeerConnection:VT,shimSenderReceiverGetStats:HO});function XO(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(i,s,a){UT("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(i).then(s,a)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const i=function(a,d,l){d in a&&!(l in a)&&(a[l]=a[d],delete a[d])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(a){return typeof a=="object"&&typeof a.audio=="object"&&(a=JSON.parse(JSON.stringify(a)),i(a.audio,"autoGainControl","mozAutoGainControl"),i(a.audio,"noiseSuppression","mozNoiseSuppression")),s(a)},r&&r.prototype.getSettings){const a=r.prototype.getSettings;r.prototype.getSettings=function(){const d=a.apply(this,arguments);return i(d,"mozAutoGainControl","autoGainControl"),i(d,"mozNoiseSuppression","noiseSuppression"),d}}if(r&&r.prototype.applyConstraints){const a=r.prototype.applyConstraints;r.prototype.applyConstraints=function(d){return this.kind==="audio"&&typeof d=="object"&&(d=JSON.parse(JSON.stringify(d)),i(d,"autoGainControl","mozAutoGainControl"),i(d,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[d])}}}}function JO(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function FT(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const s=e.RTCPeerConnection.prototype[i],a={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=a[i]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[i,s,a]=arguments;return r.apply(this,[i||null]).then(d=>{if(t.version<53&&!s)try{d.forEach(l=>{l.type=n[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;d.forEach((h,p)=>{d.set(p,Object.assign({},h,{type:n[h.type]||h.type}))})}return d}).then(s,a)}}function QO(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(i=>i._pc=this),r});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):ae.resolve(new Map)}}function ZO(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=t.apply(this,[]);return n.forEach(r=>r._pc=this),n}),vc(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function $O(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){UT("removeStream","removeTrack"),this.getSenders().forEach(n=>{var r;n.track&&te(r=t.getTracks()).call(r,n.track)&&this.removeTrack(n)})})}function eN(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function tN(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const r=n.length>0;r&&n.forEach(s=>{if("rid"in s&&!/^[a-z0-9]{0,16}$/i.test(s.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in s&&!(parseFloat(s.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in s&&!(parseFloat(s.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=t.apply(this,arguments);if(r){const{sender:s}=i,a=s.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=n,s.sendEncodings=n,this.setParametersPromises.push(s.setParameters(a).then(()=>{delete s.sendEncodings}).catch(()=>{delete s.sendEncodings})))}return i})}function nN(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function rN(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ae.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function iN(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ae.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var oN=Object.freeze({__proto__:null,shimAddTransceiver:tN,shimCreateAnswer:iN,shimCreateOffer:rN,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,ae.reject(r)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:nN,shimGetUserMedia:XO,shimOnTrack:JO,shimPeerConnection:FT,shimRTCDataChannel:eN,shimReceiverGetStats:ZO,shimRemoveStream:$O,shimSenderGetStats:QO});function sN(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){var r;this._localStreams||(this._localStreams=[]),te(r=this._localStreams).call(r,n)||this._localStreams.push(n),n.getAudioTracks().forEach(i=>t.call(this,i,n)),n.getVideoTracks().forEach(i=>t.call(this,i,n))},e.RTCPeerConnection.prototype.addTrack=function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];return i&&i.forEach(a=>{var d;this._localStreams?te(d=this._localStreams).call(d,a)||this._localStreams.push(a):this._localStreams=[a]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(t);if(n===-1)return;this._localStreams.splice(n,1);const r=t.getTracks();this.getSenders().forEach(i=>{te(r).call(r,i.track)&&this.removeTrack(i)})})}}function aN(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(i=>{var s;if(this._remoteStreams||(this._remoteStreams=[]),te(s=this._remoteStreams).call(s,i))return;this._remoteStreams.push(i);const a=new Event("addstream");a.stream=i,this.dispatchEvent(a)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(i=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(i)>=0)return;n._remoteStreams.push(i);const s=new Event("addstream");s.stream=i,n.dispatchEvent(s)})}),t.apply(n,arguments)}}}function cN(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,s=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(l,h){const p=arguments.length>=2?arguments[2]:arguments[0],_=n.apply(this,[p]);return h?(_.then(l,h),ae.resolve()):_},t.createAnswer=function(l,h){const p=arguments.length>=2?arguments[2]:arguments[0],_=r.apply(this,[p]);return h?(_.then(l,h),ae.resolve()):_};let d=function(l,h,p){const _=i.apply(this,[l]);return p?(_.then(h,p),ae.resolve()):_};t.setLocalDescription=d,d=function(l,h,p){const _=s.apply(this,[l]);return p?(_.then(h,p),ae.resolve()):_},t.setRemoteDescription=d,d=function(l,h,p){const _=a.apply(this,[l]);return p?(_.then(h,p),ae.resolve()):_},t.addIceCandidate=d}function dN(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,r=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=i=>r(lN(i))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(n,r,i){t.mediaDevices.getUserMedia(n).then(r,i)}).bind(t))}function lN(e){return e&&e.video!==void 0?Object.assign({},e,{video:UO(e.video)}):e}function uN(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(n,r){if(n&&n.iceServers){const i=[];for(let s=0;s<n.iceServers.length;s++){let a=n.iceServers[s];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(UT("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,i.push(a)):i.push(n.iceServers[s])}n.iceServers=i}return new t(n,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function hN(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function pN(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const r=this.getTransceivers().find(s=>s.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):n.offerToReceiveAudio!==!0||r||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const i=this.getTransceivers().find(s=>s.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveVideo!==!0||i||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function fN(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var _N=Object.freeze({__proto__:null,shimAudioContext:fN,shimCallbacksAPI:cN,shimConstraints:lN,shimCreateOfferLegacy:pN,shimGetUserMedia:dN,shimLocalStreamsAPI:sN,shimRTCIceServerUrls:uN,shimRemoteStreamsAPI:aN,shimTrackEventTransceiver:hN}),mN=`	
\v\f\r \u2028\u2029\uFEFF`,zz=aa,qz=qr,BT=mN,EN=W("".replace),Xz=RegExp("^["+BT+"]+"),Jz=RegExp("(^|[^"+BT+"])["+BT+"]+$"),Qz=function(e){return function(t){var n=qz(zz(t));return 1&e&&(n=EN(n,Xz,"")),2&e&&(n=EN(n,Jz,"$1")),n}},Zz={trim:Qz(3)},$z=$A.PROPER,e9=S,gN=mN,t9=Zz.trim;ut({target:"String",proto:!0,forced:function(e){return e9(function(){return!!gN[e]()||""[e]()!==""||$z&&gN[e].name!==e})}("trim")},{trim:function(){return t9(this)}});var n9=bi("String","trim"),r9=Q,i9=n9,jT=String.prototype,o9=function(e){var t=e.trim;return typeof e=="string"||e===jT||r9(jT,e)&&t===jT.trim?i9:t},hr=E(o9),SN={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},t.splitSections=function(n){return n.split(`
m=`).map((r,i)=>(i>0?"m="+r:r).trim()+`\r
`)},t.getDescription=function(n){const r=t.splitSections(n);return r&&r[0]},t.getMediaSections=function(n){const r=t.splitSections(n);return r.shift(),r},t.matchPrefix=function(n,r){return t.splitLines(n).filter(i=>i.indexOf(r)===0)},t.parseCandidate=function(n){let r;r=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const i={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let s=8;s<r.length;s+=2)switch(r[s]){case"raddr":i.relatedAddress=r[s+1];break;case"rport":i.relatedPort=parseInt(r[s+1],10);break;case"tcptype":i.tcpType=r[s+1];break;case"ufrag":i.ufrag=r[s+1],i.usernameFragment=r[s+1];break;default:i[r[s]]===void 0&&(i[r[s]]=r[s+1])}return i},t.writeCandidate=function(n){const r=[];r.push(n.foundation);const i=n.component;i==="rtp"?r.push(1):i==="rtcp"?r.push(2):r.push(i),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const s=n.type;return r.push("typ"),r.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},t.parseIceOptions=function(n){return n.substring(14).split(" ")},t.parseRtpMap=function(n){let r=n.substring(9).split(" ");const i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},t.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const i=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(i!==1?"/"+i:"")+`\r
`},t.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},t.parseFmtp=function(n){const r={};let i;const s=n.substring(n.indexOf(" ")+1).split(";");for(let a=0;a<s.length;a++)i=s[a].trim().split("="),r[i[0].trim()]=i[1];return r},t.writeFmtp=function(n){let r="",i=n.payloadType;if(n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(a=>{n.parameters[a]!==void 0?s.push(a+"="+n.parameters[a]):s.push(a)}),r+="a=fmtp:"+i+" "+s.join(";")+`\r
`}return r},t.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},t.writeRtcpFb=function(n){let r="",i=n.payloadType;return n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{r+="a=rtcp-fb:"+i+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),r},t.parseSsrcMedia=function(n){const r=n.indexOf(" "),i={ssrc:parseInt(n.substring(7,r),10)},s=n.indexOf(":",r);return s>-1?(i.attribute=n.substring(r+1,s),i.value=n.substring(s+1)):i.attribute=n.substring(r+1),i},t.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(i=>parseInt(i,10))}},t.getMid=function(n){const r=t.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},t.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},t.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:t.matchPrefix(n+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,r){let i="a=setup:"+r+`\r
`;return n.fingerprints.forEach(s=>{i+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),i},t.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,r){return t.matchPrefix(n+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,r){const i=t.matchPrefix(n+r,"a=ice-ufrag:")[0],s=t.matchPrefix(n+r,"a=ice-pwd:")[0];return i&&s?{usernameFragment:i.substring(12),password:s.substring(10)}:null},t.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},t.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(n)[0].split(" ");r.profile=i[2];for(let a=3;a<i.length;a++){const d=i[a],l=t.matchPrefix(n,"a=rtpmap:"+d+" ")[0];if(l){const h=t.parseRtpMap(l),p=t.matchPrefix(n,"a=fmtp:"+d+" ");switch(h.parameters=p.length?t.parseFmtp(p[0]):{},h.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+d+" ").map(t.parseRtcpFb),r.codecs.push(h),h.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(h.name.toUpperCase())}}}t.matchPrefix(n,"a=extmap:").forEach(a=>{r.headerExtensions.push(t.parseExtmap(a))});const s=t.matchPrefix(n,"a=rtcp-fb:* ").map(t.parseRtcpFb);return r.codecs.forEach(a=>{s.forEach(d=>{a.rtcpFeedback.find(l=>l.type===d.type&&l.parameter===d.parameter)||a.rtcpFeedback.push(d)})}),r},t.writeRtpDescription=function(n,r){let i="";i+="m="+n+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map(a=>a.preferredPayloadType!==void 0?a.preferredPayloadType:a.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(a=>{i+=t.writeRtpMap(a),i+=t.writeFmtp(a),i+=t.writeRtcpFb(a)});let s=0;return r.codecs.forEach(a=>{a.maxptime>s&&(s=a.maxptime)}),s>0&&(i+="a=maxptime:"+s+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(a=>{i+=t.writeExtmap(a)}),i},t.parseRtpEncodingParameters=function(n){const r=[],i=t.parseRtpParameters(n),s=i.fecMechanisms.indexOf("RED")!==-1,a=i.fecMechanisms.indexOf("ULPFEC")!==-1,d=t.matchPrefix(n,"a=ssrc:").map(m=>t.parseSsrcMedia(m)).filter(m=>m.attribute==="cname"),l=d.length>0&&d[0].ssrc;let h;const p=t.matchPrefix(n,"a=ssrc-group:FID").map(m=>m.substring(17).split(" ").map(g=>parseInt(g,10)));p.length>0&&p[0].length>1&&p[0][0]===l&&(h=p[0][1]),i.codecs.forEach(m=>{if(m.name.toUpperCase()==="RTX"&&m.parameters.apt){let g={ssrc:l,codecPayloadType:parseInt(m.parameters.apt,10)};l&&h&&(g.rtx={ssrc:h}),r.push(g),s&&(g=JSON.parse(JSON.stringify(g)),g.fec={ssrc:l,mechanism:a?"red+ulpfec":"red"},r.push(g))}}),r.length===0&&l&&r.push({ssrc:l});let _=t.matchPrefix(n,"b=");return _.length&&(_=_[0].indexOf("b=TIAS:")===0?parseInt(_[0].substring(7),10):_[0].indexOf("b=AS:")===0?1e3*parseInt(_[0].substring(5),10)*.95-16e3:void 0,r.forEach(m=>{m.maxBitrate=_})),r},t.parseRtcpParameters=function(n){const r={},i=t.matchPrefix(n,"a=ssrc:").map(d=>t.parseSsrcMedia(d)).filter(d=>d.attribute==="cname")[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const s=t.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=s.length>0,r.compound=s.length===0;const a=t.matchPrefix(n,"a=rtcp-mux");return r.mux=a.length>0,r},t.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},t.parseMsid=function(n){let r;const i=t.matchPrefix(n,"a=msid:");if(i.length===1)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};const s=t.matchPrefix(n,"a=ssrc:").map(a=>t.parseSsrcMedia(a)).filter(a=>a.attribute==="msid");return s.length>0?(r=s[0].value.split(" "),{stream:r[0],track:r[1]}):void 0},t.parseSctpDescription=function(n){const r=t.parseMLine(n),i=t.matchPrefix(n,"a=max-message-size:");let s;i.length>0&&(s=parseInt(i[0].substring(19),10)),isNaN(s)&&(s=65536);const a=t.matchPrefix(n,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:r.fmt,maxMessageSize:s};const d=t.matchPrefix(n,"a=sctpmap:");if(d.length>0){const l=d[0].substring(10).split(" ");return{port:parseInt(l[0],10),protocol:l[1],maxMessageSize:s}}},t.writeSctpDescription=function(n,r){let i=[];return i=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(n,r,i){let s;const a=r!==void 0?r:2;return s=n||t.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+s+" "+a+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,r){const i=t.splitLines(n);for(let s=0;s<i.length;s++)switch(i[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[s].substring(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substring(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){const r=t.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(n){const r=t.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=t.splitLines(n);for(let i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},e.exports=t})(SN);var TN=SN.exports,Zd=E(TN),s9=u({__proto__:null,default:Zd},[TN]);function $f(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const r=new t(n),i=Zd.parseCandidate(n.candidate),s=Object.assign(r,i);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new t(n)},e.RTCIceCandidate.prototype=t.prototype,vc(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function GT(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||vc(e,"icecandidate",t=>{if(t.candidate){const n=Zd.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function e_(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(d){if(!d||!d.sdp)return!1;const l=Zd.splitSections(d.sdp);return l.shift(),l.some(h=>{const p=Zd.parseMLine(h);return p&&p.kind==="application"&&p.protocol.indexOf("SCTP")!==-1})},r=function(d){const l=d.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(l===null||l.length<2)return-1;const h=parseInt(l[1],10);return h!=h?-1:h},i=function(d){let l=65536;return t.browser==="firefox"&&(l=t.version<57?d===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),l},s=function(d,l){let h=65536;t.browser==="firefox"&&t.version===57&&(h=65535);const p=Zd.matchPrefix(d.sdp,"a=max-message-size:");return p.length>0?h=parseInt(p[0].substr(19),10):t.browser==="firefox"&&l!==-1&&(h=2147483637),h},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:d}=this.getConfiguration();d==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const d=r(arguments[0]),l=i(d),h=s(arguments[0],d);let p;p=l===0&&h===0?Number.POSITIVE_INFINITY:l===0||h===0?Math.max(l,h):Math.min(l,h);const _={};Object.defineProperty(_,"maxMessageSize",{get:()=>p}),this._sctp=_}return a.apply(this,arguments)}}function t_(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(r,i){const s=r.send;r.send=function(){const a=arguments[0],d=a.length||a.size||a.byteLength;if(r.readyState==="open"&&i.sctp&&d>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return s.apply(r,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return t(r,this),r},vc(e,"datachannel",r=>(t(r.channel,r.target),r))}function WT(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const s=i.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const a=new Event("connectionstatechange",i);s.dispatchEvent(a)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function HT(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=r.sdp.split(`
`).filter(s=>hr(s).call(s)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&r instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:r.type,sdp:i}):r.sdp=i}return n.apply(this,arguments)}}function n_(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?ae.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),ae.resolve())})}function r_(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer"}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(i=>n.apply(this,[i]))})}var a9=Object.freeze({__proto__:null,removeExtmapAllowMixed:HT,shimAddIceCandidateNullOrEmpty:n_,shimConnectionState:WT,shimMaxMessageSize:e_,shimParameterlessSetLocalDescription:r_,shimRTCIceCandidate:$f,shimRTCIceCandidateRelayProtocol:GT,shimSendThrowTypeError:t_});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=kO,r=function(s){const a={browser:null,version:null};if(s===void 0||!s.navigator)return a.browser="Not a browser.",a;const{navigator:d}=s;if(d.mozGetUserMedia)a.browser="firefox",a.version=Zf(d.userAgent,/Firefox\/(\d+)\./,1);else if(d.webkitGetUserMedia||s.isSecureContext===!1&&s.webkitRTCPeerConnection)a.browser="chrome",a.version=Zf(d.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!s.RTCPeerConnection||!d.userAgent.match(/AppleWebKit\/(\d+)\./))return a.browser="Not a supported browser.",a;a.browser="safari",a.version=Zf(d.userAgent,/AppleWebKit\/(\d+)\./,1),a.supportsUnifiedPlan=s.RTCRtpTransceiver&&"currentDirection"in s.RTCRtpTransceiver.prototype}return a}(e),i={browserDetails:r,commonShim:a9,extractVersion:Zf,disableLog:Kz,disableWarnings:Yz,sdp:s9};switch(r.browser){case"chrome":if(!qO||!VT||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=qO,n_(e,r),r_(e),FO(e,r),BO(e),VT(e,r),jO(e),YO(e,r),GO(e),WO(e),HO(e),zO(e,r),$f(e),GT(e),WT(e),e_(e,r),t_(e),HT(e,r);break;case"firefox":if(!oN||!FT||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=oN,n_(e,r),r_(e),XO(e,r),FT(e,r),JO(e),$O(e),QO(e),ZO(e),eN(e),tN(e),nN(e),rN(e),iN(e),$f(e),WT(e),e_(e,r),t_(e);break;case"safari":if(!_N||!t.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=_N,n_(e,r),r_(e),uN(e),pN(e),cN(e),sN(e),aN(e),hN(e),dN(e),fN(e),$f(e),GT(e),e_(e,r),t_(e),HT(e,r);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var c9=S,vN=z.RegExp,d9=!c9(function(){var e=!0;try{vN(".","d")}catch{e=!1}var t={},n="",r=e?"dgimsy":"gimsy",i=function(d,l){Object.defineProperty(t,d,{get:function(){return n+=l,!0}})},s={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var a in e&&(s.hasIndices="d"),s)i(a,s[a]);return Object.getOwnPropertyDescriptor(vN.prototype,"flags").get.call(t)!==r||n!==r}),l9=zr,u9=en,h9=$n,p9=Q,RN={correct:d9},f9=function(){var e=l9(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},_9=RegExp.prototype,KT=RN.correct?function(e){return e.flags}:function(e){return RN.correct||!p9(_9,e)||h9(e,"flags")?e.flags:u9(f9,e)},YT=W,m9=Math.floor,zT=YT("".charAt),E9=YT("".replace),qT=YT("".slice),g9=/\$([$&'`]|\d{1,2})/g,S9=ut,T9=en,XT=W,yN=aa,v9=Bt,R9=ur,y9=Qg,$d=qr,C9=ku,I9=KT,w9=function(e,t,n,r,i,s){var a=n+e.length,d=r.length,l=g9;return E9(s,l,function(h,p){var _;switch(zT(p,0)){case"$":return"$";case"&":return e;case"`":return qT(t,0,n);case"'":return qT(t,a);case"<":_=i[qT(p,1,-1)];break;default:var m=+p;if(m===0)return h;if(m>d){var g=m9(m/10);return g===0?h:g<=d?r[g-1]===void 0?zT(p,1):r[g-1]+zT(p,1):h}_=r[m-1]}return _===void 0?"":_})},A9=cn("replace"),b9=TypeError,JT=XT("".indexOf),O9=XT("".replace),CN=XT("".slice),N9=Math.max;S9({target:"String",proto:!0},{replaceAll:function(e,t){var n,r,i,s,a,d,l,h,p,_,m=yN(this),g=0,w="";if(R9(e)){if((n=y9(e))&&(r=$d(yN(I9(e))),!~JT(r,"g")))throw new b9("`.replaceAll` does not allow non-global regexes");if(i=C9(e,A9))return T9(i,e,m,t);if(n)return O9($d(m),e,t)}for(s=$d(m),a=$d(e),(d=v9(t))||(t=$d(t)),l=a.length,h=N9(1,l),p=JT(s,a);p!==-1;)_=d?$d(t(a,p,s)):w9(a,s,p,[],void 0,t),w+=CN(s,g,p)+_,g=p+l,p=p+h>s.length?-1:JT(s,a,p+h);return g<s.length&&(w+=CN(s,g)),w}});var D9=bi("String","replaceAll"),P9=Q,L9=D9,QT=String.prototype,k9=function(e){var t=e.replaceAll;return typeof e=="string"||e===QT||P9(QT,e)&&t===QT.replaceAll?L9:t},M9=E(k9),ZT=z;ut({global:!0,forced:ZT.globalThis!==ZT},{globalThis:ZT});var IN=E(z),$T={exports:{}};(function(e,t){(function(n,r){var i="function",s="undefined",a="object",d="string",l="major",h="model",p="name",_="type",m="vendor",g="version",w="architecture",R="console",y="mobile",b="tablet",N="smarttv",L="wearable",x="embedded",F="Amazon",M="Apple",B="ASUS",J="BlackBerry",ee="Browser",pe="Chrome",Pe="Firefox",Ne="Google",Ge="Honor",Fe="Huawei",st="LG",Ut="Microsoft",Z="Motorola",oe="Nvidia",ge="OnePlus",$="Opera",v="OPPO",P="Samsung",U="Sharp",re="Sony",Ue="Xiaomi",bt="Zebra",Cn="Facebook",Bi="Chromium OS",Fa="Mac OS",rE=" Browser",ql=function(un){for(var En={},Lt=0;Lt<un.length;Lt++)En[un[Lt].toUpperCase()]=un[Lt];return En},iE=function(un,En){return typeof un===d&&id(En).indexOf(id(un))!==-1},id=function(un){return un.toLowerCase()},op=function(un,En){if(typeof un===d)return un=un.replace(/^\s\s*/,""),typeof En===s?un:un.substring(0,500)},od=function(un,En){for(var Lt,jr,Ko,$t,zs,nt,Yo=0;Yo<En.length&&!zs;){var sd=En[Yo],ys=En[Yo+1];for(Lt=jr=0;Lt<sd.length&&!zs&&sd[Lt];)if(zs=sd[Lt++].exec(un))for(Ko=0;Ko<ys.length;Ko++)nt=zs[++jr],typeof($t=ys[Ko])===a&&$t.length>0?$t.length===2?typeof $t[1]==i?this[$t[0]]=$t[1].call(this,nt):this[$t[0]]=$t[1]:$t.length===3?typeof $t[1]!==i||$t[1].exec&&$t[1].test?this[$t[0]]=nt?nt.replace($t[1],$t[2]):r:this[$t[0]]=nt?$t[1].call(this,nt,$t[2]):r:$t.length===4&&(this[$t[0]]=nt?$t[3].call(this,nt.replace($t[1],$t[2])):r):this[$t]=nt||r;Yo+=2}},Ba=function(un,En){for(var Lt in En)if(typeof En[Lt]===a&&En[Lt].length>0){for(var jr=0;jr<En[Lt].length;jr++)if(iE(En[Lt][jr],un))return Lt==="?"?r:Lt}else if(iE(En[Lt],un))return Lt==="?"?r:Lt;return En.hasOwnProperty("*")?En["*"]:un},fV={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},_V={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[g,[p,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[g,[p,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[p,g],[/opios[\/ ]+([\w\.]+)/i],[g,[p,$+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[g,[p,$+" GX"]],[/\bopr\/([\w\.]+)/i],[g,[p,$]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[g,[p,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[g,[p,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[p,g],[/quark(?:pc)?\/([-\w\.]+)/i],[g,[p,"Quark"]],[/\bddg\/([\w\.]+)/i],[g,[p,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[g,[p,"UC"+ee]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[g,[p,"WeChat"]],[/konqueror\/([\w\.]+)/i],[g,[p,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[g,[p,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[g,[p,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[g,[p,"Smart Lenovo "+ee]],[/(avast|avg)\/([\w\.]+)/i],[[p,/(.+)/,"$1 Secure "+ee],g],[/\bfocus\/([\w\.]+)/i],[g,[p,Pe+" Focus"]],[/\bopt\/([\w\.]+)/i],[g,[p,$+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[g,[p,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[g,[p,"Dolphin"]],[/coast\/([\w\.]+)/i],[g,[p,$+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[g,[p,"MIUI"+rE]],[/fxios\/([\w\.-]+)/i],[g,[p,Pe]],[/\bqihoobrowser\/?([\w\.]*)/i],[g,[p,"360"]],[/\b(qq)\/([\w\.]+)/i],[[p,/(.+)/,"$1Browser"],g],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[p,/(.+)/,"$1"+rE],g],[/samsungbrowser\/([\w\.]+)/i],[g,[p,P+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[g,[p,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[p,"Sogou Mobile"],g],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[p,g],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[p],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[g,p],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[p,Cn],g],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[p,g],[/\bgsa\/([\w\.]+) .*safari\//i],[g,[p,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[g,[p,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[g,[p,pe+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[p,pe+" WebView"],g],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[g,[p,"Android "+ee]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[p,g],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[g,[p,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[g,p],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[p,[g,Ba,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[p,g],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[p,"Netscape"],g],[/(wolvic|librewolf)\/([\w\.]+)/i],[p,g],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[g,[p,Pe+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[p,[g,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[p,[g,/master.|lts./,""]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[w,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[w,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[w,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[w,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[w,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[w,/ower/,"",id]],[/ sun4\w[;\)]/i],[[w,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[w,id]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[h,[m,P],[_,b]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[h,[m,P],[_,y]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[h,[m,M],[_,y]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[h,[m,M],[_,b]],[/(macintosh);/i],[h,[m,M]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[h,[m,U],[_,y]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[h,[m,Ge],[_,b]],[/honor([-\w ]+)[;\)]/i],[h,[m,Ge],[_,y]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[h,[m,Fe],[_,b]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[h,[m,Fe],[_,y]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[h,/_/g," "],[m,Ue],[_,b]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[h,/_/g," "],[m,Ue],[_,y]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[h,[m,v],[_,y]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[h,[m,Ba,{OnePlus:["304","403","203"],"*":v}],[_,b]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[h,[m,"Vivo"],[_,y]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[h,[m,"Realme"],[_,y]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto(?! 360)[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[h,[m,Z],[_,y]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[h,[m,Z],[_,b]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[h,[m,st],[_,b]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv|watch)\w+)/i,/\blg-?([\d\w]+) bui/i],[h,[m,st],[_,y]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[h,[m,"Lenovo"],[_,b]],[/(nokia) (t[12][01])/i],[m,h,[_,b]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[h,/_/g," "],[_,y],[m,"Nokia"]],[/(pixel (c|tablet))\b/i],[h,[m,Ne],[_,b]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[h,[m,Ne],[_,y]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[h,[m,re],[_,y]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[h,"Xperia Tablet"],[m,re],[_,b]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[h,[m,ge],[_,y]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[h,[m,F],[_,b]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[h,/(.+)/g,"Fire Phone $1"],[m,F],[_,y]],[/(playbook);[-\w\),; ]+(rim)/i],[h,m,[_,b]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[h,[m,J],[_,y]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[h,[m,B],[_,b]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[h,[m,B],[_,y]],[/(nexus 9)/i],[h,[m,"HTC"],[_,b]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[m,[h,/_/g," "],[_,y]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[h,[m,"TCL"],[_,b]],[/(itel) ((\w+))/i],[[m,id],h,[_,Ba,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[h,[m,"Acer"],[_,b]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[h,[m,"Meizu"],[_,y]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[h,[m,"Ulefone"],[_,y]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[h,[m,"Energizer"],[_,y]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[h,[m,"Cat"],[_,y]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[h,[m,"Smartfren"],[_,y]],[/droid.+; (a(?:015|06[35]|142p?))/i],[h,[m,"Nothing"],[_,y]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[h,[m,"Archos"],[_,b]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[h,[m,"Archos"],[_,y]],[/(imo) (tab \w+)/i,/(infinix) (x1101b?)/i],[m,h,[_,b]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (hmd|imo) ([\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i,/(oppo) ?([\w ]+) bui/i],[m,h,[_,y]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[m,h,[_,b]],[/(surface duo)/i],[h,[m,Ut],[_,b]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[h,[m,"Fairphone"],[_,y]],[/(u304aa)/i],[h,[m,"AT&T"],[_,y]],[/\bsie-(\w*)/i],[h,[m,"Siemens"],[_,y]],[/\b(rct\w+) b/i],[h,[m,"RCA"],[_,b]],[/\b(venue[\d ]{2,7}) b/i],[h,[m,"Dell"],[_,b]],[/\b(q(?:mv|ta)\w+) b/i],[h,[m,"Verizon"],[_,b]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[h,[m,"Barnes & Noble"],[_,b]],[/\b(tm\d{3}\w+) b/i],[h,[m,"NuVision"],[_,b]],[/\b(k88) b/i],[h,[m,"ZTE"],[_,b]],[/\b(nx\d{3}j) b/i],[h,[m,"ZTE"],[_,y]],[/\b(gen\d{3}) b.+49h/i],[h,[m,"Swiss"],[_,y]],[/\b(zur\d{3}) b/i],[h,[m,"Swiss"],[_,b]],[/\b((zeki)?tb.*\b) b/i],[h,[m,"Zeki"],[_,b]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[m,"Dragon Touch"],h,[_,b]],[/\b(ns-?\w{0,9}) b/i],[h,[m,"Insignia"],[_,b]],[/\b((nxa|next)-?\w{0,9}) b/i],[h,[m,"NextBook"],[_,b]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[m,"Voice"],h,[_,y]],[/\b(lvtel\-)?(v1[12]) b/i],[[m,"LvTel"],h,[_,y]],[/\b(ph-1) /i],[h,[m,"Essential"],[_,y]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[h,[m,"Envizen"],[_,b]],[/\b(trio[-\w\. ]+) b/i],[h,[m,"MachSpeed"],[_,b]],[/\btu_(1491) b/i],[h,[m,"Rotor"],[_,b]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[h,[m,oe],[_,b]],[/(sprint) (\w+)/i],[m,h,[_,y]],[/(kin\.[onetw]{3})/i],[[h,/\./g," "],[m,Ut],[_,y]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[h,[m,bt],[_,b]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[h,[m,bt],[_,y]],[/smart-tv.+(samsung)/i],[m,[_,N]],[/hbbtv.+maple;(\d+)/i],[[h,/^/,"SmartTV"],[m,P],[_,N]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[m,st],[_,N]],[/(apple) ?tv/i],[m,[h,M+" TV"],[_,N]],[/crkey/i],[[h,pe+"cast"],[m,Ne],[_,N]],[/droid.+aft(\w+)( bui|\))/i],[h,[m,F],[_,N]],[/(shield \w+ tv)/i],[h,[m,oe],[_,N]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[h,[m,U],[_,N]],[/(bravia[\w ]+)( bui|\))/i],[h,[m,re],[_,N]],[/(mi(tv|box)-?\w+) bui/i],[h,[m,Ue],[_,N]],[/Hbbtv.*(technisat) (.*);/i],[m,h,[_,N]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[m,op],[h,op],[_,N]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[h,[_,N]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[_,N]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[m,h,[_,R]],[/droid.+; (shield)( bui|\))/i],[h,[m,oe],[_,R]],[/(playstation \w+)/i],[h,[m,re],[_,R]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[h,[m,Ut],[_,R]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[h,[m,P],[_,L]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[m,h,[_,L]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[h,[m,v],[_,L]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[h,[m,M],[_,L]],[/(opwwe\d{3})/i],[h,[m,ge],[_,L]],[/(moto 360)/i],[h,[m,Z],[_,L]],[/(smartwatch 3)/i],[h,[m,re],[_,L]],[/(g watch r)/i],[h,[m,st],[_,L]],[/droid.+; (wt63?0{2,3})\)/i],[h,[m,bt],[_,L]],[/droid.+; (glass) \d/i],[h,[m,Ne],[_,L]],[/(pico) (4|neo3(?: link|pro)?)/i],[m,h,[_,L]],[/; (quest( \d| pro)?)/i],[h,[m,Cn],[_,L]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[m,[_,x]],[/(aeobc)\b/i],[h,[m,F],[_,x]],[/(homepod).+mac os/i],[h,[m,M],[_,x]],[/windows iot/i],[[_,x]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[h,[_,y]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[h,[_,b]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[_,b]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[_,y]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[h,[m,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[g,[p,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[p,g],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[g,[p,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[p,g],[/ladybird\//i],[[p,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[g,p]],os:[[/microsoft (windows) (vista|xp)/i],[p,g],[/(windows (?:phone(?: os)?|mobile|iot))[\/ ]?([\d\.\w ]*)/i],[p,[g,Ba,fV]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[g,Ba,fV],[p,"Windows"]],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[g,/_/g,"."],[p,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[p,Fa],[g,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[g,p],[/(ubuntu) ([\w\.]+) like android/i],[[p,/(.+)/,"$1 Touch"],g],[/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen|webos)\w*[-\/; ]?([\d\.]*)/i],[p,g],[/\(bb(10);/i],[g,[p,J]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[g,[p,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[g,[p,Pe+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[g,[p,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[g,[p,"watchOS"]],[/crkey\/([\d\.]+)/i],[g,[p,pe+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[p,Bi],g],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux)(?: arm\w*| x86\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[p,g],[/(sunos) ?([\w\.\d]*)/i],[[p,"Solaris"],g],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[p,g]]},Ho=function(un,En){if(typeof un===a&&(En=un,un=r),!(this instanceof Ho))return new Ho(un,En).getResult();var Lt=typeof n!==s&&n.navigator?n.navigator:r,jr=un||(Lt&&Lt.userAgent?Lt.userAgent:""),Ko=Lt&&Lt.userAgentData?Lt.userAgentData:r,$t=En?function(nt,Yo){var sd={};for(var ys in nt)Yo[ys]&&Yo[ys].length%2==0?sd[ys]=Yo[ys].concat(nt[ys]):sd[ys]=nt[ys];return sd}(_V,En):_V,zs=Lt&&Lt.userAgent==jr;return this.getBrowser=function(){var nt={};return nt[p]=r,nt[g]=r,od.call(nt,jr,$t.browser),nt[l]=function(Yo){return typeof Yo===d?Yo.replace(/[^\d\.]/g,"").split(".")[0]:r}(nt[g]),zs&&Lt&&Lt.brave&&typeof Lt.brave.isBrave==i&&(nt[p]="Brave"),nt},this.getCPU=function(){var nt={};return nt[w]=r,od.call(nt,jr,$t.cpu),nt},this.getDevice=function(){var nt={};return nt[m]=r,nt[h]=r,nt[_]=r,od.call(nt,jr,$t.device),zs&&!nt[_]&&Ko&&Ko.mobile&&(nt[_]=y),zs&&nt[h]=="Macintosh"&&Lt&&typeof Lt.standalone!==s&&Lt.maxTouchPoints&&Lt.maxTouchPoints>2&&(nt[h]="iPad",nt[_]=b),nt},this.getEngine=function(){var nt={};return nt[p]=r,nt[g]=r,od.call(nt,jr,$t.engine),nt},this.getOS=function(){var nt={};return nt[p]=r,nt[g]=r,od.call(nt,jr,$t.os),zs&&!nt[p]&&Ko&&Ko.platform&&Ko.platform!="Unknown"&&(nt[p]=Ko.platform.replace(/chrome os/i,Bi).replace(/macos/i,Fa)),nt},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return jr},this.setUA=function(nt){return jr=typeof nt===d&&nt.length>500?op(nt,500):nt,this},this.setUA(jr),this};Ho.VERSION="0.7.41",Ho.BROWSER=ql([p,g,l]),Ho.CPU=ql([w]),Ho.DEVICE=ql([h,m,_,R,y,N,b,L,x]),Ho.ENGINE=Ho.OS=ql([p,g]),e.exports&&(t=e.exports=Ho),t.UAParser=Ho;var Xl=typeof n!==s&&(n.jQuery||n.Zepto);if(Xl&&!Xl.ua){var oE=new Ho;Xl.ua=oE.getResult(),Xl.ua.get=function(){return oE.getUA()},Xl.ua.set=function(un){oE.setUA(un);var En=oE.getResult();for(var Lt in En)Xl.ua[Lt]=En[Lt]}}})(typeof window=="object"?window:f)})($T,$T.exports);var U9=E($T.exports),wN=Nf.clear;ut({global:!0,bind:!0,forced:z.clearImmediate!==wN},{clearImmediate:wN});var AN=z,x9=X,V9=Bt,F9=tS,B9=Ps,j9=pa,G9=_c,W9=AN.Function,H9=/MSIE .\./.test(B9)||F9==="BUN"&&function(){var e=AN.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")}(),K9=ut,bN=z,ON=Nf.set,Y9=function(e,t){var n=1;return H9?function(r,i){var s=G9(arguments.length,1)>n,a=V9(r)?r:W9(r),d=s?j9(arguments,n):[],l=s?function(){x9(a,this,d)}:a;return e(l)}:e},NN=bN.setImmediate?Y9(ON):ON;K9({global:!0,bind:!0,forced:bN.setImmediate!==NN},{setImmediate:NN});var DN=E(oi.setImmediate),z9=z,q9=V0,X9=si,J9=_c,Q9=hn;ut({global:!0,dontCallGetSet:!0,forced:S(function(){return Q9&&Object.getOwnPropertyDescriptor(z9,"queueMicrotask").value.length!==1})},{queueMicrotask:function(e){J9(arguments.length,1),q9(X9(e))}});var PN=E(oi.queueMicrotask);function LN(e,t){return function(){return e.apply(t,arguments)}}const{toString:Z9}=Object.prototype,{getPrototypeOf:ev}=Object,{iterator:i_,toStringTag:kN}=Symbol,o_=(tv=Object.create(null),e=>{const t=Z9.call(e);return tv[t]||(tv[t]=t.slice(8,-1).toLowerCase())});var tv;const wo=e=>(e=e.toLowerCase(),t=>o_(t)===e),s_=e=>t=>typeof t===e,{isArray:el}=Array,tl=s_("undefined");function rh(e){return e!==null&&!tl(e)&&e.constructor!==null&&!tl(e.constructor)&&ai(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const MN=wo("ArrayBuffer"),$9=s_("string"),ai=s_("function"),UN=s_("number"),ih=e=>e!==null&&typeof e=="object",a_=e=>{if(o_(e)!=="object")return!1;const t=ev(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||kN in e||i_ in e)},eq=wo("Date"),tq=wo("File"),nq=wo("Blob"),rq=wo("FileList"),iq=wo("URLSearchParams"),[oq,sq,aq,cq]=["ReadableStream","Request","Response","Headers"].map(wo);function oh(e,t){let n,r,{allOwnKeys:i=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),el(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{if(rh(e))return;const s=i?Object.getOwnPropertyNames(e):Object.keys(e),a=s.length;let d;for(n=0;n<a;n++)d=s[n],t.call(null,e[d],d,e)}}function xN(e,t){if(rh(e))return null;t=t.toLowerCase();const n=Object.keys(e);let r,i=n.length;for(;i-- >0;)if(r=n[i],t===r.toLowerCase())return r;return null}const Rc=IN!==void 0?IN:typeof self<"u"?self:typeof window<"u"?window:sE,VN=e=>!tl(e)&&e!==Rc,dq=(nv=typeof Uint8Array<"u"&&ev(Uint8Array),e=>nv&&e instanceof nv);var nv;const lq=wo("HTMLFormElement"),FN=(e=>{let{hasOwnProperty:t}=e;return(n,r)=>t.call(n,r)})(Object.prototype),uq=wo("RegExp"),BN=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};oh(n,(i,s)=>{let a;(a=t(i,s,e))!==!1&&(r[s]=a||i)}),Object.defineProperties(e,r)},hq=wo("AsyncFunction"),jN=(GN=typeof DN=="function",WN=ai(Rc.postMessage),GN?DN:WN?(rv="axios@".concat(Math.random()),c_=[],Rc.addEventListener("message",e=>{let{source:t,data:n}=e;t===Rc&&n===rv&&c_.length&&c_.shift()()},!1),e=>{c_.push(e),Rc.postMessage(rv,"*")}):e=>setTimeout(e));var GN,WN,rv,c_;const pq=PN!==void 0?PN.bind(Rc):typeof process<"u"&&process.nextTick||jN;var le={isArray:el,isArrayBuffer:MN,isBuffer:rh,isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||ai(e.append)&&((t=o_(e))==="formdata"||t==="object"&&ai(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&MN(e.buffer),t},isString:$9,isNumber:UN,isBoolean:e=>e===!0||e===!1,isObject:ih,isPlainObject:a_,isEmptyObject:e=>{if(!ih(e)||rh(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},isReadableStream:oq,isRequest:sq,isResponse:aq,isHeaders:cq,isUndefined:tl,isDate:eq,isFile:tq,isBlob:nq,isRegExp:uq,isFunction:ai,isStream:e=>ih(e)&&ai(e.pipe),isURLSearchParams:iq,isTypedArray:dq,isFileList:rq,forEach:oh,merge:function e(){const{caseless:t,skipUndefined:n}=VN(this)&&this||{},r={},i=(s,a)=>{const d=t&&xN(r,a)||a;a_(r[d])&&a_(s)?r[d]=e(r[d],s):a_(s)?r[d]=e({},s):el(s)?r[d]=s.slice():n&&tl(s)||(r[d]=s)};for(let s=0,a=arguments.length;s<a;s++)arguments[s]&&oh(arguments[s],i);return r},extend:function(e,t,n){let{allOwnKeys:r}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return oh(t,(i,s)=>{n&&ai(i)?e[s]=LN(i,n):e[s]=i},{allOwnKeys:r}),e},trim:e=>hr(e)?hr(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let i,s,a;const d={};if(t=t||{},e==null)return t;do{for(i=Object.getOwnPropertyNames(e),s=i.length;s-- >0;)a=i[s],r&&!r(a,e,t)||d[a]||(t[a]=e[a],d[a]=!0);e=n!==!1&&ev(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:o_,kindOfTest:wo,endsWith:(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return r!==-1&&r===n},toArray:e=>{if(!e)return null;if(el(e))return e;let t=e.length;if(!UN(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[i_]).call(e);let r;for(;(r=n.next())&&!r.done;){const i=r.value;t.call(e,i[0],i[1])}},matchAll:(e,t)=>{let n;const r=[];for(;(n=e.exec(t))!==null;)r.push(n);return r},isHTMLForm:lq,hasOwnProperty:FN,hasOwnProp:FN,reduceDescriptors:BN,freezeMethods:e=>{BN(e,(t,n)=>{if(ai(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const r=e[n];ai(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{const n={},r=i=>{i.forEach(s=>{n[s]=!0})};return el(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,r){return n.toUpperCase()+r}),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:xN,global:Rc,isContextDefined:VN,isSpecCompliantForm:function(e){return!!(e&&ai(e.append)&&e[kN]==="FormData"&&e[i_])},toJSONObject:e=>{const t=new Array(10),n=(r,i)=>{if(ih(r)){if(t.indexOf(r)>=0)return;if(rh(r))return r;if(!("toJSON"in r)){t[i]=r;const s=el(r)?[]:{};return oh(r,(a,d)=>{const l=n(a,i+1);!tl(l)&&(s[d]=l)}),t[i]=void 0,s}}return r};return n(e,0)},isAsyncFn:hq,isThenable:e=>e&&(ih(e)||ai(e))&&ai(e.then)&&ai(e.catch),setImmediate:jN,asap:pq,isIterable:e=>e!=null&&ai(e[i_])};function vt(e,t,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i,this.status=i.status?i.status:null)}le.inherits(vt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:le.toJSONObject(this.config),code:this.code,status:this.status}}});const HN=vt.prototype,KN={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{KN[e]={value:e}}),Object.defineProperties(vt,KN),Object.defineProperty(HN,"isAxiosError",{value:!0}),vt.from=(e,t,n,r,i,s)=>{const a=Object.create(HN);le.toFlatObject(e,a,function(h){return h!==Error.prototype},h=>h!=="isAxiosError");const d=e&&e.message?e.message:"Error",l=t==null&&e?e.code:t;return vt.call(a,d,l,n,r,i),e&&a.cause==null&&Object.defineProperty(a,"cause",{value:e,configurable:!0}),a.name=e&&e.name||"Error",s&&Object.assign(a,s),a};function iv(e){return le.isPlainObject(e)||le.isArray(e)}function YN(e){return le.endsWith(e,"[]")?e.slice(0,-2):e}function zN(e,t,n){return e?e.concat(t).map(function(r,i){return r=YN(r),!n&&i?"["+r+"]":r}).join(n?".":""):t}const fq=le.toFlatObject(le,{},null,function(e){return/^is[A-Z]/.test(e)});function d_(e,t,n){if(!le.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(n=le.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(m,g){return!le.isUndefined(g[m])})).metaTokens,i=n.visitor||h,s=n.dots,a=n.indexes,d=(n.Blob||typeof Blob<"u"&&Blob)&&le.isSpecCompliantForm(t);if(!le.isFunction(i))throw new TypeError("visitor must be a function");function l(m){if(m===null)return"";if(le.isDate(m))return m.toISOString();if(le.isBoolean(m))return m.toString();if(!d&&le.isBlob(m))throw new vt("Blob is not supported. Use a Buffer instead.");return le.isArrayBuffer(m)||le.isTypedArray(m)?d&&typeof Blob=="function"?new Blob([m]):Buffer.from(m):m}function h(m,g,w){let R=m;if(m&&!w&&typeof m=="object"){if(le.endsWith(g,"{}"))g=r?g:g.slice(0,-2),m=JSON.stringify(m);else if(le.isArray(m)&&function(y){return le.isArray(y)&&!y.some(iv)}(m)||(le.isFileList(m)||le.endsWith(g,"[]"))&&(R=le.toArray(m)))return g=YN(g),R.forEach(function(y,b){!le.isUndefined(y)&&y!==null&&t.append(a===!0?zN([g],b,s):a===null?g:g+"[]",l(y))}),!1}return!!iv(m)||(t.append(zN(w,g,s),l(m)),!1)}const p=[],_=Object.assign(fq,{defaultVisitor:h,convertValue:l,isVisitable:iv});if(!le.isObject(e))throw new TypeError("data must be an object");return function m(g,w){if(!le.isUndefined(g)){if(p.indexOf(g)!==-1)throw Error("Circular reference detected in "+w.join("."));p.push(g),le.forEach(g,function(R,y){(!(le.isUndefined(R)||R===null)&&i.call(t,R,le.isString(y)?hr(y).call(y):y,w,_))===!0&&m(R,w?w.concat(y):[y])}),p.pop()}}(e),t}function qN(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function ov(e,t){this._pairs=[],e&&d_(e,this,t)}const XN=ov.prototype;function _q(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function JN(e,t,n){if(!t)return e;const r=n&&n.encode||_q;le.isFunction(n)&&(n={serialize:n});const i=n&&n.serialize;let s;if(s=i?i(t,n):le.isURLSearchParams(t)?t.toString():new ov(t,n).toString(r),s){const a=e.indexOf("#");a!==-1&&(e=e.slice(0,a)),e+=(e.indexOf("?")===-1?"?":"&")+s}return e}XN.append=function(e,t){this._pairs.push([e,t])},XN.toString=function(e){const t=e?function(n){return e.call(this,n,qN)}:qN;return this._pairs.map(function(n){return t(n[0])+"="+t(n[1])},"").join("&")};var QN=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){le.forEach(this.handlers,function(t){t!==null&&e(t)})}},ZN={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},$N={exports:{}},mq=ut,Eq=hn,eD=zi.f;mq({target:"Object",stat:!0,forced:Object.defineProperty!==eD,sham:!Eq},{defineProperty:eD});var tD=oi.Object,gq=$N.exports=function(e,t,n){return tD.defineProperty(e,t,n)};tD.defineProperty.sham&&(gq.sham=!0);var nD=E($N.exports),Sq=TypeError,rD=Vu,Tq=Of,vq=ur,Rq=cn("species"),iD=Array,yq=function(e){var t;return rD(e)&&(t=e.constructor,(Tq(t)&&(t===iD||rD(t.prototype))||vq(t)&&(t=t[Rq])===null)&&(t=void 0)),t===void 0?iD:t},oD=function(e,t){return new(yq(e))(t===0?0:t)},Cq=S,Iq=uc,wq=cn("species"),sD=function(e){return Iq>=51||!Cq(function(){var t=[];return(t.constructor={})[wq]=function(){return{foo:1}},t[e](Boolean).foo!==1})},Aq=ut,bq=S,Oq=Vu,Nq=ur,Dq=ts,Pq=la,aD=function(e){if(e>9007199254740991)throw Sq("Maximum allowed index exceeded");return e},cD=fT,Lq=oD,kq=sD,Mq=uc,dD=cn("isConcatSpreadable"),Uq=Mq>=51||!bq(function(){var e=[];return e[dD]=!1,e.concat()[0]!==e}),xq=function(e){if(!Nq(e))return!1;var t=e[dD];return t!==void 0?!!t:Oq(e)};Aq({target:"Array",proto:!0,forced:!Uq||!kq("concat")},{concat:function(e){var t,n,r,i,s,a=Dq(this),d=Lq(a,0),l=0;for(t=-1,r=arguments.length;t<r;t++)if(xq(s=t===-1?a:arguments[t]))for(i=Pq(s),aD(l+i),n=0;n<i;n++,l++)n in s&&cD(d,l,s[n]);else aD(l+1),cD(d,l++,s);return d.length=l,d}});var lD={},Vq=De,Fq=ca,uD=pf.f,Bq=pa,hD=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];lD.f=function(e){return hD&&Vq(e)==="Window"?function(t){try{return uD(t)}catch{return Bq(hD)}}(e):uD(Fq(e))};var nl={},jq=cn;nl.f=jq;var pD=oi,Gq=$n,Wq=nl,Hq=zi.f,kn=function(e){var t=pD.Symbol||(pD.Symbol={});Gq(t,e)||Hq(t,e,{value:Wq.f(e)})},Kq=en,Yq=Rr,zq=cn,qq=ha,fD=function(){var e=Yq("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,r=zq("toPrimitive");t&&!t[r]&&qq(t,r,function(i){return Kq(n,this)},{})},Xq=da,Jq=of,Qq=ts,Zq=la,$q=oD,_D=W([].push),e7=function(e){var t=e===1,n=e===2,r=e===3,i=e===4,s=e===6,a=e===7,d=e===5||s;return function(l,h,p,_){for(var m,g,w=Qq(l),R=Jq(w),y=Zq(R),b=Xq(h,p),N=0,L=_||$q,x=t?L(l,y):n||a?L(l,0):void 0;y>N;N++)if((d||N in R)&&(g=b(m=R[N],N,w),e))if(t)x[N]=g;else if(g)switch(e){case 3:return!0;case 5:return m;case 6:return N;case 2:_D(x,m)}else switch(e){case 4:return!1;case 7:_D(x,m)}return s?-1:r||i?i:x}},mD={forEach:e7(0)},l_=ut,sh=z,sv=en,t7=W,rl=hn,il=bd,n7=S,pr=$n,r7=Q,av=zr,u_=ca,cv=jg,i7=qr,dv=Yn,ol=Bu,ED=_f,o7=pf,gD=lD,s7=Fu,SD=Mr,TD=zi,a7=cS,vD=Le,RD=ha,c7=bf,lv=Nd,yD=ff,CD=Fg,d7=cn,l7=nl,u7=kn,h7=fD,p7=Ls,ID=fc,h_=mD.forEach,ci=hf("hidden"),p_="Symbol",ah="prototype",f7=ID.set,wD=ID.getterFor(p_),Ao=Object[ah],yc=sh.Symbol,f_=yc&&yc[ah],_7=sh.RangeError,m7=sh.TypeError,uv=sh.QObject,AD=SD.f,Cc=TD.f,bD=gD.f,E7=vD.f,OD=t7([].push),Us=lv("symbols"),ch=lv("op-symbols"),g7=lv("wks"),hv=!uv||!uv[ah]||!uv[ah].findChild,ND=function(e,t,n){var r=AD(Ao,t);r&&delete Ao[t],Cc(e,t,n),r&&e!==Ao&&Cc(Ao,t,r)},pv=rl&&n7(function(){return ol(Cc({},"a",{get:function(){return Cc(this,"a",{value:7}).a}})).a!==7})?ND:Cc,fv=function(e,t){var n=Us[e]=ol(f_);return f7(n,{type:p_,tag:e,description:t}),rl||(n.description=t),n},__=function(e,t,n){e===Ao&&__(ch,t,n),av(e);var r=cv(t);return av(n),pr(Us,r)?(n.enumerable?(pr(e,ci)&&e[ci][r]&&(e[ci][r]=!1),n=ol(n,{enumerable:dv(0,!1)})):(pr(e,ci)||Cc(e,ci,dv(1,ol(null))),e[ci][r]=!0),pv(e,r,n)):Cc(e,r,n)},_v=function(e,t){av(e);var n=u_(t),r=ED(n).concat(kD(n));return h_(r,function(i){rl&&!sv(DD,n,i)||__(e,i,n[i])}),e},DD=function(e){var t=cv(e),n=sv(E7,this,t);return!(this===Ao&&pr(Us,t)&&!pr(ch,t))&&(!(n||!pr(this,t)||!pr(Us,t)||pr(this,ci)&&this[ci][t])||n)},PD=function(e,t){var n=u_(e),r=cv(t);if(n!==Ao||!pr(Us,r)||pr(ch,r)){var i=AD(n,r);return!i||!pr(Us,r)||pr(n,ci)&&n[ci][r]||(i.enumerable=!0),i}},LD=function(e){var t=bD(u_(e)),n=[];return h_(t,function(r){pr(Us,r)||pr(yD,r)||OD(n,r)}),n},kD=function(e){var t=e===Ao,n=bD(t?ch:u_(e)),r=[];return h_(n,function(i){!pr(Us,i)||t&&!pr(Ao,i)||OD(r,Us[i])}),r};il||(yc=function(){if(r7(f_,this))throw new m7("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?i7(arguments[0]):void 0,t=CD(e),n=function(r){var i=this===void 0?sh:this;i===Ao&&sv(n,ch,r),pr(i,ci)&&pr(i[ci],t)&&(i[ci][t]=!1);var s=dv(1,r);try{pv(i,t,s)}catch(a){if(!(a instanceof _7))throw a;ND(i,t,s)}};return rl&&hv&&pv(Ao,t,{configurable:!0,set:n}),fv(t,e)},RD(f_=yc[ah],"toString",function(){return wD(this).tag}),RD(yc,"withoutSetter",function(e){return fv(CD(e),e)}),vD.f=DD,TD.f=__,a7.f=_v,SD.f=PD,o7.f=gD.f=LD,s7.f=kD,l7.f=function(e){return fv(d7(e),e)},rl&&c7(f_,"description",{configurable:!0,get:function(){return wD(this).description}})),l_({global:!0,wrap:!0,forced:!il,sham:!il},{Symbol:yc}),h_(ED(g7),function(e){u7(e)}),l_({target:p_,stat:!0,forced:!il},{useSetter:function(){hv=!0},useSimple:function(){hv=!1}}),l_({target:"Object",stat:!0,forced:!il,sham:!rl},{create:function(e,t){return t===void 0?ol(e):_v(ol(e),t)},defineProperty:__,defineProperties:_v,getOwnPropertyDescriptor:PD}),l_({target:"Object",stat:!0,forced:!il},{getOwnPropertyNames:LD}),h7(),p7(yc,p_),yD[ci]=!0;var MD=bd&&!!Symbol.for&&!!Symbol.keyFor,S7=ut,T7=Rr,v7=$n,R7=qr,UD=Nd,y7=MD,mv=UD("string-to-symbol-registry"),C7=UD("symbol-to-string-registry");S7({target:"Symbol",stat:!0,forced:!y7},{for:function(e){var t=R7(e);if(v7(mv,t))return mv[t];var n=T7("Symbol")(t);return mv[t]=n,C7[n]=t,n}});var I7=ut,w7=$n,A7=Lu,b7=Od,O7=MD,xD=Nd("symbol-to-string-registry");I7({target:"Symbol",stat:!0,forced:!O7},{keyFor:function(e){if(!A7(e))throw new TypeError(b7(e)+" is not a symbol");if(w7(xD,e))return xD[e]}});var VD=Vu,N7=Bt,FD=De,D7=qr,BD=W([].push),P7=ut,jD=Rr,GD=X,L7=en,dh=W,WD=S,HD=Bt,KD=Lu,YD=pa,k7=function(e){if(N7(e))return e;if(VD(e)){for(var t=e.length,n=[],r=0;r<t;r++){var i=e[r];typeof i=="string"?BD(n,i):typeof i!="number"&&FD(i)!=="Number"&&FD(i)!=="String"||BD(n,D7(i))}var s=n.length,a=!0;return function(d,l){if(a)return a=!1,l;if(VD(this))return l;for(var h=0;h<s;h++)if(n[h]===d)return l}}},M7=bd,U7=String,Sa=jD("JSON","stringify"),m_=dh(/./.exec),zD=dh("".charAt),x7=dh("".charCodeAt),V7=dh("".replace),F7=dh(1.1.toString),B7=/[\uD800-\uDFFF]/g,qD=/^[\uD800-\uDBFF]$/,XD=/^[\uDC00-\uDFFF]$/,JD=!M7||WD(function(){var e=jD("Symbol")("stringify detection");return Sa([e])!=="[null]"||Sa({a:e})!=="{}"||Sa(Object(e))!=="{}"}),QD=WD(function(){return Sa("\uDF06\uD834")!=='"\\udf06\\ud834"'||Sa("\uDEAD")!=='"\\udead"'}),j7=function(e,t){var n=YD(arguments),r=k7(t);if(HD(r)||e!==void 0&&!KD(e))return n[1]=function(i,s){if(HD(r)&&(s=L7(r,this,U7(i),s)),!KD(s))return s},GD(Sa,null,n)},G7=function(e,t,n){var r=zD(n,t-1),i=zD(n,t+1);return m_(qD,e)&&!m_(XD,i)||m_(XD,e)&&!m_(qD,r)?"\\u"+F7(x7(e,0),16):e};Sa&&P7({target:"JSON",stat:!0,forced:JD||QD},{stringify:function(e,t,n){var r=YD(arguments),i=GD(JD?j7:Sa,null,r);return QD&&typeof i=="string"?V7(i,B7,G7):i}});var ZD=Fu,W7=ts;ut({target:"Object",stat:!0,forced:!bd||S(function(){ZD.f(1)})},{getOwnPropertySymbols:function(e){var t=ZD.f;return t?t(W7(e)):[]}}),kn("asyncDispose"),kn("asyncIterator"),kn("dispose"),kn("hasInstance"),kn("isConcatSpreadable"),kn("iterator"),kn("match"),kn("matchAll"),kn("replace"),kn("search"),kn("species"),kn("split");var H7=fD;kn("toPrimitive"),H7();var K7=Rr,Y7=Ls;kn("toStringTag"),Y7(K7("Symbol"),"Symbol"),kn("unscopables"),Ls(z.JSON,"JSON",!0);var z7=oi.Symbol,q7=cn,X7=zi.f,$D=q7("metadata"),eP=Function.prototype;eP[$D]===void 0&&X7(eP,$D,{value:null}),kn("metadata");var J7=z7,Q7=W,Ev=Rr("Symbol"),Z7=Ev.keyFor,$7=Q7(Ev.prototype.valueOf),tP=Ev.isRegisteredSymbol||function(e){try{return Z7($7(e))!==void 0}catch{return!1}};ut({target:"Symbol",stat:!0},{isRegisteredSymbol:tP});for(var eX=Nd,nP=Rr,tX=W,nX=Lu,rX=cn,E_=nP("Symbol"),rP=E_.isWellKnownSymbol,iP=nP("Object","getOwnPropertyNames"),iX=tX(E_.prototype.valueOf),oP=eX("wks"),gv=0,sP=iP(E_),oX=sP.length;gv<oX;gv++)try{var aP=sP[gv];nX(E_[aP])&&rX(aP)}catch{}var cP=function(e){if(rP&&rP(e))return!0;try{for(var t=iX(e),n=0,r=iP(oP),i=r.length;n<i;n++)if(oP[r[n]]==t)return!0}catch{}return!1};ut({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:cP}),kn("customMatcher"),kn("observable"),ut({target:"Symbol",stat:!0},{isRegistered:tP}),ut({target:"Symbol",stat:!0,forced:!0},{isWellKnown:cP}),kn("matcher"),kn("metadataKey"),kn("patternMatch"),kn("replaceAll");var sl=E(J7),dP=E(nl.f("iterator"));function lh(e){return lh=typeof sl=="function"&&typeof dP=="symbol"?function(t){return typeof t}:function(t){return t&&typeof sl=="function"&&t.constructor===sl&&t!==sl.prototype?"symbol":typeof t},lh(e)}var sX=E(nl.f("toPrimitive"));function aX(e){var t=function(n,r){if(lh(n)!="object"||!n)return n;var i=n[sX];if(i!==void 0){var s=i.call(n,r);if(lh(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(n)}(e,"string");return lh(t)=="symbol"?t:t+""}function I(e,t,n){return(t=aX(t))in e?nD(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var lP=E(LY),cX={isBrowser:!0,classes:{URLSearchParams:lP!==void 0?lP:ov,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const Sv=typeof window<"u"&&typeof document<"u",Tv=typeof navigator=="object"&&navigator||void 0,dX=Sv&&(!Tv||["ReactNative","NativeScript","NS"].indexOf(Tv.product)<0),lX=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",uX=Sv&&window.location.href||"http://localhost";function uP(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function hP(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?uP(Object(n),!0).forEach(function(r){I(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):uP(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var Ur=hP(hP({},Object.freeze({__proto__:null,hasBrowserEnv:Sv,hasStandardBrowserEnv:dX,hasStandardBrowserWebWorkerEnv:lX,navigator:Tv,origin:uX})),cX);function pP(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function hX(e,t){return d_(e,new Ur.classes.URLSearchParams,function(n){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?pP(Object(i),!0).forEach(function(s){I(n,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):pP(Object(i)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(i,s))})}return n}({visitor:function(n,r,i,s){return Ur.isNode&&le.isBuffer(n)?(this.append(r,n.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)}},t))}var pX=eT.charAt,fP=en,fX=zr,_X=Bt,mX=De,EX=/./.exec,gX=TypeError,SX=ut,_P=en,mP=_t,TX=vS,g_=wf,EP=aa,gP=fA,uh=qr,vX=zr,RX=ur,yX=De,CX=Qg,SP=KT,IX=ku,wX=S,AX=AS,bX=function(e,t,n){return t+(n?pX(e,t).length:1)},OX=function(e,t){var n=e.exec;if(_X(n)){var r=fP(n,e,t);return r!==null&&fX(r),r}if(mX(e)==="RegExp")return fP(EX,e,t);throw new gX("RegExp#exec called on incompatible receiver")},TP=fc,NX=cn("matchAll"),vP="RegExp String",RP=vP+" Iterator",DX=TP.set,PX=TP.getterFor(RP),LX=TypeError,vv=mP("".indexOf),S_=mP("".matchAll),Rv=!!S_&&!wX(function(){S_("a",/./)}),kX=TX(function(e,t,n,r){DX(this,{type:RP,regexp:e,string:t,global:n,unicode:r,done:!1})},vP,function(){var e=PX(this);if(e.done)return g_(void 0,!0);var t=e.regexp,n=e.string,r=OX(t,n);return r===null?(e.done=!0,g_(void 0,!0)):e.global?(uh(r[0])===""&&(t.lastIndex=bX(n,gP(t.lastIndex),e.unicode)),g_(r,!1)):(e.done=!0,g_(r,!1))}),yP=function(e){var t,n,r,i=vX(this),s=uh(e),a=AX(i,RegExp),d=uh(SP(i));return t=new a(a===RegExp?i.source:i,d),n=!!~vv(d,"g"),r=!!~vv(d,"u"),t.lastIndex=gP(i.lastIndex),new kX(t,s,n,r)};SX({target:"String",proto:!0,forced:Rv},{matchAll:function(e){var t,n,r,i,s=EP(this);if(RX(e)){if(CX(e)&&(t=uh(EP(SP(e))),!~vv(t,"g")))throw new LX("`.matchAll` does not allow non-global regexes");if(Rv)return S_(s,e);if((r=IX(e,NX))===void 0&&yX(e)==="RegExp"&&(r=yP),r)return _P(r,e,s)}else if(Rv)return S_(s,e);return n=uh(s),i=new RegExp(e,"g"),_P(yP,i,n)}});var MX=bi("String","matchAll"),UX=Q,xX=MX,yv=String.prototype,VX=function(e){var t=e.matchAll;return typeof e=="string"||e===yv||UX(yv,e)&&t===yv.matchAll?xX:t},FX=E(VX);function CP(e){function t(n,r,i,s){let a=n[s++];if(a==="__proto__")return!0;const d=Number.isFinite(+a),l=s>=n.length;return a=!a&&le.isArray(i)?i.length:a,l?(le.hasOwnProp(i,a)?i[a]=[i[a],r]:i[a]=r,!d):(i[a]&&le.isObject(i[a])||(i[a]=[]),t(n,r,i[a],s)&&le.isArray(i[a])&&(i[a]=function(h){const p={},_=Object.keys(h);let m;const g=_.length;let w;for(m=0;m<g;m++)w=_[m],p[w]=h[w];return p}(i[a])),!d)}if(le.isFormData(e)&&le.isFunction(e.entries)){const n={};return le.forEachEntry(e,(r,i)=>{t(function(s){return FX(le).call(le,/\w+|\[(\w*)]/g,s).map(a=>a[0]==="[]"?"":a[1]||a[0])}(r),i,n,0)}),n}return null}const Cv={transitional:ZN,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,i=le.isObject(e);if(i&&le.isHTMLForm(e)&&(e=new FormData(e)),le.isFormData(e))return r?JSON.stringify(CP(e)):e;if(le.isArrayBuffer(e)||le.isBuffer(e)||le.isStream(e)||le.isFile(e)||le.isBlob(e)||le.isReadableStream(e))return e;if(le.isArrayBufferView(e))return e.buffer;if(le.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return hX(e,this.formSerializer).toString();if((s=le.isFileList(e))||n.indexOf("multipart/form-data")>-1){const a=this.env&&this.env.FormData;return d_(s?{"files[]":e}:e,a&&new a,this.formSerializer)}}return i||r?(t.setContentType("application/json",!1),function(a,d,l){if(le.isString(a))try{return(d||JSON.parse)(a),hr(le).call(le,a)}catch(h){if(h.name!=="SyntaxError")throw h}return(l||JSON.stringify)(a)}(e)):e}],transformResponse:[function(e){const t=this.transitional||Cv.transitional,n=t&&t.forcedJSONParsing,r=this.responseType==="json";if(le.isResponse(e)||le.isReadableStream(e))return e;if(e&&le.isString(e)&&(n&&!this.responseType||r)){const i=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e,this.parseReviver)}catch(s){if(i)throw s.name==="SyntaxError"?vt.from(s,vt.ERR_BAD_RESPONSE,this,null,this.response):s}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ur.classes.FormData,Blob:Ur.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};le.forEach(["delete","get","head","post","put","patch"],e=>{Cv.headers[e]={}});var Iv=Cv;const BX=le.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),IP=Symbol("internals");function hh(e){var t;return e&&hr(t=String(e)).call(t).toLowerCase()}function T_(e){return e===!1||e==null?e:le.isArray(e)?e.map(T_):String(e)}function wv(e,t,n,r,i){return le.isFunction(r)?r.call(this,t,n):(i&&(t=n),le.isString(t)?le.isString(r)?t.indexOf(r)!==-1:le.isRegExp(r)?r.test(t):void 0:void 0)}class v_{constructor(t){t&&this.set(t)}set(t,n,r){const i=this;function s(l,h,p){const _=hh(h);if(!_)throw new Error("header name must be a non-empty string");const m=le.findKey(i,_);(!m||i[m]===void 0||p===!0||p===void 0&&i[m]!==!1)&&(i[m||h]=T_(l))}const a=(l,h)=>le.forEach(l,(p,_)=>s(p,_,h));if(le.isPlainObject(t)||t instanceof this.constructor)a(t,n);else if(le.isString(t)&&(t=hr(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(hr(d=t).call(d)))a((l=>{const h={};let p,_,m;return l&&l.split(`
`).forEach(function(g){var w,R;m=g.indexOf(":"),p=hr(w=g.substring(0,m)).call(w).toLowerCase(),_=hr(R=g.substring(m+1)).call(R),!p||h[p]&&BX[p]||(p==="set-cookie"?h[p]?h[p].push(_):h[p]=[_]:h[p]=h[p]?h[p]+", "+_:_)}),h})(t),n);else if(le.isObject(t)&&le.isIterable(t)){let l,h,p={};for(const _ of t){if(!le.isArray(_))throw TypeError("Object iterator must return a key-value pair");p[h=_[0]]=(l=p[h])?le.isArray(l)?[...l,_[1]]:[l,_[1]]:_[1]}a(p,n)}else t!=null&&s(n,t,r);var d;return this}get(t,n){if(t=hh(t)){const r=le.findKey(this,t);if(r){const i=this[r];if(!n)return i;if(n===!0)return function(s){const a=Object.create(null),d=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let l;for(;l=d.exec(s);)a[l[1]]=l[2];return a}(i);if(le.isFunction(n))return n.call(this,i,r);if(le.isRegExp(n))return n.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=hh(t)){const r=le.findKey(this,t);return!(!r||this[r]===void 0||n&&!wv(0,this[r],r,n))}return!1}delete(t,n){const r=this;let i=!1;function s(a){if(a=hh(a)){const d=le.findKey(r,a);!d||n&&!wv(0,r[d],d,n)||(delete r[d],i=!0)}}return le.isArray(t)?t.forEach(s):s(t),i}clear(t){const n=Object.keys(this);let r=n.length,i=!1;for(;r--;){const s=n[r];t&&!wv(0,this[s],s,t,!0)||(delete this[s],i=!0)}return i}normalize(t){const n=this,r={};return le.forEach(this,(i,s)=>{var a;const d=le.findKey(r,s);if(d)return n[d]=T_(i),void delete n[s];const l=t?function(h){return hr(h).call(h).toLowerCase().replace(/([a-z\d])(\w*)/g,(p,_,m)=>_.toUpperCase()+m)}(s):hr(a=String(s)).call(a);l!==s&&delete n[s],n[l]=T_(i),r[l]=!0}),this}concat(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return this.constructor.concat(this,...n)}toJSON(t){const n=Object.create(null);return le.forEach(this,(r,i)=>{r!=null&&r!==!1&&(n[i]=t&&le.isArray(r)?r.join(", "):r)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[n,r]=t;return n+": "+r}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const n=new this(t);for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];return i.forEach(a=>n.set(a)),n}static accessor(t){const n=(this[IP]=this[IP]={accessors:{}}).accessors,r=this.prototype;function i(s){const a=hh(s);n[a]||(function(d,l){const h=le.toCamelCase(" "+l);["get","set","has"].forEach(p=>{Object.defineProperty(d,p+h,{value:function(_,m,g){return this[p].call(this,l,_,m,g)},configurable:!0})})}(r,s),n[a]=!0)}return le.isArray(t)?t.forEach(i):i(t),this}}v_.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),le.reduceDescriptors(v_.prototype,(e,t)=>{let{value:n}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(i){this[r]=i}}}),le.freezeMethods(v_);var bo=v_;function Av(e,t){const n=this||Iv,r=t||n,i=bo.from(r.headers);let s=r.data;return le.forEach(e,function(a){s=a.call(n,s,i.normalize(),t?t.status:void 0)}),i.normalize(),s}function wP(e){return!(!e||!e.__CANCEL__)}function al(e,t,n){vt.call(this,e??"canceled",vt.ERR_CANCELED,t,n),this.name="CanceledError"}function AP(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new vt("Request failed with status code "+n.status,[vt.ERR_BAD_REQUEST,vt.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}le.inherits(al,vt,{__CANCEL__:!0});const R_=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,r=0;const i=function(s,a){s=s||10;const d=new Array(s),l=new Array(s);let h,p=0,_=0;return a=a!==void 0?a:1e3,function(m){const g=Date.now(),w=l[_];h||(h=g),d[p]=m,l[p]=g;let R=_,y=0;for(;R!==p;)y+=d[R++],R%=s;if(p=(p+1)%s,p===_&&(_=(_+1)%s),g-h<a)return;const b=w&&g-w;return b?Math.round(1e3*y/b):void 0}}(50,250);return function(s,a){let d,l,h=0,p=1e3/a;const _=function(m){h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),d=null,l&&(clearTimeout(l),l=null),s(...m)};return[function(){const m=Date.now(),g=m-h;for(var w=arguments.length,R=new Array(w),y=0;y<w;y++)R[y]=arguments[y];g>=p?_(R,m):(d=R,l||(l=setTimeout(()=>{l=null,_(d)},p-g)))},()=>d&&_(d)]}(s=>{const a=s.loaded,d=s.lengthComputable?s.total:void 0,l=a-r,h=i(l);r=a,e({loaded:a,total:d,progress:d?a/d:void 0,bytes:l,rate:h||void 0,estimated:h&&d&&a<=d?(d-a)/h:void 0,event:s,lengthComputable:d!=null,[t?"download":"upload"]:!0})},n)},bP=(e,t)=>{const n=e!=null;return[r=>t[0]({lengthComputable:n,total:e,loaded:r}),t[1]]},OP=e=>function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return le.asap(()=>e(...n))};var jX=Ur.hasStandardBrowserEnv?((e,t)=>n=>(n=new Qf(n,Ur.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new Qf(Ur.origin),Ur.navigator&&/(msie|trident)/i.test(Ur.navigator.userAgent)):()=>!0,GX=Ur.hasStandardBrowserEnv?{write(e,t,n,r,i,s,a){if(typeof document>"u")return;const d=["".concat(e,"=").concat(encodeURIComponent(t))];le.isNumber(n)&&d.push("expires=".concat(new Date(n).toUTCString())),le.isString(r)&&d.push("path=".concat(r)),le.isString(i)&&d.push("domain=".concat(i)),s===!0&&d.push("secure"),le.isString(a)&&d.push("SameSite=".concat(a)),document.cookie=d.join("; ")},read(e){if(typeof document>"u")return null;const t=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read:()=>null,remove(){}};function NP(e,t,n){let r=!function(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}(t);return e&&(r||n==0)?function(i,s){return s?i.replace(/\/?\/$/,"")+"/"+s.replace(/^\/+/,""):i}(e,t):t}function DP(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function bv(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?DP(Object(n),!0).forEach(function(r){I(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):DP(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const PP=e=>e instanceof bo?bv({},e):e;function Ic(e,t){t=t||{};const n={};function r(h,p,_,m){return le.isPlainObject(h)&&le.isPlainObject(p)?le.merge.call({caseless:m},h,p):le.isPlainObject(p)?le.merge({},p):le.isArray(p)?p.slice():p}function i(h,p,_,m){return le.isUndefined(p)?le.isUndefined(h)?void 0:r(void 0,h,0,m):r(h,p,0,m)}function s(h,p){if(!le.isUndefined(p))return r(void 0,p)}function a(h,p){return le.isUndefined(p)?le.isUndefined(h)?void 0:r(void 0,h):r(void 0,p)}function d(h,p,_){return _ in t?r(h,p):_ in e?r(void 0,h):void 0}const l={url:s,method:s,data:s,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:d,headers:(h,p,_)=>i(PP(h),PP(p),0,!0)};return le.forEach(Object.keys(bv(bv({},e),t)),function(h){const p=l[h]||i,_=p(e[h],t[h],h);le.isUndefined(_)&&p!==d||(n[h]=_)}),n}var LP=e=>{const t=Ic({},e);let{data:n,withXSRFToken:r,xsrfHeaderName:i,xsrfCookieName:s,headers:a,auth:d}=t;if(t.headers=a=bo.from(a),t.url=JN(NP(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),d&&a.set("Authorization","Basic "+btoa((d.username||"")+":"+(d.password?unescape(encodeURIComponent(d.password)):""))),le.isFormData(n)){if(Ur.hasStandardBrowserEnv||Ur.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if(le.isFunction(n.getHeaders)){const l=n.getHeaders(),h=["content-type","content-length"];Object.entries(l).forEach(p=>{let[_,m]=p;te(h).call(h,_.toLowerCase())&&a.set(_,m)})}}if(Ur.hasStandardBrowserEnv&&(r&&le.isFunction(r)&&(r=r(t)),r||r!==!1&&jX(t.url))){const l=i&&s&&GX.read(s);l&&a.set(i,l)}return t},WX=typeof XMLHttpRequest<"u"&&function(e){return new ae(function(t,n){const r=LP(e);let i=r.data;const s=bo.from(r.headers).normalize();let a,d,l,h,p,{responseType:_,onUploadProgress:m,onDownloadProgress:g}=r;function w(){h&&h(),p&&p(),r.cancelToken&&r.cancelToken.unsubscribe(a),r.signal&&r.signal.removeEventListener("abort",a)}let R=new XMLHttpRequest;function y(){if(!R)return;const N=bo.from("getAllResponseHeaders"in R&&R.getAllResponseHeaders());AP(function(L){t(L),w()},function(L){n(L),w()},{data:_&&_!=="text"&&_!=="json"?R.response:R.responseText,status:R.status,statusText:R.statusText,headers:N,config:e,request:R}),R=null}R.open(r.method.toUpperCase(),r.url,!0),R.timeout=r.timeout,"onloadend"in R?R.onloadend=y:R.onreadystatechange=function(){R&&R.readyState===4&&(R.status!==0||R.responseURL&&R.responseURL.indexOf("file:")===0)&&setTimeout(y)},R.onabort=function(){R&&(n(new vt("Request aborted",vt.ECONNABORTED,e,R)),R=null)},R.onerror=function(N){const L=new vt(N&&N.message?N.message:"Network Error",vt.ERR_NETWORK,e,R);L.event=N||null,n(L),R=null},R.ontimeout=function(){let N=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const L=r.transitional||ZN;r.timeoutErrorMessage&&(N=r.timeoutErrorMessage),n(new vt(N,L.clarifyTimeoutError?vt.ETIMEDOUT:vt.ECONNABORTED,e,R)),R=null},i===void 0&&s.setContentType(null),"setRequestHeader"in R&&le.forEach(s.toJSON(),function(N,L){R.setRequestHeader(L,N)}),le.isUndefined(r.withCredentials)||(R.withCredentials=!!r.withCredentials),_&&_!=="json"&&(R.responseType=r.responseType),g&&([l,p]=R_(g,!0),R.addEventListener("progress",l)),m&&R.upload&&([d,h]=R_(m),R.upload.addEventListener("progress",d),R.upload.addEventListener("loadend",h)),(r.cancelToken||r.signal)&&(a=N=>{R&&(n(!N||N.type?new al(null,e,R):N),R.abort(),R=null)},r.cancelToken&&r.cancelToken.subscribe(a),r.signal&&(r.signal.aborted?a():r.signal.addEventListener("abort",a)));const b=function(N){const L=/^([-+\w]{1,25})(:?\/\/|:)/.exec(N);return L&&L[1]||""}(r.url);b&&Ur.protocols.indexOf(b)===-1?n(new vt("Unsupported protocol "+b+":",vt.ERR_BAD_REQUEST,e)):R.send(i||null)})},HX=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let r,i=new AbortController;const s=function(h){if(!r){r=!0,d();const p=h instanceof Error?h:this.reason;i.abort(p instanceof vt?p:new al(p instanceof Error?p.message:p))}};let a=t&&setTimeout(()=>{a=null,s(new vt("timeout ".concat(t," of ms exceeded"),vt.ETIMEDOUT))},t);const d=()=>{e&&(a&&clearTimeout(a),a=null,e.forEach(h=>{h.unsubscribe?h.unsubscribe(s):h.removeEventListener("abort",s)}),e=null)};e.forEach(h=>h.addEventListener("abort",s));const{signal:l}=i;return l.unsubscribe=()=>le.asap(d),l}},Ov=E(Eb),kP=nl.f("asyncIterator"),KX=E(kP);function Nv(e,t){this.v=e,this.k=t}function yr(e){return function(){return new ph(e.apply(this,arguments))}}function ph(e){var t,n;function r(s,a){try{var d=e[s](a),l=d.value,h=l instanceof Nv;Ov.resolve(h?l.v:l).then(function(p){if(h){var _=s==="return"?"return":"next";if(!l.k||p.done)return r(_,p);p=e[_](p).value}i(d.done?"return":"normal",p)},function(p){r("throw",p)})}catch(p){i("throw",p)}}function i(s,a){switch(s){case"return":t.resolve({value:a,done:!0});break;case"throw":t.reject(a);break;default:t.resolve({value:a,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(s,a){return new Ov(function(d,l){var h={key:s,arg:a,resolve:d,reject:l,next:null};n?n=n.next=h:(t=n=h,r(s,a))})},typeof e.return!="function"&&(this.return=void 0)}function He(e){return new Nv(e,0)}function cl(e){var t={},n=!1;function r(i,s){return n=!0,s=new Ov(function(a){a(e[i](s))}),{done:!1,value:new Nv(s,1)}}return t[sl!==void 0&&dP||"@@iterator"]=function(){return this},t.next=function(i){return n?(n=!1,i):r("next",i)},typeof e.throw=="function"&&(t.throw=function(i){if(n)throw n=!1,i;return r("throw",i)}),typeof e.return=="function"&&(t.return=function(i){return n?(n=!1,i):r("return",i)}),t}ph.prototype[typeof sl=="function"&&KX||"@@asyncIterator"]=function(){return this},ph.prototype.next=function(e){return this._invoke("next",e)},ph.prototype.throw=function(e){return this._invoke("throw",e)},ph.prototype.return=function(e){return this._invoke("return",e)};var y_=E(kP);function Dv(e){var t,n,r,i=2;for(typeof Symbol<"u"&&(n=y_,r=Symbol.iterator);i--;){if(n&&(t=e[n])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new C_(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function C_(e){function t(n){if(Object(n)!==n)return ae.reject(new TypeError(n+" is not an object."));var r=n.done;return ae.resolve(n.value).then(function(i){return{value:i,done:r}})}return C_=function(n){this.s=n,this.n=n.next},C_.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?ae.resolve({value:n,done:!0}):t(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?ae.reject(n):t(r.apply(this.s,arguments))}},new C_(e)}const YX=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let r,i=0;for(;i<n;)r=i+t,yield e.slice(i,r),i=r},zX=function(){var e=yr(function*(t,n){var r,i=!1,s=!1;try{for(var a,d=Dv(qX(t));i=!(a=yield He(d.next())).done;i=!1){const l=a.value;yield*cl(Dv(YX(l,n)))}}catch(l){s=!0,r=l}finally{try{i&&d.return!=null&&(yield He(d.return()))}finally{if(s)throw r}}});return function(t,n){return e.apply(this,arguments)}}(),qX=function(){var e=yr(function*(t){if(t[y_])return void(yield*cl(Dv(t)));const n=t.getReader();try{for(;;){const{done:r,value:i}=yield He(n.read());if(r)break;yield i}}finally{yield He(n.cancel())}});return function(t){return e.apply(this,arguments)}}(),MP=(e,t,n,r)=>{const i=zX(e,t);let s,a=0,d=l=>{s||(s=!0,r&&r(l))};return new ReadableStream({async pull(l){try{const{done:h,value:p}=await i.next();if(h)return d(),void l.close();let _=p.byteLength;if(n){let m=a+=_;n(m)}l.enqueue(new Uint8Array(p))}catch(h){throw d(h),h}},cancel:l=>(d(l),i.return())},{highWaterMark:2})};function UP(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function xP(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?UP(Object(n),!0).forEach(function(r){I(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):UP(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const{isFunction:I_}=le,XX=(e=>{let{Request:t,Response:n}=e;return{Request:t,Response:n}})(le.global),{ReadableStream:VP,TextEncoder:FP}=le.global,BP=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return!!e(...n)}catch{return!1}},JX=e=>{e=le.merge.call({skipUndefined:!0},XX,e);const{fetch:t,Request:n,Response:r}=e,i=t?I_(t):typeof fetch=="function",s=I_(n),a=I_(r);if(!i)return!1;const d=i&&I_(VP),l=i&&(typeof FP=="function"?(h=new FP,w=>h.encode(w)):async w=>new Uint8Array(await new n(w).arrayBuffer()));var h;const p=s&&d&&BP(()=>{let w=!1;const R=new n(Ur.origin,{body:new VP,method:"POST",get duplex(){return w=!0,"half"}}).headers.has("Content-Type");return w&&!R}),_=a&&d&&BP(()=>le.isReadableStream(new r("").body)),m={stream:_&&(w=>w.body)};i&&["text","arrayBuffer","blob","formData","stream"].forEach(w=>{!m[w]&&(m[w]=(R,y)=>{let b=R&&R[w];if(b)return b.call(R);throw new vt("Response type '".concat(w,"' is not supported"),vt.ERR_NOT_SUPPORT,y)})});const g=async(w,R)=>{const y=le.toFiniteNumber(w.getContentLength());return y??(async b=>b==null?0:le.isBlob(b)?b.size:le.isSpecCompliantForm(b)?(await new n(Ur.origin,{method:"POST",body:b}).arrayBuffer()).byteLength:le.isArrayBufferView(b)||le.isArrayBuffer(b)?b.byteLength:(le.isURLSearchParams(b)&&(b+=""),le.isString(b)?(await l(b)).byteLength:void 0))(R)};return async w=>{let{url:R,method:y,data:b,signal:N,cancelToken:L,timeout:x,onDownloadProgress:F,onUploadProgress:M,responseType:B,headers:J,withCredentials:ee="same-origin",fetchOptions:pe}=LP(w),Pe=t||fetch;B=B?(B+"").toLowerCase():"text";let Ne=HX([N,L&&L.toAbortSignal()],x),Ge=null;const Fe=Ne&&Ne.unsubscribe&&(()=>{Ne.unsubscribe()});let st;try{if(M&&p&&y!=="get"&&y!=="head"&&(st=await g(J,b))!==0){let v,P=new n(R,{method:"POST",body:b,duplex:"half"});if(le.isFormData(b)&&(v=P.headers.get("content-type"))&&J.setContentType(v),P.body){const[U,re]=bP(st,R_(OP(M)));b=MP(P.body,65536,U,re)}}le.isString(ee)||(ee=ee?"include":"omit");const Ut=s&&"credentials"in n.prototype,Z=xP(xP({},pe),{},{signal:Ne,method:y.toUpperCase(),headers:J.normalize().toJSON(),body:b,duplex:"half",credentials:Ut?ee:void 0});Ge=s&&new n(R,Z);let oe=await(s?Pe(Ge,pe):Pe(R,Z));const ge=_&&(B==="stream"||B==="response");if(_&&(F||ge&&Fe)){const v={};["status","statusText","headers"].forEach(Ue=>{v[Ue]=oe[Ue]});const P=le.toFiniteNumber(oe.headers.get("content-length")),[U,re]=F&&bP(P,R_(OP(F),!0))||[];oe=new r(MP(oe.body,65536,U,()=>{re&&re(),Fe&&Fe()}),v)}B=B||"text";let $=await m[le.findKey(m,B)||"text"](oe,w);return!ge&&Fe&&Fe(),await new ae((v,P)=>{AP(v,P,{data:$,headers:bo.from(oe.headers),status:oe.status,statusText:oe.statusText,config:w,request:Ge})})}catch(Ut){throw Fe&&Fe(),Ut&&Ut.name==="TypeError"&&/Load failed|fetch/i.test(Ut.message)?Object.assign(new vt("Network Error",vt.ERR_NETWORK,w,Ge),{cause:Ut.cause||Ut}):vt.from(Ut,Ut&&Ut.code,w,Ge)}}},QX=new Map,jP=e=>{let t=e&&e.env||{};const{fetch:n,Request:r,Response:i}=t,s=[r,i,n];let a,d,l=s.length,h=QX;for(;l--;)a=s[l],d=h.get(a),d===void 0&&h.set(a,d=l?new Map:JX(t)),h=d;return d};jP();const Pv={http:null,xhr:WX,fetch:{get:jP}};le.forEach(Pv,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const GP=e=>"- ".concat(e),ZX=e=>le.isFunction(e)||e===null||e===!1;var WP={getAdapter:function(e,t){e=le.isArray(e)?e:[e];const{length:n}=e;let r,i;const s={};for(let a=0;a<n;a++){let d;if(r=e[a],i=r,!ZX(r)&&(i=Pv[(d=String(r)).toLowerCase()],i===void 0))throw new vt("Unknown adapter '".concat(d,"'"));if(i&&(le.isFunction(i)||(i=i.get(t))))break;s[d||"#"+a]=i}if(!i){const a=Object.entries(s).map(d=>{let[l,h]=d;return"adapter ".concat(l," ")+(h===!1?"is not supported by the environment":"is not available in the build")});throw new vt("There is no suitable adapter to dispatch the request "+(n?a.length>1?`since :
`+a.map(GP).join(`
`):" "+GP(a[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return i},adapters:Pv};function Lv(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new al(null,e)}function HP(e){return Lv(e),e.headers=bo.from(e.headers),e.data=Av.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),WP.getAdapter(e.adapter||Iv.adapter,e)(e).then(function(t){return Lv(e),t.data=Av.call(e,e.transformResponse,t),t.headers=bo.from(t.headers),t},function(t){return wP(t)||(Lv(e),t&&t.response&&(t.response.data=Av.call(e,e.transformResponse,t.response),t.response.headers=bo.from(t.response.headers))),ae.reject(t)})}const KP="1.13.2",w_={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{w_[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const YP={};w_.transitional=function(e,t,n){function r(i,s){return"[Axios v"+KP+"] Transitional option '"+i+"'"+s+(n?". "+n:"")}return(i,s,a)=>{if(e===!1)throw new vt(r(s," has been removed"+(t?" in "+t:"")),vt.ERR_DEPRECATED);return t&&!YP[s]&&(YP[s]=!0,console.warn(r(s," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(i,s,a)}},w_.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};var A_={assertOptions:function(e,t,n){if(typeof e!="object")throw new vt("options must be an object",vt.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let i=r.length;for(;i-- >0;){const s=r[i],a=t[s];if(a){const d=e[s],l=d===void 0||a(d,s,e);if(l!==!0)throw new vt("option "+s+" must be "+l,vt.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new vt("Unknown option "+s,vt.ERR_BAD_OPTION)}},validators:w_};const os=A_.validators;let b_=class{constructor(e){this.defaults=e||{},this.interceptors={request:new QN,response:new QN}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;const i=r.stack?r.stack.replace(/^.+\n/,""):"";try{n.stack?i&&!String(n.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+i):n.stack=i}catch{}}throw n}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=Ic(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:i}=t;n!==void 0&&A_.assertOptions(n,{silentJSONParsing:os.transitional(os.boolean),forcedJSONParsing:os.transitional(os.boolean),clarifyTimeoutError:os.transitional(os.boolean)},!1),r!=null&&(le.isFunction(r)?t.paramsSerializer={serialize:r}:A_.assertOptions(r,{encode:os.function,serialize:os.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),A_.assertOptions(t,{baseUrl:os.spelling("baseURL"),withXsrfToken:os.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s=i&&le.merge(i.common,i[t.method]);i&&le.forEach(["delete","get","head","post","put","patch","common"],g=>{delete i[g]}),t.headers=bo.concat(s,i);const a=[];let d=!0;this.interceptors.request.forEach(function(g){typeof g.runWhen=="function"&&g.runWhen(t)===!1||(d=d&&g.synchronous,a.unshift(g.fulfilled,g.rejected))});const l=[];let h;this.interceptors.response.forEach(function(g){l.push(g.fulfilled,g.rejected)});let p,_=0;if(!d){const g=[HP.bind(this),void 0];for(g.unshift(...a),g.push(...l),p=g.length,h=ae.resolve(t);_<p;)h=h.then(g[_++],g[_++]);return h}p=a.length;let m=t;for(;_<p;){const g=a[_++],w=a[_++];try{m=g(m)}catch(R){w.call(this,R);break}}try{h=HP.call(this,m)}catch(g){return ae.reject(g)}for(_=0,p=l.length;_<p;)h=h.then(l[_++],l[_++]);return h}getUri(e){return JN(NP((e=Ic(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};le.forEach(["delete","get","head","options"],function(e){b_.prototype[e]=function(t,n){return this.request(Ic(n||{},{method:e,url:t,data:(n||{}).data}))}}),le.forEach(["post","put","patch"],function(e){function t(n){return function(r,i,s){return this.request(Ic(s||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:r,data:i}))}}b_.prototype[e]=t(),b_.prototype[e+"Form"]=t(!0)});var O_=b_;class kv{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new ae(function(i){n=i});const r=this;this.promise.then(i=>{if(!r._listeners)return;let s=r._listeners.length;for(;s-- >0;)r._listeners[s](i);r._listeners=null}),this.promise.then=i=>{let s;const a=new ae(d=>{r.subscribe(d),s=d}).then(i);return a.cancel=function(){r.unsubscribe(s)},a},t(function(i,s,a){r.reason||(r.reason=new al(i,s,a),n(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const t=new AbortController,n=r=>{t.abort(r)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new kv(function(r){t=r}),cancel:t}}}var $X=kv;const Mv={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Mv).forEach(e=>{let[t,n]=e;Mv[n]=t});var eJ=Mv;const er=function e(t){const n=new O_(t),r=LN(O_.prototype.request,n);return le.extend(r,O_.prototype,n,{allOwnKeys:!0}),le.extend(r,n,null,{allOwnKeys:!0}),r.create=function(i){return e(Ic(t,i))},r}(Iv);er.Axios=O_,er.CanceledError=al,er.CancelToken=$X,er.isCancel=wP,er.VERSION=KP,er.toFormData=d_,er.AxiosError=vt,er.Cancel=er.CanceledError,er.all=function(e){return ae.all(e)},er.spread=function(e){return function(t){return e.apply(null,t)}},er.isAxiosError=function(e){return le.isObject(e)&&e.isAxiosError===!0},er.mergeConfig=Ic,er.AxiosHeaders=bo,er.formToJSON=e=>CP(le.isHTMLForm(e)?new FormData(e):e),er.getAdapter=WP.getAdapter,er.HttpStatusCode=eJ,er.default=er;var Cr=er;const tJ=()=>{};function fh(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:tJ};return e.promise=new ae((t,n)=>{e.resolve=r=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(r),e.value=r)},e.reject=r=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(r))}}),e}const N_=new Map,D_=new Map,ss=new Map;let Sn=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),ot=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const zP=new U9;let Oo=zP.getResult(),Uv=null;function rt(e){if(!Uv){Oo=zP.getResult();const t=function(d){if(d.engine.name==="Blink"&&d.browser.name!=="WeChat")return ot.CHROME;switch(d.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return ot.CHROME;case"Safari":case"Mobile Safari":return ot.SAFARI;case"Edge":return ot.EDGE;case"Firefox":return ot.FIREFOX;case"QQ":case"QQBrowser":return ot.QQ;case"Opera":return ot.OPERA;case"WeChat":return ot.WECHAT;default:return d.browser.name||""}}(Oo),n=qP(Oo),r=function(d){return d.os.name==="Windows"?d.os.version?d.os.name+" "+d.os.version:d.os.name:d.os.name||""}(Oo),i=Oo.os.version,s=qP(Oo,!1),a=Oo.device.type;if(!(t&&n&&r&&i))return{name:t,version:n,os:r,osVersion:i,browserVersion:s,deviceType:a};Uv={name:t,version:n,os:r,osVersion:i,browserVersion:s,deviceType:a}}return Uv}function qP(e){let t,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",n?t.split(".")[0]:t}function P_(){return rt().os}function XP(){const e=rt();return"".concat(e.os," ").concat(e.osVersion)}function L_(){const e=rt();return!!(Oo.engine.name==="WebKit"&&e.os===Sn.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==ot.SAFARI||tr()&&e.name!==ot.SAFARI)}function xs(){return rt().name===ot.CHROME}function An(){return rt().name===ot.SAFARI}function JP(){const e=rt();if(e.name!==ot.SAFARI||!e.browserVersion)return!1;const t=e.browserVersion.split(".");return Number(t[0])>15||Number(t[0])===15&&Number(t[1])>=4}function QP(){return rt().name===ot.EDGE}function Nt(){return rt().name===ot.FIREFOX}function tr(){return rt().os===Sn.IOS}function No(e){const t=rt();return!(t.name!==ot.CHROME||!t.osVersion)&&Number(t.version)>=e}function ZP(e){const t=rt();return!(t.name!==ot.CHROME||!t.osVersion)&&Number(t.version)<e}function xv(e,t,n){const r=rt();return!(r.name!==e||!r.osVersion)&&(n?Number(r.version)>=t&&Number(r.version)<=n:Number(r.version)===t)}function Ta(e){const t=rt();return!(t.name!==ot.EDGE||!t.osVersion)&&Number(t.version)>=e}function Vv(e){const t=rt();return!(t.name!==ot.FIREFOX||!t.osVersion)&&Number(t.version)>=e}function $P(e){const t=rt();return!(t.name!==ot.SAFARI||!t.osVersion)&&Number(t.version)>=e}function eL(e,t,n){const r=rt();if(r.os!==Sn.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])>t||Number(i[0])>e:t?Number(i[0])===e&&Number(i[1])>=t||Number(i[0])>e:Number(i[0])>=e}function tL(e,t,n){const r=rt();if(r.os!==Sn.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e:t?Number(i[0])===e&&Number(i[1])<=t||Number(i[0])<e:Number(i[0])<=e}function Fv(e,t,n){const r=rt();if(r.name!==ot.SAFARI||!r.osVersion||!r.browserVersion)return!1;const i=r.browserVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e:t?Number(i[0])===e&&Number(i[1])<=t||Number(i[0])<e:Number(i[0])<=e}function wc(e){const t=rt();return!(t.name!==ot.OPERA||!t.osVersion)&&Number(t.version)>=e}function nL(){const e=rt();if(e.os!==Sn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function dl(){const e=rt();if(e.os!==Sn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function Bv(){const e=rt();if(e.os!==Sn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===16}function rL(){const e=rt();if(e.os!==Sn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function eo(){return An()&&navigator.maxTouchPoints>0}function iL(){return rt().name===ot.WECHAT}function oL(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function sL(){const e=P_();return function(){const{deviceType:t}=rt();return t==="mobile"||t==="tablet"}()||e===Sn.ANDROID||e===Sn.IOS||e===Sn.HARMONY_OS}function as(){const e=rt();return e.name!==ot.EDGE&&e.name!==ot.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function _h(){return P_()===Sn.ANDROID}function mh(){const e=rt();return _h()&&(e.name===ot.CHROME||e.name===ot.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function xe(e,t,n){return(t=function(r){var i=function(s,a){if(typeof s!="object"||!s)return s;var d=s[Symbol.toPrimitive];if(d!==void 0){var l=d.call(s,"string");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(r);return typeof i=="symbol"?i:i+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function aL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function ie(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?aL(Object(n),!0).forEach(function(r){xe(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):aL(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let O=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),Y=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(t),xe(this,"code",void 0),xe(this,"message",void 0),xe(this,"data",void 0),xe(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=n}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function to(e,t){if(typeof e!="boolean")throw new Y(O.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function tn(e,t,n){if(!te(n).call(n,e))throw new Y(O.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function Rt(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<n||e>r||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(i){return typeof i=="number"&&i%1==0}(e))throw new Y(O.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(r,"]. integer only"))}function jv(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new Y(O.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&Rt(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&Rt(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&Rt(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&Rt(e.ideal,"".concat(t,".ideal"),1,1/0)}else Rt(e,t,1,1/0)}function Mn(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,i=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new Y(O.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!cL(e,n,r,i))throw new Y(O.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(r,"].").concat(i?" ASCII characters only.":""))}function Vs(e,t){if(!Array.isArray(e))throw new Y(O.INVALID_PARAMS,"".concat(t," should be an array"))}function Wt(e){return e==null}function cL(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,r=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=n&&e.length>=t&&(!r||function(i){if(typeof i!="string")return!1;for(let s=0;s<i.length;s+=1){const a=i.charCodeAt(s);if(a<0||a>255)return!1}return!0}(e))}function dL(e,t,n){if("getBigUint64"in DataView.prototype)return e.getBigUint64(t,n);const r=e.getUint32(t,n),i=e.getUint32(t+4,n),s=0,a=+!n;return BigInt(r*a+i*s)<<BigInt(32)|BigInt(r*s+i*a)}function lL(e,t,n,r){if("setBigUint64"in DataView.prototype)return e.setBigUint64(t,n,r);const i=Number(n>>BigInt(32)),s=Number(n&BigInt(4294967295));e.setUint32(t,i,r),e.setUint32(t+4,s,r)}var Eh=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(Eh||{}),Gv=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(Gv||{});const uL=new class{constructor(){xe(this,"_clientSize",null),xe(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),xe(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),xe(this,"getStyle",e=>window.getComputedStyle(e,null)),xe(this,"checkCssVisibleProperty",e=>{var t;let n=!0;const r=this.getStyle(e),{display:i,visibility:s,opacity:a,filter:d}=r;return(i==="none"||te(t=["hidden","collapse"]).call(t,s)||Number(a)<.1)&&(n=!1),!!n&&(d&&d.split(" ").filter(l=>{var h;const p=l.split("(")[0];return te(h=["brightness","blur","opacity"]).call(h,p)}).map(l=>{const[h,p]=l.split(/\(|\)/);return[h,Number(p.match(/^[0-9\.]+/))]}).forEach(l=>{const[h,p]=l;switch(h){case"brightness":(p<.1||p>3)&&(n=!1);break;case"blur":p>3&&(n=!1);break;case"opacity":p<.1&&(n=!1)}}),n)}),xe(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let n=!0,r=!0;const i=a=>t(a);let s=e;for(;s&&r;)i(s)||(n=!1,r=!1),s=s.parentElement,s||(r=!1);return n}),xe(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),xe(this,"getSizeAboutClient",e=>{const{width:t,height:n,left:r,right:i,top:s,bottom:a}=e.getBoundingClientRect(),d=this.getClientWidth(),l=this.getClientHeight();return{width:t,height:n,left:r,right:i,top:s,bottom:a,clientWidth:d,clientHeight:l,clientMin:Math.min(d,l)}}),xe(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)}),xe(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),xe(this,"checkCoverForAPoint",(e,t,n)=>{const r=this.elementFromPoint(e,t);return r!==null&&r!==n}),xe(this,"getPointPositionList",()=>{const{width:e,height:t,left:n,top:r}=this._clientSize,i=e/6,s=t/6,a=[],d=10**6;for(let l=0;l<5;l++)for(let h=0;h<5;h++){const p=(n*d+(l===0?.1:l===4?(i*l*d-1e5)/d:i*l)*d)/d,_=(r*d+(h===0?.1:h===4?(s*h*d-1e5)/d:s*h)*d)/d;a.push({x:p,y:_})}return[...a]}),xe(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),xe(this,"checkSizeIsVisible",(e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10)),xe(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:n,bottom:r,clientHeight:i,clientWidth:s,clientMin:a}=this._clientSize;let d,l,h,p;if(e<0)d=0;else{if(!(e<s))return!1;d=e}if(t<0)return!1;if(l=t<s?t:s,n<0)h=0;else{if(!(n<i))return!1;h=n}if(r<0)return!1;p=r<i?r:i;const _=l-d,m=p-h;return this.checkSizeIsVisible(_,m,a)}),xe(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),xe(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(Eh.COVERED);{const t=this.checkActualSize(),n=this.checkSizeOfPartInClient();return t&&!n?this.returnHiddenResult(Eh.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Eh.SIZE)}}return this.returnHiddenResult(Eh.STYLE)}return this.returnHiddenResult(Gv.UNMOUNTED)}return this.returnHiddenResult(Gv.INVALID_HTML_ELEMENT)}),xe(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function Wv(e){return new TextEncoder().encode(e)}const hL=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},Hv=async e=>function(t,n){let r="";return new Uint8Array(t).forEach(i=>{r+=i.toString(n).padStart(2,"0")}),r}(await crypto.subtle.digest("SHA-256",Wv(e)),16);let Vt=class{constructor(){xe(this,"_events",{}),xe(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(t=>t.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];this._indexOfListener(n,t)===-1&&n.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];this._indexOfListener(n,t)===-1&&n.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;const n=this._events[e],r=this._indexOfListener(n,t);r!==-1&&n.splice(r,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const t=this._events[e].map(s=>s);for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(let s=0;s<t.length;s+=1){const a=t[s];a.once&&this.off(e,a.listener),a.listener.apply(this,r||[])}}safeEmit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];[...this._events[e]||[]].forEach(i=>{i.once&&this.off(e,i.listener);try{i.listener.apply(this,n)}catch(s){console.error("safeEmit event:".concat(e," error ").concat(s==null?void 0:s.toString()))}})}_indexOfListener(e,t){let n=e.length;for(;n--;)if(e[n].listener===t)return n;return-1}},gh=null;function pL(){if(gh)return gh;if(window.electron)return gh=window.electron;if(!window.require)return null;try{return gh=window.require("electron"),gh}catch{return null}}let kt=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e.PRELOAD_MEDIA_FAILED="preloadMediaFailed",e.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",e.VOS_FALLBACK_CN="vosFallbackCN",e.DATACHANNEL_FAILBACK="datachannelFailback",e}({}),yt=function(e){return e.TRACER="tracer",e}({});function fL(e){return Rt(e.timeout,"config.timeout",0,1e5),Rt(e.timeoutFactor,"config.timeoutFactor",0,100,!1),Rt(e.maxRetryCount,"config.maxRetryConfig",0,1/0),Rt(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let nJ=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),Qe=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.FALLBACK_TO_HLS="FALLBACK_TO_HLS",e.UID_CONFLICT="UID_CONFLICT",e}({});function Ac(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function _L(e){return Mn(e.turnServerURL,"turnServerURL"),Mn(e.username,"username"),Mn(e.password,"password"),e.udpport&&Rt(e.udpport,"udpport",1,99999,!0),e.forceturn&&to(e.forceturn,"forceturn"),e.security&&to(e.security,"security"),e.tcpport&&Rt(e.tcpport,"tcpport",1,99999,!0),!0}let ll=function(e){return e[e.AUTO_SIMULCAST_STREAM=-1]="AUTO_SIMULCAST_STREAM",e[e.DISABLE_SIMULCAST_STREM=0]="DISABLE_SIMULCAST_STREM",e[e.ENABLE_SIMULCAST_STREAM=1]="ENABLE_SIMULCAST_STREAM",e}({});function Kv(e){return e.level!==void 0&&tn(e.level,"level",[1,2,3]),e.delay!==void 0&&Rt(e.delay,"delay",0,3e3,!0),!0}let Ye=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.AUDIO_PTS="audio-pts",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e.FALLBACK_TO_HLS="fallback-to-hls",e.FIRST_VIDEO_BUFFER_READY="first-video-buffer-ready",e.FIRST_VIDEO_PRE_RENDER="first-video-pre-render",e.AV1_DECODABLE_RESULT="av1-decodable-result",e}({}),Yv=function(e){return e.CONFIG="config",e.VOSERROR="vos_error",e.AP_ERROR="ap_error",e}({}),jn=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),fr=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),bc=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function dn(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return e.getListeners(t).length===0?ae.reject(new Y(O.UNEXPECTED_ERROR,"can not emit promise")):new ae((s,a)=>{e.emit(t,...r,s,a)})}function wt(e,t){if(e.getListeners(t).length===0)return ae.resolve();for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return dn(e,t,...r)}function Zr(e,t){if(e.getListeners(t).length===0)return null;for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return Oc(e,t,...r)}function Oc(e,t){let n=null,r=null;for(var i=arguments.length,s=new Array(i>2?i-2:0),a=2;a<i;a++)s[a-2]=arguments[a];if(e.emit(t,...s,d=>{n=d},d=>{r=d}),r!==null)throw r;if(n===null)throw new Y(O.UNEXPECTED_ERROR,"handler is not sync");return n}const Ht=new class extends Vt{set networkState(e){this.emit(bc.NETWORK_STATE_CHANGE,e,this._networkState),e===fr.ONLINE?this.emit(bc.ONLINE):e===fr.OFFLINE&&(this.onlineWaiter=new ae(t=>{this.once(bc.ONLINE,()=>{this.onlineWaiter=void 0,t(fr.ONLINE)})}),this.emit(bc.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===fr.ONLINE}constructor(){super(),xe(this,"_moduleName","network-indicator"),xe(this,"_networkState",fr.ONLINE),xe(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=fr.ONLINE}),window.addEventListener("offline",()=>{this.networkState=fr.OFFLINE})}},Ir=[];for(let e=0;e<256;++e)Ir.push((e+256).toString(16).slice(1));const mL=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);let zv;const rJ=new Uint8Array(16);function iJ(){return mL?mL():function(n,r,i){var s,a,d,l;const h=(s=(a=(n=n||{}).random)!==null&&a!==void 0?a:(d=(l=n).rng)===null||d===void 0?void 0:d.call(l))!==null&&s!==void 0?s:function(){if(!zv){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");zv=crypto.getRandomValues.bind(crypto)}return zv(rJ)}();if(h.length<16)throw new Error("Random bytes length must be >= 16");if(h[6]=15&h[6]|64,h[8]=63&h[8]|128,r){if((i=i||0)<0||i+16>r.length)throw new RangeError("UUID byte range ".concat(i,":").concat(i+15," is out of buffer bounds"));for(let p=0;p<16;++p)r[i+p]=h[p];return r}return function(p){let _=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(Ir[p[_+0]]+Ir[p[_+1]]+Ir[p[_+2]]+Ir[p[_+3]]+"-"+Ir[p[_+4]]+Ir[p[_+5]]+"-"+Ir[p[_+6]]+Ir[p[_+7]]+"-"+Ir[p[_+8]]+Ir[p[_+9]]+"-"+Ir[p[_+10]]+Ir[p[_+11]]+Ir[p[_+12]]+Ir[p[_+13]]+Ir[p[_+14]]+Ir[p[_+15]]).toLowerCase()}(h)}(e,t,void 0);var e,t}function k_(e,t){const n=e.indexOf(t);n!==-1&&e.splice(n,1)}function ul(e){const t=[];return e.forEach(n=>{t.indexOf(n)===-1&&t.push(n)}),t}function M_(e){ae!==void 0?ae.resolve().then(e):setTimeout(e,0)}function Dt(e){return JSON.parse(JSON.stringify(e))}function Nc(e){try{return Dt(e)}catch{return e}}const EL={};function va(e,t){EL[t]||(EL[t]=!0,e())}function Dc(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let r=0;r<t.length;r+=1)n[r]=t.charCodeAt(r);return n}function Ra(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function gL(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){const r=new Uint8Array(t);r.set(n),n=r}return n}function SL(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=Oi(t).call(t,(a,d)=>a+d.length,0),i=new Uint8Array(new ArrayBuffer(r));let s=0;return t.forEach(a=>{i.set(a,s),s+=a.length}),i}function cs(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function TL(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(n=>{t+=typeof n=="string"?cs(n):n.size}),t+138}function oJ(e){const t=new Y(O.TIMEOUT,"timeout");return new ae((n,r)=>{window.setTimeout(()=>r(t),e)})}function Tn(e){return new ae(t=>{window.setTimeout(t,e)})}function ht(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+ht(e-n.length,"")}function Pc(){let e,t=!1;try{var n;e=M9(n=iJ()).call(n,"-","")}catch{t=!0}return!t&&e&&e.length===32||(e=ht(32,"")),e.toUpperCase()}const Sh=()=>{},vL=new class{constructor(){xe(this,"fnMap",new Map)}throttleByKey(e,t,n,r){for(var i=arguments.length,s=new Array(i>4?i-4:0),a=4;a<i;a++)s[a-4]=arguments[a];if(this.fnMap.has(t)){const d=this.fnMap.get(t);if(d.threshold!==n){d.fn(...d.args),clearTimeout(d.timer);const l=window.setTimeout(()=>{const h=this.fnMap.get(t);h&&h.fn(...h.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:l,args:s,skipFn:r})}else d.skipFn&&d.skipFn(...d.args),this.fnMap.set(t,ie(ie({},d),{},{fn:e,args:s,skipFn:r}))}else{const d=window.setTimeout(()=>{const l=this.fnMap.get(t);l&&l.fn(...l.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:d,args:s,skipFn:r})}}},RL=vL.throttleByKey.bind(vL);function yL(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function qv(e,t){if(!yL(e)||!yL(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const n=[...e];for(let r=0;r<t.length;r++)n[r]=qv(e[r],t[r]);return n}{const n=ie({},e);for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)?n[r]=qv(e[r],t[r]):n[r]=t[r]);return n}}function CL(e,t){let n=[0];if(n=new Array(t).fill(0),e===0)return n;let r=0;for(;e>0&&(n[r]=255&e,e>>=8,r++,r!==t););return n}function hl(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function Xv(e,t){try{return typeof e=="object"&&typeof t=="object"&&JSON.stringify(e)===JSON.stringify(t)}catch{return!1}}function Jv(e){return Oi(e).call(e,(t,n)=>t+n,0)}function IL(e){const t="0123456789abcdef";function n(L){let x,F="";for(x=0;x<=3;x++)F+=t.charAt(L>>8*x+4&15)+t.charAt(L>>8*x&15);return F}function r(L,x){const F=(65535&L)+(65535&x);return(L>>16)+(x>>16)+(F>>16)<<16|65535&F}function i(L,x,F,M,B,J){return r(function(ee,pe){return ee<<pe|ee>>>32-pe}(r(r(x,L),r(M,J)),B),F)}function s(L,x,F,M,B,J,ee){return i(x&F|~x&M,L,x,B,J,ee)}function a(L,x,F,M,B,J,ee){return i(x&M|F&~M,L,x,B,J,ee)}function d(L,x,F,M,B,J,ee){return i(x^F^M,L,x,B,J,ee)}function l(L,x,F,M,B,J,ee){return i(F^(x|~M),L,x,B,J,ee)}const h=function(L){let x;const F=1+(L.length+8>>6),M=new Array(16*F);for(x=0;x<16*F;x++)M[x]=0;for(x=0;x<L.length;x++)M[x>>2]|=L.charCodeAt(x)<<x%4*8;return M[x>>2]|=128<<x%4*8,M[16*F-2]=8*L.length,M}(e);let p,_,m,g,w,R=1732584193,y=-271733879,b=-1732584194,N=271733878;for(p=0;p<h.length;p+=16)_=R,m=y,g=b,w=N,R=s(R,y,b,N,h[p+0],7,-680876936),N=s(N,R,y,b,h[p+1],12,-389564586),b=s(b,N,R,y,h[p+2],17,606105819),y=s(y,b,N,R,h[p+3],22,-1044525330),R=s(R,y,b,N,h[p+4],7,-176418897),N=s(N,R,y,b,h[p+5],12,1200080426),b=s(b,N,R,y,h[p+6],17,-1473231341),y=s(y,b,N,R,h[p+7],22,-45705983),R=s(R,y,b,N,h[p+8],7,1770035416),N=s(N,R,y,b,h[p+9],12,-1958414417),b=s(b,N,R,y,h[p+10],17,-42063),y=s(y,b,N,R,h[p+11],22,-1990404162),R=s(R,y,b,N,h[p+12],7,1804603682),N=s(N,R,y,b,h[p+13],12,-40341101),b=s(b,N,R,y,h[p+14],17,-1502002290),y=s(y,b,N,R,h[p+15],22,1236535329),R=a(R,y,b,N,h[p+1],5,-165796510),N=a(N,R,y,b,h[p+6],9,-1069501632),b=a(b,N,R,y,h[p+11],14,643717713),y=a(y,b,N,R,h[p+0],20,-373897302),R=a(R,y,b,N,h[p+5],5,-701558691),N=a(N,R,y,b,h[p+10],9,38016083),b=a(b,N,R,y,h[p+15],14,-660478335),y=a(y,b,N,R,h[p+4],20,-405537848),R=a(R,y,b,N,h[p+9],5,568446438),N=a(N,R,y,b,h[p+14],9,-1019803690),b=a(b,N,R,y,h[p+3],14,-187363961),y=a(y,b,N,R,h[p+8],20,1163531501),R=a(R,y,b,N,h[p+13],5,-1444681467),N=a(N,R,y,b,h[p+2],9,-51403784),b=a(b,N,R,y,h[p+7],14,1735328473),y=a(y,b,N,R,h[p+12],20,-1926607734),R=d(R,y,b,N,h[p+5],4,-378558),N=d(N,R,y,b,h[p+8],11,-2022574463),b=d(b,N,R,y,h[p+11],16,1839030562),y=d(y,b,N,R,h[p+14],23,-35309556),R=d(R,y,b,N,h[p+1],4,-1530992060),N=d(N,R,y,b,h[p+4],11,1272893353),b=d(b,N,R,y,h[p+7],16,-155497632),y=d(y,b,N,R,h[p+10],23,-1094730640),R=d(R,y,b,N,h[p+13],4,681279174),N=d(N,R,y,b,h[p+0],11,-358537222),b=d(b,N,R,y,h[p+3],16,-722521979),y=d(y,b,N,R,h[p+6],23,76029189),R=d(R,y,b,N,h[p+9],4,-640364487),N=d(N,R,y,b,h[p+12],11,-421815835),b=d(b,N,R,y,h[p+15],16,530742520),y=d(y,b,N,R,h[p+2],23,-995338651),R=l(R,y,b,N,h[p+0],6,-198630844),N=l(N,R,y,b,h[p+7],10,1126891415),b=l(b,N,R,y,h[p+14],15,-1416354905),y=l(y,b,N,R,h[p+5],21,-57434055),R=l(R,y,b,N,h[p+12],6,1700485571),N=l(N,R,y,b,h[p+3],10,-1894986606),b=l(b,N,R,y,h[p+10],15,-1051523),y=l(y,b,N,R,h[p+1],21,-2054922799),R=l(R,y,b,N,h[p+8],6,1873313359),N=l(N,R,y,b,h[p+15],10,-30611744),b=l(b,N,R,y,h[p+6],15,-1560198380),y=l(y,b,N,R,h[p+13],21,1309151649),R=l(R,y,b,N,h[p+4],6,-145523070),N=l(N,R,y,b,h[p+11],10,-1120210379),b=l(b,N,R,y,h[p+2],15,718787259),y=l(y,b,N,R,h[p+9],21,-343485551),R=r(R,_),y=r(y,m),b=r(b,g),N=r(N,w);return n(R)+n(y)+n(b)+n(N)}let sJ=1,wL=console,bn=class{static setLogger(e){wL=e}constructor(e,t){xe(this,"id",void 0),xe(this,"lockingPromise",ae.resolve()),xe(this,"locks",0),xe(this,"name",""),xe(this,"lockId",void 0),this.lockId=sJ++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),r=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");wL.debug("".concat(n," ").concat(r))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const n=new ae(i=>{t=()=>{this.locks-=1,this.logger("unlocked",e),i()}}),r=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>n),r}};function pl(e,t){return function(n,r,i){const s=i.value;if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const a=this[t];if(!a)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const d=await a.lock("From ".concat(e,".").concat(r));try{for(var l=arguments.length,h=new Array(l),p=0;p<l;p++)h[p]=arguments[p];return await s.apply(this,h)}finally{d()}},i}}const nn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function U_(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function Do(e,t,n,r){const i=Object.assign({},nn,r);let s=i.timeout;const a=async()=>{await function(h){return new ae(p=>{window.setTimeout(p,h)})}(s),s*=i.timeoutFactor,s=Math.min(i.maxRetryTimeout,s)};let d=!1;const l=new ae(async(h,p)=>{t=t||(()=>!1),n=n||(()=>!0);for(let _=0;_<i.maxRetryCount;_+=1){if(d)return p(new Y(O.OPERATION_ABORTED));try{const m=await e();if(!t(m,_)||_+1===i.maxRetryCount)return h(m);await a()}catch(m){if(!n(m,_)||_+1===i.maxRetryCount)return p(m);await a()}}});return l.cancel=()=>d=!0,l}let x_,Qv=class{constructor(e){xe(this,"input",[]),xe(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:Oi(e=this.input).call(e,(t,n)=>t+n)/this.input.length}},V_=0,Zv=0;function $v(e,t,n,r){return new ae((i,s)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),V_+=cs(t.data)):n&&(t.data.size?V_+=t.data.size:t.data instanceof FormData?V_+=TL(t.data):V_+=cs(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Cr.request(t).then(a=>{typeof a.data=="string"?Zv+=cs(a.data):a.data instanceof ArrayBuffer||a.data instanceof Uint8Array?Zv+=a.data.byteLength:Zv+=cs(JSON.stringify(a.data)),i(a.data)}).catch(a=>{Cr.isCancel(a)?s(new Y(O.OPERATION_ABORTED,"cancel token canceled")):a.code==="ECONNABORTED"?s(new Y(O.NETWORK_TIMEOUT,a.message)):a.response?s(new Y(O.NETWORK_RESPONSE_ERROR,a.response.status)):s(new Y(O.NETWORK_ERROR,a.message))})})}async function aJ(e,t){const n=new Blob([t.data],{type:"buffer"});return await $v(e,ie(ie({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const AL=()=>window.isSecureContext!==void 0;function no(e){if(Array.isArray(e))return e.map(n=>n);if(!bL(e))return e;const t={};for(const n in e){const r=e[n];bL(r)||Array.isArray(r)?t[n]=no(r):t[n]=r}return t}function bL(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let eR=class{constructor(e){xe(this,"input",[]),xe(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const ro={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Th={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],transport:{bytesSent:0,bytesReceived:0,packetsSent:0,packetsReceived:0},selectedCandidatePair:{id:"unknown",localCandidate:ro,remoteCandidate:ro},updateInterval:0},OL={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},NL={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},DL={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},PL={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let tR=class{constructor(e,t){xe(this,"onFirstVideoReceived",void 0),xe(this,"onFirstVideoDecoded",void 0),xe(this,"onFirstAudioReceived",void 0),xe(this,"onFirstVideoDecodedTimeout",void 0),xe(this,"onFirstAudioDecoded",void 0),xe(this,"onSelectedLocalCandidateChanged",void 0),xe(this,"onSelectedRemoteCandidateChanged",void 0),xe(this,"videoIsReady",!1),xe(this,"videoIsReady2",{}),xe(this,"pc",void 0),xe(this,"options",void 0),xe(this,"intervalTimer",void 0),xe(this,"stats",no(Th)),xe(this,"isFirstVideoReceived",{}),xe(this,"isFirstVideoDecoded",{}),xe(this,"isFirstAudioReceived",{}),xe(this,"isFirstAudioDecoded",{}),xe(this,"isFirstVideoDecodedTimeout",{}),xe(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new ae(e=>{e({local:ie({},ro),remote:ie({},ro)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let r=0,i=0,s=0,a=0;for(const d of n)e[d].forEach((l,h)=>{if(!this.lossRateWindowStats[t-1][d][h]||!this.lossRateWindowStats[0][d][h])return;const p=this.lossRateWindowStats[t-1][d][h].packets-this.lossRateWindowStats[0][d][h].packets,_=this.lossRateWindowStats[t-1][d][h].packetsLost-this.lossRateWindowStats[0][d][h].packetsLost;d==="videoSend"||d==="audioSend"?(r+=p,s+=_):(i+=p,a+=_),Number.isNaN(p)||Number.isNaN(p)?l.packetLostRate=0:l.packetLostRate=p<=0||_<=0?0:_/(p+_)});e.sendPacketLossRate=r<=0||s<=0?0:s/(r+s),e.recvPacketLossRate=i<=0||a<=0?0:a/(i+a)}},cJ=class extends tR{constructor(){super(...arguments),xe(this,"_stats",Th),xe(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=no(Th);const n=t.filter(i=>i.type==="ssrc");this.processSSRCStats(n);const r=t.find(i=>i.type==="VideoBwe");r&&this.processBandwidthStats(r),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var n;const r=te(n=t.id).call(n,"send");switch("".concat(t.mediaType,"_").concat(r?"send":"recv")){case"video_send":{const i=no(NL);i.codec=t.googCodecName,i.adaptionChangeReason="none",t.googCpuLimitedResolution&&(i.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(i.adaptionChangeReason="bandwidth"),i.avgEncodeMs=Number(t.googAvgEncodeMs),i.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},i.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},i.firsCount=Number(t.googFirReceived),i.nacksCount=Number(t.googNacksReceived),i.plisCount=Number(t.googPlisReceived),i.frameCount=Number(t.framesEncoded),i.bytes=Number(t.bytesSent),i.packets=Number(t.packetsSent),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(i),this._stats.rtt=i.rttMs;break}case"video_recv":{const i=no(OL),s=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(i.codec=t.googCodecName,i.targetDelayMs=Number(t.googTargetDelayMs),i.renderDelayMs=Number(t.googRenderDelayMs),i.currentDelayMs=Number(t.googCurrentDelayMs),i.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),i.decodeMs=Number(t.googDecodeMs),i.maxDecodeMs=Number(t.googMaxDecodeMs),i.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},i.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},i.decodeFrameRate=Number(t.googFrameRateDecoded),i.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},i.jitterBufferMs=Number(t.googJitterBufferMs),i.firsCount=Number(t.googFirsSent),i.nacksCount=Number(t.googNacksSent),i.plisCount=Number(t.googPlisSent),i.framesDecodeCount=Number(t.framesDecoded),i.bytes=Number(t.bytesReceived),i.packets=Number(t.packetsReceived),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.packets>0&&!this.isFirstVideoReceived[i.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(i.ssrc),this.isFirstVideoReceived[i.ssrc]=!0),i.framesDecodeCount>0&&!this.isFirstVideoDecoded[i.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(i.ssrc,i.decodedFrame.width,i.decodedFrame.height),this.isFirstVideoDecoded[i.ssrc]=!0),s){const a=s.stats,d=Date.now()-s.lts;i.framesDecodeFreezeTime=a.framesDecodeFreezeTime,i.framesDecodeInterval=a.framesDecodeInterval,i.framesDecodeCount>a.framesDecodeCount&&this.isFirstVideoDecoded[i.ssrc]?(s.lts=Date.now(),i.framesDecodeInterval=d,i.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?i.framesDecodeFreezeTime+=i.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):i.framesDecodeCount<s.stats.framesDecodeCount&&(i.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(i.ssrc,{stats:ie({},i),lts:Date.now()}),this._stats.videoRecv.push(i);break}case"audio_recv":{const i=no(PL);i.codec=t.googCodecName,i.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,i.decodingCNG=Number(t.googDecodingCNG),i.decodingCTN=Number(t.googDecodingCTN),i.decodingCTSG=Number(t.googDecodingCTSG),i.decodingNormal=Number(t.googDecodingNormal),i.decodingPLC=Number(t.googDecodingPLC),i.decodingPLCCNG=Number(t.googDecodingPLCCNG),i.expandRate=Number(t.googExpandRate),i.accelerateRate=Number(t.googAccelerateRate),i.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),i.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),i.speechExpandRate=Number(t.googSpeechExpandRate),i.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),i.jitterBufferMs=Number(t.googJitterBufferMs),i.jitterMs=Number(t.googJitterReceived),i.bytes=Number(t.bytesReceived),i.packets=Number(t.packetsReceived),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),i.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),i.receivedFrames>0&&!this.isFirstAudioReceived[i.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(i.ssrc),this.isFirstAudioReceived[i.ssrc]=!0),i.decodingNormal>0&&!this.isFirstAudioDecoded[i.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(i.ssrc),this.isFirstAudioDecoded[i.ssrc]=!0),this._stats.audioRecv.push(i);break}case"audio_send":{const i=no(DL);i.codec=t.googCodecName,i.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,i.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),i.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),i.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),i.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),i.bytes=Number(t.bytesSent),i.packets=Number(t.packetsSent),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.rttMs=Number(t.googRtt||0),this._stats.rtt=i.rttMs,this._stats.audioSend.push(i);break}}})}_getStats(){return new ae((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){const t=[];return e.result().forEach(n=>{const r={id:n.id,timestamp:n.timestamp.valueOf().toString(),type:n.type};n.names().forEach(i=>{r[i]=n.stat(i)}),t.push(r)}),t}},fl=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),F_=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),nR=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),di=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var _l=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(_l||{});function vh(e,t,n,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:_l.kNone;if(!t)return;const s=Number(t[n]);if(typeof s!="number")return;const a=Number(t[r]);if(typeof a!="number")return;if(!e)return a?s/a*i:void 0;const d=Number(e[n]);if(typeof d!="number")return;const l=Number(e[r]);if(typeof l!="number")return;const h=a-l;return h?(s-d)/h*i:void 0}let LL=class extends tR{constructor(){super(...arguments),xe(this,"_stats",Th),xe(this,"report",void 0),xe(this,"lastDecodeVideoReceiverStats",new Map),xe(this,"lastVideoFramesRecv",new Map),xe(this,"lastVideoFramesSent",new Map),xe(this,"lastVideoFramesDecode",new Map),xe(this,"lastVideoFramesOutput",new Map),xe(this,"lastVideoJBDelay",new Map),xe(this,"lastAudioJBDelay",new Map),xe(this,"mediaBytesSent",new Map),xe(this,"mediaBytesRetransmit",new Map),xe(this,"mediaBytesTargetEncode",new Map),xe(this,"lastDecodeAudioReceiverStats",new Map),xe(this,"lastAudioConcealment",new Map),xe(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=no(Th),this.report.forEach(e=>{switch(e.type){case di.OUTBOUND:case di.INBOUND:{const t=e.mediaType||e.kind,n=!t&&"frameWidth"in e,r=!t&&!("frameWidth"in e);e.type===di.OUTBOUND?t==="audio"||r?this.processAudioOutboundStats(e):(t==="video"||n)&&this.processVideoOutboundStats(e):e.type===di.INBOUND&&(t==="audio"||r?this.processAudioInboundStats(e):(t==="video"||n)&&this.processVideoInboundStats(e));break}case di.TRANSPORT:{this.processTransportStats(e);const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case di.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:ie({},ro),remote:ie({},ro)};return e.forEach(n=>{let r;if(n.type===di.TRANSPORT&&(r=e.get(n.selectedCandidatePairId)),n.type===di.CANDIDATE_PAIR&&n.selected&&(r=n),r){const i=(s,a)=>{s.type=a.type,s.id=a.id,a.address&&(s.address=a.address),a.candidateType&&(s.candidateType=a.candidateType),a.port&&(s.port=a.port),a.priority&&(s.priority=a.priority),a.protocol&&(s.protocol=a.protocol),a.relayProtocol&&(s.relayProtocol=a.relayProtocol)};if(r.localCandidateId){const s=e.get(r.localCandidateId);s&&i(t.local,s)}if(r.remoteCandidateId){const s=e.get(r.remoteCandidateId);s&&i(t.remote,s)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===di.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===di.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===di.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(ie({},t),ie({},this.stats.selectedCandidatePair.localCandidate)),e.type===di.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(ie({},t),ie({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(r=>r.ssrc===e.ssrc);t||(t=no(PL),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount,t.estimatedPlayoutTimestamp=e.estimatedPlayoutTimestamp;const n=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=vh(n,t,"totalProcessingDelay","jitterBufferEmittedCount",_l.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,n,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,ie({},t))}calculateAudioFreeze(e,t,n){const r=this.lastAudioConcealment.get(e.ssrc);if(t!=null&&r!=null){const i=r.lts,s=n.timestamp,a=s-i;if(a<=0)return;const d=e.concealedSamples-t.concealedSamples-0,l=r.nonSilent+d,h=e.totalSamplesReceived-t.totalSamplesReceived;if(h<=0)return;const p=80*h/a,_=200*h/a,m=a/h;let g=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,l>p&&(r.plc80>0?(e.freezeSamples80+=d,e.freezeMs80+=Math.round(d*m)):(e.freezeSamples80+=l,e.freezeMs80+=Math.round(l*m)),g=r.plc80+1);let w=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,l>_&&(r.plc200>0?(e.freezeSamples200+=d,e.freezeMs200+=Math.round(d*m)):(e.freezeSamples200+=l,e.freezeMs200+=Math.round(l*m)),w=r.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:d,lts:s,plc80:g,plc200:w})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:n.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find(a=>a.ssrc===e.ssrc);t||(t=no(OL),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.estimatedPlayoutTimestamp=e.estimatedPlayoutTimestamp;const n=this.lastDecodeVideoReceiverStats.get(t.ssrc),r=this.lastVideoFramesDecode.get(t.ssrc),i=this.lastVideoFramesOutput.get(t.ssrc),s=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const a=t.decodedFrame?t.decodedFrame.width:0,d=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,a,d),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){const a=n.stats,d=s-n.lts;t.framesDecodeFreezeTime=a.framesDecodeFreezeTime,t.framesDecodeInterval=a.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&d>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>a.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=d,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<a.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=vh(n==null?void 0:n.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=vh(n==null?void 0:n.stats,t,"totalProcessingDelay","framesDecodeCount",_l.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=vh(n==null?void 0:n.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",_l.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=vh(n==null?void 0:n.stats,t,"totalInterFrameDelay","framesDecodeCount",_l.kMillisecondsFromSeconds),r&&s-r.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-r.count)/((s-r.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:s,rate:t.decodeFrameRate})):r?t.decodeFrameRate=r.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:s,rate:0}),t.framesDroppedCount&&e.framesReceived&&(i&&s-i.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-i.count)/((s-i.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:s,rate:Math.max(t.outputFrameRate,0)})):i?t.outputFrameRate=i.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:s,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:ie({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(r=>r.ssrc===e.ssrc);t||(t=no(NL),this._stats.videoSend.push(t));const n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{const r=new eR(10);r.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,r)}if(e.retransmittedBytesSent!==void 0){const r=this.mediaBytesRetransmit.get(e.ssrc);if(r)r.add(e.retransmittedBytesSent);else{const i=new eR(10);i.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,i)}}if(e.totalEncodedBytesTarget){const r=this.mediaBytesTargetEncode.get(e.ssrc);if(r)r.add(e.totalEncodedBytesTarget);else{const i=new eR(10);i.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,i)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){const r=this.lastEncoderMs.get(e.ssrc);if(!r||r.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const i=e.framesEncoded-r.lastFrameCount,s=e.totalEncodeTime-r.lastEncoderTime;t.avgEncodeMs=1e3*s/i}}if(e.framesEncoded&&e.qpSum){const r=this.lastEncoderMs.get(e.ssrc);!r||r.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-r.lastQpSum)/(e.framesEncoded-r.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const r=this.findRemoteStatsId(e.ssrc,di.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(n=>n.ssrc===e.ssrc);if(t||(t=no(DL),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,di.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}processTransportStats(e){this._stats.transport.bytesReceived=e.bytesReceived||this._stats.transport.bytesReceived,this._stats.transport.bytesSent=e.bytesSent||this._stats.transport.bytesSent,this._stats.transport.packetsReceived=e.packetsReceived||this._stats.transport.packetsReceived,this._stats.transport.packetsSent=e.packetsSent||this._stats.transport.packetsSent}findRemoteStatsId(e,t){var n;const r=Array.from(Xr(n=this.report).call(n)).find(i=>i.type===t&&i.ssrc===e);return r?r.id:null}processVideoMediaSource(e,t){const n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(e,t){const n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}processVideoTrackSenderStats(e,t,n){var r,i,s,a;const d=t?this.report.get(t):void 0,l=(r=d==null?void 0:d.framesSent)!==null&&r!==void 0?r:e.framesSent;if(typeof l!="number")return;let h=(i=d==null?void 0:d.frameWidth)!==null&&i!==void 0?i:e.frameWidth,p=(s=d==null?void 0:d.frameHeight)!==null&&s!==void 0?s:e.frameHeight,_=(a=d==null?void 0:d.framesPerSecond)!==null&&a!==void 0?a:e.framesPerSecond;if(typeof h=="number"&&typeof p=="number"||(h=0,p=0),_==null){const m=Date.now(),g=this.lastVideoFramesSent.get(n.ssrc);g&&m-g.lts>=800?(_=Math.round((l-g.count)/((m-g.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:l,lts:m,rate:_})):g?_=g.rate:this.lastVideoFramesSent.set(n.ssrc,{count:l,lts:m,rate:0})}n.sentFrame={width:h,height:p,frameRate:Math.max(0,_)}}processVideoTrackReceiverStats(e,t,n){var r,i,s,a,d;const l=t?this.report.get(t):void 0,h=(r=l==null?void 0:l.framesReceived)!==null&&r!==void 0?r:e.framesReceived,p=(i=l==null?void 0:l.frameWidth)!==null&&i!==void 0?i:e.frameWidth,_=(s=l==null?void 0:l.frameHeight)!==null&&s!==void 0?s:e.frameHeight,m=(a=l==null?void 0:l.jitterBufferDelay)!==null&&a!==void 0?a:e.jitterBufferDelay,g=(d=l==null?void 0:l.jitterBufferEmittedCount)!==null&&d!==void 0?d:e.jitterBufferEmittedCount;if(typeof h=="number"){const w=this.lastVideoFramesRecv.get(n.ssrc),R=Date.now();n.framesReceivedCount=h;let y=0;w&&R-w.lts>=800?(y=Math.round((h-w.count)/((R-w.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:h,lts:R,rate:y})):w?y=w.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:h,lts:R,rate:0}),n.receivedFrame={width:p||0,height:_||0,frameRate:y||0},n.decodedFrame={width:p||0,height:_||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:p||0,height:_||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(m&&g){const w=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let R=w.jitterBufferMs;const y=g-w.jitterBufferEmittedCount;y>0&&(R=1e3*(m-w.jitterBufferDelay)/y),n.jitterBufferMs=R,n.currentDelayMs=Math.round(R),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:m,jitterBufferEmittedCount:g,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(e,t,n){var r,i,s,a;const d=t?this.report.get(t):void 0,l=(r=(i=d==null?void 0:d.echoReturnLoss)!==null&&i!==void 0?i:e.echoReturnLoss)!==null&&r!==void 0?r:0,h=(s=(a=d==null?void 0:d.echoReturnLossEnhancement)!==null&&a!==void 0?a:e.echoReturnLossEnhancement)!==null&&s!==void 0?s:0;n.aecReturnLoss=l,n.aecReturnLossEnhancement=h}processAudioTrackReceiverStats(e,t,n){var r,i,s,a,d,l,h,p,_;const m=t?this.report.get(t):void 0,g=(r=m==null?void 0:m.removedSamplesForAcceleration)!==null&&r!==void 0?r:e.removedSamplesForAcceleration,w=(i=m==null?void 0:m.totalSamplesReceived)!==null&&i!==void 0?i:e.totalSamplesReceived,R=(s=m==null?void 0:m.jitterBufferDelay)!==null&&s!==void 0?s:e.jitterBufferDelay,y=(a=m==null?void 0:m.jitterBufferEmittedCount)!==null&&a!==void 0?a:e.jitterBufferEmittedCount,b=(d=m==null?void 0:m.audioLevel)!==null&&d!==void 0?d:e==null?void 0:e.audioLevel,N=(l=m==null?void 0:m.totalSamplesDuration)!==null&&l!==void 0?l:e==null?void 0:e.totalSamplesDuration,L=(h=m==null?void 0:m.concealedSamples)!==null&&h!==void 0?h:e.concealedSamples,x=(p=m==null?void 0:m.silentConcealedSamples)!==null&&p!==void 0?p:e.silentConcealedSamples,F=(_=m==null?void 0:m.concealmentEvents)!==null&&_!==void 0?_:e.concealmentEvents;if(typeof w=="number"&&(n.totalSamplesReceived=w),typeof x=="number"&&(n.silentConcealedSamples=x),typeof F=="number"&&(n.concealmentEvents=F),typeof L=="number"&&(n.concealedSamples=L),g&&w&&(n.accelerateRate=g/w),R&&y){const B=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let J=B.jitterBufferMs;const ee=y-B.jitterBufferEmittedCount;ee>0&&(J=1e3*(R-B.jitterBufferDelay)/ee),n.jitterBufferMs=Math.round(J),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:R,jitterBufferEmittedCount:y,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=b;let M=1920;N&&w&&(M=w/N/50,n.receivedFrames=Math.round(w/M)),L&&(n.droppedFrames=Math.round(L/M))}processRemoteInboundStats(e,t){const n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime),n.jitter&&(t.jitterMs=1e3*n.jitter),n.timestamp&&(t.timestamp=n.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let e=0,t=null,n=null;this.mediaBytesSent.forEach(i=>{e+=i.diffMean()}),this.mediaBytesRetransmit.forEach(i=>{t=t===null?i.diffMean():t+i.diffMean()}),this.mediaBytesTargetEncode.forEach(i=>{n=n===null?i.diffMean():n+i.diffMean()});const r=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*r/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),n!==null&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},dJ=class extends tR{updateStats(){return ae.resolve()}};function B_(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const s=function(){const a=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return a&&a[0]?Number(a[0].split("/")[1]):null}();return s?s<76?new cJ(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new LL(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):function(a){if(!window.RTCStatsReport)return!1;const d=a.getStats();return!!(d instanceof ae||function(l){return!!l&&(typeof l=="object"||typeof l=="function")&&typeof l.then=="function"}(d))}(e)?new LL(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new dJ(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i})}const kL="websdk_ng_install_id";function rR(){try{if(A("INSTALL_ID"))return A("INSTALL_ID");let e=window.localStorage.getItem(kL);return e||(e=Pc(),window.localStorage.setItem(kL,e)),St("INSTALL_ID",e),e}catch{return}}const Di=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const n=t[1],r=t[2];return"".concat(n,".").concat(r)}return"4.0.0.999"}("4.24.2"),iR=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let Lc=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const Gn=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const r=n.join(""),i=[];for(let d=0;d<6;d++)i.push("1");const s=i.join(""),a={};return a[e]=r,a[t]=s,Object.assign(a,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Gn;const j_={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},oR={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},sR="v4.24.2-0-g002485b1-dirty(12/12/2025, 5:26:54 PM)",aR={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",TURN_DOMAINS:["edge.agora.io"],USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,FLS_FALLBACK_TIMEOUT:3e4,RTE_DETAIL_REPORT_INTERVAL:6e4,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0,UPDATE_RTP_CAP_IN_HOST:!1,IOS_BG_TAG:!0,IOS_AUTO_RESTART_BG_TAG:!0,IGNORE_UID_CHECK:!1,ENABLE_UP_SPS_PPS:!1,ENABLE_DOWN_SPS_PPS:!1,NO_EDGES_RETRY:!0,BUFFER_READY_FRAMES:3,FLS_SYNC_AV_PLAY_LIMIT:0,FLS_BUFFER_WAIT_TIME:1500,VOS_CONFIGURE:void 0,ENABLE_QUALITY_FALLBACK:!1,QUALITY_FALLBACK_REHEARSAL:!0,ENABLE_FLS_AV1_FIRST:!1,ENABLE_AP_MULTI_IP:!0,FLS_ENABLE_AV1_DETECT:!0,FLS_ENABLE_AV1_DECODE_DETECT:!0},pt=ie(ie(ie(ie({},aR),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_MANAGER_WSS:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_WSS:"",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,DC_JOIN_WITH_FAILBACK:4e3,DC_CONNECTION_TIMEOUT:2e3,DC_PINGPONG_INTERVAL:2e3,DC_DEBUG_LOG:!1,UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:oR,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},j_),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,REMOTE_VIDEO_STREAM_TYPE:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_FORCE_HLS:!1,MAX_WEBAUDIO_VOLUME:300,ENABLE_VOS_FALLBACK:!1,ENABLE_FALLBACK_TO_HLS:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!0,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1,IGNORE_RTC_DEVICE_CHECK:!1,FLS_AUTOPLAY_EMITS:!1,ENABLE_DUAL_STREAM_FLAG:!1,FORBID_MODIFY_LOCAL_OFFER_SDP:!1,RESERVE_MID_1_MLINE:!1});function St(e,t,n){var r,i,s;te(r=Object.keys(pt)).call(r,e)&&(!n&&te(i=Object.keys(li)).call(i,e)||(pt[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS"||t!==!0||(pt.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(s=!!t,pt.USE_NEW_NETWORK_CONFIG=s,s&&(pt.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],pt.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],pt.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],pt.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],pt.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",pt.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",pt.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(pt.ENABLE_INSTANT_VIDEO=!0,pt.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(pt.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&t&&(pt.NEW_TURN_MODE||(pt.NEW_TURN_MODE=4))))}function A(e){if(e==="TURN_DOMAINS"){const t=pt.TURN_DOMAINS;return te(t).call(t,A("TURN_DOMAIN"))?t:[A("TURN_DOMAIN")].concat(t)}return pt[e]}iR||(pt.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],pt.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],pt.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],pt.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],pt.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],pt.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],pt.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",pt.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",pt.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",pt.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",pt.AREAS=["NORTH_AMERICA","OVERSEA"]);let ML=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const li={};var ke=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_RTE_URL="SET_RTE_URL",e.SET_RTE_SID="SET_RTE_SID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",e.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",e.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",e.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",e.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",e.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",e.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(ke||{});let kc=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const UL=128,lJ=96,xL=1e3,ml=10;let uJ=0;var VL=(()=>{var e={8:(r,i,s)=>{s.r(i),s.d(i,{Parser:()=>ee,Printer:()=>Fe,parse:()=>oe,print:()=>ge});const a=`
`,d="".concat("\r").concat(a),l=" ";let h;function p($){return $>="0"&&$<="9"}function _($){return $>="!"&&$<="~"}function m($){return _($)||$>=""&&$<=""}function g($){return $==="!"||$>="#"&&$<="'"||$>="*"&&$<="+"||$>="-"&&$<="."||$>="0"&&$<="9"||$>="A"&&$<="Z"||$>="^"&&$<="~"}function w($){return $>="1"&&$<="9"}function R($){return $>="A"&&$<="Z"||$>="a"&&$<="z"}function y($){return $==="d"||$==="h"||$==="m"||$==="s"}function b($){return $>""&&$<"	"||$>"\v"&&$<"\f"||$>""&&$<""}function N($){return R($)||p($)||$==="+"||$==="/"}function L($){return p($)||R($)||$==="+"||$==="/"||$==="-"||$==="_"}function x($){return R($)||p($)||$==="+"||$==="/"}function F($,v){var P=Object.keys($);if(Object.getOwnPropertySymbols){var U=Object.getOwnPropertySymbols($);v&&(U=U.filter(function(re){return Object.getOwnPropertyDescriptor($,re).enumerable})),P.push.apply(P,U)}return P}function M($){for(var v=1;v<arguments.length;v++){var P=arguments[v]!=null?arguments[v]:{};v%2?F(Object(P),!0).forEach(function(U){B($,U,P[U])}):Object.getOwnPropertyDescriptors?Object.defineProperties($,Object.getOwnPropertyDescriptors(P)):F(Object(P)).forEach(function(U){Object.defineProperty($,U,Object.getOwnPropertyDescriptor(P,U))})}return $}function B($,v,P){return v in $?Object.defineProperty($,v,{value:P,enumerable:!0,configurable:!0,writable:!0}):$[v]=P,$}(function($){$.VERSION="v",$.ORIGIN="o",$.SESSION_NAME="s",$.INFORMATION="i",$.URI="u",$.EMAIL="e",$.PHONE="p",$.CONNECTION="c",$.BANDWIDTH="b",$.TIME="t",$.REPEAT="r",$.ZONE_ADJUSTMENTS="z",$.KEY="k",$.ATTRIBUTE="a",$.MEDIA="m"})(h||(h={}));class J{consumeText(v,P){let U=P;for(;U<v.length;){const re=v[U];if(re==="\0"||re==="\r"||re===a)break;U+=1}if(U-P==0)throw new Error("Invalid text, at ".concat(v));return U}consumeUnicastAddress(v,P,U){return this.consumeTill(v,P,l)}consumeOneOrMore(v,P,U){let re=P;for(;U(v[re]);)re++;if(re-P==0)throw new Error("Invalid rule at ".concat(P,"."));return re}consumeSpace(v,P){if(v[P]===l)return P+1;throw new Error("Invalid space at ".concat(P,"."))}consumeIP4Address(v,P){let U=P;for(let re=0;re<4;re++)if(U=this.consumeDecimalUChar(v,U),re!==3){if(v[U]!==".")throw new Error("Invalid IP4 address.");U++}return U}consumeDecimalUChar(v,P){let U=P;for(let Ue=0;Ue<3&&p(v[U]);Ue++,U++);if(U-P==0)throw new Error("Invalid decimal uchar.");const re=parseInt(v.slice(P,U));if(re>=0&&re<=255)return U;throw new Error("Invalid decimal uchar")}consumeIP6Address(v,P){let U=this.consumeHexpart(v,P);return v[U]===":"&&(U+=1,U=this.consumeIP4Address(v,U)),U}consumeHexpart(v,P){let U=P;if(v[U]===":"&&v[U+1]===":"){U+=2;try{U=this.consumeHexseq(v,U)}catch{}return U}if(U=this.consumeHexseq(v,U),v[U]===":"&&v[U+1]===":"){U+=2;try{U=this.consumeHexseq(v,U)}catch{}return U}return U}consumeHexseq(v,P){let U=P;for(;U=this.consumeHex4(v,U),v[U]===":"&&v[U+1]!==":";)U+=1;return U}consumeHex4(v,P){let U=0;for(;U<4;U++)if(!((re=v[P+U])>="0"&&re<="9"||re>="a"&&re<="f"||re>="A"&&re<="F")){if(U===0)throw new Error("Invalid hex 4");break}var re;return P+U}consumeFQDN(v,P){let U=P;for(;p(v[U])||R(v[U])||v[U]==="-"||v[U]===".";)U+=1;if(U-P<4)throw new Error("Invalid FQDN");return U}consumeExtnAddr(v,P){return this.consumeOneOrMore(v,P,m)}consumeMulticastAddress(v,P,U){switch(U){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(v,P);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(v,P);default:try{return this.consumeFQDN(v,P)}catch{return this.consumeExtnAddr(v,P)}}}consumeIP6MulticastAddress(v,P){const U=this.consumeHexpart(v,P);return v[U]==="/"?this.consumeInteger(v,U+1):U}consumeIP4MulticastAddress(v,P){let U=P+3;const re=v.slice(P,U),Ue=parseInt(re);if(Ue<224||Ue>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let bt=0;bt<3;bt++){if(v[U]!==".")throw new Error("Invalid IP4 multicast address.");U+=1,U=this.consumeDecimalUChar(v,U)}return v[U]==="/"&&(U+=1),U=this.consumeTTL(v,U),v[U]==="/"&&(U=this.consumeInteger(v,U)),U}consumeInteger(v,P){if(!w(v[P]))throw new Error("Invalid integer.");for(P+=1;p(v[P]);)P+=1;return P}consumeTTL(v,P){if(v[P]==="0")return P+1;if(!w(v[P]))throw new Error("Invalid TTL.");P+=1;for(let U=0;U<2&&p(v[P]);U++)P+=1;return P}consumeToken(v,P){return this.consumeOneOrMore(v,P,g)}consumeTime(v,P){let U=P;if(v[U]==="0")return U+1;for(w(v[U])&&(U+=1);p(v[U]);)U++;if(U-P<10)throw new Error("Invalid time");return U}consumeAddress(v,P){return this.consumeTill(v,P,l)}consumeTypedTime(v,P){let U=P;return U=this.consumeOneOrMore(v,U,p),y(v[U])?U+1:U}consumeRepeatInterval(v,P){if(!w(v[P]))throw new Error("Invalid repeat interval");for(P+=1;p(v[P]);)P+=1;return y(v[P])&&(P+=1),P}consumePort(v,P){return this.consumeOneOrMore(v,P,p)}consume(v,P,U){for(let re=0;re<U.length;re++){if(P+re>=v.length)throw new Error("consume exceeding value length");if(v[P+re]!==U[re])throw new Error("consume ".concat(U," failed at ").concat(re))}return P+U.length}consumeTill(v,P,U){let re=P;for(;re<v.length&&(typeof U!="string"||v[re]!==U)&&(typeof U!="function"||!U(v[re]));)re++;return re}}class ee extends J{constructor(){super(),B(this,"records",[]),B(this,"currentLine",0)}parse(v){const P=this.probeEOL(v);this.records=v.split(P).filter(Ba=>!!hr(Ba).call(Ba)).map(this.parseLine),this.currentLine=0;const U=this.parseVersion(),re=this.parseOrigin(),Ue=this.parseSessionName(),bt=this.parseInformation(),Cn=this.parseUri(),Bi=this.parseEmail(),Fa=this.parsePhone(),rE=this.parseConnection(),ql=this.parseBandWidth(),iE=this.parseTimeFields(),id=this.parseKey(),op=this.parseSessionAttribute(),od=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:U,origin:re,sessionName:Ue,information:bt,uri:Cn,emails:Bi,phones:Fa,connection:rE,bandwidths:ql,timeFields:iE,key:id,attributes:op,mediaDescriptions:od}}getCurrentRecord(){const v=this.records[this.currentLine];if(!v)throw new Error("Record doesn't exit.");return v}probeEOL(v){for(let P=0;P<v.length;P++)if(v[P]===a)return v[P-1]==="\r"?d:a;throw new Error("Invalid newline character.")}parseLine(v,P){if(v.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const U=v[0];if(v[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:U,value:v.slice(2),line:P,cur:0}}parseSessionAttribute(){const v=new Pe;for(;this.currentLine<this.records.length;){const P=this.getCurrentRecord();if(P.type!==h.ATTRIBUTE)break;const U={attField:this.extractOneOrMore(P,re=>g(re)&&re!==":"),_cur:0};P.value[P.cur]===":"&&(P.cur+=1,U.attValue=this.extractOneOrMore(P,b)),v.parse(U),this.currentLine++}return v.digest()}parseMediaAttributes(v){const P=new Ne(v);for(;this.currentLine<this.records.length;){const U=this.getCurrentRecord();if(U.type!==h.ATTRIBUTE)break;const re={attField:this.extractOneOrMore(U,Ue=>g(Ue)&&Ue!==":"),_cur:0};U.value[U.cur]===":"&&(U.cur+=1,re.attValue=this.extractOneOrMore(U,b)),P.parse(re),this.currentLine++}return P.digest()}parseKey(){const v=this.getCurrentRecord();if(v.type===h.KEY){if(v.value==="prompt"||v.value==="clear:"||v.value==="base64:"||v.value==="uri:")return v.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const v=this.getCurrentRecord();if(v.type===h.ZONE_ADJUSTMENTS){const P=[];for(;;)try{const U=this.extract(v,this.consumeTime);this.consumeSpaceForRecord(v);let re=!1;v.value[v.cur]==="-"&&(re=!0,v.cur+=1);const Ue=this.extract(v,this.consumeTypedTime);P.push({time:U,typedTime:Ue,back:re})}catch{break}if(P.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,P}return[]}parseRepeat(){const v=[];for(;;){const P=this.getCurrentRecord();if(P.type!==h.REPEAT)break;{const U=this.extract(P,this.consumeRepeatInterval),re=this.parseTypedTime(P);v.push({repeatInterval:U,typedTimes:re}),this.currentLine++}}return v}parseTypedTime(v){const P=[];for(;;)try{this.consumeSpaceForRecord(v),P.push(this.extract(v,this.consumeTypedTime))}catch{break}if(P.length===0)throw new Error("Invalid typed time.");return P}parseTime(){const v=this.getCurrentRecord(),P=this.extract(v,this.consumeTime);this.consumeSpaceForRecord(v);const U=this.extract(v,this.consumeTime);return this.currentLine++,{startTime:P,stopTime:U}}parseBandWidth(){const v=[];for(;this.currentLine<this.records.length;){const P=this.getCurrentRecord();if(P.type!==h.BANDWIDTH)break;{const U=this.extractOneOrMore(P,g);if(P.value[P.cur]!==":")throw new Error("Invalid bandwidth field.");P.cur++;const re=this.extractOneOrMore(P,p);v.push({bwtype:U,bandwidth:re}),this.currentLine++}}return v}parseVersion(){const v=this.getCurrentRecord();if(v.type!==h.VERSION)throw new Error("first sdp record must be version");const P=v.value.slice(0,this.consumeOneOrMore(v.value,0,p));if(P.length!==v.value.length)throw new Error('invalid proto version, "v='.concat(v.value,'"'));return this.currentLine++,P}parseOrigin(){const v=this.getCurrentRecord();if(v.type!==h.ORIGIN)throw new Error("second line of sdp must be origin");const P=this.extractOneOrMore(v,m);this.consumeSpaceForRecord(v);const U=this.extractOneOrMore(v,p);this.consumeSpaceForRecord(v);const re=this.extractOneOrMore(v,p);this.consumeSpaceForRecord(v);const Ue=this.extractOneOrMore(v,g);this.consumeSpaceForRecord(v);const bt=this.extractOneOrMore(v,g);this.consumeSpaceForRecord(v);const Cn=this.extract(v,this.consumeUnicastAddress);return this.currentLine++,{username:P,sessId:U,sessVersion:re,nettype:Ue,addrtype:bt,unicastAddress:Cn}}parseSessionName(){const v=this.getCurrentRecord();if(v.type===h.SESSION_NAME){const P=this.extract(v,this.consumeText);return this.currentLine++,P}}parseInformation(){const v=this.getCurrentRecord();if(v.type!==h.INFORMATION)return;const P=this.extract(v,this.consumeText);return this.currentLine++,P}parseUri(){const v=this.getCurrentRecord();if(v.type===h.URI)return this.currentLine++,v.value}parseEmail(){const v=[];for(;;){const P=this.getCurrentRecord();if(P.type!==h.EMAIL)break;v.push(P.value),this.currentLine++}return v}parsePhone(){const v=[];for(;;){const P=this.getCurrentRecord();if(P.type!==h.PHONE)break;v.push(P.value),this.currentLine++}return v}parseConnection(){const v=this.getCurrentRecord();if(v.type===h.CONNECTION){const P=this.extractOneOrMore(v,g);this.consumeSpaceForRecord(v);const U=this.extractOneOrMore(v,g);this.consumeSpaceForRecord(v);const re=this.extract(v,this.consumeAddress);return this.currentLine++,{nettype:P,addrtype:U,address:re}}}parseMedia(){const v=this.getCurrentRecord(),P=this.extract(v,this.consumeToken);this.consumeSpaceForRecord(v);let U=this.extract(v,this.consumePort);v.value[v.cur]==="/"&&(v.cur+=1,U+=this.extract(v,this.consumeInteger)),this.consumeSpaceForRecord(v);const re=[];for(re.push(this.extract(v,this.consumeToken));v.value[v.cur]==="/";)v.cur+=1,re.push(this.extract(v,this.consumeToken));if(re.length===0)throw new Error("Invalid proto");const Ue=this.parseFmt(v);return this.currentLine++,{mediaType:P,port:U,protos:re,fmts:Ue}}parseTimeFields(){const v=[];for(;this.getCurrentRecord().type===h.TIME;){const P=this.parseTime(),U=this.parseRepeat(),re=this.parseZone();v.push({time:P,repeats:U,zones:re})}return v}parseMediaDescription(){const v=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===h.MEDIA;){const P=this.parseMedia(),U=this.parseInformation(),re=this.parseConnections(),Ue=this.parseBandWidth(),bt=this.parseKey(),Cn=this.parseMediaAttributes(P);v.push({media:P,information:U,connections:re,bandwidths:Ue,key:bt,attributes:Cn})}return v}parseConnections(){const v=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===h.CONNECTION;)v.push(this.parseConnection());return v}parseFmt(v){const P=[];for(;;)try{this.consumeSpaceForRecord(v),P.push(this.extract(v,this.consumeToken))}catch{break}if(P.length===0)throw new Error("Invalid fmts");return P}extract(v,P){for(var U=arguments.length,re=new Array(U>2?U-2:0),Ue=2;Ue<U;Ue++)re[Ue-2]=arguments[Ue];const bt=P.call(this,v.value,v.cur,...re),Cn=v.value.slice(v.cur,bt);return v.cur=bt,Cn}extractOneOrMore(v,P){const U=this.consumeOneOrMore(v.value,v.cur,P),re=v.value.slice(v.cur,U);return v.cur=U,re}consumeSpaceForRecord(v){if(v.value[v.cur]!==l)throw new Error("Invalid space at ".concat(v.cur,"."));v.cur+=1}}class pe extends J{constructor(){super(...arguments),B(this,"attributes",void 0),B(this,"digested",!1)}extractOneOrMore(v,P,U){const re=this.consumeOneOrMore(v.attValue,v._cur,P),Ue=v.attValue.slice(v._cur,re),[bt,Cn]=U||[];if(typeof bt=="number"&&Ue.length<bt)throw new Error("error in length, should be more or equal than ".concat(bt," characters."));if(typeof Cn=="number"&&Ue.length>Cn)throw new Error("error in length, should be less or equal than ".concat(Cn," characters."));return v._cur=re,Ue}consumeAttributeSpace(v){if(v.attValue[v._cur]!==l)throw new Error("Invalid space at ".concat(v._cur,"."));v._cur+=1}extract(v,P){if(!v.attValue)throw new Error("Nothing to extract from attValue.");for(var U=arguments.length,re=new Array(U>2?U-2:0),Ue=2;Ue<U;Ue++)re[Ue-2]=arguments[Ue];const bt=P.call(this,v.attValue,v._cur,...re),Cn=v.attValue.slice(v._cur,bt);return v._cur=bt,Cn}atEnd(v){if(!v.attValue)throw new Error;return v._cur>=v.attValue.length}peekChar(v){if(!v.attValue)throw new Error;return v.attValue[v._cur]}peek(v,P){if(!v.attValue)throw new Error;for(let U=0;U<P.length;U++)if(P[U]!==v.attValue[v._cur+U])return!1;return!0}parseIceUfrag(v){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(v,N,[4,256])}parseIcePwd(v){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(v,N,[22,256])}parseIceOptions(v){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const P=[];for(;!this.atEnd(v);){P.push(this.extractOneOrMore(v,N));try{this.consumeAttributeSpace(v)}catch(U){if(this.atEnd(v))break;throw U}}this.attributes.iceOptions=P}parseFingerprint(v){const P=this.extract(v,this.consumeToken);this.consumeAttributeSpace(v);const U=this.extract(v,this.consumeTill);this.attributes.fingerprints.push({hashFunction:P,fingerprint:U})}parseExtmap(v){const P=this.extractOneOrMore(v,p);let U;this.peekChar(v)==="/"&&(this.extract(v,this.consume,"/"),U=this.extract(v,this.consumeToken)),this.consumeAttributeSpace(v);const re=this.extract(v,this.consumeTill,l),Ue=M(M({entry:parseInt(P,10)},U&&{direction:U}),{},{extensionName:re});this.peekChar(v)===l&&(this.consumeAttributeSpace(v),Ue.extensionAttributes=this.extract(v,this.consumeTill)),this.attributes.extmaps.push(Ue)}parseSetup(v){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const P=this.extract(v,this.consumeTill);if(P!=="active"&&P!=="passive"&&P!=="actpass"&&P!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=P}}class Pe extends pe{constructor(){super(...arguments),B(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(v){if(this.digested)throw new Error("already digested");try{switch(v.attField){case"group":this.parseGroup(v);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(v);break;case"ice-pwd":this.parseIcePwd(v);break;case"ice-options":this.parseIceOptions(v);break;case"fingerprint":this.parseFingerprint(v);break;case"setup":this.parseSetup(v);break;case"tls-id":this.parseTlsId(v);break;case"identity":this.parseIdentity(v);break;case"extmap":this.parseExtmap(v);break;case"msid-semantic":this.parseMsidSemantic(v);break;default:v.ignored=!0,this.attributes.unrecognized.push(v)}}catch(P){throw console.error("parsing session attribute ".concat(v.attField,' error, "a=').concat(v.attField,":").concat(v.attValue,'"')),P}if(!v.ignored&&v.attValue&&!this.atEnd(v))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(v){const P=this.extract(v,this.consumeToken),U=[];for(;!this.atEnd(v)&&this.peekChar(v)===l;)this.consumeAttributeSpace(v),U.push(this.extract(v,this.consumeToken));this.attributes.groups.push({semantic:P,identificationTag:U})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(v){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(v,L)}parseIdentity(v){const P=this.extractOneOrMore(v,x),U=[];for(;!this.atEnd(v)&&this.peekChar(v)===l;){this.consumeAttributeSpace(v);const re=this.extract(v,this.consumeToken);this.extract(v,this.consume,"=");const Ue=this.extractOneOrMore(v,bt=>bt!==l&&b(bt));U.push({name:re,value:Ue})}this.attributes.identities.push({assertionValue:P,extensions:U})}parseMsidSemantic(v){this.peekChar(v)===l&&this.consumeAttributeSpace(v);const P={semantic:this.extract(v,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(v)}catch{break}if(this.peekChar(v)==="*"){this.extract(v,this.consume,"*"),P.applyForAll=!0;break}{const U=this.extract(v,this.consumeTill,l);P.identifierList.push(U)}}this.attributes.msidSemantic=P}}class Ne extends pe{constructor(v){super(),B(this,"attributes",void 0),v.protos.indexOf("RTP")!==-1||v.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(v){if(this.digested)throw new Error("already digested");try{switch(v.attField){case"extmap":this.parseExtmap(v);break;case"setup":this.parseSetup(v);break;case"ice-ufrag":this.parseIceUfrag(v);break;case"ice-pwd":this.parseIcePwd(v);break;case"ice-options":this.parseIceOptions(v);break;case"candidate":this.parseCandidate(v);break;case"remote-candidate":this.parseRemoteCandidate(v);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(v);break;case"rtpmap":this.parseRtpmap(v);break;case"ptime":this.parsePtime(v);break;case"maxptime":this.parseMaxPtime(v);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(v);break;case"ssrc":this.parseSSRC(v);break;case"fmtp":this.parseFmtp(v);break;case"rtcp-fb":this.parseRtcpFb(v);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(v);break;case"mid":this.parseMid(v);break;case"msid":this.parseMsid(v);break;case"imageattr":this.parseImageAttr(v);break;case"rid":this.parseRid(v);break;case"simulcast":this.parseSimulcast(v);break;case"sctp-port":this.parseSctpPort(v);break;case"max-message-size":this.parseMaxMessageSize(v);break;case"ssrc-group":this.parseSSRCGroup(v);break;default:v.ignored=!0,this.attributes.unrecognized.push(v)}}catch(P){throw console.error("parsing media attribute ".concat(v.attField,' error, "a=').concat(v.attField,":").concat(v.attValue,'"')),P}if(!v.ignored&&v.attValue&&!this.atEnd(v))throw new Error("attribute parsing error")}parseCandidate(v){const P=this.extractOneOrMore(v,N,[1,32]);this.consumeAttributeSpace(v);const U=this.extractOneOrMore(v,p,[1,5]);this.consumeAttributeSpace(v);const re=this.extract(v,this.consumeToken);this.consumeAttributeSpace(v);const Ue=this.extractOneOrMore(v,p,[1,10]);this.consumeAttributeSpace(v);const bt=this.extract(v,this.consumeAddress);this.consumeAttributeSpace(v);const Cn=this.extract(v,this.consumePort);this.consumeAttributeSpace(v),this.extract(v,this.consume,"typ"),this.consumeAttributeSpace(v);const Bi={foundation:P,componentId:U,transport:re,priority:Ue,connectionAddress:bt,port:Cn,type:this.extract(v,this.consumeToken),extension:{}};for(this.peek(v," raddr")&&(this.extract(v,this.consume," raddr"),this.consumeAttributeSpace(v),Bi.relAddr=this.extract(v,this.consumeAddress)),this.peek(v," rport")&&(this.extract(v,this.consume," rport"),this.consumeAttributeSpace(v),Bi.relPort=this.extract(v,this.consumePort));this.peekChar(v)===l;){this.consumeAttributeSpace(v);const Fa=this.extract(v,this.consumeToken);this.consumeAttributeSpace(v),Bi.extension[Fa]=this.extractOneOrMore(v,_)}this.attributes.candidates.push(Bi)}parseRemoteCandidate(v){const P=[];for(;;){const U=this.extractOneOrMore(v,p,[1,5]);this.consumeAttributeSpace(v);const re=this.extract(v,this.consumeAddress);this.consumeAttributeSpace(v);const Ue=this.extract(v,this.consumePort);P.push({componentId:U,connectionAddress:re,port:Ue});try{this.consumeAttributeSpace(v)}catch{break}}this.attributes.remoteCandidatesList.push(P)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(v){const P=this.extract(v,this.consumeToken);this.consumeAttributeSpace(v);const U=this.extract(v,this.consumeTill,"/");this.extract(v,this.consume,"/");const re={encodingName:U,clockRate:this.extractOneOrMore(v,p)};this.atEnd(v)||this.peekChar(v)!=="/"||(this.extract(v,this.consume,"/"),re.encodingParameters=parseInt(this.extract(v,this.consumeTill),10));const Ue=this.attributes.payloads.find(bt=>bt.payloadType===parseInt(P,10));Ue?Ue.rtpMap=re:this.attributes.payloads.push({payloadType:parseInt(P,10),rtpMap:re,rtcpFeedbacks:[]})}parsePtime(v){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(v,this.consumeTill)}parseMaxPtime(v){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(v,this.consumeTill)}parseDirection(v){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=v.attField}parseSSRC(v){const P=this.extractOneOrMore(v,p);this.consumeAttributeSpace(v);const U=this.extract(v,this.consumeTill,":");let re;this.peekChar(v)===":"&&(this.extract(v,this.consume,":"),re=this.extract(v,this.consumeTill));const Ue=this.attributes.ssrcs.find(bt=>bt.ssrcId===parseInt(P,10));Ue?Ue.attributes[U]=re:this.attributes.ssrcs.push({ssrcId:parseInt(P,10),attributes:{[U]:re}})}parseFmtp(v){const P=this.extract(v,this.consumeTill,l);this.consumeAttributeSpace(v);const U=this.extract(v,this.consumeTill),re={};U.split(";").forEach(bt=>{let[Cn,Bi]=bt.split("=");Cn=hr(Cn).call(Cn);const Fa=typeof Bi=="string"?hr(Bi).call(Bi):null;typeof Cn=="string"&&Cn.length>0&&(re[Cn]=Fa)});const Ue=this.attributes.payloads.find(bt=>bt.payloadType===parseInt(P,10));Ue?Ue.fmtp={parameters:re}:this.attributes.payloads.push({payloadType:parseInt(P,10),rtcpFeedbacks:[],fmtp:{parameters:re}})}parseFmtParameters(v){const P={},U=this.extract(v,this.consumeTill,"=");v._cur++;const re=this.extract(v,this.consumeTill,";");for(P[U]=re;v.attValue[v._cur]===";";){const Ue=this.extract(v,this.consumeTill,"=");v._cur++;const bt=this.extract(v,this.consumeTill,";");P[Ue]=bt}return P}parseRtcpFb(v){let P="";P=this.peekChar(v)==="*"?this.extract(v,this.consume,"*"):this.extract(v,this.consumeTill,l),this.consumeAttributeSpace(v);const U=this.extract(v,this.consumeTill,l);let re;if(U==="trr-int")re={type:U,interval:this.extract(v,this.consumeTill)};else{const Ue={type:U};this.peekChar(v)===l&&(this.consumeAttributeSpace(v),Ue.parameter=this.extract(v,this.consumeToken),this.peekChar(v)===l&&(Ue.additional=this.extract(v,this.consumeTill))),re=Ue}if(P==="*")this.attributes.rtcpFeedbackWildcards.push(re);else{const Ue=this.attributes.payloads.find(bt=>bt.payloadType===parseInt(P,10));Ue?Ue.rtcpFeedbacks.push(re):this.attributes.payloads.push({payloadType:parseInt(P,10),rtcpFeedbacks:[re]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(v){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const P={port:this.extract(v,this.consumePort)};this.peekChar(v)===l&&(this.consumeAttributeSpace(v),P.netType=this.extractOneOrMore(v,g),this.consumeAttributeSpace(v),P.addressType=this.extractOneOrMore(v,g),this.consumeAttributeSpace(v),P.address=this.extract(v,this.consumeAddress)),this.attributes.rtcp=P}parseMsid(v){const P={id:this.extractOneOrMore(v,g,[1,64])};this.peekChar(v)===l&&(this.consumeAttributeSpace(v),P.appdata=this.extractOneOrMore(v,g,[1,64])),this.attributes.msids.push(P)}parseImageAttr(v){this.attributes.imageattr.push(v.attValue)}parseRid(v){const P=this.extractOneOrMore(v,re=>R(re)||p(re)||re==="_"||re==="-");this.consumeAttributeSpace(v);const U={id:P,direction:this.extract(v,this.consumeToken),params:[]};if(this.peekChar(v)===l){if(this.consumeAttributeSpace(v),this.peek(v,"pt=")){this.extract(v,this.consume,"pt=");const re=[];for(;;){const Ue=this.extract(v,this.consumeToken);re.push(Ue);try{this.extract(v,this.consume,",")}catch{break}}U.payloads=re,this.peekChar(v)===l&&this.extract(v,this.consume,l)}for(;;){const re=this.extract(v,this.consumeToken);switch(re){case"depend":{const Ue={type:re,rids:this.extract(v,this.consume,"=").split(",")};U.params.push(Ue);break}default:{const Ue={type:re};this.peekChar(v)==="="&&(this.extract(v,this.consume,"="),Ue.val=this.extract(v,this.consumeTill,";")),U.params.push(Ue)}}try{this.extract(v,this.consume,";")}catch{break}}}this.attributes.rids.push(U)}parseSimulcast(v){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=v.attValue,this.extract(v,this.consumeTill)}parseSctpPort(v){this.attributes.sctpPort=this.extractOneOrMore(v,p,[1,5])}parseMaxMessageSize(v){this.attributes.maxMessageSize=this.extractOneOrMore(v,p,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(v){this.attributes.mid=this.extract(v,this.consumeToken)}parseSSRCGroup(v){const P=this.extract(v,this.consumeToken),U=[];for(;;)try{this.consumeAttributeSpace(v);const re=this.extract(v,this.consumeInteger);U.push(parseInt(re,10))}catch{break}this.attributes.ssrcGroups.push({semantic:P,ssrcIds:U})}}function Ge($,v,P){return v in $?Object.defineProperty($,v,{value:P,enumerable:!0,configurable:!0,writable:!0}):$[v]=P,$}class Fe{constructor(){Ge(this,"eol",d)}print(v,P){let U="";return P&&(this.eol=P),U+=this.printVersion(v.version),U+=this.printOrigin(v.origin),U+=this.printSessionName(v.sessionName),U+=this.printInformation(v.information),U+=this.printUri(v.uri),U+=this.printEmail(v.emails),U+=this.printPhone(v.phones),U+=this.printConnection(v.connection),U+=this.printBandwidth(v.bandwidths),U+=this.printTimeFields(v.timeFields),U+=this.printKey(v.key),U+=this.printSessionAttributes(v.attributes),U+=this.printMediaDescription(v.mediaDescriptions),U}printVersion(v){return"v=".concat(v).concat(this.eol)}printOrigin(v){return"o=".concat(v.username," ").concat(v.sessId," ").concat(v.sessVersion," ").concat(v.nettype," ").concat(v.addrtype," ").concat(v.unicastAddress).concat(this.eol)}printSessionName(v){return v?"s=".concat(v).concat(this.eol):""}printInformation(v){return v?"i=".concat(v).concat(this.eol):""}printUri(v){return v?"u=".concat(v).concat(this.eol):""}printEmail(v){let P="";for(const U of v)P+="e=".concat(U).concat(this.eol);return P}printPhone(v){let P="";for(const U of v)P+="e=".concat(U).concat(this.eol);return P}printConnection(v){return v?"c=".concat(v.nettype," ").concat(v.addrtype," ").concat(v.address).concat(this.eol):""}printBandwidth(v){let P="";for(const U of v)P+="b=".concat(U.bwtype,":").concat(U.bandwidth).concat(this.eol);return P}printTimeFields(v){let P="";for(const U of v){P+="t=".concat(U.time.startTime," ").concat(U.time.startTime).concat(this.eol);for(const re of U.repeats)P+="r=".concat(re.repeatInterval," ").concat(re.typedTimes.join(" ")).concat(this.eol);U.zoneAdjustments&&(P+="z=",P+="z=".concat(U.zoneAdjustments.map(re=>"".concat(re.time," ").concat(re.back?"-":""," ").concat(re.typedTime)).join(" ")).concat(this.eol),P+=this.eol)}return P}printKey(v){return v?"k=".concat(v).concat(this.eol):""}printAttributes(v){let P="";for(const U of v)P+="a=".concat(U.attField).concat(U.attValue?":".concat(U.attValue):"").concat(this.eol);return P}printMediaDescription(v){let P="";for(const U of v)P+=this.printMedia(U.media),P+=this.printInformation(U.information),P+=this.printConnections(U.connections),P+=this.printBandwidth(U.bandwidths),P+=this.printKey(U.key),P+=this.printMediaAttributes(U);return P}printConnections(v){let P="";for(const U of v)P+=this.printConnection(U);return P}printMedia(v){return"m=".concat(v.mediaType," ").concat(v.port," ").concat(v.protos.join("/")," ").concat(v.fmts.join(" ")).concat(this.eol)}printSessionAttributes(v){return new Ut(this.eol).print(v)}printMediaAttributes(v){return new Z(this.eol).print(v)}}class st{constructor(v){Ge(this,"eol",void 0),this.eol=v}printIceUfrag(v){return v===void 0?"":"a=ice-ufrag:".concat(v).concat(this.eol)}printIcePwd(v){return v===void 0?"":"a=ice-pwd:".concat(v).concat(this.eol)}printIceOptions(v){return v===void 0?"":"a=ice-options:".concat(v.join(l)).concat(this.eol)}printFingerprints(v){return v.length>0?v.map(P=>"a=fingerprint:".concat(P.hashFunction).concat(l).concat(P.fingerprint)).join(this.eol)+this.eol:""}printExtmap(v){return v.map(P=>"a=extmap:".concat(P.entry).concat(P.direction?"/".concat(P.direction):"").concat(l).concat(P.extensionName).concat(P.extensionAttributes?"".concat(l).concat(P.extensionAttributes):"").concat(this.eol)).join("")}printSetup(v){return v===void 0?"":"a=setup:".concat(v).concat(this.eol)}printUnrecognized(v){return v.map(P=>"a=".concat(P.attField).concat(P.attValue?":".concat(P.attValue):"").concat(this.eol)).join("")}}class Ut extends st{print(v){let P="";return P+=this.printGroups(v.groups),P+=this.printMsidSemantic(v.msidSemantic),P+=this.printIceLite(v.iceLite),P+=this.printIceUfrag(v.iceUfrag),P+=this.printIcePwd(v.icePwd),P+=this.printIceOptions(v.iceOptions),P+=this.printFingerprints(v.fingerprints),P+=this.printSetup(v.setup),P+=this.printTlsId(v.tlsId),P+=this.printIdentity(v.identities),P+=this.printExtmap(v.extmaps),P+=this.printUnrecognized(v.unrecognized),P}printGroups(v){let P="";return v.length>0&&(P+=v.map(U=>"a=group:".concat(U.semantic).concat(U.identificationTag.map(re=>"".concat(l).concat(re)).join("")).concat(this.eol)).join("")),P}printIceLite(v){return v===void 0?"":"a=ice-lite"+this.eol}printTlsId(v){return v?"a=tls-id:".concat(v).concat(this.eol):""}printIdentity(v){return v.length===0?"":v.map(P=>"a=identity:".concat(P.assertionValue).concat(P.extensions.map(U=>"".concat(l).concat(U.name).concat(U.value?"=".concat(U.value):"")))).join(this.eol)+this.eol}printMsidSemantic(v){if(!v)return"";let P="a=msid-semantic:".concat(v.semantic);return v.applyForAll?P+="".concat(l,"*"):v.identifierList.length>0&&(P+=v.identifierList.map(U=>"".concat(l).concat(U))),P+this.eol}}class Z extends st{print(v){const P=v.attributes;let U="";return U+=this.printRTCP(P.rtcp),U+=this.printIceUfrag(P.iceUfrag),U+=this.printIcePwd(P.icePwd),U+=this.printIceOptions(P.iceOptions),U+=this.printCandidates(P.candidates),U+=this.printRemoteCandidatesList(P.remoteCandidatesList),U+=this.printEndOfCandidates(P.endOfCandidates),U+=this.printFingerprints(P.fingerprints),U+=this.printSetup(P.setup),U+=this.printMid(P.mid),U+=this.printExtmap(P.extmaps),U+=this.printRTPRelated(P),U+=this.printPtime(P.ptime),U+=this.printMaxPtime(P.maxPtime),U+=this.printDirection(P.direction),U+=this.printSSRCGroups(P.ssrcGroups),U+=this.printSSRC(P.ssrcs),U+=this.printRTCPMux(P.rtcpMux),U+=this.printRTCPMuxOnly(P.rtcpMuxOnly),U+=this.printRTCPRsize(P.rtcpRsize),U+=this.printMSId(P.msids),U+=this.printImageattr(P.imageattr),U+=this.printRid(P.rids),U+=this.printSimulcast(P.simulcast),U+=this.printSCTPPort(P.sctpPort),U+=this.printMaxMessageSize(P.maxMessageSize),U+=this.printUnrecognized(P.unrecognized),U}printCandidates(v){return v.map(P=>"a=candidate:".concat(P.foundation).concat(l).concat(P.componentId).concat(l).concat(P.transport).concat(l).concat(P.priority).concat(l).concat(P.connectionAddress).concat(l).concat(P.port).concat(l,"typ").concat(l).concat(P.type).concat(P.relAddr?"".concat(l,"raddr").concat(l).concat(P.relAddr):"").concat(P.relPort?"".concat(l,"rport").concat(l).concat(P.relPort):"").concat(Object.keys(P.extension).map(U=>"".concat(l).concat(U).concat(l).concat(P.extension[U])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(v){return v.map(P=>"a=remote-candidates:".concat(P.join(l)).concat(this.eol)).join("")}printEndOfCandidates(v){return v===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(v){if(!v.payloads)return"";const P=v.payloads;let U="";U+=v.rtcpFeedbackWildcards.map(re=>this.printRTCPFeedback("*",re)).join("");for(const re of P)U+=this.printRtpMap(re.payloadType,re.rtpMap),U+=this.printFmtp(re.payloadType,re.fmtp),U+=re.rtcpFeedbacks.map(Ue=>this.printRTCPFeedback(re.payloadType,Ue)).join("");return U}printFmtp(v,P){if(!P)return"";const U=Object.keys(P.parameters);return U.length===1&&P.parameters[U[0]]===null?"a=fmtp:".concat(v).concat(l).concat(U[0]).concat(this.eol):"a=fmtp:".concat(v).concat(l).concat(Object.keys(P.parameters).map(re=>"".concat(re,"=").concat(P.parameters[re])).join(";")).concat(this.eol)}printRtpMap(v,P){return P?"a=rtpmap:".concat(v).concat(l).concat(P.encodingName,"/").concat(P.clockRate).concat(P.encodingParameters?"/".concat(P.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(v,P){let U="a=rtcp-fb:".concat(v).concat(l),re=P;return re.type==="trr-int"?U+="ttr-int".concat(l).concat(re.interval):(U+="".concat(re.type),re.parameter&&(U+="".concat(l).concat(re.parameter),re.additional&&(U+="".concat(l).concat(re.additional)))),U+this.eol}printPtime(v){return v===void 0?"":"a=ptime:".concat(v).concat(this.eol)}printMaxPtime(v){return v===void 0?"":"a=maxptime:".concat(v).concat(this.eol)}printDirection(v){return v===void 0?"":"a=".concat(v).concat(this.eol)}printSSRC(v){return v.map(P=>Object.keys(P.attributes).map(U=>"a=ssrc:".concat(P.ssrcId.toString(10)).concat(l).concat(U).concat(P.attributes[U]?":".concat(P.attributes[U]):"").concat(this.eol)).join("")).join("")}printRTCPMux(v){return v===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(v){return v===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(v){return v===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(v){if(v===void 0)return"";let P="a=rtcp:".concat(v.port);return v.netType&&(P+="".concat(l).concat(v.netType)),v.addressType&&(P+="".concat(l).concat(v.addressType)),v.address&&(P+="".concat(l).concat(v.address)),P+this.eol}printMSId(v){return v.map(P=>"a=msid:".concat(P.id).concat(P.appdata?"".concat(l).concat(P.appdata):"").concat(this.eol)).join("")}printImageattr(v){return v.map(P=>"a=imageattr:".concat(P).concat(this.eol)).join("")}printRid(v){return v.map(P=>{let U="a=rid:".concat(P.id).concat(l).concat(P.direction);return P.payloads&&(U+="".concat(l,"pt=").concat(P.payloads.join(","))),P.params.length>0&&(U+="".concat(l).concat(P.params.map(re=>re.type==="depend"?"depend=".concat(re.rids.join(",")):"".concat(re.type,"=").concat(re.val)).join(";"))),U+this.eol}).join("")}printSimulcast(v){return v===void 0?"":"a=simulcast:".concat(v).concat(this.eol)}printSCTPPort(v){return v===void 0?"":"a=sctp-port:".concat(v).concat(this.eol)}printMaxMessageSize(v){return v===void 0?"":"a=max-message-size:".concat(v).concat(this.eol)}printMid(v){return v===void 0?"":"a=mid:".concat(v).concat(this.eol)}printSSRCGroups(v){return v.map(P=>"a=ssrc-group:".concat(P.semantic).concat(P.ssrcIds.map(U=>"".concat(l).concat(U.toString(10))).join("")).concat(this.eol)).join("")}}function oe($){return new ee().parse($)}function ge($,v){return new Fe().print($,v)}}},t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}return n.d=(r,i)=>{for(var s in i)n.o(i,s)&&!n.o(r,s)&&Object.defineProperty(r,s,{enumerable:!0,get:i[s]})},n.o=(r,i)=>Object.prototype.hasOwnProperty.call(r,i),n.r=r=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},n(8)})();function _r(e){return VL.parse(e)}function Fs(e,t){return VL.print(e,t)}var hJ=bi("Array","keys"),pJ=ua,fJ=$n,_J=Q,mJ=hJ,cR=Array.prototype,EJ={DOMTokenList:!0,NodeList:!0},gJ=function(e){var t=e.keys;return e===cR||_J(cR,e)&&t===cR.keys||fJ(EJ,pJ(e))?mJ:t},nr=E(gJ);function Kt(e,t,n){return(t=function(r){var i=function(s,a){if(typeof s!="object"||!s)return s;var d=s[Symbol.toPrimitive];if(d!==void 0){var l=d.call(s,"string");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(r);return typeof i=="symbol"?i:i+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function FL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function je(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?FL(Object(n),!0).forEach(function(r){Kt(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):FL(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function G_(e,t){return G_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},G_(e,t)}function dR(){dR=function(i,s){return new n(i,void 0,s)};var e=RegExp.prototype,t=new WeakMap;function n(i,s,a){var d=RegExp(i,s);return t.set(d,a||t.get(i)),G_(d,n.prototype)}function r(i,s){var a,d=t.get(s);return Oi(a=Object.keys(d)).call(a,function(l,h){var p=d[h];if(typeof p=="number")l[h]=i[p];else{for(var _=0;i[p[_]]===void 0&&_+1<p.length;)_++;l[h]=i[p[_]]}return l},Object.create(null))}return function(i,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(s&&s.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),s&&G_(i,s)}(n,RegExp),n.prototype.exec=function(i){var s=e.exec.call(this,i);if(s){s.groups=r(s,this);var a=s.indices;a&&(a.groups=r(a,this))}return s},n.prototype[Symbol.replace]=function(i,s){if(typeof s=="string"){var a=t.get(this);return e[Symbol.replace].call(this,i,s.replace(/\$<([^>]+)(>|$)/g,function(l,h,p){if(p==="")return l;var _=a[h];return Array.isArray(_)?"$"+_.join("$"):typeof _=="number"?"$"+_:""}))}if(typeof s=="function"){var d=this;return e[Symbol.replace].call(this,i,function(){var l=arguments;return typeof l[l.length-1]!="object"&&(l=[].slice.call(l)).push(r(l,d)),s.apply(this,l)})}return e[Symbol.replace].call(this,i,s)},dR.apply(this,arguments)}const BL=new class extends Vt{constructor(){super(...arguments),Kt(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class SJ{constructor(t){Kt(this,"logger",void 0),Kt(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.debug(...this.prefixLists,...n)}info(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.info(...this.prefixLists,...n)}warning(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.warning(...this.prefixLists,...n)}error(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.error(...this.prefixLists,...n)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function lR(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function jL(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const Pi={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},W_=Date.now(),Rh=e=>{for(const t in Pi)if(Object.prototype.hasOwnProperty.call(Pi,t)&&Pi[t]===e)return t;return"DEFAULT"},T=new class{constructor(){Kt(this,"proxyServerURL",void 0),Kt(this,"logLevel",Pi.DEBUG),Kt(this,"uploadState","collecting"),Kt(this,"uploadLogWaitingList",[]),Kt(this,"uploadLogUploadingList",[]),Kt(this,"uploadErrorCount",0),Kt(this,"currentLogID",0),Kt(this,"url",void 0),Kt(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Pi.DEBUG].concat(t);this.log.apply(this,r)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Pi.INFO].concat(t);this.log.apply(this,r)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Pi.WARNING].concat(t);this.log.apply(this,r)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Pi.ERROR].concat(t);this.log.apply(this,r)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Pi.DEBUG].concat(t);this.uploadLog.apply(this,r)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){St("UPLOAD_LOG",!0)}disableLogUpload(){St("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new SJ(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-W_<100)return void setTimeout(()=>{this.log(...t)},Date.now()-W_);const r=Math.max(0,Math.min(4,t[0]));if(t[0]=lR()+" Agora-SDK [".concat(Rh(r),"]:"),this.appendLogToWaitingList(r,...t),r<this.logLevel)return;const i=lR()+" %cAgora-SDK [".concat(Rh(r),"]:");let s=[];if(!A("USE_NEW_LOG"))switch(r){case Pi.DEBUG:s=[i,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,s);break;case Pi.INFO:s=[i,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,s);break;case Pi.WARNING:s=[i,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,s);break;case Pi.ERROR:s=[i,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,s)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-W_<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-W_);const r=Math.max(0,Math.min(4,t[0]));t[0]=lR()+" Agora-SDK [".concat(Rh(r),"]:"),this.appendLogToWaitingList(r,...t)}appendLogToWaitingList(e){if(!A("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Array.isArray(n[0])?n[0][0]=jL()+" Agora-SDK [".concat(Rh(e),"]:"):n[0]=jL()+" Agora-SDK [".concat(Rh(e),"]:");let i="";n.forEach(s=>{typeof s=="object"&&(s=JSON.stringify(s)),i+="".concat(s," ")}),this.uploadLogWaitingList.push({payload_str:i,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:Di,process_id:A("PROCESS_ID"),payload:JSON.stringify(e)};return Do(async()=>{const n=await Cr.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(A("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(A("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(n.data!=="OK"){const r=new Error("unexpected upload log response");throw r.response=n,r}},()=>(this.uploadLogUploadingList=[],!1),n=>{const r={status:-1,message:n.message,errorRange:e.map(i=>i.log_item_id)};return n.response?(r.status=n.response.status,r.data=n.response.data,r.headers=n.response.headers):n.request&&(r.status=n.request.status),BL.reportLogUploadError(r),!0},{timeout:A("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:A("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,A("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),A("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),A("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),A("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var GL;function TJ(e){return Mn(e.reportId,"params.reportId",0,100,!1),Mn(e.category,"params.category",0,100,!1),Mn(e.event,"params.event",0,100,!1),Mn(e.label,"params.label",0,100,!1),Rt(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(GL={}).FREE="free",GL.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const vJ={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let pn=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.RTE_DETAIL="rte_detail_stats",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),Mt=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.RTE_DETAIL="io.agora.pb.Wrtc.RteDetailStats",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let RJ=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function Ae(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,n,r){const i=r.value;if(typeof i=="function"){const s=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);r.value=function(){for(var a,d=arguments.length,l=new Array(d),h=0;h<d;h++)l[h]=arguments[h];let p=l;if(e.argsMap)try{p=e.argsMap(this,...l)}catch(m){T.warning(m),p=[]}try{JSON.stringify(p)}catch{T.warning("arguments for method ".concat(s,".").concat(String(n)," not serializable for apiInvoke.")),p=[]}const _=(e.report||Se).reportApiInvoke(this._sessionId||null,{id:this._clientId||((a=this.store)===null||a===void 0?void 0:a.clientId)||this._ID,name:"".concat(s,".").concat(String(n)),options:p,tag:yt.TRACER,reportResult:e.reportResult},e.throttleTime);try{const m=i.apply(this,l);return m instanceof ae?m.then(g=>(_.onSuccess(e.reportResult&&g),g)).catch(g=>{throw _.onError(g),g}):(_.onSuccess(e.reportResult&&m),m)}catch(m){throw _.onError(m),m}}}return r}}const Se=new class{constructor(){Kt(this,"baseInfoMap",new Map),Kt(this,"proxyServer",void 0),Kt(this,"eventUploadTimer",void 0),Kt(this,"setSessionIdTimer",void 0),Kt(this,"url",void 0),Kt(this,"sids",new Set),Kt(this,"backupUrl",void 0),Kt(this,"_appId",void 0),Kt(this,"_aid",0),Kt(this,"keyEventUploadPendingItems",[]),Kt(this,"normalEventUploadPendingItems",[]),Kt(this,"apiInvokeUploadPendingItems",[]),Kt(this,"apiInvokeCount",0),Kt(this,"apiInvokeLoggedCount",0),Kt(this,"ltsList",[]),Kt(this,"lastSendNormalEventTime",Date.now()),Kt(this,"customReportCounterTimer",void 0),Kt(this,"customReportCount",0),Kt(this,"extApiInvoke",async e=>{for(const t of e){const n=je(je({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:yt.TRACER});this.sendApiInvoke(n)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),A("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),A("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,t=>{let[n,r]=t;return n+r}),16)||0}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const r=Date.now();this.apiInvokeCount+=1;const i=this.apiInvokeCount,s=!!A("SHOW_REPORT_INVOKER_LOG"),a=!!A("SHOW_REPORT_USER_INVOKER_LOG"),d=s||a&&t.id;d&&(this.apiInvokeLoggedCount+=1);const l=this.apiInvokeLoggedCount;function h(g,w){if(d){let R="[apiInvoke-".concat(l,"]");if(t.id&&(R+="[".concat(t.id,"]")),t.name&&(R+="[".concat(t.name,"]"),t.name===kt.JOIN))return T.info("".concat(R," ").concat(g));T.info("".concat(R," ").concat(g),g==="start"?t.options:w||"")}}const p=()=>({tag:t.tag,invokeId:i,sid:e,name:t.name,apiInvokeTime:r,options:t.options,states:t.states||null});h("start");let _=!1;Tn(t.timeout).then(()=>{_||(this.sendApiInvoke(je(je({},p()),{},{error:O.API_INVOKE_TIMEOUT,success:!1})),h("timeout"))});const m=new Y(O.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:g=>{const w=()=>{if(_)throw m;return _=!0,this.sendApiInvoke(je(je({},p()),{},{success:!0},t.reportResult&&{result:g})),h("onSuccess"),g};return n?RL(w,t.name+"Success",n,()=>_=!0):w()},onError:g=>{const w=()=>{if(_)throw g;_=!0,this.sendApiInvoke(je(je({},p()),{},{success:!1,error:g})),h("onFailure",g.toString())};return n?RL(w,t.name+"Error",n,()=>_=!0):w()}}}_send(e,t,n){this.send({type:e,data:t},n)}_sendApiInvoke(e){return this.sendApiInvoke(e)}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),r=this.createBaseInfo(e,n);r.cname=t.cname,r.rteUrl=t.rteUrl;const i=Object.assign({},{willUploadConsoleLog:A("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:iR?"global":"oversea",areas:A("AREAS")&&A("AREAS").join(",")},t.extend),{stringUid:s,channelProfile:a,channelMode:d,isABTestSuccess:l,lsid:h,clientRole:p}=t,_=Date.now(),m=je(je({},r),{},{eventType:pn.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:sR,lts:_,elapse:_-n,extend:JSON.stringify(i),mode:t.mode,process:A("PROCESS_ID"),appType:A("APP_TYPE"),success:!0,version:Di,stringUid:s,channelProfile:a,channelMode:d,isABTestSuccess:l,lsid:h,clientType:te(g=window.navigator.userAgent).call(g,"AgoraWebView")?42:20,clientRole:p,serviceId:A("PROCESS_ID"),extensionID:A("PLUGIN_INFO").join(",")||"",rteUrl:t.rteUrl,rteSid:t.rteSid});var g;this.send({type:Mt.SESSION,data:m},!0)}reportRteDetail(e){const t=this.baseInfoMap.get(e);if(!t)return;const n=t.info,r=Date.now(),i=je(je({},n),{},{eventType:pn.RTE_DETAIL,lts:r,success:!0,elapse:r-t.startTime,vid:n.vid===void 0?0:Number(n.vid),ua:navigator.userAgent});this.send({type:Mt.RTE_DETAIL,data:i},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info;t.vid&&(r.vid=t.vid);const i=Date.now(),s=je(je({},r),{},{role:t.role,eventType:pn.JOIN_CHOOSE_SERVER,lts:i,eventElapse:t.elapse||i-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:i-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0,ua:navigator.userAgent,resourceTimingInfo:t.resourceTimingInfo||void 0});this.send({type:Mt.JOIN_CHOOSE_SERVER,data:s},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=je(je({},r),{},{eventType:pn.REQ_USER_ACCOUNT,lts:i,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||i-n.startTime,eventElapse:i-t.lts,extend:JSON.stringify(t.extend)});this.send({type:Mt.REQ_USER_ACCOUNT,data:s},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info;t.vid&&(r.vid=t.vid),r.uid=t.uid,r.cid=t.cid;const i=Date.now(),{firstSuccess:s,addr:a,isProxy:d}=t,l=i-n.startTime,h=je(je({},r),{},{eventType:pn.JOIN_GATEWAY,lts:i,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:l,eventElapse:i-t.lts,firstSuccess:s,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:rR(),isABTestSuccess:t.isABTestSuccess?1:0,gatewayIp:null,gatewayPort:null,isProxy:d?1:0}),p=h.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=i),a)if(h.signalChannel==="1"){const _=dR(/(\d+\.\d+\.\d+\.\d+):(\d+)/,{ip:1,port:2}),m=a.match(_);h.gatewayIp=m&&m.groups?m.groups.ip:"",h.gatewayPort=m&&m.groups?m.groups.port:""}else if(d){const _=a.match(/h=(\d{1,3}-){3}\d{1,3}/g),m=a.match(/p=[0-9]{1,6}/g);h.gatewayIp=_&&_.length?_[0].split("=")[1].replace(/-/g,"."):"",h.gatewayPort=m&&m.length?m[0].split("=")[1]:""}else{const _=a.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),m=a.match(/(:|p=)[0-9]{1,6}/g);h.gatewayIp=_&&_.length?_[0].split("//")[1].replace(/-/g,"."):"",h.gatewayPort=m&&m.length?m[0].split(/:|p=/g)[1]:""}if(s)this.send({type:Mt.JOIN_GATEWAY,data:h},!0);else{let _={isSuccess:p,port:h.gatewayPort};delete h.success,delete h.eventType,delete h.firstSuccess,delete h.gatewayPort,h.vid=Number(h.vid);const m=Object.assign({},h,_,{eventType:pn.REJOIN_GATEWAY});this.send({type:Mt.RE_JOIN_GATEWAY,data:m},!0)}}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=Date.now(),i=je(je({},n.info),{},{lts:r,timeout:t,elapse:r-n.startTime});this.send({type:Mt.JOIN_CHANNEL_TIMEOUT,data:i},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=je(je({},r),{},{eventType:pn.PUBLISH,lts:i,eventElapse:t.eventElapse,elapse:i-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:Mt.PUBLISH,data:s},!0)}subscribe(e,t,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=Date.now(),a=je(je({},i),{},{eventType:pn.SUBSCRIBE,lts:s,eventElapse:t.eventElapse,elapse:s-r.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?a.peerSuid=t.peerid:a.peer=t.peerid,this.send({type:Mt.SUBSCRIBE,data:a},!0)}wsCompressorInit(e){var t;const n=[...nr(t=this.baseInfoMap).call(t)],r=n.length?n[0]:"UnableToGetSid",i=this.baseInfoMap.get(r);if(!i)return;const s=i.info,a=Date.now(),d=je(je({},s),{},{eventType:pn.WS_COMPRESSOR_INIT,lts:a,eventElapse:e.eventElapse,elapse:a-i.startTime,status:e.status?1:2});this.send({type:Mt.WS_COMPRESSOR_INIT,data:d},!0)}firstXLAPeerFirstVideoFrame(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=t.peerPubStatusMs-(n.lastJoinSuccessTime||i),a=je(je({},r),{},{elapse:i-n.startTime,eventType:pn.XLA_PEER_FIRST_VIDEO_FRAME,lts:i,peer:t.peer,width:t.width,height:t.height,ssrc:t.ssrc,p2pid:t.p2pid,peerPublishDuration:t.peerPublishDuration,joinChannelSuccessElapse:s,peerPubStatusMs:t.peerPubStatusMs-t.joinChannelStart,availablePublish:t.peerPublishDuration>s?1:0,preloadStart:Math.max(t.preloadStart-t.joinChannelStart,0),preloadEnd:Math.max(t.preloadEnd-t.joinChannelStart,0),encrypt:Math.max(t.apStart-t.joinChannelStart,0),ap:Math.max(t.apEnd-t.joinChannelStart,0),sua:Math.max(t.suaEnd-t.joinChannelStart,0),beforeConnect:Math.max(t.beforeConnect-t.joinChannelStart,0),peerRecevier:Math.max(t.peerReceiver-t.joinChannelStart,0),ice:Math.max(t.ice-t.joinChannelStart,0),pc:Math.max(t.pc-t.joinChannelStart,0),signalConnected:Math.max(t.signalConnected-t.joinChannelStart,0),joinReq:Math.max(t.joinReq-t.joinChannelStart,0),joinRes:Math.max(t.joinRes-t.joinChannelStart,0),userJoinNotify:Math.max(t.userJoinNotify-t.joinChannelStart,0),videoSsrcNotify:Math.max(t.videoAddNotify-t.joinChannelStart,0),subscribeDelayMs:Math.max(t.subscribeStart-t.videoAddNotify,0),subscribeStart:Math.max(t.subscribeStart-t.joinChannelStart,0),subscribeEnd:Math.max(t.subscribeEnd-t.joinChannelStart,0),firstReceived:Math.max(t.firstReceived-t.joinChannelStart,0),firstDecoded:Math.max(t.firstDecoded-t.joinChannelStart,0),firstPreRender:Math.max(t.firstPreRender-t.joinChannelStart,0),firstRender:Math.max(t.firstRender-t.joinChannelStart,0),playDelayMs:Math.max(t.playStart-t.subscribeEnd,0),playStart:Math.max(t.playStart-t.joinChannelStart,0),playEnd:Math.max(t.playEnd-t.joinChannelStart,0),isPreSub:t.isPreSub?1:0,isPrePc:t.isPrePc?1:0,isPreInstantVideo:t.isPreInstantVideo?1:0,firstReceivedEncodedFrame:t.firstReceivedEncodedFrame?Math.max(t.firstReceivedEncodedFrame-t.joinChannelStart,0):void 0,frameType:t.frameType||"",rtpTimestamp:t.rtpTimestamp||0,framePayloadType:t.framePayloadType||0,frameDataLength:t.frameDataLength||0,mimeType:t.mimeType||""});this.send({type:Mt.XLA_PEER_FIRST_VIDEO_FRAME,data:a},!0)}firstRemoteVideoDecode(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,a=Date.now(),d=je(je(je({},s),r),{},{elapse:a-i.startTime,eventType:t,lts:a,firstDecodeFrame:Math.max((r.firstFrame||a)-i.startTime,0),apEnd:Math.max(r.apEnd-i.startTime,0),apStart:Math.max(r.apStart-i.startTime,0),joinGwEnd:Math.max(r.joinGwEnd-i.startTime,0),joinGwStart:Math.max(r.joinGwStart-i.startTime,0),pcEnd:Math.max(r.pcEnd-i.startTime,0),pcStart:Math.max(r.pcStart-i.startTime,0),subscriberEnd:Math.max(r.subscriberEnd-i.startTime,0),subscriberStart:Math.max(r.subscriberStart-i.startTime,0),videoAddNotify:Math.max(r.videoAddNotify-i.startTime,0)});this.send({type:n,data:d},!0)}firstRemoteFrame(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,a=Date.now(),d=je(je(je({},s),r),{},{elapse:a-i.startTime,eventType:t,lts:a});this.send({type:n,data:d},!0)}abTest(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=je(je(je({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),elapse:i-n.startTime,eventType:pn.AB_TEST,lts:i});this.send({type:Mt.AB_TEST,data:s},!0)}pcStats(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=je(je(je({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),elapse:i-n.startTime,eventType:pn.PC_STATS,lts:i,preallocation:t.preallocation?1:0});this.send({type:Mt.PC_STATS,data:s},!0)}updateRemoteRTPCapabilities(e,t){if(e){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=je(je(je({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),eventType:pn.UPDATE_REMOTE_RTPCAPABILITIES,lts:i});this.send({type:Mt.UPDATE_REMOTE_RTPCAPABILITIES,data:s},!0)}}onGatewayStream(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,a=Date.now(),d=je(je(je({},s),r),{},{eventType:t,lts:a});this.send({type:n,data:d},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=je(je({},r),{},{eventType:pn.STREAM_SWITCH,lts:i,isDual:t.isdual,elapse:i-n.startTime,success:t.succ});this.send({type:Mt.STREAM_SWITCH,data:s},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=je(je({},r),{},{eventType:pn.REQUEST_PROXY_APPCENTER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Mt.REQUEST_PROXY_APPCENTER,data:s},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=je(je({},r),{},{eventType:pn.REQUEST_PROXY_WORKER_MANAGER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Mt.REQUEST_PROXY_WORKER_MANAGER,data:s},!0)}setProxyServer(e){this.proxyServer=e,e?T.debug("reportProxyServerurl: ".concat(e)):T.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=je(je({},r),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:i,elapse:i-n.startTime,joinChannelSuccessElapse:i-(n.lastJoinSuccessTime||i),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:Mt.PEER_PUBLISH_STATUS,data:s},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now();(function(s,a,d){const l=s[a];if(!l||typeof l!="string")return[s];s[a]="";const h=cs(JSON.stringify(s));let p=0;const _=[];let m=0;for(let g=0;g<l.length;g++)m+=l.charCodeAt(g)<=127?1:3,m<=d-h||(_[_.length]=ie(ie({},s),{},{[a]:l.substring(p,g)}),p=g,m=l.charCodeAt(g)<=127?1:3);return p!==l.length-1&&(_[_.length]=ie(ie({},s),{},{[a]:l.substring(p)})),_})(je(je(je({},r),t),{},{elapse:i-n.startTime,lts:i,productType:"WebRTC"}),"payload",1300).forEach(s=>this.send({type:Mt.WORKER_EVENT,data:s},!0))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=je(je(je({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:Mt.AP_WORKER_EVENT,data:s},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=je(je(je({},r),t),{},{elapse:i-n.startTime,lts:i,extend:t.extend||void 0});this.send({type:Mt.JOIN_WEB_PROXY_AP,data:s},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=je(je(je({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:Mt.WEBSOCKET_QUIT,data:s},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>A("CUSTOM_REPORT_LIMIT"))throw new Y(O.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),r=t.map(i=>({type:Mt.USER_ANALYTICS,data:je(je({sid:e},i),{},{lts:n})}));try{A("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(r):await this.postDataToStatsCollector(r)}catch(i){throw T.error("send custom report message failed",i.toString()),new Y(O.CUSTOM_REPORT_SEND_FAILED,i.message)}}sendApiInvoke(e){const t=A("NOT_REPORT_EVENT");if(e.tag&&te(t)&&te(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:r,uid:i,cid:s}=n.info;let a;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof Y){const{code:l,message:h}=e.error;a=l||h||e.error.toString()}else a=e.error.toString();const d={invokeId:e.invokeId,sid:e.sid,cname:r,cid:s,uid:i,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?a:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:Mt.API_INVOKE,data:d},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const t=Array.from(this.sids).find(n=>n!==null);t&&e.forEach(n=>{n&&(n.sid=t,this.sendApiInvoke(Object.assign({},n)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>A("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],r=[];for(;e.length;){const s=e.shift();n.length<20?n.push(s):r.push(s)}e.push(...r);for(const s of[...n]){var i;this.ltsList.indexOf(s.data.lts)!==-1?(s.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(s.data.lts)):(this.ltsList.push(s.data.lts),Ec(i=this.ltsList).call(i,(a,d)=>a-d))}return t||(this.lastSendNormalEventTime=Date.now()),A("ENABLE_EVENT_REPORT")&&n.length&&(A("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((s=>a=>{A("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(s):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(s),this.normalEventUploadPendingItems.length>A("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-A("NORMAL_EVENT_QUEUE_CAPACITY")),T.warning("report: drop normal events"))))})(n)),e}async postDataToStatsCollector2(e){Ht.networkState===fr.OFFLINE&&await ae.race([Ht.onlineWaiter,Tn(2*nn.maxRetryTimeout)]);const t=i=>{let s=new Uint8Array;return i.forEach(a=>{const d=Wv(JSON.stringify(a.data)),l=new ArrayBuffer(5),h=(_=>{let m=0;return Object.entries(Mt).forEach(g=>{let[w,R]=g;R===_.type&&(m=RJ[w])}),m})(a),p=new DataView(l);p.setUint16(0,d.byteLength,!0),p.setUint8(2,255&h),p.setUint8(3,h>>>8&255),p.setUint8(4,h>>>16&255),s=hL(s,new Uint8Array(l)),s=hL(s,d)}),s},n="event";let r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(A("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(A("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let i=0;i<2;i+=1){i===1&&(r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(A("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(A("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await $v(r,{timeout:1e4,data:t(e),headers:je(je({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(s){if(i===1)throw s;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=(d=>{const l=d&&d.data.sid&&this.baseInfoMap.get(d.data.sid);return l&&l.info.vid&&+l.info.vid||0})(e[0]),r=n?void 0:this._aid,i={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(d=>JSON.stringify(d)),vid:n,aid:r};Ht.networkState===fr.OFFLINE&&await ae.race([Ht.onlineWaiter,Tn(2*nn.maxRetryTimeout)]);const s=t?"/events/proto-raws":"/events/messages";let a=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(A("EVENT_REPORT_DOMAIN"),"&p=").concat(A("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(A("EVENT_REPORT_DOMAIN"),":").concat(A("STATS_COLLECTOR_PORT")).concat(s));for(let d=0;d<2;d+=1){d===1&&(a=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(A("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(A("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(A("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(A("STATS_COLLECTOR_PORT")).concat(s)));try{t?await aJ(a,{timeout:1e4,data:i}):await $v(a,{timeout:1e4,data:i})}catch(l){if(d===1)throw l;continue}return}}createBaseInfo(e,t){const n=Object.assign({},vJ);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),r=n[n.length-1];r&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:r,tag:yt.TRACER}).onSuccess()}};BL.on("REPORT_LOG_UPLOAD",e=>{e.networkState=Ht.networkState,Se.reportApiInvoke(null,{name:"logUploadError",options:e,tag:yt.TRACER}).onSuccess("logUploadError")});let j=class extends Y{constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Kt(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e,T)}throw(){super.throw(T)}};const vn={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1,supportSuppressLocalAudioPlayback:!1,supportRestrictOwnAudio:!1};function qe(){return vn}function WL(){return"setSinkId"in HTMLAudioElement.prototype&&(!A("RESTRICTION_SET_PLAYBACK_DEVICE")||(xs()||QP())&&!sL())}function H_(){return!vn.supportUnifiedPlan||A("CHROME_FORCE_PLAN_B")&&as()}function yh(e){return!(Nt()||ZP(87)||H_()||!A("ENABLE_PRE_SUB")&&(e==null||!e.autoSubscribe||A("FORCE_DISABLE_AUTO_SUB")))}function HL(e){return A("ENABLE_INSTANT_VIDEO")?A("ENABLE_INSTANT_VIDEO"):!(e==null||!e.autoSubscribe||A("FORCE_DISABLE_AUTO_SUB"))}function KL(){return navigator.mediaDevices&&"getSupportedConstraints"in navigator.mediaDevices}function YL(){if(KL()){const e=navigator.mediaDevices.getSupportedConstraints();return!(!("suppressLocalAudioPlayback"in e)||!e.suppressLocalAudioPlayback)}return No(141)||Ta(141)||wc(141)}function zL(){if(KL()){const e=navigator.mediaDevices.getSupportedConstraints();return!(!("restrictOwnAudio"in e)||!e.restrictOwnAudio)}return No(141)||Ta(141)||wc(125)}let Un=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function El(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function it(e,t,n,r,i){return{width:e,height:t,frameRate:n,bitrateMin:r,bitrateMax:i}}function io(e,t,n,r,i){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:r,bitrateMax:i}}function uR(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const yJ={"90p":it(160,90),"90p_1":it(160,90),"120p":it(160,120,15,30,65),"120p_1":it(160,120,15,30,65),"120p_3":it(120,120,15,30,50),"120p_4":it(212,120),"180p":it(320,180,15,30,140),"180p_1":it(320,180,15,30,140),"180p_3":it(180,180,15,30,100),"180p_4":it(240,180,15,30,120),"240p":it(320,240,15,40,200),"240p_1":it(320,240,15,40,200),"240p_3":it(240,240,15,40,140),"240p_4":it(424,240,15,40,220),"360p":it(640,360,15,80,400),"360p_1":it(640,360,15,80,400),"360p_3":it(360,360,15,80,260),"360p_4":it(640,360,30,80,600),"360p_6":it(360,360,30,80,400),"360p_7":it(480,360,15,80,320),"360p_8":it(480,360,30,80,490),"360p_9":it(640,360,15,80,800),"360p_10":it(640,360,24,80,800),"360p_11":it(640,360,24,80,1e3),"480p":it(640,480,15,100,500),"480p_1":it(640,480,15,100,500),"480p_2":it(640,480,30,100,1e3),"480p_3":it(480,480,15,100,400),"480p_4":it(640,480,30,100,750),"480p_6":it(480,480,30,100,600),"480p_8":it(848,480,15,100,610),"480p_9":it(848,480,30,100,930),"480p_10":it(640,480,10,100,400),"720p":it(1280,720,15,120,1130),"720p_auto":it(1280,720,30,900,3e3),"720p_1":it(1280,720,15,120,1130),"720p_2":it(1280,720,30,120,2e3),"720p_3":it(1280,720,30,120,1710),"720p_5":it(960,720,15,120,910),"720p_6":it(960,720,30,120,1380),"1080p":it(1920,1080,15,120,2080),"1080p_1":it(1920,1080,15,120,2080),"1080p_2":it(1920,1080,30,120,3e3),"1080p_3":it(1920,1080,30,120,3150),"1080p_5":it(1920,1080,60,120,4780),"1440p":it(2560,1440,30,120,4850),"1440p_1":it(2560,1440,30,120,4850),"1440p_2":it(2560,1440,60,120,7350),"4k":it(3840,2160,30,120,8910),"4k_1":it(3840,2160,30,120,8910),"4k_3":it(3840,2160,60,120,13500)},CJ={"480p":io(640,480,5),"480p_1":io(640,480,5),"480p_2":io(640,480,30),"480p_3":io(640,480,15),"720p":io(1280,720,5),"720p_auto":it(1280,720,30,900,3e3),"720p_1":io(1280,720,5),"720p_2":io(1280,720,30),"720p_3":io(1280,720,15),"1080p":io(1920,1080,5),"1080p_1":io(1920,1080,5),"1080p_2":io(1920,1080,30),"1080p_3":io(1920,1080,15)},IJ={"1SL1TL":uR(1,1),"3SL3TL":uR(3,3),"2SL3TL":uR(2,3)};function oo(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},yJ[e]):e}function hR(e){return typeof e=="string"?Object.assign({},CJ[e]):e}function K_(e){return typeof e=="string"?Object.assign({},IJ[e]):e}const wJ={speech_low_quality:El(16e3,!1),speech_standard:El(32e3,!1,18),music_standard:El(48e3,!1),standard_stereo:El(48e3,!0,56),high_quality:El(48e3,!1,128),high_quality_stereo:El(48e3,!0,192)};function Y_(e){return typeof e=="string"?Object.assign({},wJ[e]):e}const Mc=[];function qL(e){return tn(e,"mediaSource",["screen","window","application"]),!0}let Te=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),lt=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),gl=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),AJ=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),bJ=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),Uc=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),Sl=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),Li=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e.PLAY_START="play-start",e.PLAY_END="play-end",e.FIRST_FRAME_RENDER="first-frame-render",e}({}),Tl=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),ui=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const pR={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},fR={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},XL={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},OJ={uplinkNetworkQuality:0,downlinkNetworkQuality:0},JL={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let mr=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),hi=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),Ch=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),xc=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),zn=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),ds=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const _R={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let z_=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function $e(e,t,n,r,i){var s,a,d={};return Object.keys(r).forEach(function(l){d[l]=r[l]}),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=Oi(s=CA(a=n.slice()).call(a)).call(s,function(l,h){return h(e,t,l)||l},d),i&&d.initializer!==void 0&&(d.value=d.initializer?d.initializer.call(i):void 0,d.initializer=void 0),d.initializer===void 0?(Object.defineProperty(e,t,d),null):d}function H(e,t,n){return(t=function(r){var i=function(s,a){if(typeof s!="object"||!s)return s;var d=s[Symbol.toPrimitive];if(d!==void 0){var l=d.call(s,"string");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(r);return typeof i=="symbol"?i:i+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function QL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Ot(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?QL(Object(n),!0).forEach(function(r){H(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):QL(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class ZL extends Vt{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(Uc.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,n){super(),H(this,"trackMediaType",void 0),H(this,"_ID",void 0),H(this,"_rtpTransceiver",void 0),H(this,"_lowRtpTransceiver",void 0),H(this,"_hints",[]),H(this,"_isClosed",!1),H(this,"_originMediaStreamTrack",void 0),H(this,"mediaStreamTrack",void 0),H(this,"_external",{}),this._ID=n||ht(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,function(r){te(Mc).call(Mc,r)||Mc.push(r)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||va(()=>{var n;Se.reportApiInvoke(null,{name:kt.GET_MEDIA_STREAM_TRACK,options:[],tag:yt.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===gl.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){const n=Mc.indexOf(t);n!==-1&&Mc.splice(n,1)}(this),this.emit(Sl.CLOSED),this.removeAllListeners(Uc.SEI_RECEIVED)}_updateRtpTransceiver(t,n){if(n===gl.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(Uc.TRANSCEIVER_UPDATED,t,n)}}class vl extends ZL{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,n){super(t,n),H(this,"_enabled",!0),H(this,"_muted",!1),H(this,"_isExternalTrack",!1),H(this,"_isClosed",!1),H(this,"_enabledMutex",void 0),H(this,"processor",void 0),H(this,"_processorContext",void 0),H(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new bn("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,n;return(t=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,T.debug("[".concat(this.getTrackId(),"] close")),this.emit(Te.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,n){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=r,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await wt(this,Te.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){T.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Sl.TRACK_ENDED)}stateCheck(t,n){if(T.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(n,"]")),to(n,t),this._enabled&&this._muted&&t==="enabled"&&n===!1)throw new Y(O.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",T);if(!this._enabled&&!this._muted&&t==="muted"&&n===!0)throw new Y(O.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",T)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():ae.resolve([])}}const $L=window.AudioContext||window.webkitAudioContext;let mR,pi=null;const Tt=new class extends Vt{constructor(){super(...arguments),H(this,"prevState",void 0),H(this,"curState",void 0),H(this,"currentTime",void 0),H(this,"currentTimeStuckAt",void 0),H(this,"interruptDetectorTrack",void 0),H(this,"onLocalAudioTrackMute",()=>{T.info("ios15-interruption-start"),this.emit(Un.IOS_15_16_INTERRUPTION_START)}),H(this,"onLocalAudioTrackUnmute",async()=>{T.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?T.info("ios15-interruption-end-canceled"):(pi&&await pi.suspend(),this.emit(Un.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){T.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){T.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Rl(){if(!pi){if(function(){if(!$L)return void T.error("your browser is not support web audio");T.info("create audio context");const e=Ot({},A("WEBAUDIO_INIT_OPTIONS"));T.debug("audio context init option:",JSON.stringify(e)),pi=new $L(e),Tt.curState=pi.state,pi.onstatechange=()=>{Tt.prevState=Tt.curState,Tt.curState=pi?pi.state:void 0;const{prevState:t,curState:n}=Tt,r=n==="running",i=n==="interrupted",s=t==="running",a=t==="suspended",d=t==="interrupted",l=rt().osVersion;(tr()||eo())&&s&&i&&(T.info("ios".concat(l,"-interruption-start")),Tt.emit(Un.IOS_INTERRUPTION_START)),(tr()||eo())&&(a||d)&&r&&(T.info("ios".concat(l,"-interruption-end")),Tt.emit(Un.IOS_INTERRUPTION_END)),t!==n&&Tt.emit(Un.STATE_CHANGE,n,t)},setInterval(()=>{var t;const n=(t=pi)===null||t===void 0?void 0:t.currentTime;Tt.currentTime!==n?(Tt.currentTimeStuckAt&&(T.debug("AudioContext current time resume at ".concat(n)),Tt.currentTimeStuckAt=void 0),Tt.currentTime=n):(n!==Tt.currentTimeStuckAt&&(Se.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:yt.TRACER}).onSuccess(),T.warning("AudioContext current time stuck at ".concat(n))),Tt.currentTimeStuckAt=n)},5e3),async function(t){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let r,i,s=!1,a=!1,d=!1;function l(b){t.state==="running"?h(!1):tr()||eo()?t.state==="suspended"&&(h(!0),b&&t.resume().then(p,p)):t.state!=="closed"&&(h(!0),b&&t.resume().then(p,p))}function h(b){if(s!==b){s=b;for(let N=0,L=n;N<L.length;N+=1){const x=L[N];b?window.addEventListener(x,_,{capture:!0,passive:!0}):window.removeEventListener(x,_,{capture:!0,passive:!0})}}}function p(){l(!1)}function _(){l(!0)}function m(){let b;try{b=r.play(),b?b.then(R,R):(r.addEventListener("playing",R),r.addEventListener("abort",R),r.addEventListener("error",R))}catch{R()}}function g(b){d||(r.paused?b?(w(!1),d=!0,m()):w(!0):w(!1))}function w(b){if(a!==b){a=b;for(let N=0,L=n;N<L.length;N++){const x=L[N];b?window.addEventListener(x,y,{capture:!0,passive:!0}):window.removeEventListener(x,y,{capture:!0,passive:!0})}}}function R(){r.removeEventListener("playing",R),r.removeEventListener("abort",R),r.removeEventListener("error",R),d=!1,g(!1)}function y(){g(!0)}if(tr()&&A("IOS_BG_TAG")){const b=t.createMediaStreamDestination(),N=document.createElement("div");N.innerHTML="<audio x-webkit-airplay='deny'></audio>",r=N.children.item(0),r.controls=!1,r.disableRemotePlayback=!0,r.preload="auto",r.srcObject=b.stream,i=()=>{if(A("IOS_AUTO_RESTART_BG_TAG")&&r&&r.srcObject&&!d&&(!r.paused||a!==!0)){r.paused||r.pause();try{d=!0,m()}catch{d=!1}return!0}},g(!0)}return Tt.on(Un.STATE_CHANGE,function(){l(!0)}),l(!1),i}(pi).then(t=>{mR=t})}(),!pi)throw new Y(O.NOT_SUPPORTED,"can not create audio context");return pi}return pi}function Vc(e){if(function(){if(ER!==null)return ER;const r=Rl(),i=r.createBufferSource(),s=r.createGain(),a=r.createGain();i.connect(s),i.connect(a),i.disconnect(s);let d=!1;try{i.disconnect(s)}catch{d=!0}return i.disconnect(),ER=d,d}())return;const t=e.connect,n=e.disconnect;e.connect=(r,i,s)=>{var a;return e._inputNodes||(e._inputNodes=[]),te(a=e._inputNodes).call(a,r)||(r instanceof AudioNode?(e._inputNodes.push(r),t.call(e,r,i,s)):t.call(e,r,i)),e},e.disconnect=(r,i,s)=>{n.call(e),r?k_(e._inputNodes,r):e._inputNodes=[];for(const a of e._inputNodes)t.call(e,a)}}let ER=null;function gR(e,t){let n=!1;const r=1/t;if(A("DISABLE_WEBAUDIO")){const i=window.setInterval(()=>{n?window.clearInterval(i):e(performance.now()/1e3)},1e3*r)}else{const i=Rl();let s=i.createGain();s.gain.value=0,s.connect(i.destination);const a=()=>{if(n)return void(s=null);const d=i.createOscillator();d.onended=a,d.connect(s),d.start(0),d.stop(i.currentTime+r),e(i.currentTime)};a()}return()=>{n=!0}}class ek{constructor(){H(this,"context",void 0),H(this,"analyserNode",void 0),H(this,"sourceNode",void 0),this.context=Rl(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||tr()||eo()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const r=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(r);for(let i=0;i<t.length;++i)t[i]=r[i]/128-1}const n=Oi(t).call(t,(r,i)=>r+i*i,0)/t.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,n;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{T.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class tk extends Vt{get processSourceNode(){return this.sourceNode}set processedNode(t){var n;if(!this.isDestroyed&&this._processedNode!==t){try{var r;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),H(this,"outputNode",void 0),H(this,"outputTrack",void 0),H(this,"isPlayed",!1),H(this,"sourceNode",void 0),H(this,"context",void 0),H(this,"audioBufferNode",void 0),H(this,"destNode",void 0),H(this,"audioOutputLevel",0),H(this,"volumeLevelAnalyser",void 0),H(this,"_processedNode",void 0),H(this,"playNode",void 0),H(this,"isDestroyed",!1),H(this,"onNoAudioInput",void 0),H(this,"isNoAudioInput",!1),H(this,"_noAudioInputCount",0),this.context=Rl(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Vc(this.outputNode),this.volumeLevelAnalyser=new ek}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(ui.ON_AUDIO_BUFFER,function(r){for(let i=0;i<r.outputBuffer.numberOfChannels;i+=1){const s=r.outputBuffer.getChannelData(i);for(let a=0;a<s.length;a+=1)s[a]=0}return r.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!qe().webAudioMediaStreamDest)throw new Y(O.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&M_(()=>{Tt.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;tr()||eo()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let r;n.getFloatTimeDomainData?(r=new Float32Array(n.fftSize),n.getFloatTimeDomainData(r)):(r=new Uint8Array(n.fftSize),n.getByteTimeDomainData(r));let i=!1;for(let s=0;s<r.length;s++)r[s]!==0&&(i=!0);return i?(this.isNoAudioInput=!1,!0):(await Tn(200),await this.checkHasAudioInput(t?t+1:1)&&i)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,n;(t=this.processedNode)===null||t===void 0||t.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class SR extends tk{get isFreeze(){return!1}constructor(t,n,r){var i;if(super(),H(this,"sourceNode",void 0),H(this,"track",void 0),H(this,"clonedTrack",void 0),H(this,"audioElement",void 0),H(this,"isCurrentTrackCloned",!1),H(this,"isRemoteTrack",!1),H(this,"originVolumeLevelAnalyser",void 0),H(this,"rebuildWebAudio",async()=>{if(T.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void T.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>T.info("resume success")),T.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const d=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?d.stop():this.isCurrentTrackCloned=!0;const l=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(l),Vc(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const h=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(h,this.context.currentTime),Vc(this.outputNode),this.emit(ui.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=l,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new Y(O.UNEXPECTED_ERROR);this.track=t;const s=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(s),Vc(this.sourceNode),r){const d=r.clone();d.enabled=!0,this.clonedTrack=d,T.debug("create an unmuted track ".concat(d.id," from the original track ").concat(r.id," to get the volume"));const l=this.context.createMediaStreamSource(new MediaStream([d]));Vc(l),this.originVolumeLevelAnalyser=new ek,this.originVolumeLevelAnalyser.updateSource(l)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=s;const a=rt();n&&a.os===Sn.IOS&&Number((i=a.osVersion)===null||i===void 0?void 0:i.split(".")[0])<15&&(Tt.on(Un.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(d=>{d||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const n=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(n),Vc(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(ui.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),Tt.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const n=t.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),T.debug("create an unmuted track ".concat(n.id," from the original track ").concat(t.id," to get the volume"));const r=this.context.createMediaStreamSource(new MediaStream([n]));Vc(r),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(r)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function nk(e,t,n){const r=(s,a)=>s?typeof s!="number"?s.max||s.exact||s.ideal||s.min||a:s:a,i={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:r(t.height,1080),maxWidth:r(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(i.video.mandatory.maxFrameRate=t.frameRate.max,i.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(i.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(i)}async function NJ(e,t){const n=await rk(e.mediaSource),{sourceId:r,audio:i}=await function(s){let a=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new ae((d,l)=>{const h=document.createElement("div");h.innerText="share screen",h.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const p=document.createElement("div");p.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const _=document.createElement("div");_.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",_.setAttribute("style","height: 12%;");const m=document.createElement("div");m.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const g=document.createElement("div");g.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const w=document.createElement("button");w.innerHTML="cancel",w.setAttribute("style","width: 85px;"),w.onclick=()=>{document.body.removeChild(b);const N=new Error("NotAllowedError");N.name="NotAllowedError",l(N)};let R=a;const y=document.createElement("div");if(a){const N=document.createElement("input");N.setAttribute("type","checkbox");const L=document.createElement("span");N.setAttribute("style","margin-right: 6px;"),L.innerText="Share audio",N.checked=R,N.onchange=()=>{R=N.checked},y.appendChild(N),y.appendChild(L)}g.appendChild(y),g.appendChild(w),p.appendChild(_),p.appendChild(m),p.appendChild(g);const b=document.createElement("div");b.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),b.appendChild(h),b.appendChild(p),document.body.appendChild(b),s.map(N=>{if(N.id){const L=document.createElement("div");L.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let x=N.thumbnail;try{const{width:F}=x.getSize();F>1920&&(x=x.resize({width:1920}))}catch(F){throw F&&F.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),F}L.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+x.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+N.name.replace(/[\u00A0-\u9999<>\&]/g,function(F){return"&#"+F.charCodeAt(0)+";"})+"</span>",L.onclick=()=>{document.body.removeChild(b),d({sourceId:N.id,audio:R})},m.appendChild(L)}})})}(n,t);return await nk(r,e,i)}async function rk(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const n=pL();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new Y(O.ELECTRON_IS_NULL);let r=null;try{var i;r=((i=n.desktopCapturer)===null||i===void 0?void 0:i.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{r=null}r&&r.then||(r=new ae((s,a)=>{n.desktopCapturer.getSources({types:t},(d,l)=>{d?a(d):s(l)})}));try{return await r}catch(s){throw new Y(O.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,s.toString())}}const TR=new bn("safari");let ik=!1,ok=!1;async function fi(e,t){let n=0,r=null;for(;n<2;)try{r=await DJ(e,t,n>0);break}catch(i){if(i instanceof Y)throw T.error("[".concat(t,"] ").concat(i.toString())),i;const s=q_(i.name||i.code||i,i.message);if(s.code===O.MEDIA_OPTION_INVALID){T.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await Tn(500);continue}throw T.error("[".concat(t,"] ").concat(s.toString())),s}if(!r)throw new Y(O.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r}async function DJ(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Y(O.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const r=qe(),i=new MediaStream;if(e.audioSource&&i.addTrack(e.audioSource),e.videoSource&&i.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return T.debug("Using Video Source/ Audio Source"),i;if(e.screen)if(pL())e.screen.sourceId?yl(i,await nk(e.screen.sourceId,e.screen,!!e.screenAudio)):yl(i,await NJ(e.screen,!!e.screenAudio));else if(xs()&&e.screen.extensionId&&e.screen.mandatory){if(!r.getStreamFromExtension)throw new Y(O.NOT_SUPPORTED,"This browser does not support screen sharing");T.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const m=await(a=e.screen.extensionId,d=t,new ae((g,w)=>{try{chrome.runtime.sendMessage(a,{getStream:!0},R=>{if(!R||!R.streamId)return T.error("[".concat(d,"] No response from Chrome Plugin. Plugin not installed properly"),R),void w(new Y(O.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));g(R.streamId)})}catch(R){T.error("[".concat(d,"] AgoraRTC screensharing plugin is not accessible(").concat(a,")"),R.toString()),w(new Y(O.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=m,yl(i,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(r.getDisplayMedia){var s;e.screen.mediaSource&&qL(e.screen.mediaSource);const m={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(s=e.screen.displaySurface)!==null&&s!==void 0?s:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:g,surfaceSwitching:w,systemAudio:R,preferCurrentTab:y,windowAudio:b,monitorTypeSurfaces:N}=e.screen,L={selfBrowserSurface:g,surfaceSwitching:w,systemAudio:R,preferCurrentTab:y,windowAudio:b,monitorTypeSurfaces:N};!g&&delete L.selfBrowserSurface,!w&&delete L.surfaceSwitching,!R&&delete L.systemAudio,!y&&delete L.preferCurrentTab,!b&&delete L.windowAudio,!N&&delete L.monitorTypeSurfaces,T.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:m,audio:e.screenAudio,controls:L})),yl(i,await navigator.mediaDevices.getDisplayMedia(Ot({video:m,audio:e.screenAudio},L)))}else{if(!Nt())throw T.error("[".concat(t,"] This browser does not support screenSharing")),new Y(O.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&qL(e.screen.mediaSource);const m={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};T.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(m))),yl(i,await navigator.mediaDevices.getUserMedia(m))}}var a,d;if(!e.video&&!e.audio)return i;let l={video:e.video,audio:e.audio},h=A("MEDIA_DEVICE_CONSTRAINTS");if(h)try{typeof h=="string"&&(h=JSON.parse(h)),l=qv(l,h)}catch{}T.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(l)),rt();let p,_=null;(An()||tr()||L_())&&(_=await TR.lock());try{p=await navigator.mediaDevices.getUserMedia(l)}catch(m){throw _&&_(),m}return l.audio&&(ik=!0),l.video&&(ok=!0),yl(i,p),_&&_(),i}function q_(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Y(O.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new Y(O.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new Y(O.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new Y(O.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Y(O.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new Y(O.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return T.error("getUserMedia unexpected error",e),new Y(O.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function yl(e,t){const n=e.getVideoTracks()[0],r=e.getAudioTracks()[0],i=t.getVideoTracks()[0],s=t.getAudioTracks()[0];s&&(r&&e.removeTrack(r),e.addTrack(s)),i&&(n&&e.removeTrack(n),e.addTrack(i))}const _i=new class extends Vt{get state(){return this._state}set state(e){e!==this._state&&(this.emit(xc.STATE_CHANGE,e),this._state=e)}constructor(){super(),H(this,"_state",Ch.IDLE),H(this,"isAccessMicrophonePermission",!1),H(this,"isAccessCameraPermission",!1),H(this,"lastAccessMicrophonePermission",!1),H(this,"lastAccessCameraPermission",!1),H(this,"checkdeviceMatched",!1),H(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(A("ENUMERATE_DEVICES_INTERVAL")||(_h()||P_()===Sn.HARMONY_OS)&&as())&&this.updateDevicesInfo()},A("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>T.error(e.toString()))}async enumerateDevices(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)throw new Y(O.NOT_SUPPORTED,"enumerateDevices() not supported.");const r=await navigator.mediaDevices.enumerateDevices(),i=this.checkMediaDeviceInfoIsOk(r);let s=!this.isAccessMicrophonePermission&&e,a=!this.isAccessCameraPermission&&t;i.audio&&(s=!1),i.video&&(a=!1);let d=null,l=null,h=null;if(!n&&(s||a)){if(TR.isLocked&&(T.debug("[device manager] wait GUM lock"),(await TR.lock())(),T.debug("[device manager] GUM unlock")),ik&&(s=!1,this.isAccessMicrophonePermission=!0),ok&&(a=!1,this.isAccessCameraPermission=!0),T.debug("[device manager] check media device permissions",e,t,s,a),s&&a){try{h=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(p){const _=q_(p.name||p.code||p,p.message);if(_.code===O.PERMISSION_DENIED)throw _;T.warning("getUserMedia failed in getDevices",_)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(s){try{d=await navigator.mediaDevices.getUserMedia({audio:e})}catch(p){const _=q_(p.name||p.code||p,p.message);if(_.code===O.PERMISSION_DENIED)throw _;T.warning("getUserMedia failed in getDevices",_)}this.isAccessMicrophonePermission=!0}else if(a){try{l=await navigator.mediaDevices.getUserMedia({video:t})}catch(p){const _=q_(p.name||p.code||p,p.message);if(_.code===O.PERMISSION_DENIED)throw _;T.warning("getUserMedia failed in getDevices",_)}this.isAccessCameraPermission=!0}T.debug("[device manager] mic permission",e,"cam permission",t)}try{const p=await navigator.mediaDevices.enumerateDevices();return d&&d.getTracks().forEach(_=>_.stop()),l&&l.getTracks().forEach(_=>_.stop()),h&&h.getTracks().forEach(_=>_.stop()),d=null,l=null,h=null,p}catch(p){return d&&d.getTracks().forEach(_=>_.stop()),l&&l.getTracks().forEach(_=>_.stop()),h&&h.getTracks().forEach(_=>_.stop()),d=null,l=null,h=null,new Y(O.ENUMERATE_DEVICES_FAILED,p.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(n=>{n.device.label===e&&(t=n.device.deviceId)}),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===e);if(!t)throw new Y(O.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=Ch.INITING;try{await this.updateDevicesInfo(),this.state=Ch.INITEND}catch(e){throw this.state=Ch.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")?(T.warning("Device Detection functionality cannot start properly.",e.toString()),e):new Y(O.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.")}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const i=e.find(a=>a.kind==="audioinput"&&a.deviceId==="default"),s=e.find(a=>a.kind==="audiooutput"&&a.deviceId==="default");i&&s?s.groupId===i.groupId?T.debug("[device-check] default input ".concat(i.label," and output ").concat(s.label," is the same group")):T.debug("[device-check] default input ".concat(i.label," and output ").concat(s.label," is not the same group")):T.debug("[device-check] default input or output not found")}const r=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(i=>{if(!i.deviceId)return;const s=this.deviceInfoMap.get("".concat(i.kind,"_").concat(i.deviceId));if((s?s.state:"INACTIVE")!=="ACTIVE"){const a={initAt:t,updateAt:t,device:i,state:"ACTIVE"};this.deviceInfoMap.set("".concat(i.kind,"_").concat(i.deviceId),a),n.push(a)}s&&(s.updateAt=t)}),this.deviceInfoMap.forEach((i,s)=>{i.state==="ACTIVE"&&i.updateAt!==t&&(i.state="INACTIVE",n.push(i))}),this.state!==Ch.INITEND)return r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(i=>{switch(i.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(xc.RECORDING_DEVICE_CHANGED,i);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(xc.CAMERA_DEVICE_CHANGED,i);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(xc.PLAYOUT_DEVICE_CHANGED,i)}}),r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter(i=>i.kind==="audioinput"),n=e.filter(i=>i.kind==="videoinput"),r={audio:!1,video:!1};for(const i of t)if(i.label&&i.deviceId){r.audio=!0;break}for(const i of n)if(i.label&&i.deviceId){r.video=!0;break}return r}};let vR=!1;const wr=new class extends Vt{constructor(){super(...arguments),H(this,"onAutoplayFailed",void 0),H(this,"onAudioAutoplayFailed",void 0)}};function sk(){if(vR)return A("FLS_AUTOPLAY_EMITS")?(wr.onAutoplayFailed&&wr.onAutoplayFailed(),wr.emit("autoplay-failed")):void 0;{const e=t=>{t.preventDefault(),vR=!1,mh()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};vR=!0,mh()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),T.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),wr.onAutoplayFailed?wr.onAutoplayFailed():wr.onAudioAutoplayFailed?T.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):T.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),wr.emit("autoplay-failed")}}function ak(e,t,n,r){if(!e)return;const i=Se.getBaseInfoBySessionId(e);if(!i)return;const s=i.info,a=Date.now(),d=Ot(Ot({},s),{},{vid:s.vid===void 0?0:Number(s.vid),lts:a,elapse:a-i.startTime,cbRegistered:wr.onAutoplayFailed||wr.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:r,extend:void 0});Se.send({type:Mt.AUTOPLAY_FAILED,data:d},!0)}const PJ=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],or=new class{constructor(){H(this,"onAutoplayFailed",void 0),H(this,"elementMap",new Map),H(this,"elementStateMap",new Map),H(this,"elementsNeedToResume",[]),H(this,"sinkIdMap",new Map),H(this,"autoResumeAfterInterruption",e=>ae.all(Array.from(this.elementMap.entries()).map(async t=>{let[n,r]=t;const i=this.elementStateMap.get(n),s=r.srcObject.getAudioTracks()[0],a=s&&s.readyState;if(T.debug("resume after interrupted, ele: ".concat(i," audio: ").concat(a," ").concat(e)),a==="live"){if(e)return r.pause(),r.play();if(Tt.curState==="running")return dl()?(r.pause(),r.play()):i&&i==="paused"?r.play():void 0}}))),H(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e;const r=n.srcObject.getAudioTracks()[0];r&&r.readyState==="live"&&(T.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),Tt.on(Un.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Tt.on(Un.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Tt.on(Un.STATE_CHANGE,()=>{tr()&&Tt.prevState==="suspended"&&Tt.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(r){throw new Y(O.PERMISSION_DENIED,"can not set sink id: "+r.toString())}}play(e,t,n,r){if(this.elementMap.has(t))return;const i=document.createElement("audio");i.autoplay=!0,i.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,i),this.elementMap.set(t,i),this.elementStateMap.set(t,zn.INIT),this.setVolume(t,n);const s=this.sinkIdMap.get(t);if(s)try{i.setSinkId(s).catch(d=>{T.warning("[".concat(t,"] set sink id failed"),d.toString())})}catch(d){T.warning("[".concat(t,"] set sink id failed"),d.toString())}const a=i.play();a&&a.then&&a.catch(d=>{r&&ak(r,"audio",d.message,t),T.warning("audio element play warning",d.toString()),this.elementMap.has(t)&&d.name==="NotAllowedError"&&(T.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(i),M_(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),sk()}))})}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}getVolume(e){const t=this.elementMap.get(e);return t?t.volume:0}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){PJ.forEach(n=>{t.addEventListener(n,r=>{const i=this.elementStateMap.get(e),s=r.type==="pause"?"paused":r.type;if(T.debug("[".concat(e,"] audio-element-status change ").concat(i," => ").concat(s)),r.type==="error"){const a=t==null?void 0:t.error;a&&T.error("[".concat(e,"] media error, code: ").concat(a.code,", message: ").concat(a.message))}this.elementStateMap.set(e,s)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(n=>{T.debug("Auto resume audio element success")}).catch(n=>{T.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new ae(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{mh()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function qt(){return function(e,t,n){const r=n.value;return typeof r=="function"&&(n.value=function(){this._isClosed&&new Y(O.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",T);for(var i=arguments.length,s=new Array(i),a=0;a<i;a++)s[a]=arguments[a];const d=r.apply(this,s);return d instanceof ae?new ae((l,h)=>{d.then(l).catch(h)}):d}),n}}class ck extends Vt{constructor(t){super(),H(this,"name","VideoProcessorDestination"),H(this,"ID","0"),H(this,"_source",void 0),H(this,"videoContext",void 0),H(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Y(O.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Y(O.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(mr.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(mr.ON_TRACK,void 0)}}class dk extends Vt{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n){super(),H(this,"constraintsMap",new Map),H(this,"statsRegistry",[]),H(this,"usageRegistry",[]),H(this,"trackId",void 0),H(this,"direction",void 0),H(this,"_chained",!1),this.trackId=t,this.direction=n}async getConstraints(){return await dn(this,hi.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,n){var r;return T.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),wt(this,hi.REQUEST_UPDATE_CONSTRAINTS,Array.from(Xr(r=this.constraintsMap).call(r)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return T.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),wt(this,hi.REQUEST_UPDATE_CONSTRAINTS,Array.from(Xr(n=this.constraintsMap).call(n)))}registerStats(t,n,r){this.statsRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:r})}unregisterStats(t,n){const r=this.statsRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:r,type:i,cb:s}of this.statsRegistry)try{const a=s();t.push({processorID:n,processorName:r,type:i,stats:a})}catch(a){T.error(new Y(O.UNEXPECTED_ERROR,a.message))}return t}registerUsage(t,n){this.usageRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let r=n();r instanceof ae&&(r=await r),t.push(Ot(Ot({},r),{},{direction:this.direction}))}catch(r){T.error("gather extension usage error",r)}return t}getDirection(){return this.direction}}class lk extends Vt{constructor(t){super(),H(this,"name","AudioProcessorDestination"),H(this,"ID","0"),H(this,"inputTrack",void 0),H(this,"inputNode",void 0),H(this,"audioProcessorContext",void 0),H(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Y(O.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Y(O.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(mr.ON_TRACK,void 0),this.emit(mr.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(mr.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(mr.ON_NODE,this.inputNode))}}class uk extends Vt{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n,r){super(),H(this,"constraintsMap",new Map),H(this,"statsRegistry",[]),H(this,"audioContext",void 0),H(this,"trackId",void 0),H(this,"direction",void 0),H(this,"usageRegistry",[]),H(this,"_chained",!1),this.audioContext=t,this.trackId=n,this.direction=r}async getConstraints(){return dn(this,hi.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,n){var r;return T.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),wt(this,hi.REQUEST_UPDATE_CONSTRAINTS,Array.from(Xr(r=this.constraintsMap).call(r)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),wt(this,hi.REQUEST_UPDATE_CONSTRAINTS,Array.from(Xr(n=this.constraintsMap).call(n)))}registerStats(t,n,r){this.statsRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:r})}unregisterStats(t,n){const r=this.statsRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:r,type:i,cb:s}of this.statsRegistry)try{const a=s();t.push({processorID:n,processorName:r,type:i,stats:a})}catch(a){T.error(new Y(O.UNEXPECTED_ERROR,a.message))}return t}registerUsage(t,n){this.usageRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let r=n();r instanceof ae&&(r=await r),t.push(Ot(Ot({},r),{},{direction:this.direction}))}catch(r){T.error("gather extension usage error",r)}return t}getDirection(){return this.direction}}class RR extends Vt{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),H(this,"context",void 0),H(this,"processSourceNode",void 0),H(this,"outputTrack",void 0),H(this,"processedNode",void 0),H(this,"clonedTrack",void 0),H(this,"outputNode",void 0),this.outputNode=new LJ}setVolume(){}createOutputTrack(){throw new Y(O.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class LJ{disconnect(){}connect(){}}function hk(e){return new ae((t,n)=>{let r=!1;const i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.muted=!0,i.autoplay=!0,i.setAttribute("playsinline",""),i.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i);const s=tr()?"canplay":"playing";i.addEventListener(s,()=>{const a=i.videoWidth,d=i.videoHeight;!a&&Nt()||(r=!0,i.srcObject=null,i.remove(),t([a,d]))}),i.srcObject=new MediaStream([e]),i.play().catch(Sh),setTimeout(()=>{r||(i.srcObject=null,i.remove(),t([i.videoWidth,i.videoHeight]))},4e3)})}function X_(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=oo(e.encoderConfig);return n.width!=null&&(t.width=n.width),n.height!=null&&(t.height=n.height),!oL()&&n.frameRate&&(t.frameRate=n.frameRate),QP()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),Nt()&&(t.frameRate={ideal:30,max:30}),t}function pk(e){const t={};return oL()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,xs()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function fk(e){const t=pk(e);if(e.encoderConfig){const n=Y_(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),_h()&&(t.sampleRate=void 0),t}const _k=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:n,width:r,height:i}=e.getMediaStreamTrackSettings();let{frameRate:s=n,width:a=r,height:d=i}=t;if(!s||!a||!d)return;a=hl(a),d=hl(d),s=hl(s);const{max:l,min:h}=function(g,w,R){const y=200*Math.pow(R/15,.6)*Math.pow(g*w/640/360,.75);return{min:Math.floor(y),max:Math.floor(4*y)}}(a,d,s),{bitrateMax:p,bitrateMin:_}=t||{};p||T.debug("calculate bitrate: [w: ".concat(a,", h: ").concat(d,", fps: ").concat(s,"] => [brMax: ").concat(p,", brMin: ").concat(_,"]"));const{maxFramerate:m}=A("ENCODER_CONFIG_LIMIT");return m&&typeof m=="number"&&(s=Math.min(s,m)),{frameRate:s,bitrateMax:p||l,bitrateMin:_||h,scaleResolutionDownBy:1,scale:0}},mk=async(e,t,n)=>await(async(r,i,s)=>{const a=function(h){const p=[];for(let _=0;_<h.length;_+=2)p.push(parseInt(h.slice(_,_+2),16));return Uint8Array.from(p)}(IL(""+i+s)).slice(0,16),d=a.slice(0,12),l=await window.crypto.subtle.importKey("raw",a,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:d},l,r))})(e.buffer,t,n),yR=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new ae((n,r)=>{t.toBlob(async i=>{if(t.remove(),i){const s=await Ek(i);n({buffer:s,width:t.width,height:t.height})}else r(new Y(O.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},Ek=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var gk,Sk,Tk,vk,Rk,yk,Ck,Ik,wk,Ak,bk,Ok,Nk,Dk,Pk,Lk,kk,Mk,Gt,Uk,xk,Vk,Fk,Bk,jk,ls,Gk,Wk,Hk,Kk,Yk,zk,qk,Xk,Jk,Qk,Zk,$k,e1,Wn;let Xt=(gk=Ae({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),Sk=Ae({argsMap:(e,t)=>[e.getTrackId(),t]}),Tk=qt(),vk=pl("LocalAudioTrack","_enabledMutex"),Rk=Ae({argsMap:(e,t)=>[e.getTrackId(),t]}),yk=qt(),Ck=pl("LocalAudioTrack","_enabledMutex"),Ik=Ae({argsMap:(e,t)=>[e.getTrackId(),t]}),wk=qt(),Ak=qt(),bk=qt(),Ok=Ae({argsMap:e=>[e.getTrackId()]}),Nk=qt(),Dk=Ae({argsMap:e=>[e.getTrackId()]}),Pk=qt(),Lk=Ae({argsMap:e=>[e.getTrackId()]}),kk=Ae({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Mk=Ae({argsMap:e=>[e.getTrackId()]}),$e((Gt=class extends vl{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?or.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,r){super(e,n),H(this,"trackMediaType",Tl.AUDIO),H(this,"_encoderConfig",void 0),H(this,"_trackSource",void 0),H(this,"metadata",[]),H(this,"_enabled",!0),H(this,"_volume",100),H(this,"_useAudioElement",!0),H(this,"_bypassWebAudio",!1),H(this,"processor",void 0),H(this,"_processorContext",void 0),H(this,"_processorDestination",void 0),H(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!r,this._trackSource=new RR,A("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),A("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),An()&&!pi?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){Rt(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&or.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void T.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,wt(this,Te.NEED_REPLACE_TRACK,this).then(()=>{T.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{T.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!WL())throw new Y(O.NOT_SUPPORTED,"your browser does not support setting the audio output device");await or.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await wt(this,Te.NEED_ENABLE_TRACK,this),T.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(r){throw n||(this._enabled=!1),T.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await wt(this,Te.NEED_DISABLE_TRACK,this)}catch(r){throw n||(this._enabled=!0),T.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,T.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await wt(this,Te.NEED_MUTE_TRACK,this):await wt(this,Te.NEED_UNMUTE_TRACK,this))}getStats(){return va(()=>{T.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Zr(this,Te.GET_STATS)||Ot({},pR)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(ui.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(ui.ON_AUDIO_BUFFER),this._source.on(ui.ON_AUDIO_BUFFER,n=>e(n))}play(){T.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(T.debug("[".concat(this.getTrackId(),"] start audio playback in element")),or.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){T.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?or.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];T.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&or.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await wt(this,Te.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return ae.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new Y(O.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new Y(O.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(mr.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await wt(this,Te.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await wt(this,Te.NEED_REPLACE_TRACK,this))}),e.on(mr.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(mr.ON_TRACK),e.removeAllListeners(mr.ON_NODE)}bindProcessorContextEvents(e){e.on(hi.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(hi.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof RR&&(this._trackSource=new SR(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new uk(this._source.context,this.getTrackId(),"local"),t=new lk(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(ui.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(or.stop(this.getTrackId()),this._source.play()),wt(this,Te.NEED_REPLACE_MIXING_TRACK,this).then(()=>{T.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{T.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[gk],Object.getOwnPropertyDescriptor(Gt.prototype,"setVolume"),Gt.prototype),$e(Gt.prototype,"setPlaybackDevice",[Sk,Tk],Object.getOwnPropertyDescriptor(Gt.prototype,"setPlaybackDevice"),Gt.prototype),$e(Gt.prototype,"setEnabled",[vk,Rk,yk],Object.getOwnPropertyDescriptor(Gt.prototype,"setEnabled"),Gt.prototype),$e(Gt.prototype,"setMuted",[Ck,Ik,wk],Object.getOwnPropertyDescriptor(Gt.prototype,"setMuted"),Gt.prototype),$e(Gt.prototype,"getStats",[Ak],Object.getOwnPropertyDescriptor(Gt.prototype,"getStats"),Gt.prototype),$e(Gt.prototype,"setAudioFrameCallback",[bk],Object.getOwnPropertyDescriptor(Gt.prototype,"setAudioFrameCallback"),Gt.prototype),$e(Gt.prototype,"play",[Ok,Nk],Object.getOwnPropertyDescriptor(Gt.prototype,"play"),Gt.prototype),$e(Gt.prototype,"stop",[Dk,Pk],Object.getOwnPropertyDescriptor(Gt.prototype,"stop"),Gt.prototype),$e(Gt.prototype,"close",[Lk],Object.getOwnPropertyDescriptor(Gt.prototype,"close"),Gt.prototype),$e(Gt.prototype,"pipe",[kk],Object.getOwnPropertyDescriptor(Gt.prototype,"pipe"),Gt.prototype),$e(Gt.prototype,"unpipe",[Mk],Object.getOwnPropertyDescriptor(Gt.prototype,"unpipe"),Gt.prototype),Gt),Ih=(Uk=Ae({argsMap:(e,t)=>[e.getTrackId(),t]}),xk=qt(),Vk=pl("MicrophoneAudioTrack","_enabledMutex"),Fk=Ae({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),Bk=qt(),jk=Ae({argsMap:e=>[e.getTrackId()]}),$e((ls=class extends Xt{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,r){super(e,t.encoderConfig?Y_(t.encoderConfig):{},r,A("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),H(this,"_config",void 0),H(this,"_deviceName","default"),H(this,"_constraints",void 0),H(this,"_originalConstraints",void 0),H(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(dl()||Bv())&&Tt.bindInterruptDetectorTrack(this)}async setDevice(e){if(T.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await _i.getDeviceById(e),n={};n.audio=Ot({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let r=null;try{r=await fi(n,this.getTrackId())}catch(i){throw T.error("[".concat(this.getTrackId(),"] setDevice failed"),i.toString()),r=await fi({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await _i.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}T.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return T.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),e),A("AUTO_RESET_AUDIO_ROUTE")&&(tr()||eo())){const a=navigator.audioSession;a&&(e||(a.type="playback"),a.type="auto")}if(!e){var r;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(r=this._source.clonedTrack)===null||r===void 0||r.stop(),n||(this._enabled=!1);try{await wt(this,Te.NEED_DISABLE_TRACK,this)}catch(a){throw T.error("[".concat(this.getTrackId(),"] setEnabled false failed"),a.toString()),a}return}const i=Ot({},this._constraints),s=_i.searchDeviceIdByName(this._deviceName);s&&!i.deviceId&&(i.deviceId=s);try{n||(this._enabled=!0);const a=await fi({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!1),await wt(this,Te.NEED_ENABLE_TRACK,this)}catch(a){throw n||(this._enabled=!1),T.error("[".concat(this.getTrackId(),"] setEnabled true failed"),a.toString()),a}T.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(dl()||Bv())&&Tt.unbindInterruptDetectorTrack(this),Mc.some(e=>function(t){return"__className__"in t&&t.__className__==="MicrophoneAudioTrack"}(e))||mR&&mR()&&(Se.reportApiInvoke(null,{name:"BG_AUDIO_TAG_RESTART",options:{},tag:yt.TRACER}).onSuccess(),T.debug("restart background audio tag success"))}onTrackEnded(){if((tr()||eo())&&this._enabled&&!this._isClosed&&Tt.duringInterruption){const e=async()=>{Tt.off(Un.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(T.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Tt.on(Un.IOS_INTERRUPTION_END,e)}else T.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Sl.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=_i.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const r=await fi({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(hi.REQUEST_UPDATE_CONSTRAINTS,async(t,n,r)=>{try{const i=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(i),n()}catch(i){r(i)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(hi.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[Uk,xk],Object.getOwnPropertyDescriptor(ls.prototype,"setDevice"),ls.prototype),$e(ls.prototype,"setEnabled",[Vk,Fk,Bk],Object.getOwnPropertyDescriptor(ls.prototype,"setEnabled"),ls.prototype),$e(ls.prototype,"close",[jk],Object.getOwnPropertyDescriptor(ls.prototype,"close"),ls.prototype),ls),kJ=(Gk=Ae({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),Wk=qt(),Hk=Ae({argsMap:e=>[e.getTrackId()]}),Kk=qt(),Yk=Ae({argsMap:e=>[e.getTrackId()]}),zk=qt(),qk=Ae({argsMap:e=>[e.getTrackId()]}),Xk=qt(),Jk=Ae({argsMap:e=>[e.getTrackId()]}),Qk=qt(),Zk=Ae({argsMap:e=>[e.getTrackId()]}),$k=Ae({argsMap:e=>[e.getTrackId()]}),e1=qt(),$e((Wn=class extends Xt{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,r){super(t.createOutputTrack(),n,r),H(this,"source",void 0),H(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(ui.AUDIO_SOURCE_STATE_CHANGE,i=>{this.safeEmit(Sl.SOURCE_STATE_CHANGE,i)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){Rt(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[Gk,Wk],Object.getOwnPropertyDescriptor(Wn.prototype,"startProcessAudioBuffer"),Wn.prototype),$e(Wn.prototype,"pauseProcessAudioBuffer",[Hk,Kk],Object.getOwnPropertyDescriptor(Wn.prototype,"pauseProcessAudioBuffer"),Wn.prototype),$e(Wn.prototype,"seekAudioBuffer",[Yk,zk],Object.getOwnPropertyDescriptor(Wn.prototype,"seekAudioBuffer"),Wn.prototype),$e(Wn.prototype,"resumeProcessAudioBuffer",[qk,Xk],Object.getOwnPropertyDescriptor(Wn.prototype,"resumeProcessAudioBuffer"),Wn.prototype),$e(Wn.prototype,"stopProcessAudioBuffer",[Jk,Qk],Object.getOwnPropertyDescriptor(Wn.prototype,"stopProcessAudioBuffer"),Wn.prototype),$e(Wn.prototype,"close",[Zk],Object.getOwnPropertyDescriptor(Wn.prototype,"close"),Wn.prototype),$e(Wn.prototype,"setAudioBufferPlaybackSpeed",[$k,e1],Object.getOwnPropertyDescriptor(Wn.prototype,"setAudioBufferPlaybackSpeed"),Wn.prototype),Wn);class fn extends Xt{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=Rl().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,ht(8,"track-mix-")),H(this,"trackList",void 0),H(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(T.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):T.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){T.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}k_(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(n=>{n instanceof fn?n.emit(Uc.TRANSCEIVER_UPDATED,t):n._updateRtpTransceiver(t)}))}}class MJ extends tk{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(ui.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),H(this,"audioBuffer",void 0),H(this,"sourceNode",void 0),H(this,"startPlayTime",0),H(this,"startPlayOffset",0),H(this,"pausePlayTime",0),H(this,"options",void 0),H(this,"currentLoopCount",0),H(this,"currentPlaybackSpeed",100),H(this,"_currentState","stopped"),this.audioBuffer=t,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):T.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const t1=new Map;function n1(e,t){if(e.length===0||t.length===0)return 1/0;const n=Jv(e),r=Jv(t);return Math.floor(r/n)}class CR{get rendFrameRate(){const t=Math.max(1,n1(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/t)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:zn.DESTROYED}set videoElementStatus(t){t!==this._videoElementStatus&&(T.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var n;t!==this._videoState&&(this._videoState=t,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(t){H(this,"trackId",void 0),H(this,"config",void 0),H(this,"onFirstVideoFrameDecoded",void 0),H(this,"onFirstVideoFrameRender",void 0),H(this,"onVideoBufferReady",void 0),H(this,"onVideoStateChanged",void 0),H(this,"freezeTimeCounterList",[]),H(this,"renderFreezeAccTime",0),H(this,"renderFreezeAccTime2",0),H(this,"isKeepLastFrame",!1),H(this,"isDestroyed",!1),H(this,"timeUpdatedCount",0),H(this,"freezeTime",0),H(this,"playbackTime",0),H(this,"lastTimeUpdatedTime",0),H(this,"autoplayFailed",!1),H(this,"videoTrack",void 0),H(this,"videoElement",void 0),H(this,"cacheVideoElement",void 0),H(this,"cancelRVFId",void 0),H(this,"internal",!1),H(this,"_render_interframe_delays",[]),H(this,"_render_interframe_delays_sizes",[]),H(this,"_videoState",ds.VideoStateStopped),H(this,"videoElementCheckInterval",void 0),H(this,"videoElementFreezeTimeout",void 0),H(this,"_videoElementStatus",zn.NONE),H(this,"_isInPage",!0),H(this,"isGettingVideoDimensions",!1),H(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return T.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),H(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Tt.curState==="running"&&(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(XP())),rL()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),H(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":n.type==="play"&&T.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=zn.PLAYING;break;case"loadeddata":if(this.videoState=ds.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=zn.CANPLAY;break;case"stalled":this.videoElementStatus=zn.STALLED;break;case"suspend":this.videoElementStatus=zn.SUSPEND;break;case"pause":this.videoElementStatus=zn.PAUSED,tr()||eo()||An()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=zn.WAITING;break;case"abort":this.videoElementStatus=zn.ABORT;break;case"ended":this.videoElementStatus=zn.ENDED;break;case"emptied":this.videoElementStatus=zn.EMPTIED;break;case"error":{const r=this.videoElement.error;r&&(this.videoElementStatus=zn.ERROR,T.error("[".concat(this.trackId,"] media error: ").concat(r.message," (").concat(r.code,")")));break}case"timeupdate":{const r=performance.now();if(this.timeUpdatedCount+=1,this.onVideoBufferReady&&this.timeUpdatedCount>A("BUFFER_READY_FRAMES")&&this.onVideoBufferReady(),this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=r);const i=r-this.lastTimeUpdatedTime,s=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=r,$r.lastVisibleTime<$r.lastHiddenTime||s<$r.lastHiddenTime||s<$r.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(i>A("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=i),this.playbackTime+=i;this.playbackTime>=6e3;){this.playbackTime-=6e3;const a=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(a),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),H(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(XP())),rL()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),Tt.on(Un.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Tt.on(Un.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const n=this.videoElement.play();n&&n.catch&&n.catch(i=>{t&&ak(t,"video",i.message,this.trackId),i.name==="NotAllowedError"?(T.warning("detected video element autoplay failed",i),this.autoplayFailed=!0,this.handleAutoPlayFailed()):T.warning("[".concat(this.trackId,"] play warning: "),i)});const r=rt();if((r.name==="Safari"&&Number(r.version)===15||dl())&&n&&n.then){const i=()=>{this.config.mirror&&!this.config.noStyle&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(i).catch(i)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const n=t.getContext("2d");if(!n)return T.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,t.width,t.height);const r=n.getImageData(0,0,t.width,t.height);return t.remove(),r}async getCurrentFrameToUint8Array(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const i=r.getContext("2d");return i?(i.drawImage(this.videoElement,0,0,r.width,r.height),new ae((s,a)=>{r.toBlob(async d=>{if(r.remove(),d){const l=await Ek(d);s({buffer:l,width:r.width,height:r.height})}else a(new Y(O.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,n<0?.1:n>1?1:n)})):await yR(t)}destroy(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.isDestroyed=!0,Tt.off(Un.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Tt.off(Un.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),t?this.videoElement.pause():this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=ds.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=zn.INIT,!this.videoElementCheckInterval&&(r1.forEach(s=>{this.videoElement.addEventListener(s,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=function(s){return s!==document.body&&document.body.contains(s)}(this.videoElement)},1e3),A("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,n;let s;const a=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",a),this.videoElementFreezeTimeout=window.setTimeout(d,A("VIDEO_FREEZE_DURATION")))},d=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===ds.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=ds.VideoStateFrozen:document.addEventListener("visibilitychange",a))},l=(h,p)=>{if(this.videoElementStatus===zn.PLAYING){if(s){const g=p.presentationTime-s.presentationTime,w=p.presentedFrames-s.presentedFrames;this._render_interframe_delays_sizes.push(w),this._render_interframe_delays.push(g);const R=Jv(this._render_interframe_delays_sizes),y=R-this._render_interframe_delays_sizes[0];if(R>30&&y>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===ds.VideoStateStarting&&(this.videoState=ds.VideoStateDecoding),this.videoState===ds.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(d,A("VIDEO_FREEZE_DURATION"))),g<A("VIDEO_FREEZE_DURATION")&&this.videoState===ds.VideoStateFrozen&&(this.videoState=ds.VideoStateDecoding),g>A("VIDEO_FREEZE_DURATION")&&$r.lastVisibleTime>=$r.lastHiddenTime&&s.timestamp>$r.lastVisibleTime&&s.timestamp>$r.lastHiddenTime){const b=Math.min(66,n1(this._render_interframe_delays_sizes,this._render_interframe_delays)),N=Math.max(0,g-(w-1)*b);this.renderFreezeAccTime2+=N>b?N:0,this.renderFreezeAccTime+=g}}s=Ot(Ot({},p),{},{timestamp:h})}else this.isSkipCalcRenderFreezeTime()&&(s=Ot(Ot({},p),{},{timestamp:h}));var _,m;A("ENABLE_VIDEO_FRAME_CALLBACK")&&(this.cancelRVFId=(_=(m=this.videoElement).requestVideoFrameCallback)===null||_===void 0?void 0:_.call(m,l))};this.cancelRVFId=(t=(n=this.videoElement).requestVideoFrameCallback)===null||t===void 0?void 0:t.call(n,l)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),_h()&&!A("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const r=rt();this.config.noStyle||(r.name==="Safari"&&Number(r.version)===15||dl()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover"),this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Nt()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Nt()&&this.videoElement.load());const i=this.videoElement.play();i!==void 0&&i.catch(s=>{T.debug("[".concat(this.trackId,"] playback interrupted"),s.toString())})}resetVideoElement(){var t,n;r1.forEach(r=>{this.videoElement&&this.videoElement.removeEventListener(r,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.cancelRVFId&&this.videoElement&&((t=(n=this.videoElement).cancelVideoFrameCallback)===null||t===void 0||t.call(n,this.cancelRVFId),this.cancelRVFId=void 0),this.videoElementStatus=zn.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===zn.DESTROYED||this.internal}handleAutoPlayFailed(){const t=n=>{n.preventDefault(),this.videoElement.play().then(()=>{T.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(r=>{T.error(r)}),this.autoplayFailed=!1,mh()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};mh()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),sk()}}const r1=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class J_ extends CR{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(t),H(this,"container",void 0),H(this,"slot",void 0),this.slot=t.element,this.internal=n,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const n=t.element;var r;!this.internal||this.slot?(n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()):(this.slot=n,n&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(r=this.slot)===null||r===void 0||r.appendChild(this.container)):this.createElements())}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var n;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,r):await yR(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var t;this.container.remove(),(t=this.slot)===null||t===void 0||t.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var t;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",A("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(t=this.slot)===null||t===void 0||t.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var i1,o1,s1,a1,c1,d1,l1,u1,h1,p1,f1,_1,m1,E1,g1,S1,T1,v1,R1,y1,C1,I1,w1,A1,b1,O1,N1,D1,Xe,P1,L1,k1,M1,U1,x1,V1,F1,mi;let Ct=(i1=Ae({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),o1=qt(),s1=Ae({argsMap:e=>[e.getTrackId()]}),a1=pl("LocalVideoTrack","_enabledMutex"),c1=Ae({argsMap:(e,t)=>[e.getTrackId(),t]}),d1=qt(),l1=pl("LocalVideoTrack","_enabledMutex"),u1=Ae({argsMap:(e,t)=>[e.getTrackId(),t]}),h1=qt(),p1=Ae({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),f1=qt(),_1=Ae({argsMap:(e,t)=>[e.getTrackId(),t]}),m1=qt(),E1=qt(),g1=Ae({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),S1=qt(),T1=qt(),v1=qt(),R1=Ae({argsMap:e=>[e.getTrackId()]}),y1=qt(),C1=qt(),I1=qt(),w1=qt(),A1=qt(),b1=Ae({argsMap:(e,t)=>[e.getTrackId(),t.name]}),O1=Ae({argsMap:e=>[e.getTrackId()]}),N1=Ae({argsMap:e=>[e.getTrackId()]}),D1=Ae({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),Xe=class q3 extends vl{get videoHeight(){if(An()){const{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(An()){const{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==zn.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,n,r,i,s,a){if(super(t,s),H(this,"trackMediaType",Tl.VIDEO),H(this,"_player",void 0),H(this,"isUseScaleResolutionDownBy",!1),H(this,"_videoVisibleTimer",null),H(this,"_previousVideoVisibleStatus",void 0),H(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),H(this,"_encoderConfig",void 0),H(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),H(this,"_optimizationMode",void 0),H(this,"_saveEncodeBitrateRatio",1),H(this,"_videoHeight",void 0),H(this,"_videoWidth",void 0),H(this,"_forceBitrateLimit",void 0),H(this,"_enabled",!0),H(this,"_processorDestination",void 0),H(this,"_processorContext",void 0),An()){const{width:d,height:l}=t.getSettings();this._videoWidth=d,this._videoHeight=l}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=r,this._optimizationMode=i,this._hints=a||[],n&&this._hints.indexOf(lt.CUSTOM_TRACK)!==-1?this._encoderConfig=Dt(n):this._encoderConfig=n,this._hints.indexOf(lt.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(xv(ot.CHROME,115)&&P_().indexOf("Windows")!==-1){const d=function(l,h){if("VideoFrame"in window&&"TransformStream"in window&&qe().supportWebRTCInsertableStream){const p=new MediaStreamTrackProcessor(l),_=new MediaStreamTrackGenerator({kind:"video"});let m,g,w=Date.now();const R=()=>{y&&(clearInterval(y),y=void 0),m&&(m.close(),m=void 0),l.stop(),g=void 0,_.removeEventListener("ended",R)};let y=window.setInterval(()=>{if(g&&m&&Date.now()-w>1e3)try{_.readyState==="live"?g.enqueue(m.clone()):R()}catch{R()}},1e3);const b=new TransformStream({transform:(N,L)=>{_.readyState==="live"?(g=L,w=Date.now(),m===void 0?(m=N,L.enqueue(N.clone())):(L.enqueue(m),m=N)):N.close()}});return _.addEventListener("ended",R),p.readable.pipeThrough(b).pipeTo(_.writable),_}}(t);d&&(T.info("local screen video track begin to inject frame"),this._mediaStreamTrack=d)}n&&this._hints.indexOf(lt.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new dk(this.getTrackId(),"local"),this._processorDestination=new ck(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const i=document.getElementById(t);i?t=i:(T.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}T.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const r=Ot(Ot(Ot({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(r):(t instanceof HTMLVideoElement?this._player=new CR(r):this._player=new J_(r),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(Sl.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},A("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,T.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await wt(this,Te.NEED_DISABLE_TRACK,this)}catch(r){throw T.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}return n||(this._enabled=!1),void T.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await wt(this,Te.NEED_ENABLE_TRACK,this)}catch(r){throw T.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}T.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,T.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await wt(this,Te.NEED_MUTE_TRACK,this):await wt(this,Te.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*t),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*t),T.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(t)),this._saveEncodeBitrateRatio=1;try{await wt(this,Te.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(T)}}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new Y(O.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=oo(t),A("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const r=X_({encoderConfig:t});(An()||tr()||eo())&&(r.deviceId=void 0),T.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(i){const s=new Y(O.UNEXPECTED_ERROR,i.toString());throw T.error("[".concat(this.getTrackId(),"] applyConstraints error"),s.toString()),s}}this._encoderConfig=t,this._hints.indexOf(lt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await wt(this,Te.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(T)}}getStats(){return va(()=>{T.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Zr(this,Te.GET_STATS)||Ot({},fR)}async setBeautyEffect(t){T.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,n):await yR(t)}async findClosestProfile(){const{width:t,height:n,frameRate:r}=this.getMediaStreamTrackSettings(),{width:i,height:s,frameRate:a}=this._encoderConfig||{},d=hl(this._videoWidth||t||i||0),l=hl(this._videoHeight||n||s||0),h=function(p,_,m){if(!Array.isArray(A("VIDEO_ENCODER_CONFIG_LIST"))||A("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;const g=Math.min(p,_);return!(g>=480)&&Ot(Ot({},A("VIDEO_ENCODER_CONFIG_LIST").find(w=>w.height>g)),{},{frameRate:m})}(d,l,hl(r||a||15));if(h)return T.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(d,"x").concat(l," => ").concat(JSON.stringify(h))),this.setEncoderConfiguration(h)}async setBitrateLimit(t){T.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void T.error(O.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=t,await wt(this,Te.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(r){throw this._optimizationMode=n,T.error("[".concat(this.getTrackId(),"] set optimization mode failed"),r.toString()),r}T.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return T.error(O.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,T.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){hk(this._originMediaStreamTrack).then(t=>{let[n,r]=t;this._videoHeight=r,this._videoWidth=n}).catch(Sh)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new Y(O.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");T.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=oo(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(lt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await wt(this,Te.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(T)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:n,frameRate:r}=this.getMediaStreamTrackSettings();if(!t||!n||!r)return;const{bitrateMax:i,bitrateMin:s}=this._encoderConfig;if(s==null||i==null){const{max:a,min:d}=function(l,h,p,_,m){const g=A("BITRATE_ADAPTER_TYPE");if(g==="DEFAULT_BITRATE")return{min:_,max:m};if(m===void 0){const w=Math.floor(200*Math.pow(p/15,.6)*Math.pow(l*h/640/360,.75));m=g==="STANDARD_BITRATE"?4*w:2*w,_=_??w}else _=_??Math.floor(m/10);return{min:_,max:m}}(t,n,r,s,i);if(this._encoderConfig.bitrateMin=d,this._encoderConfig.bitrateMax=a,A("VIDEO_STANDARD_BITRATE_VERSION")&&s==null&&i==null){const[l,h]=function(p,_,m){const g=4*Math.floor(2e5*Math.pow(m/15,.6)*Math.pow(p*_/230400,.75)),w=p*_,R=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),y=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let b=Xr(R).call(R).next().value,N=1;if(R.has(w))b=R.get(w);else{var L;const pe=Ec(L=Array.from(R.entries())).call(L,(Ne,Ge)=>{let[Fe]=Ne,[st]=Ge;return Fe-st}),Pe=pe.find(Ne=>{let[Ge]=Ne;return Ge>w});if(Pe){const Ne=pe.indexOf(Pe);if(Ne>0){const Ge=pe[Ne-1],Fe=(w-Ge[0])/(Pe[0]-Ge[0]);b=Ge[1]+Fe*(Pe[1]-Ge[1])}else b=Pe[1]}else b=pe[pe.length-1][1]}if(y.has(w))N=y.get(w);else{var x;const pe=Ec(x=Array.from(y.entries())).call(x,(Ne,Ge)=>{let[Fe]=Ne,[st]=Ge;return Fe-st}),Pe=pe.find(Ne=>{let[Ge]=Ne;return Ge>w});if(Pe){const Ne=pe.indexOf(Pe);if(Ne>0){const Ge=pe[Ne-1],Fe=(w-Ge[0])/(Pe[0]-Ge[0]);N=Ge[1]+Fe*(Pe[1]-Ge[1])}else N=Pe[1]}else N=pe[pe.length-1][1]}const F=A("VIDEO_NEW_BITRATE_RATIO");F&&F>0&&(b=F/100);const M=Math.floor(g*b),B=Math.floor(65e4*Math.pow(p*_/230400,.5)*Math.pow(m/15,.69));let J=M;const ee=A("VIDEO_STANDARD_BITRATE_VERSION");return ee&&ee>0&&(ee===1?J=g:ee===2?J=M:ee===3&&(J=B)),[Math.floor(J/1e3),N]}(t,n,r);this._encoderConfig.bitrateMax=l,this._encoderConfig.bitrateMin=d?Math.min(d,l):l,this._saveEncodeBitrateRatio=h,T.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(r,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else T.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(r,"] => [brMax: ").concat(a,", brMin: ").concat(d,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var t,n;const r=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),i={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:r==null?void 0:r.parentElement},{element:s,slot:a}=i;if(this.isPlaying&&s instanceof HTMLVideoElement&&a instanceof HTMLElement){const d=uL.checkOneElementVisible(s),l=Object.assign({},d);if(l.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=l.visible;const h=Se.reportApiInvoke(null,{tag:yt.TRACER,name:kt.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});l.visible?h.onSuccess("Video is visible"):h.onSuccess("Invisible because of ".concat(l.reason))}return l}return}catch(r){throw new Y(O.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new Y(O.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=Ot(Ot({},r),oo(t))),r=Nc(r);const i=ht(8,"track-video-cloned-"),s=new q3(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,r,Nc(this._scalabilityMode),this._optimizationMode,i,Nc(this._hints));return t&&r&&s.setEncoderConfiguration(r),T.debug("clone video track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),s}async replaceTrack(t,n){if(!(t instanceof MediaStreamTrack))throw new Y(O.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new Y(O.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,n,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(va(()=>{Se.reportApiInvoke(null,{name:kt.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:yt.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!A("ENABLE_VIDEO_SEI")||!A("ENABLE_ENCODED_TRANSFORM"))return void T.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new Y(O.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void T.warning("Video track is not published, SEI can not be send");const r=n.sender.getParameters();if(r.codecs.length===0)return;const i=r.codecs[0].mimeType.toLocaleLowerCase();i==="video/h264"||i==="video/h265"?this.safeEmit("sei-to-send",t):T.warning("SEI is not supported by ".concat(i))}bindProcessorDestinationEvents(){this.processorDestination.on(mr.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await wt(this,Te.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await wt(this,Te.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(mr.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(hi.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(hi.REQUEST_CONSTRAINTS)}},$e(Xe.prototype,"play",[i1,o1],Object.getOwnPropertyDescriptor(Xe.prototype,"play"),Xe.prototype),$e(Xe.prototype,"stop",[s1],Object.getOwnPropertyDescriptor(Xe.prototype,"stop"),Xe.prototype),$e(Xe.prototype,"setEnabled",[a1,c1,d1],Object.getOwnPropertyDescriptor(Xe.prototype,"setEnabled"),Xe.prototype),$e(Xe.prototype,"setMuted",[l1,u1,h1],Object.getOwnPropertyDescriptor(Xe.prototype,"setMuted"),Xe.prototype),$e(Xe.prototype,"setSaveEncodeBitrateRatio",[p1,f1],Object.getOwnPropertyDescriptor(Xe.prototype,"setSaveEncodeBitrateRatio"),Xe.prototype),$e(Xe.prototype,"setEncoderConfiguration",[_1,m1],Object.getOwnPropertyDescriptor(Xe.prototype,"setEncoderConfiguration"),Xe.prototype),$e(Xe.prototype,"getStats",[E1],Object.getOwnPropertyDescriptor(Xe.prototype,"getStats"),Xe.prototype),$e(Xe.prototype,"setBeautyEffect",[g1,S1],Object.getOwnPropertyDescriptor(Xe.prototype,"setBeautyEffect"),Xe.prototype),$e(Xe.prototype,"getCurrentFrameData",[T1],Object.getOwnPropertyDescriptor(Xe.prototype,"getCurrentFrameData"),Xe.prototype),$e(Xe.prototype,"getCurrentFrameImage",[v1],Object.getOwnPropertyDescriptor(Xe.prototype,"getCurrentFrameImage"),Xe.prototype),$e(Xe.prototype,"findClosestProfile",[R1,y1],Object.getOwnPropertyDescriptor(Xe.prototype,"findClosestProfile"),Xe.prototype),$e(Xe.prototype,"setBitrateLimit",[C1],Object.getOwnPropertyDescriptor(Xe.prototype,"setBitrateLimit"),Xe.prototype),$e(Xe.prototype,"setOptimizationMode",[I1],Object.getOwnPropertyDescriptor(Xe.prototype,"setOptimizationMode"),Xe.prototype),$e(Xe.prototype,"setScalabiltyMode",[w1],Object.getOwnPropertyDescriptor(Xe.prototype,"setScalabiltyMode"),Xe.prototype),$e(Xe.prototype,"updateMediaStreamTrackResolution",[A1],Object.getOwnPropertyDescriptor(Xe.prototype,"updateMediaStreamTrackResolution"),Xe.prototype),$e(Xe.prototype,"pipe",[b1],Object.getOwnPropertyDescriptor(Xe.prototype,"pipe"),Xe.prototype),$e(Xe.prototype,"unpipe",[O1],Object.getOwnPropertyDescriptor(Xe.prototype,"unpipe"),Xe.prototype),$e(Xe.prototype,"close",[N1],Object.getOwnPropertyDescriptor(Xe.prototype,"close"),Xe.prototype),$e(Xe.prototype,"replaceTrack",[D1],Object.getOwnPropertyDescriptor(Xe.prototype,"replaceTrack"),Xe.prototype),Xe),Q_=(P1=Ae({argsMap:(e,t)=>[e.getTrackId(),t]}),L1=qt(),k1=pl("CameraVideoTrack","_enabledMutex"),M1=Ae({argsMap:(e,t)=>[e.getTrackId(),t]}),U1=qt(),x1=Ae({argsMap:(e,t)=>[e.getTrackId(),t]}),V1=qt(),F1=Ae({argsMap:e=>[e.getTrackId()]}),mi=class X3 extends Ct{get __className__(){return"CameraVideoTrack"}constructor(t,n,r,i,s,a){super(t,oo(n.encoderConfig),i,s,a),H(this,"_config",void 0),H(this,"_originalConstraints",void 0),H(this,"_constraints",void 0),H(this,"_enabled",!0),H(this,"_deviceName","default"),H(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(dl()||Bv())&&!function(){const d=rt();if(d.os!==Sn.IOS||!d.osVersion)return!1;const l=d.osVersion.split(".");return Number(l[0])===15&&Number(l[1])>=2}()&&iL()&&this._enabled&&!this._isClosed&&(T.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=n,this._originalConstraints=r,this._constraints=r,this._deviceName=t.label,this._encoderConfig=oo(this._config.encoderConfig),Tt.on(Un.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Tt.on(Un.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(T.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{const n=await _i.getDeviceById(t),r={};r.video=Ot({},this._constraints),r.video.deviceId={exact:t},r.video.facingMode=void 0,this._originMediaStreamTrack.stop();let i=null;try{i=await fi(r,this.getTrackId())}catch(s){throw T.error("[".concat(this.getTrackId(),"] setDevice failed"),s.toString()),i=await fi({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await _i.getDeviceById(t);this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}T.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){T.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));const n={video:Ot(Ot({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let r=null;try{r=await fi(n,this.getTrackId())}catch(i){throw T.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),i.toString()),r=await fi({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=Ot({},n.video),T.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const r=await fi({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1)}await wt(this,Te.NEED_ENABLE_TRACK,this)}catch(r){throw T.error("[".concat(this.getTrackId(),"] setEnabled true error"),r.toString()),r}this.updateMediaStreamTrackResolution(),T.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await wt(this,Te.NEED_DISABLE_TRACK,this)}catch(r){throw T.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}T.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new Y(O.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=oo(t),A("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);const r=Dt(this._config);r.encoderConfig=t;const i=X_(r);(An()||tr()||eo())&&(i.deviceId=void 0),T.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(s){const a=new Y(O.UNEXPECTED_ERROR,s.toString());throw T.error("[".concat(this.getTrackId(),"] applyConstraints error"),a.toString()),a}this._config=r,this._constraints=i,this._originalConstraints=i,this._encoderConfig=t,this._hints.indexOf(lt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await wt(this,Te.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(T)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((tr()||eo())&&this._enabled&&!this._isClosed&&Tt.duringInterruption){const t=async()=>{Tt.off(Un.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(T.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Tt.on(Un.IOS_INTERRUPTION_END,t)}else T.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Sl.TRACK_ENDED)}async renewMediaStreamTrack(t){const n=t||this._constraints,r=_i.searchDeviceIdByName(this._deviceName);if(r&&!n.deviceId&&(n.deviceId={exact:r}),this._enabled){const i=await fi({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Tt.off(Un.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Tt.off(Un.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=Ot(Ot({},r),oo(t))),r=Nc(r);const i=ht(8,"track-cam-cloned-"),s=new X3(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,Nc(Ot(Ot({},this._config),{},{encoderConfig:r})),Nc(this._constraints),Nc(this._scalabilityMode),this._optimizationMode,i);return t&&r&&s.setEncoderConfiguration(r),T.debug("clone track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),s}bindProcessorContextEvents(){this.processorContext.on(hi.REQUEST_UPDATE_CONSTRAINTS,async(t,n,r)=>{try{const i=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(i),n()}catch(i){r(i)}}),this.processorContext.on(hi.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},$e(mi.prototype,"setDevice",[P1,L1],Object.getOwnPropertyDescriptor(mi.prototype,"setDevice"),mi.prototype),$e(mi.prototype,"setEnabled",[k1,M1,U1],Object.getOwnPropertyDescriptor(mi.prototype,"setEnabled"),mi.prototype),$e(mi.prototype,"setEncoderConfiguration",[x1,V1],Object.getOwnPropertyDescriptor(mi.prototype,"setEncoderConfiguration"),mi.prototype),$e(mi.prototype,"close",[F1],Object.getOwnPropertyDescriptor(mi.prototype,"close"),mi.prototype),mi);function B1(e){const t=ht(8,"track-cus-"),n=Se.reportApiInvoke(null,{id:t,tag:yt.TRACER,name:kt.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),r=new Xt(e.mediaStreamTrack,e.encoderConfig?Y_(e.encoderConfig):{},t,!1);return T.info("create custom audio track success with config",e,"trackId",r.getTrackId()),n.onSuccess(r.getTrackId()),r}function IR(e,t,n,r){n.optimizationMode&&(r&&r.width&&r.height?(n.encoderConfig=Ot(Ot({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?T.debug("[".concat(e,"] set content hint to"),n.optimizationMode):T.debug("[".concat(e,"] set content hint failed")))):T.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var j1,G1,W1,H1,ki,K1,Y1,z1,q1,X1,J1,Q1,Hn;class Z1 extends ZL{getUserId(){return this._userId}constructor(t,n,r,i){super(t,"track-".concat(t.kind,"-").concat(n,"-").concat(i.clientId,"_").concat(ht(5,""))),H(this,"_userId",void 0),H(this,"_uintId",void 0),H(this,"_isDestroyed",!1),H(this,"store",void 0),H(this,"processor",void 0),H(this,"processorContext",void 0),this._userId=n,this._uintId=r,this.store=i}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,T.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Cl=(j1=Ae({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),G1=Ae({argsMap:e=>[e.getTrackId()]}),W1=Ae({argsMap:(e,t)=>[e.getTrackId(),t.name]}),H1=Ae({argsMap:e=>[e.getTrackId()]}),$e((ki=class extends Z1{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==zn.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,r,i){super(e,t,n,r),H(this,"_videoVisibleTimer",null),H(this,"_previousVideoVisibleStatus",void 0),H(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),H(this,"trackMediaType",Tl.VIDEO),H(this,"_videoWidth",void 0),H(this,"_videoHeight",void 0),H(this,"_player",void 0),H(this,"_prePlayer",void 0),H(this,"processorDestination",void 0),H(this,"processorContext",void 0),this._prePlayer=i,this.updateMediaStreamTrackResolution(),this.processorContext=new dk(this.getTrackId(),"remote"),this.processorDestination=new ck(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return va(()=>{T.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Zr(this,Te.GET_STATS)||Ot({},JL)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(Li.PLAY_START),typeof e=="string"){const r=document.getElementById(e);r?e=r:(T.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}T.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=Ot(Ot({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});if(this._player)this._player.updateConfig(n);else{let r=!1,i=!1;e instanceof HTMLVideoElement?(this._player=new CR(n),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,i=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,r=this._player.videoState>0,this._player.updateConfig(n)):this._player=new J_(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Li.FIRST_FRAME_DECODED),i&&this.safeEmit(Li.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=s=>{this.safeEmit(Li.VIDEO_STATE_CHANGED,s)},r&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const r=this.getVideoElementVisibleStatus();this.safeEmit(Li.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}},A("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(Li.PLAY_END)}stop(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(e),this._player=void 0,T.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){hk(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(Sh)}_updatePlayerSource(){T.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),r={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:i,slot:s}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&s instanceof HTMLElement){const a=uL.checkOneElementVisible(i),d=Object.assign({},a);if(d.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=d.visible;const l=Se.reportApiInvoke(null,{tag:yt.TRACER,name:kt.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});d.visible?l.onSuccess("Video is visible"):l.onSuccess("Invisible because of ".concat(d.reason))}return d}return}catch(n){throw new Y(O.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new Y(O.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(mr.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(mr.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(Uc.SEI_RECEIVED,e)}}).prototype,"play",[j1],Object.getOwnPropertyDescriptor(ki.prototype,"play"),ki.prototype),$e(ki.prototype,"stop",[G1],Object.getOwnPropertyDescriptor(ki.prototype,"stop"),ki.prototype),$e(ki.prototype,"pipe",[W1],Object.getOwnPropertyDescriptor(ki.prototype,"pipe"),ki.prototype),$e(ki.prototype,"unpipe",[H1],Object.getOwnPropertyDescriptor(ki.prototype,"unpipe"),ki.prototype),ki),Il=(K1=Ae({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),Y1=Ae({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),z1=Ae({argsMap:(e,t)=>[e.getTrackId(),t]}),q1=Ae({argsMap:e=>[e.getTrackId()]}),X1=Ae({argsMap:e=>[e.getTrackId()]}),J1=Ae({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Q1=Ae({argsMap:e=>[e.getTrackId()]}),$e((Hn=class extends Z1{get isPlaying(){return this._useAudioElement?or.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,r){super(e,t,n,r),H(this,"trackMediaType",Tl.AUDIO),H(this,"_source",void 0),H(this,"_useAudioElement",!0),H(this,"_volume",100),H(this,"processorContext",void 0),H(this,"processorDestination",void 0),H(this,"_played",!1),H(this,"_bypassWebAudio",!1),A("DISABLE_WEBAUDIO")?(this._source=new RR,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new SR(e,!0),A("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(ui.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Li.FIRST_FRAME_DECODED)}),this.processorContext=new uk(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new lk(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(ui.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(ui.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(ui.ON_AUDIO_BUFFER),this._source.on(ui.ON_AUDIO_BUFFER,n=>e(n))}setVolume(e){this._volume=e,this._useAudioElement?or.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}setAmplifiedVolume(e){this._useAudioElement&&this._played&&(or.stop(this.getTrackId()),this._source.play()),this._useAudioElement=!1,e=Math.min(e,A("MAX_WEBAUDIO_VOLUME")),this._volume=e,this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!WL())throw new Y(O.NOT_SUPPORTED,"your browser does not support setting the audio output device");await or.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getVolume(){return this._useAudioElement?or.getVolume(this.getTrackId()):this._source instanceof SR?this._source.getAudioVolume():0}getStats(){return va(()=>{T.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Zr(this,Te.GET_STATS)||Ot({},XL)}play(){T.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(T.debug("[".concat(this.getTrackId(),"] use audio element to play")),or.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):(T.debug("[".concat(this.getTrackId(),"] use audio context to play")),this._source.play())}stop(){T.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?or.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];T.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&or.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new Y(O.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new Y(O.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new Y(O.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(mr.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(mr.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(mr.ON_TRACK),this.processorDestination.removeAllListeners(mr.ON_NODE)}}).prototype,"setVolume",[K1],Object.getOwnPropertyDescriptor(Hn.prototype,"setVolume"),Hn.prototype),$e(Hn.prototype,"setAmplifiedVolume",[Y1],Object.getOwnPropertyDescriptor(Hn.prototype,"setAmplifiedVolume"),Hn.prototype),$e(Hn.prototype,"setPlaybackDevice",[z1],Object.getOwnPropertyDescriptor(Hn.prototype,"setPlaybackDevice"),Hn.prototype),$e(Hn.prototype,"play",[q1],Object.getOwnPropertyDescriptor(Hn.prototype,"play"),Hn.prototype),$e(Hn.prototype,"stop",[X1],Object.getOwnPropertyDescriptor(Hn.prototype,"stop"),Hn.prototype),$e(Hn.prototype,"pipe",[J1],Object.getOwnPropertyDescriptor(Hn.prototype,"pipe"),Hn.prototype),$e(Hn.prototype,"unpipe",[Q1],Object.getOwnPropertyDescriptor(Hn.prototype,"unpipe"),Hn.prototype),Hn);const $r=new class extends Vt{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),H(this,"_lastHiddenTime",0),H(this,"_lastVisibleTime",0),H(this,"needUploadStats",[]),H(this,"isCollectingStats",!1),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),this.isCollectingStats&&this.needUploadStats.push(document.visibilityState==="visible"?1:0),T.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}startCollectStats(){this.isCollectingStats=!0,this.needUploadStats.push(this.visibility==="visible"?1:0)}stopCollectStats(){this.isCollectingStats=!1,this.needUploadStats.length=0}};class $1 extends Vt{constructor(t,n){super(),H(this,"trackMediaType",Tl.DATA),H(this,"_version",1),H(this,"_type",3),H(this,"_config",void 0),H(this,"_originDataChannel",void 0),H(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),H(this,"_dataStreamPacketHandler",{serialize:r=>r,deserialize:r=>r}),H(this,"_datachannelEventMap",new Map),this._config=t,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return A("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new ae((t,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();const r=setTimeout(()=>{var i;n(new Y(O.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((i=this._originDataChannel)===null||i===void 0?void 0:i.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(r),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(r),new Y(O.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new Y(O.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[z_.OPEN,z_.CLOSE,z_.ERROR].forEach(n=>{const r=()=>{this.emit(n)};this._datachannelEventMap.set(n,r),t.addEventListener(n,r)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[r,i]=n;t.removeEventListener(r,i)}),this._datachannelEventMap.clear()}}class UJ extends $1{constructor(t){super(t),H(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const r=n.data.slice(0,this._dataStreamPacketHeader.byteLength),i=new DataView(r).getUint8(3);if(i!==this.id)return void(A("SHOW_DATASTREAM2_LOG")&&T.debug("invalid datachannel id: ".concat(i," !== ").concat(this.id)));let s=n.data.slice(this._dataStreamPacketHeader.byteLength);s=this._dataStreamPacketHandler.deserialize(s),this.emit(z_.MESSAGE,s)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class xJ extends $1{send(t){if(this._originDataChannel){let n=t;n=this._dataStreamPacketHandler.serialize(t);const r=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);r.set(new Uint8Array(this._dataStreamPacketHeader),0),r.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(r.buffer)}}}function Z_(){const e=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcixuPVtdLHI9W107bGV0IGg9bnVsbDtlLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9dD0+e3QuZGF0YS5zZWkmJm4ucHVzaCh0LmRhdGEuc2VpKSx0LmRhdGEubWV0YWRhdGEmJnIucHVzaCh0LmRhdGEubWV0YWRhdGEpfSxzZWxmLnBvc3RNZXNzYWdlKCJzdGFydGVkIik7Y29uc3QgcD1lLnJlYWRhYmxlLmdldFJlYWRlcigpLFU9ZS53cml0YWJsZS5nZXRXcml0ZXIoKTsic2VpLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1pKG5ldyBVaW50OEFycmF5KG4udmFsdWUuZGF0YSkpLHI9YShuLnZhbHVlLHQpO2lmKHImJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtzZWk6cn0pLCFoKXtjb25zdCB0PW4udmFsdWUuZ2V0TWV0YWRhdGEoKXx8e307aD17dHlwZTpuLnZhbHVlLnR5cGUscnRwVGltZXN0YW1wOm4udmFsdWUudGltZXN0YW1wLHBheWxvYWRUeXBlOnQucGF5bG9hZFR5cGV8fDAsc3NyYzp0LnN5bmNocm9uaXphdGlvblNvdXJjZXx8MCxsZW5ndGg6bi52YWx1ZS5kYXRhLmJ5dGVMZW5ndGgsLi4uIm1pbWVUeXBlImluIHQ/e21pbWVUeXBlOnQubWltZVR5cGV9Ont9fSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7Zmlyc3RGcmFtZUluZm86aH0pfX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToic2VpLXR4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigoYT0+e2lmKCFhLmRvbmUpe2lmKGEudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1pKG5ldyBVaW50OEFycmF5KGEudmFsdWUuZGF0YSkpLGU9bi5zaGlmdCgpO2lmKGUpe2NvbnN0IG49byhhLnZhbHVlLmRhdGEsZSx0KTtuJiYoYS52YWx1ZS5kYXRhPW4pfX1VLndyaXRlKGEudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtwLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PW5ldyBEYXRhVmlldyhuLnZhbHVlLmRhdGEpLGE9dC5nZXRVaW50OCgwKTtsZXQgcjtpZigwIT0oMTI4JmEpJiY3MSE9PWEpe2NvbnN0IGU9ZnVuY3Rpb24odCl7aWYodC5ieXRlTGVuZ3RoPD0wKXJldHVybltdO2NvbnN0IGU9W107bGV0IG49MDtmb3IoO248dC5ieXRlTGVuZ3RoOyl7Y29uc3QgYT0oMTI4JnQuZ2V0VWludDgobikpPj43LHI9MTI3JnQuZ2V0VWludDgobik7aWYoIShhJiZuKzQ8PXQuYnl0ZUxlbmd0aCkpe24rKzticmVha317Y29uc3QgYT10LmdldFVpbnQzMihuLCExKSxvPSgxNjc3NjE5MiZhKT4+MTAsaT0xMDIzJmE7ZS5wdXNoKHtwdDpyLHRzX29mZnNldDpvLGxlbmd0aDppLGRhdGE6bmV3IFVpbnQ4QXJyYXl9KSxuKz00fX1sZXQgYT10LmJ5dGVMZW5ndGgtbjtmb3IoY29uc3QgciBvZiBlKXtpZihyLmxlbmd0aD5hKXJldHVybiBjb25zb2xlLndhcm4oIkJyb2tlbiByZWQgcGF5bG9hZCIpLFtdO3IubGVuZ3RoPjAmJihyLmRhdGE9bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0K24sci5sZW5ndGgpLG4rPXIubGVuZ3RoLGEtPXIubGVuZ3RoKX1pZihhPjApe2NvbnN0IHI9e3B0OmUubGVuZ3RoPjA/ZVtlLmxlbmd0aC0xXS5wdDowLHRzX29mZnNldDowLGxlbmd0aDphLGRhdGE6bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0K24sYSl9O2UucHVzaChyKX1yZXR1cm4gZX0odCk7aWYoZS5sZW5ndGg+MCl7Y29uc3QgdD1mdW5jdGlvbih0KXtsZXQgZT0wO2ZvcihsZXQgbj0wO248dC5sZW5ndGg7bisrKWUrPW48dC5sZW5ndGgtMT80OjEsZSs9dFtuXS5sZW5ndGg7Y29uc3Qgbj1uZXcgVWludDhBcnJheShlKTtsZXQgYT0wO2ZvcihsZXQgZT0wO2U8dC5sZW5ndGg7ZSsrKWlmKGU8dC5sZW5ndGgtMSl7Y29uc3Qgcj0oMjE0NzQ4MzY0OHwoMTI3JnRbZV0ucHQpPDwyNHwoMjYyMTQzJnRbZV0udHNfb2Zmc2V0KTw8MTB8MTAyMyZ0W2VdLmxlbmd0aCk+Pj4wO25bYSsrXT1yPj4yNCYyNTUsblthKytdPXI+PjE2JjI1NSxuW2ErK109cj4+OCYyNTUsblthKytdPTI1NSZyfWVsc2UgblthKytdPTEyNyZ0W2VdLnB0O2Zvcihjb25zdCBlIG9mIHQpbi5zZXQoZS5kYXRhLGEpLGErPWUubGVuZ3RoO3JldHVybiBufShlLm1hcCgodD0+e2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>Qf.revokeObjectURL(e),0),new Worker(Qf.createObjectURL(e))}const eM=71,wR=1,AR=2,bR=1,tM=2;var ya=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(ya||{});function OR(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=e.getUint8(0);if(n!==eM)return;const r=e.getUint16(1),i=wR+AR+r,s=new Uint8Array(e.byteLength-i);s.set(new Uint8Array(e.buffer,i,e.byteLength-i));const a={m:n,tlvLen:r,tlv:[],frame:s};let d=wR+AR;for(;d<i;){const l=e.getUint8(d),h=e.getUint16(d+bR),p=bR+tM;if(l===ya.AUDIO_LEVEL){let _=e.getUint8(d+p);for(let m=1;m<h;m++)_=_<<8|e.getUint8(d+p+m);a.tlv.push({tag:l,length:h,value:t?127^_>>1:127&_})}else if(l===ya.METADATA||l===ya.AUDIO_64_BIT_PTS){const _=new Uint8Array(h);for(let m=0;m<h;m++)_[m]=e.getUint8(d+p+m);a.tlv.push({tag:l,length:h,value:_})}d+=p+h}return a}const $_=new Map,em=127,Fc=1e-10,NR=139/13,tm=new Map;function DR(e,t,n){const r="".concat(e,"-").concat(t,"-").concat(n);let i=0;return tm.has(r)?i=tm.get(r):(i=Math.log(function(a,d){const l=a-d;d<l&&(d=l);let h=1;for(let p=a,_=1;p>d;p--,_++)h=h*p/_;return h}(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(n)+n*e,tm.set(r,i)),i<Fc&&(i=Fc),i}function nM(e,t,n){const r=t.length,i=e.length/r;let s=!1;for(let a=0,d=0;a<r;a++){let l=0;for(let h=d+i;d<h;d++)e[d]>n&&l++;t[a]!==l&&(t[a]=l,s=!0)}return s}window.cache=tm;let VJ=0;class rM{constructor(t){H(this,"id",void 0),H(this,"immediates",[]),H(this,"lastNonSilence",-1),H(this,"immediateSpeechActivityScore",Fc),H(this,"lastLevelChangedTime",Date.now()),H(this,"levels",[]),H(this,"longs",[]),H(this,"longSpeechActivityScore",Fc),H(this,"mediums",[]),H(this,"mediumSpeechActivityScore",Fc),H(this,"minLevel",0),H(this,"nextMinLevel",0),H(this,"nextMinLevelWindowLength",0),H(this,"energyScore",0),this.id=t||"".concat(VJ++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const t=this.immediates,n=this.levels,r=this.minLevel+NR;let i=!1;for(let s=0;s<t.length;++s){let a=n[s];a<r&&(a=0);const d=Math.floor(a/NR);t[s]!==d&&(t[s]=d,i=!0)}return i}computeLongs(){return nM(this.mediums,this.longs,4)}computeMediums(){return nM(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=DR(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=DR(this.longs[0],10,47),this.longSpeechActivityScore>Fc&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=DR(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(CA(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,n){if(this.lastLevelChangedTime<=n){this.lastLevelChangedTime=n;let r=t;return t<0&&(r=0),t>em&&(r=em),this.levels.unshift(r),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(r),r>=this.minLevel+NR?r:r/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let n=Math.sqrt(this.minLevel*this.nextMinLevel);n<0?n=0:n>em&&(n=em),this.minLevel=n,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class FJ{constructor(t){H(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{const n=this.algorithm.runInDecisionMaker(this);n<=0?t=!0:setTimeout(this.execute.bind(this),n)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class PR{constructor(t,n,r){H(this,"isDominant",void 0),H(this,"energyRanking",void 0),H(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=n,this.energyScore=r}}class BJ extends Vt{constructor(t){super(),H(this,"dominantId",null),H(this,"lastDecisionTime",0),H(this,"lastLevelChangedTime",0),H(this,"lastLevelIdleTime",0),H(this,"relativeSpeechActivities",[]),H(this,"speakers",new Map),H(this,"enableSilence",!1),H(this,"timeoutToSilenceInterval",0),H(this,"decisionMaker",null),H(this,"loudest",[]),H(this,"numLoudestToTrack",3),H(this,"energyExpireTimeMs",250),H(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,n!=null&&(this.energyExpireTimeMs=n),r!=null&&(this.energyAlphaPct=r),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some(n=>n.id===t)}levelChanged(t,n){const r=Date.now(),i=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<r&&(this.lastLevelChangedTime=r,this.maybeStartDecisionMaker());const s=i.levelChanged(n,r);return this.updateLoudestList(i,s,r)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach(n=>{this.speakers.has(n.id)||this.speakers.set(n.id,n)})}removeSpeakers(t){t.forEach(n=>{this.speakers.delete(n.id)})}getOrCreateSpeaker(t){let n=this.speakers.get(t);return n||(n=new rM(t),this.speakers.set(t,n),this.maybeStartDecisionMaker()),n}updateLoudestList(t,n,r){const i=t.id===this.dominantId;if(n<0){let l=0;for(;l<this.loudest.length&&this.loudest[l]!==t;)++l;return new PR(i,l,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*n+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new PR(i,0,t.energyScore);const s=r-this.energyExpireTimeMs;let a=0;for(;a<this.loudest.length;){const l=this.loudest[a];if(l.getLastLevelChangedTime()<s&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(a,1);else if(l.id!==t.id)++a;else if(this.loudest.splice(a,1),this.loudest.length<this.numLoudestToTrack)break}let d=0;for(;d<this.loudest.length&&!(this.loudest[d].energyScore<t.energyScore);)++d;return d<this.numLoudestToTrack&&(this.loudest.splice(d,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new PR(i,d,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new FJ(this),this.decisionMaker.execute())}makeDecision(t){let n=null,r=null;const i=this.speakers.size;let s=null;if(i===0)s=null;else if(i===1){var a;const d=Xr(a=this.speakers).call(a).next().value;this.enableSilence&&d&&(s=d.id,d.evaluateSpeechActivityScores(t),t-d.lastNonSilence>this.timeoutToSilenceInterval&&(s=null))}else{let d=this.dominantId==null?null:this.speakers.get(this.dominantId);if(d==null){const p=this.speakers.entries().next();p.value&&(s=p.value[0],d=p.value[1])}else s=d.id;d!=null&&d.evaluateSpeechActivityScores(t);const l=this.relativeSpeechActivities;let h=2;for(const p of this.speakers.entries()){const[_,m]=p;if(m===d)continue;m.evaluateSpeechActivityScores(t);for(let y=0;y<l.length;++y){const b=d==null?Fc:d.getSpeechActivityScore(y);l[y]=Math.log(m.getSpeechActivityScore(y)/b)}const g=l[0],w=l[1],R=l[2];g>3&&w>2&&R>0&&w>h&&(h=w,s=_)}this.enableSilence&&d!=null&&s===d.id&&t-d.lastNonSilence>this.timeoutToSilenceInterval&&(s=null)}s==null&&!this.enableSilence||s===this.dominantId||(n=this.dominantId,this.dominantId=s,r=this.dominantId),r==null&&!this.enableSilence||r===n||this.emit("ActiveSpeakerChanged",r)}_runInDecisionMaker(){const t=Date.now(),n=300-(t-this.lastLevelIdleTime);let r=0;n<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):r=n;let i=300-(t-this.lastDecisionTime);return i<=0&&(this.lastDecisionTime=t,this.makeDecision(t),i=300-(Date.now()-t)),i>0&&r>i&&(r=i),r}timeoutIdleLevels(t){const n=[];for(const i of Xr(r=this.speakers).call(r)){var r;const s=t-i.getLastLevelChangedTime();36e5<s&&(this.dominantId==null||i.id!==this.dominantId)?n.push(i.id):300<s&&i.levelTimedOut()}n.forEach(i=>this.speakers.delete(i))}}const wl=new Map;let Po=null,nm=null;const iM=3;let Bc=[];const Lo=new Map,rm=new Map;class jJ{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,n){H(this,"id",void 0),H(this,"track",void 0),H(this,"score",0),H(this,"active",!0),H(this,"muted",!1),H(this,"timer",0),H(this,"actives",0),H(this,"inactives",0),this.id=t,this.track=n,this.setActive(Lo.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const t=this.active;this.active=this.activeRate>=.8;const{actives:n,inactives:r}=function(){const i=[],s=[];return Array.from(Xr(Lo).call(Lo)).forEach(a=>{a.active?i.push(a):s.push(a)}),{actives:i,inactives:s}}();if(n.length>3){let i;n.forEach(s=>{(!i||i.score>s.score)&&(i=s)}),i&&i.setActive(!1)}if(n.length<3&&r.length>0){let i;r.forEach(s=>{(!i||i.score<s.score)&&s.id!==this.id&&(i=s)}),i&&t&&!this.active&&(i.samples>40&&i.activeRate-this.activeRate>.4?i.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const t=function(n){let r;return Array.from(Xr(Lo).call(Lo)).forEach(i=>{!i.active||i.id===n||i.samples<40||(!r||i.score<r.score)&&(r=i)}),r}(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const t=function(n){let r;return Array.from(Xr(Lo).call(Lo)).forEach(i=>{i.active||i.id===n||i.samples<40||(!r||i.score>r.score)&&(r=i)}),r}(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let im;function oM(e){const t=Lo.get(e);t&&(Lo.delete(e),t.clearTimer())}const om=new Map,GJ=new Map,LR="video/h264",kR="video/h265";function sM(e,t,n){let r=new Uint8Array(e,t,n),i=[],s=0;for(;i.length<n;)s+3<n&&r[s]===0&&r[s+1]===0&&r[s+2]===3&&(r[s+3]===0||r[s+3]===1||r[s+3]===2||r[s+3]===3)?(i.push(r[s],r[s+1],r[s+3]),s+=4):(i.push(r[s]),s++);return new Uint8Array(i)}function aM(e){const t=e.length;let n=[],r=0;for(;r<t;)r+2<t&&e[r]===0&&e[r+1]===0&&(e[r+2]===0||e[r+2]===1||e[r+2]===2||e[r+2]===3)?(n.push(e[r],e[r+1],3,e[r+2]),r+=3):(n.push(e[r]),r++);return new Uint8Array(n)}function cM(e){if(e.length<5)return"";let t=-1;for(let i=0;i<e.length-3;i++){if(e[i]===0&&e[i+1]===0&&e[i+2]===1){t=i;break}if(i<e.length-4&&e[i]===0&&e[i+1]===0&&e[i+2]===0&&e[i+3]===1){t=i;break}}if(t===-1)return"";const n=t+(e[t+2]===0?4:3);if(n>=e.length)return"";const r=e[n];return 128&r?"":(r>>1&63)>=32||n+1<e.length&&!(248&e[n+1])?kR:(31&r)<=31?LR:""}const sm=new Map,wh=new Map;(function(){const e=rt();vn.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),vn.getStreamFromExtension=e.name===ot.CHROME&&Number(e.version)>34,vn.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let n=!1;try{t.addTransceiver("audio"),n=!0}catch{}return t.close(),n}(),vn.supportMinBitrate=e.name===ot.CHROME||e.name===ot.EDGE,vn.supportSetRtpSenderParameters=function(){const t=rt();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!as()||!(!An()&&!L_())||t.name===ot.FIREFOX&&Number(t.version)>=64)}(),e.name===ot.SAFARI&&(Number(e.version)>=14?vn.supportDualStream=!0:vn.supportDualStream=!1),vn.webAudioMediaStreamDest=function(){const t=rt();return!(t.name===ot.SAFARI&&Number(t.version)<12)}(),vn.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",vn.supportWebGL=typeof WebGLRenderingContext<"u",vn.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,as()||(vn.webAudioWithAEC=!0),vn.supportShareAudio=function(){const t=rt();return(t.os===Sn.WIN_10||t.os===Sn.WIN_81||t.os===Sn.WIN_7||t.os===Sn.LINUX||t.os===Sn.MAC_OS||t.os===Sn.CHROMIUM_OS)&&t.name===ot.CHROME&&Number(t.version)>=74}(),vn.supportDataChannel=!!(No(76)||Vv(68)||$P(14)),vn.supportPCSetConfiguration=function(){const t=window.RTCPeerConnection;return!Nt()&&!!t&&t.prototype.setConfiguration instanceof Function}(),vn.supportWebRTCEncodedTransform=No(87)||JP()||Vv(117),vn.supportWebRTCInsertableStream=function(){const t=rt();return(t.name===ot.CHROME||t.name===ot.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),vn.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,vn.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,vn.supportSuppressLocalAudioPlayback=YL(),vn.supportRestrictOwnAudio=zL(),M_(()=>{vn.supportDualStreamEncoding=function(){const t=rt();return!!A("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&A("CHROME_DUAL_STREAM_USE_ENCODING"))}(),T.debug("browser ua: ",navigator.userAgent),T.info("browser info: ",e),T.info("browser compatibility: ",vn)})})();const WJ=["CHINA","GLOBAL"],dM=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],jc=[],Al=[];function Gc(e,t){return!!t&&jc.some(n=>n.uid===e&&n.channelName===t)}function MR(){return Al.length>0}var HJ=mD.forEach,lM=df("forEach")?[].forEach:function(e){return HJ(this,e,arguments.length>1?arguments[1]:void 0)};ut({target:"Array",proto:!0,forced:[].forEach!==lM},{forEach:lM});var KJ=bi("Array","forEach"),YJ=ua,zJ=$n,qJ=Q,XJ=KJ,UR=Array.prototype,JJ={DOMTokenList:!0,NodeList:!0},QJ=function(e){var t=e.forEach;return e===UR||qJ(UR,e)&&t===UR.forEach||zJ(JJ,YJ(e))?XJ:t},ZJ=E(QJ),$J=ts,uM=_f;ut({target:"Object",stat:!0,forced:S(function(){uM(1)})},{keys:function(e){return uM($J(e))}});var eQ=E(oi.Object.keys),tQ=E(vA),nQ=E(yA),rQ=ut,hM=Vu,iQ=Of,oQ=ur,pM=Xg,sQ=la,aQ=ca,cQ=fT,dQ=cn,lQ=pa,uQ=sD("slice"),hQ=dQ("species"),xR=Array,pQ=Math.max;rQ({target:"Array",proto:!0,forced:!uQ},{slice:function(e,t){var n,r,i,s=aQ(this),a=sQ(s),d=pM(e,a),l=pM(t===void 0?a:t,a);if(hM(s)&&(n=s.constructor,(iQ(n)&&(n===xR||hM(n.prototype))||oQ(n)&&(n=n[hQ])===null)&&(n=void 0),n===xR||n===void 0))return lQ(s,d,l);for(r=new(n===void 0?xR:n)(pQ(l-d,0)),i=0;d<l;d++,i++)d in s&&cQ(r,i,s[d]);return r.length=i,r}});var fQ=bi("Array","slice"),_Q=Q,mQ=fQ,VR=Array.prototype,EQ=function(e){var t=e.slice;return e===VR||_Q(VR,e)&&t===VR.slice?mQ:t},gQ=E(EQ);function ce(e,t,n,r,i){var s,a,d,l={};return ZJ(s=eQ(r)).call(s,function(h){l[h]=r[h]}),l.enumerable=!!l.enumerable,l.configurable=!!l.configurable,("value"in l||l.initializer)&&(l.writable=!0),l=tQ(a=nQ(d=gQ(n).call(n)).call(d)).call(a,function(h,p){return p(e,t,h)||h},l),i&&l.initializer!==void 0&&(l.value=l.initializer?l.initializer.call(i):void 0,l.initializer=void 0),l.initializer===void 0?(nD(e,t,l),null):l}let am=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),FR=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),Mi=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e[e.REQ_DOWNGRADE_FALLBACK=27]="REQ_DOWNGRADE_FALLBACK",e}({}),Er=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),Ie=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.K_VOS_FALLBACK=30]="K_VOS_FALLBACK",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),Ze=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),ve=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_CONNECTING="datachannel_connecting",e.DATACHANNEL_FAILBACK="datachannel_failback",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e.VOS_FALLBACK="vos_fallback",e.VOS_FALLBACK_PROMISE="vos_fallback_promise",e}({}),ye=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SET_DUAL_STREAM_MODE="set_dual_stream_mode",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.CONFIGURE="configure",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e.DOWNGRADE_CODEC="downgrade_codec",e}({}),Wc=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),Me=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e.ENABLE_MULTI_STREAM="enable_multi_stream",e}({}),gr=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),Be=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e.ON_FALLBACK="websocket:on_fallback",e}({});function cm(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw T.error("Invalid Channel Name ".concat(e)),new j(O.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function dm(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||cL(e,1,255)))throw new j(O.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&T.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Bs=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const SQ={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},BR={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function jR(e,t){Mn(e.url,"".concat(t,".url"),1,1e3,!1),Wt(e.x)||Rt(e.x,"".concat(t,".x"),0,1e4),Wt(e.y)||Rt(e.y,"".concat(t,".y"),0,1e4),Wt(e.width)||Rt(e.width,"".concat(t,".width"),0,1e4),Wt(e.height)||Rt(e.height,"".concat(t,".height"),0,1e4),Wt(e.zOrder)||Rt(e.zOrder,"".concat(t,".zOrder"),0,255),Wt(e.alpha)||Rt(e.alpha,"".concat(t,".alpha"),0,1,!1)}const TQ={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Ca=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),GR=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),_n=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function fM(e){if(!e.channelName)throw new j(O.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new j(O.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&Mn(e.token,"info.token",1,2047),dm(e.uid),cm(e.channelName),!0}let Ar=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),js=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),xr=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),bl=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),ft=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),Qt=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e.VOS_FALLBACK="vos-fallback",e.VOS_FALLBACK_PROMISE="vos-fallback-promise",e.RESET_SIGNAL="reset-signal",e.DATACHANNEL_FAILBACK="datachannel-failback",e}({}),lm=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),Rn=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),at=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const _M=[at.AFRICA,at.ASIA,at.CHINA,at.EUROPE,at.GLOBAL,at.INDIA,at.JAPAN,at.NORTH_AMERICA,at.OCEANIA,at.OVERSEA,at.SOUTH_AMERICA];let qn=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const um={CHINA:{},ASIA:{CODE:qn.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:qn.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:qn.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:qn.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:qn.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:qn.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:qn.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:qn.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:qn.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:qn.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:qn.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:qn.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:qn.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};iR&&(um.CHINA={CODE:qn.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let ko=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e.UPDATE_REMOTE_VIDEO_STREAM_TYPE="update_remote_video_stream_type",e.FALLBACK_TO_HLS="fallback_to_hls",e.UPDATE_VOS_CONFIGURE="update_vos_configure",e}({});function mM(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class EM extends Vt{constructor(t,n){super(),I(this,"onICEConnectionStateChange",void 0),I(this,"onConnectionStateChange",void 0),I(this,"onDTLSTransportStateChange",void 0),I(this,"onDTLSTransportError",void 0),I(this,"onICETransportStateChange",void 0),I(this,"onFirstAudioReceived",void 0),I(this,"onFirstVideoReceived",void 0),I(this,"onFirstAudioDecoded",void 0),I(this,"onFirstVideoDecoded",void 0),I(this,"onFirstVideoRender",void 0),I(this,"onFirstVideoBufferReady",void 0),I(this,"onFirstVideoDecodedTimeout",void 0),I(this,"onSelectedLocalCandidateChanged",void 0),I(this,"onSelectedRemoteCandidateChanged",void 0),I(this,"onICECandidateError",void 0),I(this,"getLocalVideoStats",void 0)}}class hm extends EM{constructor(t,n){super(t,n),I(this,"establishPromise",void 0)}}let _e=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),On=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),Gs=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const gM=["disconnected","failed"];let ne=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),dt=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),Ce=function(e){return e.AudioMetadata="audioMetadata",e.AudioPts="audioPts",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e.FirstVideoPreRender="FirstVideoPreRender",e.FirstVideoBufferReady="FirstVideoBufferReady",e}({}),so=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),ao=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Nn=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),Ia=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e}({}),mn=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),us=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),Ui=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Mo=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),Ol=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Zt=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),Nl=function(e){return e.ABORT="abort",e}({}),wa=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),vQ=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const RQ={[am.ACCESS_POINT]:{[Er.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Er.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Er.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Er.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Er.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Er.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Er.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Er.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Er.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Er.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Er.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Er.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Er.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Er.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Er.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Er.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Er.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Er.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[am.UNILBS]:{[Mi.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Mi.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Mi.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Mi.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Mi.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Mi.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Mi.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Mi.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Mi.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Mi.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Mi.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Mi.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1},[Mi.REQ_DOWNGRADE_FALLBACK]:{desc:"request downgrade fallback",retry:!1}},[am.STRING_UID_ALLOCATOR]:{[FR.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[FR.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[FR.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Dl(e){const t=RQ[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===am.ACCESS_POINT){const r=e%1e4;if(r.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(r.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const yQ={[Ie.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Ie.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Ie.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Ie.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Ie.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Ie.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Ie.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Ie.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Ie.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Ie.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Ie.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Ie.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Ie.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Ie.K_VOS_FALLBACK]:{desc:"K_VOS_FALLBACK",action:"tryNext"},[Ie.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Ie.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Ie.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Ie.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Ie.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Ie.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Ie.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Ie.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Ie.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Ie.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Ie.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Ie.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Ie.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Ie.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Ie.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Ie.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Ie.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Ie.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Ie.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Ie.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Ie.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Ie.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Ie.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Ie.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Ie.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Ie.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Ie.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Ie.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Ie.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ie.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ie.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Ie.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Ie.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Ie.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Ie.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Ie.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Ie.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Ie.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Ie.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Ie.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Ie.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Ie.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Ie.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Ie.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Ie.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Ie.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Ie.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Ie.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Ie.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Ie.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Ie.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Hc(e){return yQ[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function SM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function WR(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?SM(Object(n),!0).forEach(function(r){I(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):SM(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function HR(e,t){if(typeof e=="string")return e;const{proxy:n,host:r,port:i}=e;if(t){const s=A("JOIN_GATEWAY_FALLBACK_PORT")||443;return s===443?"wss://".concat(r,"/ws/?p=").concat(Number(i)+150):"wss://".concat(r,":").concat(s,"/ws/?p=").concat(Number(i)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(r,"&p=").concat(i):"wss://".concat(r,":").concat(i)}const CQ=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,IQ=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,wQ=/wss:\/\/(.+):([0-9]+)\/?/,AQ=/wss:\/\/(.[^\/]+)\/?/;let bQ=0;class OQ{constructor(t,n){I(this,"id",0),I(this,"store",void 0),I(this,"recordIndex",void 0),I(this,"websockets",[]),I(this,"try443PortDuration",2e3),I(this,"forceCloseWSDuration",5e3),I(this,"try443PortTimeout",null),I(this,"forceCloseTimeout",null),I(this,"isTry443PortFailed",!1),I(this,"isNormalPortFailed",!1),I(this,"useDoubleDomain",!1),I(this,"useProxy",!1),I(this,"startTime",Date.now()),this.id=++bQ,this.try443PortDuration=A("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;const n=Date.now()-this.startTime;for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];T.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...i)}createWebSocket(t,n,r){this.logger("createWebSocket:",t,{isTry443Port:n,hasTimeoutDetection:r});const i=A("GATEWAY_DOMAINS"),s=Date.now(),a=[],d=i.find(m=>{var g;return te(g=t.host).call(g,m)});d||(this.useDoubleDomain=!1);const l=[];if(this.useDoubleDomain)i.forEach(m=>{l.push(HR(WR(WR({},t),{},{host:t.host.replace(d,m)}),n))});else{const m=WR({},t);if(n&&d){const g=i.find(w=>w!==d);g&&(m.host=m.host.replace(d,g))}l.push(HR(m,n))}try{l.forEach(m=>{const g=new WebSocket(m);g.binaryType="arraybuffer",a.push(g),this.logger("ws is connecting:",g.url)})}catch(m){if(this.logger("ws create failed"),a.forEach(g=>g.close()),a.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,n,r);if(!n&&Number(t.port)!==443)return this.createWebSocket(t,!0,r);throw new j(O.WS_ERR,"init websocket failed! Error: ".concat(m.toString()))}const h=fh();this.store&&this.store.recordJoinChannelService({urls:a.map(m=>m.url),service:"gateway"},this.recordIndex),a.forEach(m=>{m.onopen=()=>{this.logger("onopen: ws ".concat(m.url," open cost ").concat(Date.now()-s,"ms")),this.websockets.forEach(g=>{g!==m&&(g.onopen=null,g.onclose=null,g.onmessage=null,g.close(),this.logger("close backup websocket: ".concat(g.url)))}),this.websockets.length=0,h.resolve(m)},m.onclose=g=>{this.logger("onclose: ws ".concat(m.url," closed cost ").concat(Date.now()-s,"ms state: ").concat(m.readyState));const w=a.every(R=>R.readyState===WebSocket.CLOSED||R.readyState===WebSocket.CLOSING);this.logger("".concat(n?"443":"47xx"," websocket closed, all failed: ").concat(w)),w&&(n||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(g.reason)),h.reject({code:g.code,reason:lm.A_ROUND_WS_FAILED})):!n&&w&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),_()),n?this.isTry443PortFailed=w:this.isNormalPortFailed=w},m.onmessage=g=>this.logger("".concat(m.url," onmessage: ").concat(g.data))}),this.websockets.push(...a);const p=()=>{this.websockets.forEach(m=>m.readyState!==WebSocket.OPEN&&m.close())},_=()=>{if(h.isResolved)return p();rt().os===Sn.MAC_OS&&Nt()&&p(),this.createWebSocket(t,!0,!0).then(m=>{h.resolve(m)}).catch(m=>{this.isNormalPortFailed&&h.reject(m),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",h.isResolved),this.forceCloseTimeout=null,p()},this.forceCloseWSDuration)};return r||(()=>{if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,p()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",h.isResolved),this.try443PortTimeout=null,_()},this.try443PortDuration)})(),h.promise}chooseBestWebsocket(t,n,r,i){return this.useDoubleDomain=!!n,typeof t=="string"&&(t=function(s){let a,d,l;return[,a,d,l]=s.match(CQ)||[],a||([,d,l]=s.match(IQ)||[]),d&&l||([,d,l]=s.match(wQ)||[]),d&&l||([,d]=s.match(AQ)||[]),d||T.warning("un-destructible url: ",s),{proxy:a,host:d,port:l||"443"}}(t)),this.recordIndex=i,this.useProxy=!!t.proxy,r&&this.useProxy&&(T.warn("cannot use 443 only when use proxy"),r=!1),this.createWebSocket(t,!!r,!1).finally(()=>this.clearTimeout())}}function TM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}class vM extends Vt{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var n;te(n=["tryNext","recover"]).call(n,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(Be.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Be.CONNECTED):this._state==="closed"?this.emit(Be.CLOSED):this._state==="failed"&&this.emit(Be.FAILED))}resetReconnectCount(t){T.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,n){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2],i=arguments.length>3&&arguments[3]!==void 0&&arguments[3],s=arguments.length>4&&arguments[4]!==void 0&&arguments[4],a=arguments.length>5?arguments[5]:void 0;super(),I(this,"_websocketUrl",null),I(this,"connectionID",0),I(this,"currentURLIndex",0),I(this,"urls",[]),I(this,"_reconnectMode","tryNext"),I(this,"reconnectReason",void 0),I(this,"_initMutex",void 0),I(this,"name",void 0),I(this,"_state","closed"),I(this,"reconnectInterrupter",void 0),I(this,"websocket",void 0),I(this,"retryConfig",void 0),I(this,"reconnectCount",0),I(this,"forceCloseTimeout",5e3),I(this,"onlineReconnectListener",void 0),I(this,"useCompress",void 0),I(this,"tryDoubleDomain",!1),I(this,"use443PortOnly",!1),I(this,"wsInflateLength",0),I(this,"wsDeflateLength",0),I(this,"closeEstablishingWs",()=>{}),I(this,"store",void 0),I(this,"joinGatewayRecordIndex",void 0),this.store=a,this.name=t,this.retryConfig=function(_){for(var m=1;m<arguments.length;m++){var g=arguments[m]!=null?arguments[m]:{};m%2?TM(Object(g),!0).forEach(function(w){I(_,w,g[w])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_,Object.getOwnPropertyDescriptors(g)):TM(Object(g)).forEach(function(w){Object.defineProperty(_,w,Object.getOwnPropertyDescriptor(g,w))})}return _}({},n),this.useCompress=r,this.tryDoubleDomain=i,this.use443PortOnly=s,this._initMutex=new bn("websocket",a?a.clientId:void 0);const{timeout:d,timeoutFactor:l}=n,h=Math.max(300,Math.floor(3*d/5)),p=Math.max(1.2,Math.floor(8*l)/10);fr.ONLINE&&(this.retryConfig.timeout=h,this.retryConfig.timeoutFactor=p),Ht.on(bc.NETWORK_STATE_CHANGE,(_,m)=>{_!==m&&(this.resetReconnectCount("network state change: ".concat(m," -> ").concat(_)),_===fr.ONLINE?(this.retryConfig.timeout=h,this.retryConfig.timeoutFactor=p):(this.retryConfig.timeout=d,this.retryConfig.timeoutFactor=l))})}getConnection(){return this.websocket||void 0}async init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=n,this.urls=t,this.state="connecting";try{var i;const s=fh(),a=this.urls[this.currentURLIndex];(i=this.store)===null||i===void 0||i.beforeConnect(),function(d){return!(H_()||A("USE_NEW_TOKEN")||!A("ENABLE_PREALLOC_PC")&&(d==null||!d.autoSubscribe||A("FORCE_DISABLE_AUTO_SUB")))}(this.store)&&this.emit(mn.PRE_CONNECT_PC),this.createWebSocketConnection(a).then(s.resolve).catch(s.reject),this.once(Be.CLOSED,()=>{s.reject(new Y(O.WS_DISCONNECT))}),this.once(Be.CONNECTED,s.resolve),await s.promise}catch{}finally{r()}}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const r=this.websocket;n?setTimeout(()=>r.close(),500):r.close(),this.websocket=void 0,this._websocketUrl=null}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,n){if(!this.websocket)return void T.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),T.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const r=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),r&&r.bind(this.websocket)({code:9999,reason:n})}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Y(O.WS_ABORT,"websocket is not ready");try{n||(t=JSON.stringify(t)),this.websocket.send(t)}catch(r){throw new Y(O.WS_ERR,"send websocket message error"+r.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var n;const r=fh();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const i=p=>{var _;(_=this.store)===null||_===void 0||_.signalChannelOpen(),T.debug("[".concat(this.name,"] websocket opened:"),p),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),r.resolve()},s=async p=>{var _;if(T.debug("[".concat(this.name,"] websocket close ").concat((_=this.websocket)===null||_===void 0?void 0:_.url,", code: ").concat(p.code,", reason: ").concat(p.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)r.reject(new Y(O.WS_DISCONNECT,"websocket close: ".concat(p.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=p.reason,this.state="reconnecting");const m=Zr(this,Be.WILL_RECONNECT,this.reconnectMode,p.reason)||this.reconnectMode,g=await this.reconnectWithAction(m);if(this.state==="closed")return void T.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!g)return r.reject(new Y(O.WS_DISCONNECT,"websocket reconnect failed: ".concat(p.code))),this.close(!0);r.resolve()}},a=p=>{this.emit(Be.ON_MESSAGE,p)},d=p=>{T.warn("[".concat(this.connectionID,"] ws open error ").concat(p))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),A("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=A("GATEWAY_WSS_ADDRESS")),T.debug("[".concat(this.name,"] start connect, url:"),t);const l=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var h;this._websocketUrl=HR(t);const p=await this.chooseBestWebsocketConnection(t);this.websocket=p,i&&i(this.websocket.url),this.websocket.onclose=s,this.websocket.onmessage=a,this.websocket.onerror=d,(h=this.store)===null||h===void 0||h.recordJoinChannelService({endTs:Date.now(),status:"success"},l),this.joinGatewayRecordIndex=l}catch(p){const _=this.state==="closed",m=p instanceof Y,g=m&&p.code===O.WS_ABORT,w=m&&p.code===O.WS_ERR,R=m?p.message:p&&(p.reason||p.toString());T.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(R)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:g?"aborted":"error",errors:[p]},l),_||w?(r.reject(_?new Y(O.WS_DISCONNECT,"websocket is closed: ".concat(R)):new Y(O.WS_ERR,"init websocket failed: ".concat(R))),w&&T.error("[".concat(this.name,"] init websocket failed: ").concat(R))):s&&s(p)}return r.promise}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;T.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||Ht.isOnline||!Ht.onlineWaiter||(this.onlineReconnectListener=Ht.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let r=!0;if(this.reconnectInterrupter=()=>r=!1,n){const a=U_(this.reconnectCount,this.retryConfig);T.debug("[".concat(this.name,"] wait ").concat(a,"ms to reconnect websocket, mode: ").concat(t)),await ae.race([Tn(a),this.onlineReconnectListener||new ae(()=>{})])}if(this._state==="closed"||!r)return!1;this.reconnectCount+=1;const i=async(a,d)=>{this.emit(Be.RECONNECT_CREATE_CONNECTION,d),await this.createWebSocketConnection(a)};try{if(t==="retry")await i(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);T.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await i(this.urls[this.currentURLIndex],t)}else t==="recover"&&(T.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await dn(this,Be.REQUEST_NEW_URLS),this.currentURLIndex=0,await i(this.urls[this.currentURLIndex],t))}catch(a){var s;T.error("[".concat(this.name,"] reconnect failed ").concat(a&&a.toString()));const d=a==null||(s=a.data)===null||s===void 0?void 0:s.desc;if(Array.isArray(d)){if(te(d).call(d,"dynamic key expired"))return this.emit(Be.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1;if(te(d).call(d,"request downgrade fallback"))return this.emit(Be.ON_FALLBACK),!1}return this.reconnectWithAction(t,n)}return!0}}class KR extends vM{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){const r=fh(),i=function(a,d){return new OQ(a,d)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{T.debug("[choose-best-ws] close establishing websockets"),i.closeAllWebsockets(),r.reject(new Y(O.WS_ABORT,"choose best websocket aborted"))};const s=A("GATEWAY_DOMAINS");return T.debug("[choose-best-ws] currentDomain: ",t,", domains: ",s,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),i.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,n).then(r.resolve).catch(r.reject),r.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class Ah extends vM{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){return new ae((r,i)=>{let s=!1;const a=[];this.closeEstablishingWs=()=>{T.debug("[choose-best-ws] close establishing websockets"),a.forEach(w=>{w.onclose=null,w.onopen=null,w.onmessage=null,w.close()}),i(new Y(O.WS_ABORT,"choose best websocket aborted"))};const d=A("GATEWAY_DOMAINS");let l;const h=t.indexOf("?h="),p=d.find(w=>h!==-1?te(t).call(t,w,h):te(t).call(t,w));T.debug("[choose-best-ws] currentDomain: ",p,", domains: ",d);let _=!this.tryDoubleDomain||!p;if(!_&&p){var m;const w=Date.now();try{d.forEach(R=>{const y=h===-1?t.replace(p,R):t.substr(0,h)+t.substr(h).replace(p,R),b=new WebSocket(y);b.binaryType="arraybuffer",a.push(b),T.debug("[choose-best-ws] ws is connecting:",b.url)})}catch{for(T.debug("[choose-best-ws] ws create failed, fallback to single url"),a.forEach(y=>y.close());a.length;)a.pop();_=!0}(m=this.store)===null||m===void 0||m.recordJoinChannelService({urls:a.map(R=>R.url),service:"gateway"},n),a.forEach(R=>{R.onopen=()=>{if(s)return;const y=Date.now()-w;T.debug("[choose-best-ws] ws open cost ".concat(y,"ms")),a.filter(b=>b!==R).forEach(b=>{T.debug("[choose-best-ws]close backup websocket: ".concat(b.url)),b.close()}),s=!0,r(R)},R.onclose=y=>{l=y,!s&&(a.find(b=>!(b.readyState===WebSocket.CLOSED||b.readyState===WebSocket.CLOSING))||(T.debug("[choose-best-ws] all websocket is closed"),s=!0,i(l)))},R.onmessage=y=>{T.debug("[choose-best-ws]".concat(R.url," onmessage: ").concat(y.data))}}),Tn(this.forceCloseTimeout).then(()=>{a.forEach(R=>{R.readyState!==WebSocket.OPEN&&R.close()})})}if(_){var g;let w;T.debug("[choose-best-ws] use single url: ",t),(g=this.store)===null||g===void 0||g.recordJoinChannelService({urls:[t],service:"gateway"},n);try{w=new WebSocket(t),a.push(w),w.binaryType="arraybuffer"}catch(R){const y=new Y(O.WS_ERR,"init websocket failed! Error: ".concat(R.toString()));return T.error("[".concat(this.name,"]").concat(y)),void i(y)}w.onopen=()=>{r(w)},w.onclose=R=>{i(R)},w.onmessage=R=>{T.debug("[choose-best-ws]".concat(w.url," onmessage: ").concat(R.data))},Tn(this.forceCloseTimeout).then(()=>{w&&w.readyState!==WebSocket.OPEN&&w.close()})}}).then(r=>(this.closeEstablishingWs=void 0,r)).catch(r=>{throw this.closeEstablishingWs=void 0,r})}}class RM extends Vt{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Ze.CONNECTED?this.emit(ve.WS_CONNECTED):t===Ze.RECONNECTING?this.emit(ve.WS_RECONNECTING,this._websocketReconnectReason):t===Ze.CLOSED&&this.emit(ve.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),I(this,"__name__","AgoraRTCSignal"),I(this,"_disconnectedReason",void 0),I(this,"_websocketReconnectReason",void 0),I(this,"_connectionState",Ze.CLOSED),I(this,"reconnectToken",void 0),I(this,"websocket",void 0),I(this,"openConnectionTime",void 0),I(this,"clientId",void 0),I(this,"lastMsgTime",Date.now()),I(this,"uploadCache",[]),I(this,"uploadCacheInterval",void 0),I(this,"rttRolling",new Qv(5)),I(this,"pingpongTimer",void 0),I(this,"wsInflateDataTimer",void 0),I(this,"pingpongTimeoutCount",0),I(this,"ortc",void 0),I(this,"joinResponse",void 0),I(this,"multiIpOption",void 0),I(this,"initError",void 0),I(this,"spec",void 0),I(this,"store",void 0),I(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(ve.ON_BINARY_DATA,r.data);const i=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const s="res-@".concat(i._id);this.emit(s,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){if(this.emit(i._type,i._message),i._type===Me.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===Me.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(Qe.UID_BANNED);break;case 15:this.close(Qe.IP_BANNED);break;case 16:this.close(Qe.CHANNEL_BANNED)}if(i._type===Me.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case Ie.ERR_LICENSE_MISSING:this.close(Qe.LICENSE_MISSING);break;case Ie.ERR_LICENSE_EXPIRED:this.close(Qe.LICENSE_EXPIRED);break;case Ie.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Qe.LICENSE_MINUTES_EXCEEDED);break;case Ie.ERR_LICENSE_PERIOD_INVALID:this.close(Qe.LICENSE_PERIOD_INVALID);break;case Ie.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Qe.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ie.ERR_LICENSE_ILLEGAL:this.close(Qe.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new KR("gateway-".concat(this.clientId),this.spec.retryConfig,!0,A("JOIN_GATEWAY_USE_DUAL_DOMAIN"),A("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Ze.CONNECTED&&this.reconnect("retry",jn.OFFLINE)})}async request(t,n,r,i){const s=ht(6,""),a={_id:s,_type:t,_message:n},d=this.websocket.connectionID,l=()=>new ae((w,R)=>{if(this.connectionState===Ze.CONNECTED)return w();const y=()=>{this.off(ve.WS_CLOSED,b),w()},b=()=>{this.off(ve.WS_CONNECTED,y),R(new j(O.WS_ABORT))};this.once(ve.WS_CONNECTED,y),this.once(ve.WS_CLOSED,b),t!==ye.PUBLISH&&t!==ye.PUBLISH_DATASTREAM&&t!==ye.SUBSCRIBE&&t!==ye.SUBSCRIBE_DATASTREAM&&t!==ye.UNSUBSCRIBE&&t!==ye.UNSUBSCRIBE_DATASTREAM&&t!==ye.UNPUBLISH&&t!==ye.UNPUBLISH_DATASTREAM&&t!==ye.CONTROL&&t!==ye.RESTART_ICE||this.once(ve.DISCONNECT_P2P,()=>{R(new j(O.DISCONNECT_P2P))}),t!==ye.PUBLISH&&t!==ye.RESTART_ICE||this.once(ve.ABORT_P2P_EXECUTION,()=>{R(new j(O.DISCONNECT_P2P))})});if(this.connectionState!==Ze.CONNECTING&&this.connectionState!==Ze.RECONNECTING||t===ye.JOIN||t===ye.REJOIN||await l(),this.websocket.sendMessage(a,!0),i)return;const h=new ae((w,R)=>{let y=!1;const b=(L,x)=>{y=!0,w({isSuccess:L==="success",message:x||{}}),this.off(ve.WS_CLOSED,N),this.off(ve.WS_RECONNECTING,N),this.emit(ve.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(s),b);const N=()=>{R(new j(O.WS_ABORT,"type: ".concat(t))),this.off(ve.WS_CLOSED,N),this.off(ve.WS_RECONNECTING,N),this.off("res-@".concat(s),b)};this.once(ve.WS_CLOSED,N),this.once(ve.WS_RECONNECTING,N),Tn(A("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==d||y||(T.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(ve.REQUEST_TIMEOUT,t,n))})});let p=null;try{p=await h}catch(w){if(this.connectionState===Ze.CLOSED||t===ye.LEAVE)throw new j(O.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?w.throw():t===ye.JOIN||t===ye.REJOIN?null:(await l(),await this.request(t,n))}if(p.isSuccess)return p.message;const _=Number(p.message.error_code||p.message.code),m=Hc(_),g=new j(O.UNEXPECTED_RESPONSE,"".concat(m.desc,": ").concat(p.message.error_str),{code:_,data:p.message,desc:m.desc});return m.action==="success"?p.message:(T.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(_,", message: ").concat(m.desc,", action: ").concat(m.action)),_===Ie.ERR_TOO_MANY_BROADCASTERS?((t===ye.JOIN||t===ye.REJOIN)&&(this.initError=g,this.close()),g.throw()):m.action==="failed"?g.throw():m.action==="quit"?(this.initError=g,this.close(),g.throw()):(_===Ie.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=p.message.option,T.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",jn.MULTI_IP)):this.reconnect(m.action,jn.SERVER_ERROR),t===ye.JOIN||t===ye.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new ae(r=>{const i=s=>{(!n||n(s))&&(this.off(t,i),r(s))};this.on(t,i)})}uploadWRTCStats(t){if(!this.store.sessionId)return void T.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Wc.WRTC_STATS,n)}upload(t,n){const r={_type:t,_message:n};try{this.websocket.sendMessage(r)}catch{const s=A("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Ze.CONNECTED)return;const a=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(a._type,a._message)},A("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const r={_type:t,_message:n};this.websocket.sendMessage(r)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ae((n,r)=>{this.once(ve.WS_CONNECTED,()=>n(this.joinResponse)),this.once(ve.WS_CLOSED,i=>r(this.initError||new j(O.WS_ABORT,i))),this.connectionState=Ze.CONNECTING,this.websocket.init(t).catch(r),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||Qe.LEAVE,this.connectionState=Ze.CLOSED,T.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(ve.ABORT_P2P_EXECUTION),this.store.signalConnected();const t=await dn(this,ve.REQUEST_JOIN_INFO);this.store.joinReq();const n=await this.request(ye.JOIN,t);if(this.ortc=t==null?void 0:t.ortc,this.store.joinRep(),!n)return this.emit(ve.REPORT_JOIN_GATEWAY,lm.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(ve.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Ze.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new j(O.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=Oc(this,ve.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(ye.REJOIN,t);return!!n&&(this.connectionState=Ze.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(r=>{this.emit(Me.ON_USER_ONLINE,{uid:r.uid}),r.audio&&this.emit(Me.ON_ADD_AUDIO_STREAM,{uid:r.uid,uint_id:r.uint_id,audio:!0,ssrcId:r.audio_ssrc}),r.video&&this.emit(Me.ON_ADD_VIDEO_STREAM,{uid:r.uid,uint_id:r.uint_id,video:!0,ssrcId:r.video_ssrc}),r.audio_mute?this.emit(Me.MUTE_AUDIO,{uid:r.uid}):this.emit(Me.UNMUTE_AUDIO,{uid:r.uid}),r.video_mute?this.emit(Me.MUTE_VIDEO,{uid:r.uid}):this.emit(Me.UNMUTE_VIDEO,{uid:r.uid}),r.audio_enable_local?this.emit(Me.ENABLE_LOCAL_AUDIO,{uid:r.uid}):this.emit(Me.DISABLE_LOCAL_AUDIO,{uid:r.uid}),r.video_enable_local?this.emit(Me.ENABLE_LOCAL_VIDEO,{uid:r.uid}):this.emit(Me.DISABLE_LOCAL_VIDEO,{uid:r.uid}),r.audio||r.video||this.emit(Me.ON_REMOVE_STREAM,{uid:r.uid,uint_id:r.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}async downgradeCodec(t){if(!this.ortc)return!1;const n={downgrade_codec:t,ortc:this.ortc};return!!await this.request(ye.DOWNGRADE_CODEC,n)}handleNotification(t){T.debug("[".concat(this.clientId,"] receive notification: "),t);const n=Hc(t.code);if(t.code===28&&"detail"in t&&(T.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(ve.RECOVER_NOTIFICATION,t.detail)),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?t.code===Ie.ERR_REPEAT_JOIN_CHANNEL&&A("IGNORE_UID_CHECK")?void this.close(Qe.UID_CONFLICT):(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Qe.UID_BANNED),void this.close()):t.code===Ie.K_VOS_FALLBACK&&"detail"in t?(T.info("[".concat(this.clientId,"] receive vos fallback notification: "),t.detail),t.detail==="FALLBACKCN"&&A("ENABLE_QUALITY_FALLBACK")?void dn(this,ve.VOS_FALLBACK_PROMISE,t.detail).then(()=>{this.reconnect("recover",n.desc)}).catch(r=>{T.debug("[".concat(this.clientId,"] cancel vos fallback cn, error: "),r)}):t.detail==="fallback_hls"&&A("ENABLE_FALLBACK_TO_HLS")?(this.emit(ve.VOS_FALLBACK,t.detail),void this.close(Qe.FALLBACK_TO_HLS)):this.reconnect(n.action,n.desc)):void this.reconnect(n.action,jn.SERVER_ERROR);T.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=A("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(T.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>A("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",jn.TIMEOUT):this.request(ye.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-n;this.rttRolling.add(r),A("REPORT_STATS")&&this.send(ye.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:n}=this.websocket.getWsInflateData();t!==0&&n!==0&&this.upload(Wc.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(Be.RECONNECT_CREATE_CONNECTION,t=>{this.emit(ve.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Be.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Be.CLOSED,()=>{this.connectionState=Ze.CLOSED}),this.websocket.on(Be.FAILED,()=>{this._disconnectedReason=Qe.NETWORK_ERROR,this.connectionState=Ze.CLOSED}),this.websocket.on(Be.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Ze.CONNECTED?this.connectionState=Ze.RECONNECTING:this.connectionState=Ze.CONNECTING}),this.websocket.on(Be.WILL_RECONNECT,(t,n,r)=>{const i=Oc(this,ve.IS_P2P_DISCONNECTED),s=i||t!=="retry";i&&t==="retry"&&(T.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",n=lm.P2P_DISCONNECTED),s&&(T.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(ve.REPORT_JOIN_GATEWAY,n||lm.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(ve.DISCONNECT_P2P)),r(t)}),this.websocket.on(Be.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{T.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",jn.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(ve.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof j){if(t.code===O.UNEXPECTED_RESPONSE&&t.data.code===Ie.ERR_NO_AUTHORIZED)return this.initError=new j(O.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Qe.TOKEN_EXPIRE);T.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",jn.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(Be.REQUEST_NEW_URLS,(t,n)=>{dn(this,ve.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(Be.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Me.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(mn.PRE_CONNECT_PC,()=>{this.emit(ve.PRE_CONNECT_PC)}),this.websocket.on(Be.ON_FALLBACK,()=>{A("ENABLE_FALLBACK_TO_HLS")&&this.emit(ve.VOS_FALLBACK,"fallback_hls")})}}let NQ=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),rn=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function yM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function pm(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?yM(Object(n),!0).forEach(function(r){I(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yM(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let YR=0;function co(e){const t=A("TURN_DOMAINS");YR=(YR+1)%t.length;const n=t[YR]||"edge.agora.io";return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(n):(T.debug("Cannot recognized as ip address: ".concat(e,", use as host2")),e)}function fm(e){try{const t=A("TURN_DOMAINS"),n=A("GATEWAY_DOMAINS").concat(t).find(r=>te(e).call(e,r));return n?e.split(".".concat(n))[0].replace(/-/g,"."):e}catch{return T.debug("serverUrlToIp error, fallback to url",e),e}}function zR(e,t){e.addresses||(e.addresses=[]);const n=function(d,l){if(A("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return d.map(_=>{let{ip:m,port:g}=_;return{address:"".concat(m,":").concat(g)}});const h=A("GATEWAY_DOMAINS");let p=h[1]&&te(l).call(l,h[1])?1:0;return d.map(_=>{let{domain_prefix:m,port:g,ip:w}=_;if(m)return{address:"".concat(m,".").concat(h[p++%h.length],":").concat(g)};const R=/^[\.\:\d]+$/.test(w),y=R?"".concat(w.replace(/[^\d]/g,"-"),".").concat(h[p++%h.length],":").concat(g):"".concat(w,":").concat(g);return R||T.debug("Cannot recognized as ip address: ".concat(w,", use as host3")),{ip:w,port:g,address:y}})}(e.addresses,t),r=Array.isArray(e.detail)&&e.detail[18];if(r&&typeof r=="string"){const d=r.split(";");for(let l=0;l<d.length;l++){var i;const h=hr(i=d[l]).call(i);n[l]&&h&&(n[l].ip6=h)}}const s=e.detail&&e.detail.candidate;let a;if(s){const[d,l]=s.split(":");d&&l&&(a={port:Number(l),ip:d,address:"".concat(d,":").concat(l)})}return{gatewayAddrs:n,apGatewayAddress:a,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function br(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function CM(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(br(t.width),"x").concat(br(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function _m(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function bh(e,t){let n,r,i;switch(t){case rn.CHOOSE_SERVER:r=4096,i="choose server";break;case rn.CLOUD_PROXY:r=1048576,i="proxy";break;case rn.CLOUD_PROXY_5:r=4194304,i="proxy5";break;case rn.CLOUD_PROXY_FALLBACK:r=4194310,i="proxy fallback";break;default:throw new j(O.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(s=>{s.buffer&&s.buffer.flag===r&&(n={code:s.buffer.code,addresses:(s.buffer.edges_services||[]).map(a=>pm(pm({},a),{},{ticket:s.buffer.cert})),server_ts:e.enter_ts,uid:s.buffer.uid,cid:s.buffer.cid,cname:s.buffer.cname,detail:pm(pm({},s.buffer.detail),e.detail),flag:s.buffer.flag,opid:e.opid,cert:s.buffer.cert})}),!n)throw new j(O.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}async function IM(e,t){return await ae.all(e.addresses.map(async n=>({address:co(n.ip),tcpport:n.port,udpport:n.port,username:t&&A("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():Gn.username,password:t&&A("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await Hv(t.toString()):Gn.password})))}function qR(e,t){const n=t.getMediaStreamTrack(!0).getSettings(),r=t.videoHeight||n.height,i=t.videoWidth||n.width;return r&&i?Math.max(Math.min(r,i)/Math.min(br(e.height),br(e.width)),1):(T.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Aa(e){let{candidateType:t,relayProtocol:n,type:r,address:i,port:s,protocol:a}=e;const d={candidateType:t,relayProtocol:n,protocol:a};if(r!=="local-candidate"){const l=i.split(".");l.length>=4&&(l[1]="*",l[2]="*"),d.address=l.join("."),d.port=s}return d}function hs(e){const t=e.split(":"),n=e.split(/[-.]/),r=te(e).call(e,"-")?"-":".";let i=e;return t.length>1?n.length>1?(n[1]="**",i=n[0]+r+"**:"+t[t.length-1]):i=t.length>2?t[0]+r+"**:"+t[t.length-1]:"**:"+t[t.length-1]:n.length>1&&(i=n[0]+r+"**"),i}function wM(e,t){return e.getTransceivers().find(n=>n.sender.track===t||n.receiver.track===t)}function Oh(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:A("SVC_MODE");if(A("ENABLE_SVC"))return function(t){return t in F_}(e)?e:F_.L1T3}const AM={[_e.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[_e.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function bM(e){e.send&&(Pl(_e.VIDEO,e.send.videoExtensions),Pl(_e.AUDIO,e.send.audioExtensions)),e.recv&&(Pl(_e.VIDEO,e.recv.videoExtensions),Pl(_e.AUDIO,e.recv.audioExtensions)),e.sendrecv&&(Pl(_e.VIDEO,e.sendrecv.videoExtensions),Pl(_e.AUDIO,e.sendrecv.audioExtensions))}function OM(e,t){e.send&&(mm(_e.VIDEO,e.send.videoExtensions,t.send.videoExtensions),mm(_e.AUDIO,e.send.audioExtensions,t.send.audioExtensions)),e.recv&&(mm(_e.VIDEO,e.recv.videoExtensions,t.recv.videoExtensions),mm(_e.AUDIO,e.recv.audioExtensions,t.recv.audioExtensions))}function mm(e,t,n){t.forEach(r=>{var i;const s=AM[e].find(d=>{var l;let{key:h}=d;return te(l=r.extensionName).call(l,h)});if(!s)return;const a=n.find(d=>{let{extensionName:l}=d;return te(l).call(l,s.key)});a&&te(i=a.extensionName).call(i,"gdpr_forbidden")&&(r.extensionName=a.extensionName)})}function Pl(e,t){t.forEach(n=>{var r;const i=AM[e].find(s=>{var a;let{key:d}=s;return te(a=n.extensionName).call(a,d)});te(r=n.extensionName).call(r,"gdpr_forbidden")&&i&&(n.extensionName=i.extensionName)})}function NM(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||te(e).call(e,"abs-send-time")}function Em(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||te(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function DM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function PM(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?DM(Object(n),!0).forEach(function(r){I(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):DM(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function Nh(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;const{filterRTX:i,filterVideoFec:s,filterAudioFec:a,filterAudioCodec:d,filterVideoCodec:l,unsupportedVideoUplinkCodec:h,unsupportedVideoDownlinkCodec:p}=t,{useXR:_}=n;let m=[],g=[],w=[],R=[],y=!1,b=!1;if(_r(e).mediaDescriptions.forEach(L=>{r&&r!==L.attributes.direction||(L.media.mediaType!=="video"||y||(g=L.attributes.payloads,R=L.attributes.extmaps,y=!0),L.media.mediaType!=="audio"||b||(m=L.attributes.payloads,w=L.attributes.extmaps,b=!0))}),!R||g.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!w||m.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(g.forEach(L=>{var x;(x=L.rtpMap)!==null&&x!==void 0&&x.clockRate&&(L.rtpMap.clockRate=parseInt(L.rtpMap.clockRate)),_&&L.rtcpFeedbacks.push({type:"rrtr"})}),m.forEach(L=>{var x;(x=L.rtpMap)!==null&&x!==void 0&&x.clockRate&&(L.rtpMap.clockRate=parseInt(L.rtpMap.clockRate)),_&&L.rtcpFeedbacks.push({type:"rrtr"})}),i&&(m=m.filter(L=>{var x;return((x=L.rtpMap)===null||x===void 0?void 0:x.encodingName.toLowerCase())!=="rtx"}),g=g.filter(L=>{var x;return((x=L.rtpMap)===null||x===void 0?void 0:x.encodingName.toLowerCase())!=="rtx"})),s){const L=g.filter(M=>{var B;return/(red)|(ulpfec)|(flexfec)/i.test(((B=M.rtpMap)===null||B===void 0?void 0:B.encodingName)||"")}),x=ba(L,g).map(M=>M.payloadType),F=[...L.map(M=>M.payloadType),...x];g=g.filter(M=>!te(F).call(F,M.payloadType))}if(a&&(m=m.filter(L=>{var x;return!/(red)|(ulpfec)|(flexfec)/i.test(((x=L.rtpMap)===null||x===void 0?void 0:x.encodingName)||"")})),d&&(d==null?void 0:d.length)>0&&(m=m.filter(L=>{var x;return te(d).call(d,((x=L.rtpMap)===null||x===void 0?void 0:x.encodingName.toLowerCase())||"")})),l&&(l==null?void 0:l.length)>0){const L=g.filter(x=>{var F;return te(l).call(l,((F=x.rtpMap)===null||F===void 0?void 0:F.encodingName.toLowerCase())||"")});g=L.concat(i?[]:ba(L,g))}const N=A("UNSUPPORTED_VIDEO_CODEC");if(N&&N.length>0){const L=g.filter(M=>M.rtpMap&&te(N).call(N,M.rtpMap.encodingName.toLowerCase())),x=ba(L,g),F=L.concat(x).map(M=>M.payloadType);g=g.filter(M=>!te(F).call(F,M.payloadType)),T.debug("unsupportedVideoCodec: ".concat(N,", toBeRemoved: ").concat(F))}if(h&&h.length>0&&r==="sendonly"){const L=g.filter(M=>M.rtpMap&&te(h).call(h,M.rtpMap.encodingName.toLowerCase())),x=ba(L,g),F=L.concat(x).map(M=>M.payloadType);g=g.filter(M=>!te(F).call(F,M.payloadType)),T.debug("unsupportedVideoUplinkCodec: ".concat(h,", toBeRemoved: ").concat(F))}if(p&&p.length>0&&r==="recvonly"){const L=g.filter(M=>M.rtpMap&&te(p).call(p,M.rtpMap.encodingName.toLowerCase())),x=ba(L,g),F=L.concat(x).map(M=>M.payloadType);g=g.filter(M=>!te(F).call(F,M.payloadType)),T.debug("unsupportedVideoDownlinkCodec: ".concat(p,", toBeRemoved: ").concat(F))}return{audioCodecs:m,videoCodecs:g,audioExtensions:w,videoExtensions:R}}function ps(e){const t=_r(e);let n,r;for(const i of t.mediaDescriptions){if(!n){const s=i.attributes.iceUfrag,a=i.attributes.icePwd;if(!s||!a)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:s,icePwd:a}}if(!r){const s=i.attributes.fingerprints;s.length>0&&(r={fingerprints:s})}}if(!r&&t.attributes.fingerprints.length>0&&(r={fingerprints:t.attributes.fingerprints}),!r||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:r}}function XR(e,t){const n=[],r=e.attributes.ssrcGroups.filter(a=>a.semantic==="FID"),i=e.attributes.ssrcGroups.find(a=>a.semantic==="SIM"),s=e.attributes.ssrcs;if(i)i.ssrcIds.forEach(a=>{var d;const l=(d=r.find(h=>h.ssrcIds[0]===a))===null||d===void 0?void 0:d.ssrcIds[1];n.push({ssrcId:a,rtx:t?l:void 0})});else if(r.length>0){const a=r[0].ssrcIds[0],d=r[0].ssrcIds[1];n.push({ssrcId:a,rtx:t?d:void 0})}else{if(s.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:s[0].ssrcId})}return n}function LM(e,t,n){const{cname:r}=e;let i=[];t&&(i=kM(t)),i.length===0&&(i=e.iceParameters.candidates.map(p=>({foundation:p.foundation,componentId:"1",transport:p.protocol,priority:p.priority.toString(),connectionAddress:p.ip,port:p.port.toString(),type:p.type,extension:{}})),T.debug("Using candidates from gateway."));const s={fingerprints:e.dtlsParameters.fingerprints.map(p=>({hashFunction:p.algorithm,fingerprint:p.fingerprint}))},a={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let d;switch(e.dtlsParameters.role){case"server":d="passive";break;case"client":d="active";break;case"auto":d="actpass"}const l=Ph(e.rtpCapabilities),h=[];return Array.isArray(n)&&n.length>0&&n.forEach(p=>{h.push({kind:_e.VIDEO,ssrcMsg:[{ssrcId:p.v,rtx:p.v_rtx}],mslabel:"".concat(p.v,"_").concat(p.a)},{kind:_e.AUDIO,ssrcMsg:[{ssrcId:p.a}],mslabel:"".concat(p.v,"_").concat(p.a)})}),{dtlsParameters:s,iceParameters:a,candidates:i,rtpCapabilities:l,setup:d,cname:r,preSSRCs:h}}function kM(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],T.debug("Using remote candidate from AP ".concat(hs(e.ip),":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),T.debug("Using IPV6 remote candidate from AP ".concat(hs(e.ip6),":").concat(e.port)))),t}function Dh(e,t,n){const r=[],i=[];return e.forEach(s=>{let{ssrcId:a,rtx:d}=s;const l=ht(8,"track-"),h={ssrcId:a,attributes:PM({label:l,mslabel:n=n||ht(10,""),msid:"".concat(n," ").concat(l)},t&&{cname:t})};if(r.push(h),d!==void 0){const p={ssrcId:d,attributes:PM({label:l,mslabel:n,msid:"".concat(n," ").concat(l)},t&&{cname:t})};r.push(p),i.push({semantic:"FID",ssrcIds:[a,d]})}}),e.length>1&&i.push({semantic:"SIM",ssrcIds:e.map(s=>{let{ssrcId:a}=s;return a})}),{ssrcs:r,ssrcGroups:i}}function Kc(e,t){t instanceof Xt&&e.attributes.payloads.forEach(n=>{var r;const i=(r=n.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase();if(!i||["opus","pcmu","pcma","g722"].indexOf(i)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),i==="opus"&&typeof A("OPUS_PTIME")=="number"?n.fmtp.parameters.ptime=A("OPUS_PTIME"):n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const s=t._encoderConfig;s&&(i!=="pcmu"&&i!=="pcma"&&i!=="g722"&&(s.bitrate&&!Nt()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*s.bitrate))),s.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(s.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(s.sampleRate)),s.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1")),t instanceof Ih&&i==="opus"&&t._config.DTX&&(n.fmtp.parameters.usedtx="1"))})}function JR(e){const t=e.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function QR(e,t){var n;if(e.attributes.payloads.forEach(i=>{var s;((s=i.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase())==="h264"&&i.fmtp&&i.fmtp.parameters&&A("ENABLE_UP_SPS_PPS")&&(i.fmtp.parameters["sps-pps-idr-in-keyframe"]="1")}),!(t instanceof Ct&&t._encoderConfig&&t._hints.indexOf(lt.SCREEN_TRACK)===-1))return;const r=t._encoderConfig;qe().supportMinBitrate&&r.bitrateMin&&e.attributes.payloads.forEach(i=>{var s,a;te(s=["h264","h265","vp8","vp9","av1"]).call(s,((a=i.rtpMap)===null||a===void 0?void 0:a.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-min-bitrate"]="".concat(r.bitrateMin))}),qe().supportMinBitrate&&!te(n=t._hints).call(n,lt.LOW_STREAM)&&r.bitrateMax&&e.attributes.payloads.forEach(i=>{var s,a;te(s=["h264","h265","vp8","vp9","av1"]).call(s,((a=i.rtpMap)===null||a===void 0?void 0:a.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-start-bitrate"]="".concat(A("X_GOOGLE_START_BITRATE")||Math.floor(r.bitrateMax)))})}function MM(e){if(e.media.mediaType!=="video")return;const t=rt();if(t.name!==ot.SAFARI&&t.os!==Sn.IOS)return;const n=e.attributes.extmaps.findIndex(r=>/video-orientation/g.test(r.extensionName));n!==-1&&e.attributes.extmaps.splice(n,1)}function gm(e,t,n){if(!t)return;let r,i;if(e.media.mediaType==="video"?(r=n.videoExtensions,i=n.videoCodecs):(r=n.audioExtensions,i=n.audioCodecs),t.twcc===!0){const s=r.find(a=>Em(a.extensionName));if(s){const a=s.extensionName;e.attributes.extmaps.find(l=>Em(l.extensionName))||e.attributes.extmaps.push({entry:s.entry,extensionName:a}),function(l,h){return h.filter(p=>!!l.find(_=>_.payloadType===p.payloadType&&!!_.rtcpFeedbacks.find(m=>m.type==="transport-cc")))}(i,e.attributes.payloads).forEach(l=>{l.rtcpFeedbacks.find(h=>h.type==="transport-cc")||l.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(t.twcc===!1){const s=e.attributes.extmaps.findIndex(a=>Em(a.extensionName));s!==-1&&e.attributes.extmaps.splice(s,1),e.attributes.payloads.forEach(a=>{const d=a.rtcpFeedbacks.findIndex(l=>l.type==="transport-cc");d!==-1&&a.rtcpFeedbacks.splice(d,1)})}if(t.remb===!0){const s=r.find(a=>NM(a.extensionName));if(s){const a=s.extensionName;e.attributes.extmaps.find(l=>l.extensionName===a)||e.attributes.extmaps.push({entry:s.entry,extensionName:a}),function(l,h){return h.filter(p=>!!l.find(_=>_.payloadType===p.payloadType&&!!_.rtcpFeedbacks.find(m=>m.type==="goog-remb")))}(i,e.attributes.payloads).forEach(l=>{l.rtcpFeedbacks.find(h=>h.type==="goog-remb")||l.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(t.remb===!1){const s=e.attributes.extmaps.findIndex(a=>NM(a.extensionName));s!==-1&&e.attributes.extmaps.splice(s,1),e.attributes.payloads.forEach(a=>{const d=a.rtcpFeedbacks.findIndex(l=>l.type==="goog-remb");d!==-1&&a.rtcpFeedbacks.splice(d,1)})}}function ZR(e,t,n){if(Nt()||e.media.mediaType!=="video"||!(t instanceof Ct)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!A("SIMULCAST")||n==="vp9"&&A("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;const r=n==="vp8"?2:t._scalabilityMode.numSpatialLayers,i=e.attributes.ssrcs[0],s=e.attributes.ssrcGroups.find(d=>d.semantic==="FID"&&d.ssrcIds[0]===i.ssrcId),a={semantic:"SIM",ssrcIds:[i.ssrcId]};for(let d=1;d<r;d++)e.attributes.ssrcs.push({ssrcId:i.ssrcId+d,attributes:Dt(i.attributes)}),a.ssrcIds.push(i.ssrcId+d),s&&(e.attributes.ssrcs.push({ssrcId:s.ssrcIds[1]+d,attributes:Dt(i.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i.ssrcId+d,s.ssrcIds[1]+d]}));e.attributes.ssrcGroups.unshift(a)}async function UM(){try{const e=new RTCPeerConnection;e.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:F_.L1T3}]});const t=await e.createOffer();if(!t.sdp)return void e.close();const n=_r(t.sdp).mediaDescriptions[0];if(!n)return;const r=n.attributes.extmaps.find(i=>i.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return e.close(),r}catch{return}}async function $R(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const r=(await n.createOffer()).sdp,{send:i,recv:s,sendrecv:a}=function(){let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;const p=Nh(h,d,l,"sendonly"),_=Nh(h,d,l,"recvonly"),m={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},g={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},w={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(lo(p,_,"videoExtensions",m,g,w),lo(p,_,"videoCodecs",m,g,w),lo(p,_,"audioExtensions",m,g,w),lo(p,_,"audioCodecs",m,g,w),A("RAISE_H264_BASELINE_PRIORITY")){const R=[],y=[];if(w.videoCodecs.forEach((b,N)=>{var L;if(((L=b.rtpMap)===null||L===void 0?void 0:L.encodingName.toLocaleLowerCase())==="h264"){var x,F;const M=w.videoCodecs[N+1],B=M&&BM(b,M),J=(x=b.fmtp)===null||x===void 0?void 0:x.parameters["profile-level-id"],ee=(F=b.fmtp)===null||F===void 0?void 0:F.parameters["packetization-mode"];!J||J!==A("FIRST_H264_PROFILE_LEVEL_ID")||A("FIRST_PACKETIZATION_MODE")&&ee!==A("FIRST_PACKETIZATION_MODE")?B?y.push([b,M]):y.push([b]):B?R.push([b,M]):R.push([b])}}),R.length>0&&y.length>0){T.debug("raising H264 baseline profile priority"),w.videoCodecs.forEach((N,L)=>{var x;if(((x=N.rtpMap)===null||x===void 0?void 0:x.encodingName.toLocaleLowerCase())==="h264"){const F=BM(N,w.videoCodecs[L+1]),M=R.shift()||y.shift()||[];M.length>0&&(F?w.videoCodecs.splice(L,2,...M):w.videoCodecs.splice(L,1,...M))}});const b=g.videoCodecs.filter(N=>{var L,x;return((L=N.rtpMap)===null||L===void 0?void 0:L.encodingName.toLocaleLowerCase())==="h264"&&((x=N.fmtp)===null||x===void 0?void 0:x.parameters["profile-level-id"])!==A("FIRST_H264_PROFILE_LEVEL_ID")});if(b.length>0){const N=ba(b,g.videoCodecs).map(x=>x.payloadType),L=[...b.map(x=>x.payloadType),...N];g.videoCodecs=g.videoCodecs.filter(x=>!te(L).call(L,x.payloadType))}A("FILTER_SEND_H264_BASELINE")&&(m.videoCodecs=m.videoCodecs.filter(N=>{var L,x;return!(((L=N.rtpMap)===null||L===void 0?void 0:L.encodingName.toLocaleLowerCase())==="h264"&&((x=N.fmtp)===null||x===void 0?void 0:x.parameters["profile-level-id"])!==A("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:m,recv:g,sendrecv:w}}return{send:m,recv:g,sendrecv:w}}(e,t,r);try{n.close()}catch{}return{send:i,recv:s,sendrecv:a}}function xM(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=Nh(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(lo(e,t,"videoExtensions",n,r,i),lo(e,t,"videoCodecs",n,r,i),lo(e,t,"audioExtensions",n,r,i),lo(e,t,"audioCodecs",n,r,i),A("RAISE_H264_BASELINE_PRIORITY")){const s=i.videoCodecs.findIndex(a=>a.rtpMap&&a.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&a.fmtp&&a.fmtp.parameters["profile-level-id"]==="42001f");if(s!==-1){const a=i.videoCodecs.findIndex(d=>d.rtpMap&&d.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(a<s){T.debug("raising H264 baseline profile priority");const d=i.videoCodecs[s];i.videoCodecs.splice(s,1),i.videoCodecs.splice(a,0,d)}a!==-1&&(r.videoCodecs=r.videoCodecs.filter(d=>!(d.rtpMap&&d.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&d.fmtp&&d.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:r,sendrecv:i}}function lo(e,t,n,r,i,s){if(n==="videoExtensions"||n==="audioExtensions"){const a=[];return e[n].forEach(d=>{t[n].some((l,h)=>{if(d.entry===l.entry&&d.extensionName===l.extensionName)return a.push(h),!0})?s[n].push(d):r[n].push(d)}),void t[n].forEach((d,l)=>{a.indexOf(l)===-1&&i[n].push(d)})}if(n==="videoCodecs"||n==="audioCodecs"){const a=[];return e[n].forEach(d=>{t[n].some((l,h)=>{if(d.payloadType===l.payloadType&&JSON.stringify(d)===JSON.stringify(l))return a.push(h),!0})?s[n].push(d):r[n].push(d)}),void t[n].forEach((d,l)=>{a.indexOf(l)===-1&&i[n].push(d)})}}function Ph(e){const{send:t,recv:n,sendrecv:r}=e;if(!r){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let i,s;return t?(i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i.audioCodecs=[...t.audioCodecs,...r.audioCodecs],i.videoCodecs=[...t.videoCodecs,...r.videoCodecs],i.audioExtensions=[...t.audioExtensions,...r.audioExtensions],i.videoExtensions=[...t.videoExtensions,...r.videoExtensions]):i=Dt(r),n?(s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s.audioCodecs=[...n.audioCodecs,...r.audioCodecs],s.videoCodecs=[...n.videoCodecs,...r.videoCodecs],s.audioExtensions=[...n.audioExtensions,...r.audioExtensions],s.videoExtensions=[...n.videoExtensions,...r.videoExtensions]):s=Dt(r),{send:i,recv:s}}function Ll(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var n;return((n=t.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function Lh(e,t,n,r){let i=[];if(e===_e.VIDEO){if(A("H264_PROFILE_LEVEL_ID")&&r==="h264"&&(i=t.videoCodecs.filter(s=>{var a;return te(a=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(a,r)&&s&&s.fmtp&&s.fmtp.parameters["profile-level-id"]===A("H264_PROFILE_LEVEL_ID")})),!Array.isArray(i)||i.length===0){let s=[];const a=[],d=[],l=[];if(n.videoCodecs.forEach(h=>{const p=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"";te(p).call(p,r)?s.push(h):te(p).call(p,"vp9")?a.push(h):te(p).call(p,"vp8")?d.push(h):te(p).call(p,"h264")&&l.push(h)}),s.length===0){let h="";a.length!==0?(s=a,h="vp9"):d.length!==0?(s=d,h="vp8"):l.length!==0&&(s=l,h="h264"),T.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(h))}s.length!==0&&(i=t.videoCodecs.filter(h=>s.some(p=>p.payloadType===h.payloadType)))}if(i.length===0&&(T.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),i=t.videoCodecs),A("USE_PUB_RTX")||A("USE_SUB_RTX")){const s=ba(i,t.videoCodecs);i=[...i,...s]}}else{i=t.audioCodecs.filter(a=>{var d;return te(d=a.rtpMap&&a.rtpMap.encodingName.toLowerCase()||"").call(d,r)});const s=t.audioCodecs.filter(a=>{var d;return te(d=a.rtpMap&&a.rtpMap.encodingName.toLowerCase()||"").call(d,"red")});i.length===0&&(T.warning("codec ".concat(r," not included in rtpCapabilities, fallback to opus")),i=t.audioCodecs.filter(a=>{var d;return te(d=a.rtpMap&&a.rtpMap.encodingName.toLowerCase()||"").call(d,"opus")})),A("ENABLE_AUDIO_RED")&&s.length!==0&&(i=[...s,...i])}return i}function ba(e,t){const n=e.map(r=>r.payloadType.toString());return t.filter(r=>r.rtpMap&&r.rtpMap.encodingName==="rtx"&&r.fmtp&&r.fmtp.parameters.apt&&te(n).call(n,r.fmtp&&r.fmtp.parameters.apt))}async function Vr(e,t,n){const r=t.toString(),i=VM(r,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:r});const s=await e.createAnswer();if(!s.sdp)throw new Error("cannot get answer sdp");let a=s.sdp;a=ey(a,n||{}),i==null||i(a||""),await e.setLocalDescription({type:"answer",sdp:a})}function ey(e,t,n){if(A("FORBID_MODIFY_LOCAL_OFFER_SDP"))return e;const r=_r(e),{useXR:i}=t;return r.mediaDescriptions.forEach(s=>{var a;s.attributes.mid&&(Array.isArray(n)&&!te(n).call(n,s.attributes.mid)||(s.media.mediaType==="audio"&&Ll(s),s.media.mediaType==="video"&&function(d){d.media.mediaType==="video"&&A("ENABLE_DOWN_SPS_PPS")&&d.attributes.payloads.filter(l=>{var h;return((h=l.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())==="h264"}).forEach(l=>{l.fmtp||(l.fmtp={parameters:{}}),l.fmtp.parameters["sps-pps-idr-in-keyframe"]="1"})}(s),i&&te(a=["audio","video"]).call(a,s.media.mediaType)&&s.attributes.payloads.forEach(d=>{d.rtcpFeedbacks.findIndex(l=>l.type==="rrtr")===-1&&d.rtcpFeedbacks.push({type:"rrtr"})})))}),Fs(r)}function VM(e,t,n,r){if(A("SDP_LOGGING"))return T.upload("exchanging ".concat(n," ").concat(t," SDP during P2PConnection.").concat(r,`
`),e),t==="offer"?i=>{VM(i,"answer",n==="local"?"remote":"local",r)}:void 0}async function FM(e,t,n){try{var r;if(!qe().supportSetRtpSenderParameters||!function(l){return l==="vp9"||l==="av1"}(e)||!A("ENABLE_SVC"))return;const i={},s={},a=t.getParameters(),d=(r=a.encodings)===null||r===void 0?void 0:r[0];s.scalabilityMode=Oh(n),d&&Object.assign(d,s),Object.assign(a,i),await t.setParameters(a),T.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(a.encodings)))}catch(i){T.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",i)}}function Sm(e){const t=A("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(n=>te(e).call(e,n))}function BM(e,t){try{var n;return((n=e.fmtp)===null||n===void 0?void 0:n.parameters.apt)===t.payloadType.toString()}catch{return!1}}function jM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function ei(e,t){return typeof A(e)===t?A(e):void 0}function DQ(){try{const e=A("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?jM(Object(r),!0).forEach(function(i){I(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):jM(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}({},e)}catch(e){return T.debug("handle gateway attributes failed: ",e),{}}}const GM={};function fs(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&T.debug("install service ".concat(e.name)),GM[e.name]=e}function Uo(e){const t=GM[e];if(!t)throw new Y(O.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function WM(e,t){return Uo("DataStream").create(e,t)}function Tm(){return Uo("InterceptFrame").create()}function HM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Dn(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?HM(Object(n),!0).forEach(function(r){I(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):HM(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const ty=new Map;class PQ extends Vt{get state(){return this._state}set state(t){if(t===this._state)return;const n=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(Qt.CONNECTION_STATE_CHANGE,t,n,this._disconnectedReason):this.emit(Qt.CONNECTION_STATE_CHANGE,t,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){T.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,n){var r,i,s;super(),I(this,"store",void 0),I(this,"joinInfo",void 0),I(this,"key",void 0),I(this,"ntpOffset",0),I(this,"usingProxy",!1),I(this,"signal",void 0),I(this,"role",void 0),I(this,"isPreallocation",void 0),I(this,"isPreSub",void 0),I(this,"inChannelInfo",{joinAt:null,duration:0}),I(this,"spec",void 0),I(this,"_state","DISCONNECTED"),I(this,"_statsCollector",void 0),I(this,"_disconnectedReason",void 0),I(this,"isSignalRecover",!1),I(this,"hasChangeBGPAddress",!1),I(this,"trafficStatsInterval",void 0),I(this,"networkQualityInterval",void 0),I(this,"_joinGatewayStartTime",0),I(this,"_signalTimeout",!1),I(this,"_clientRoleOptions",void 0),I(this,"_isProactiveJoin",!1),this.store=t,this.spec=n,this.signal=this.store.useP2P?(r={spec:Dn(Dn({},n),{},{retryConfig:n.websocketRetryConfig}),store:t},(i=(s=Uo("P2PChannel")).createSubmodule)===null||i===void 0?void 0:i.call(s,r)):this.store.useDcSignal?function(a){return Uo("DataChannelSignal").create(a)}({spec:Dn(Dn({},n),{},{retryConfig:n.websocketRetryConfig}),store:t}):new RM(Dn(Dn({},n),{},{retryConfig:n.websocketRetryConfig}),t),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}setUsingProxy(t){this.usingProxy=t}async join(t,n,r){if(this.store.useDcSignal){let p=!1;t.cloudProxyServer!=="disabled"?(T.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(t.cloudProxyServer,")")),p=!0):"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length>255||"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length<22?(T.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),p=!0):t.apResponse.addresses.some(_=>_.fingerprint)||A("FINGERPRINT")||(T.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),p=!0),p&&this.resetSignal()}this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const i=Date.now();let s=ty.get(t.cname);if(s||(s=new Map,ty.set(t.cname,s)),this._isProactiveJoin=!0,s.has(t.uid)){const p=new j(O.UID_CONFLICT);throw Se.joinGateway(t.sid,{lts:i,succ:!1,ec:p.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!t.proxyServer||this.usingProxy,signalChannel:this.store.useDcSignal?"1":"0",preload:t.preload}),p}s.set(t.uid,!0),this.joinInfo=t,this.key=n;let a=0;this.joinGatewayStartTime=i;const d=t.proxyServer,l=this.store.useDcSignal?"datachannel":"websocket";try{T.debug("[".concat(this.store.clientId,"] use ").concat(l," join uid ").concat(a));const p=t.gatewayAddrs.map(m=>{let{address:g}=m;const[w,R]=g.split(":"),y={host:w,port:R};return t.proxyServer&&(y.proxy=t.proxyServer),y});let _;_=this.store.useDcSignal?await this.signal.init(t.apResponse.addresses):await this.signal.init(p),a=_.uid,T.debug("[".concat(this.store.clientId,"] ").concat(l," join uid ").concat(a," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(p){var h;throw p.code===O.INIT_DATACHANNEL_TIMEOUT&&this.signal.__name__==="AgoraRTCSignal"||Se.joinGateway(t.sid,{lts:i,succ:!1,ec:((h=p.data)===null||h===void 0?void 0:h.desc)||p.code,errorMsg:p.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!d||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:t.preload}),p&&p.code===O.INIT_DATACHANNEL_TIMEOUT?(T.warning("[".concat(this.store.clientId,"] User join datachannel failed"),p.toString()),this.resetSignal(),p):(T.error("[".concat(this.store.clientId,"] User join failed"),p.toString()),s.delete(t.uid),this.signal.close(),p)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),T.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(p=>{T.warning("[".concat(this.store.clientId,"] get traffic stats error"),p.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Qt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Qt.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Qt.NETWORK_QUALITY,{uplinkNetworkQuality:_m(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:_m(this._statsCollector.trafficStats.B_dnq)}):this.emit(Qt.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),a}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==Qe.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==Ze.CONNECTED||await function(r,i){return i===1/0?r:ae.race([r,oJ(i)])}(this.signal.request(ye.LEAVE,void 0,!0),3e3)}catch(r){T.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),r)}this.signal.close(n),n!==Qe.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new j(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const i={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:A("PUB_EXTEND"),twcc:!!A("PUBLISH_TWCC"),rtx:!!A("USE_PUB_RTX")};try{return(await this.signal.request(ye.PUBLISH,i,!0))._message}catch(s){if(r&&s.data&&s.data.code===Ie.ERR_PUBLISH_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),s.toString()),await this.tryUnpubBeforeRepub(t,n),this.publish(t,n,!1);throw s}}async publishDataChannel(t,n,r){var i;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new j(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const s={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(i=n.maxRetransmits)!==null&&i!==void 0?i:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(ye.PUBLISH_DATASTREAM,s,!0)}catch(a){if(r&&a.data&&a.data.code===Ie.ERR_PUBLISH_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),a.toString()),await this.tryUnpubDataChannelBeforeRepub(t,n),this.publishDataChannel(t,n,!1);throw a}}async unpublish(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new j(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(ye.UNPUBLISH,{stream_id:n,ortc:t},!0)}catch(r){T.warning("[".concat(this.store.clientId,"] unpublish warning: "),r)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new j(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ae.all(t.map(n=>this.signal.request(ye.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){T.warning("unpublish datachannels warning: ",n)}}async presubscribe(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new j(O.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const i={stream_id:t,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!A("SUBSCRIBE_TWCC"),rtx:!!A("USE_SUB_RTX")||void 0,extend:A("SUB_EXTEND"),svc:Array.isArray(A("SVC"))&&A("SVC").length!==0?A("SVC"):void 0};try{return await this.signal.request(ye.PRE_SUBSCRIBE,i,!0)}catch(s){if(r&&s.data&&s.data.code===Ie.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),s.toString()),this.presubscribe(t,n,!1);throw s}}async subscribe(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new j(O.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const i={stream_id:t,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!A("SUBSCRIBE_TWCC"),rtx:!!A("USE_SUB_RTX"),extend:A("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(A("SVC"))&&A("SVC").length!==0?A("SVC"):void 0};try{return(await this.signal.request(ye.SUBSCRIBE,i,!0))._message}catch(s){if(r&&s.data&&s.data.code===Ie.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),s.toString()),await this.tryUnsubBeforeResub(t,n),await this.subscribe(t,n,!1);throw s}}async subscribeDataChannel(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new j(O.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const i={uid:t,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(ye.SUBSCRIBE_DATASTREAM,i,!0)}catch(s){if(r&&s.data&&s.data.code===Ie.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),s.toString()),await this.tryUnsubDataChannelBeforeResub(t,n),await this.subscribeDataChannel(t,n,!1);throw s}}async subscribeAll(t,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new j(O.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const r={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!A("USE_SUB_RTX"),twcc:!!A("SUBSCRIBE_TWCC"),svc:Array.isArray(A("SVC"))&&A("SVC").length!==0?A("SVC"):void 0};try{return await this.signal.request(ye.SUBSCRIBE_STREAMS,r,!0)}catch(i){if(n&&i.data&&i.data.code===Ie.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),i.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw i}}async setVideoProfile(t){const n=function(r){if(!(r.bitrateMax&&r.bitrateMin&&r.frameRate&&r.height&&r.width))return;let i=r.frameRate,s=r.width,a=r.height,d=!0;return typeof i!="number"&&(i=i.exact||i.ideal||i.max||i.min||0,i||(d=!1)),typeof s!="number"&&(s=s.exact||s.ideal||s.max||s.min||0,s||(d=!1)),typeof a!="number"&&(a=a.exact||a.ideal||a.max||a.min||0,i||(d=!1)),d?{stream_type:0,width:s,height:a,fps:i,start_bps:1e3*r.bitrateMax,min_bps:1e3*r.bitrateMin,target_bps:1e3*r.bitrateMax}:void 0}(t);if(n)return this.signal.request(ye.SET_VIDEO_PROFILE,n);T.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,n){try{await this.signal.request(ye.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:n},!0)}catch(r){T.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),r)}}async unsubscribeDataChannel(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new j(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ae.all(t.map(r=>this.signal.request(ye.UNSUBSCRIBE_DATASTREAM,{stream_id:r,uid:n},!0)))}catch(r){T.warning("unsubscribeDataChannel warning: ",r)}}async massUnsubscribe(t){try{await this.signal.request(ye.UNSUBSCRIBE_STREAMS,t,!0)}catch(n){T.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(t){const{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}=t;return{gatewayEstablishParams:await this.signal.request(ye.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(ye.GATEWAY_INFO)}async renewToken(t){await this.signal.request(ye.RENEW_TOKEN,t),this.key=t.token}updateClientRole(t,n){n&&(this._clientRoleOptions=Object.assign({},n)),A("CLIENT_ROLE_OPTIONS")&&(T.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(A("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},A("CLIENT_ROLE_OPTIONS"))),this.role=t}async setClientRole(t,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),A("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},A("CLIENT_ROLE_OPTIONS")),T.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(A("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let r,i=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(r=this._clientRoleOptions.delay,i=1):i=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:i=0;const s=Object.assign({},n);delete s.delay,delete s.level,await this.signal.request(ye.SET_CLIENT_ROLE,Dn(Dn({role:t,level:i,delay:r},s),{},{client_ts:Date.now()})),this.role=t}async setDualStreamMode(t,n,r){await this.signal.request(ye.SET_DUAL_STREAM_MODE,{mode:t},r,n)}async setRemoteVideoStreamType(t,n){await this.signal.request(ye.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:n})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(ye.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,n){await this.signal.request(ye.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:n})}async pickSVCLayer(t,n){await this.signal.request(ye.PICK_SVC_LAYER,{stream_id:t,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(t){await this.signal.request(ye.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,n,r){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,n,r)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Dn({},this.inChannelInfo)}async setConfigure(t){if(t&&Array.isArray(t)&&t.length!==0)return this.signal.request(ye.CONFIGURE,t)}async getGatewayVersion(){return(await this.signal.request(ye.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=ty.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0),this.usingProxy=!1}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(n){let r;return r=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),r?{username:Gn.username,password:Gn.password,turnServerURL:r[2],tcpport:parseInt(r[3])+30,udpport:parseInt(r[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Dn(Dn({},Gn),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(ye.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(n=>{const r=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(i=>i.peer_uid===n.peer_uid);r&&r.B_st!==n.B_st&&M_(()=>{this.emit(Qt.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){var n,r,i,s;if(!this.joinInfo||!this.key)throw new j(O.UNEXPECTED_ERROR,"can not generate join message, no join info");const a=Object.assign({},this.joinInfo.apResponse);let d=A("REPORT_APP_SCENARIO");if(typeof d!="string")try{d=JSON.stringify(d)}catch{d=void 0}var l;d&&d.length>128&&(d=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(Qt.UPDATE_GATEWAY_CONFIG),l=this.store.clientId,te(Al).call(Al,l)||Al.push(l);const h=yh(this.store),p=!((n=this.isPreallocation)===null||n===void 0||!n.call(this)),_=HL(this.store),m=DQ(),g=No(87)||JP()||Vv(117),w=(function(){const N=rt();if(N.name!==ot.SAFARI||!N.browserVersion)return!1;const L=N.browserVersion.split(".");return Number(L[0])>18||Number(L[0])===18&&Number(L[1])>=4}()||eL(18,4,!1))&&Fv(18,6,!0)&&this.spec.codec==="h264"&&A("ENABLE_ABSSENDTIME_AS_SENTTS"),R=!(((r=a.detail)===null||r===void 0?void 0:r[3])!=="CN"||!A("ENABLE_QUALITY_FALLBACK"))&&A("ENABLE_QUALITY_FALLBACK"),y=!!A("ENABLE_AP_MULTI_IP")&&((i=a.detail)===null||i===void 0?void 0:i[5])==="multi-ip",b=Dn({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Di,browser:navigator.userAgent,process_id:A("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:y||this.hasChangeBGPAddress,ap_response:a,extend:A("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:d,attributes:{userAttributes:Dn(Dn({enableEncodedTransform:(!!A("ENABLE_AUDIO_METADATA")||!!A("ENABLE_AUDIO_PTS"))&&g||!!A("ENABLE_AUDIO_TOPN")&&xv(ot.CHROME,87,116)||void 0,enableAudioMetadata:!!A("ENABLE_AUDIO_METADATA")&&g,enableAudioPts:!!A("ENABLE_AUDIO_PTS")&&g,topnSmoothLevel:A("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:A("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:A("TOPN_SWITCH_HOLD_MS"),topnAudioGain:A("TOPN_AUDIO_GAIN"),enableNetworkQualityProbe:this.store.networkQualityProbe,enablePublishedUserList:A("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:A("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:ei("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:ei("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:ei("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:A("USE_PUB_RTX")===!0||A("USE_SUB_RTX")===!0||void 0,disableFEC:A("DISABLE_FEC"),enableNTPReport:!!A("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:_,enableFulllinkAvSync:!!A("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:ei("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!A("FORCE_ENABLE_AUT_CC")||!H_()&&(!!A("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!A("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:ei("USE_XR","boolean"),enableLossbasedBwe:ei("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!A("FORCE_ENABLE_AUT_CC")||!H_()&&(!!A("ENABLE_AUT_CC")||void 0),enableCCFallback:ei("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:p,preSubNum:h?ei("PRE_SUB_NUM","number"):void 0,enablePubTWCC:ei("PUBLISH_TWCC","boolean"),enableSubTWCC:ei("SUBSCRIBE_TWCC","boolean"),enablePubRTX:ei("USE_PUB_RTX","boolean"),enableSubRTX:ei("USE_SUB_RTX","boolean"),enableSubSVC:A("ENABLE_SVC")?A("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(A("SVC"))&&A("SVC").length!==0?A("SVC"):void 0,enableSvcExtended:A("ENABLE_SVC")&&Array.isArray(A("SVC_EXTENDED"))&&A("SVC_EXTENDED").length!==0?A("SVC_EXTENDED"):void 0,enableVosFallback:A("ENABLE_VOS_FALLBACK"),enableQualityFallback:R},m),{},{audioDuplicate:ei("ENABLE_AUDIO_RED","boolean")?(s=ei("AUDIO_DUPLICATE_NUM","number"))!==null&&s!==void 0?s:2:void 0,senttsUsesAbsSendTime:!!w||void 0,enableDualStreamFlag:ei("ENABLE_DUAL_STREAM_FLAG","boolean")})},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(b.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(b.aes_mode=this.joinInfo.aesmode,A("ENCRYPT_AES")?(b.aes_secret=this.joinInfo.aespassword,b.aes_encrypt=!0):b.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(b.aes_salt=this.joinInfo.aessalt)),a.addresses[this.signal.websocket.currentURLIndex]&&(b.ap_response.ticket=a.addresses[this.signal.websocket.currentURLIndex].ticket,delete a.addresses),this.joinInfo.defaultVideoStream!==void 0&&(b.default_video_stream=this.joinInfo.defaultVideoStream),b}getRejoinMessage(){if(!this.joinInfo)throw new j(O.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(ve.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(ve.WS_RECONNECTING,t=>{this.joinInfo&&Se.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||jn.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Se.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(ve.WS_CLOSED,t=>{let n;switch(t){case Qe.LEAVE:n=jn.LEAVE;break;case Qe.UID_BANNED:case Qe.IP_BANNED:case Qe.CHANNEL_BANNED:case Qe.SERVER_ERROR:n=jn.SERVER_ERROR;break;case Qe.FALLBACK:n=jn.FALLBACK;break;case Qe.LICENSE_MISSING:case Qe.LICENSE_EXPIRED:case Qe.LICENSE_MINUTES_EXCEEDED:case Qe.LICENSE_PERIOD_INVALID:case Qe.LICENSE_MULTIPLE_SDK_SERVICE:case Qe.LICENSE_ILLEGAL:case Qe.TOKEN_EXPIRE:n=t;break;default:n=jn.NETWORK_ERROR}T.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+jn.NETWORK_ERROR)),this.joinInfo&&Se.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===Qe.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=t,t!==Qe.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(ve.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const t=A("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(T.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(Se.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void T.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));St("EVENT_REPORT_DOMAIN",t[1]),St("EVENT_REPORT_BACKUP_DOMAIN",t[1]),St("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}}),this.signal.on(Me.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(ve.REQUEST_RECOVER,(t,n,r)=>{if(!this.joinInfo)return r(new j(O.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,dn(this,Qt.REQUEST_NEW_GATEWAY_LIST).then(n).catch(r)}),this.signal.on(ve.REQUEST_JOIN_INFO,async(t,n,r)=>{var i,s,a;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));const d=Dt((i=this.joinInfo)===null||i===void 0?void 0:i.turnServer);if(A("NEW_TURN_MODE")&&d&&((s=this.joinInfo)===null||s===void 0?void 0:s.cloudProxyServer)==="disabled"){var l;let m=d.servers.map(R=>"turnServerURL"in R&&A("USE_TURN_IP")?Dn(Dn({},R),{},{turnServerURL:fm(R.turnServerURL)}):R),g=(l=d.serversFromGateway)===null||l===void 0?void 0:l.map(R=>A("USE_TURN_IP")?Dn(Dn({},R),{},{turnServerURL:fm(R.turnServerURL)}):R);const w=this.signal.currentURLIndex;m.length>0&&(m=[m[w%m.length]],d.servers=m),Array.isArray(g)&&g.length>0&&(g=[g[0]],d.serversFromGateway=g),T.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(w))}const{iceParameters:h,dtlsParameters:p,rtpCapabilities:_}=await dn(this,Qt.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:d,cloudProxyServer:(a=this.joinInfo)===null||a===void 0?void 0:a.cloudProxyServer});try{t(this.getJoinMessage({ortc:{iceParameters:h,dtlsParameters:p,rtpCapabilities:_,version:"2"}}))}catch(m){n(m)}}),this.signal.on(ve.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(ve.REPORT_JOIN_GATEWAY,(t,n)=>{if(!this.joinInfo)return;let r,i="";var s;t instanceof j?(r=((s=t.data)===null||s===void 0?void 0:s.desc)||t.code,i=t.message):r=t,Se.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:r,errorMsg:i,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:this.joinInfo.preload})}),this.signal.on(ve.IS_P2P_DISCONNECTED,t=>{t(Oc(this,Qt.IS_P2P_DISCONNECTED))}),this.signal.on(ve.DISCONNECT_P2P,()=>{this.emit(Qt.DISCONNECT_P2P)}),this.signal.on(ve.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(ve.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(ve.JOIN_RESPONSE,t=>{const n=this.getCurrentGatewayAddress();this.emit(Qt.JOIN_RESPONSE,t,n)}),this.signal.on(ve.PRE_CONNECT_PC,async(t,n)=>{if(this.joinInfo){var r,i;this.updateTurnConfigFromSignal();const a=this.getCurrentGatewayAddress(),d=Dt((r=this.joinInfo)===null||r===void 0?void 0:r.turnServer);if(A("NEW_TURN_MODE")&&d&&((i=this.joinInfo)===null||i===void 0?void 0:i.cloudProxyServer)==="disabled"){var s;let h=d.servers.map(m=>"turnServerURL"in m&&A("USE_TURN_IP")?Dn(Dn({},m),{},{turnServerURL:fm(m.turnServerURL)}):m),p=(s=d.serversFromGateway)===null||s===void 0?void 0:s.map(m=>A("USE_TURN_IP")?Dn(Dn({},m),{},{turnServerURL:fm(m.turnServerURL)}):m);const _=this.signal.currentURLIndex;h.length>0&&(h=[h[_%h.length]],d.servers=h),Array.isArray(p)&&p.length>0&&(p=[p[0]],d.serversFromGateway=p),T.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(_,",in pre pc"))}const l=A("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(a&&l){const h=kM(a);dn(this,Qt.PRE_CONNECT_PC,{candidates:h,fingerprint:l,turnServer:d}).then(p=>{t==null||t(p)}).catch(n||(()=>{}))}}}),this.signal.on(ve.RECOVER_NOTIFICATION,t=>{this.joinInfo&&typeof A("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(A("AP_REQUEST_DETAIL"),";").concat(t))}),this.signal.on(ve.VOS_FALLBACK,t=>{this.emit(Qt.VOS_FALLBACK,t)}),this.signal.on(ve.DATACHANNEL_FAILBACK,t=>{T.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(Qt.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(t,n){try{await this.signal.request(ye.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[n]},!0)}catch(r){throw T.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),r),r}}async tryUnsubDataChannelBeforeResub(t,n){try{await this.signal.request(ye.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(r){throw T.warning("unsubscribe datachannel warning",r),r}}async tryUnpubBeforeRepub(t,n){try{await this.signal.request(ye.UNPUBLISH,{stream_id:t,ortc:n},!0)}catch(r){throw T.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),r),r}}async tryUnpubDataChannelBeforeRepub(t,n){try{await this.signal.request(ye.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(r){throw T.warning("unpublish datastream warning: ",r),r}}async tryMassUnsubBeforeResub(t){const n={users:t.map(r=>({stream_id:r.stream_id,stream_type:r.stream_type}))};try{await this.signal.request(ye.UNSUBSCRIBE_STREAMS,n,!0)}catch(r){throw T.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),r),r}}async muteLocal(t,n){const r={action:t.find(i=>i.stream_type===ft.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(ye.CONTROL,r,!0,!0)}catch(i){throw T.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),i),i}}async unmuteLocal(t,n){const r={action:t.find(i=>i.stream_type===ft.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(ye.CONTROL,r,!0,!0)}catch(i){throw T.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),i),i}}async muteRemote(t,n){const r={action:t===_e.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(ye.CONTROL,r,!0,!0)}catch(i){throw T.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),i),i}}async unmuteRemote(t,n){const r={action:t===_e.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(ye.CONTROL,r,!0,!0)}catch(i){throw T.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),i),i}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,n){this.signal.upload(t,n)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(ye.RESTART_ICE,n,!0)}catch(r){throw T.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),r),r}}reconnect(t,n){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,n||jn.P2P_FAILED)}getCurrentGatewayAddress(){var t,n;if(!A("GATEWAY_WSS_ADDRESS"))return A("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(T.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(ye.SET_PARAMETER,{enablePublishAudioFilter:t})}downgradeCodec(t){this.signal.downgradeCodec(t)}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(Qe.FALLBACK)),this.store.useDcSignal=!1,this.signal=new RM(Dn(Dn({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(Qt.RESET_SIGNAL)}}let vm=0,ny=0;function xo(e,t,n,r){return new ae((i,s)=>{t.timeout=t.timeout||A("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),vm+=cs(t.data)):n&&(t.data.size?vm+=t.data.size:t.data instanceof FormData?vm+=TL(t.data):vm+=cs(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Cr.request(t).then(a=>{typeof a.data=="string"?ny+=cs(a.data):a.data instanceof ArrayBuffer||a.data instanceof Uint8Array?ny+=a.data.byteLength:ny+=cs(JSON.stringify(a.data)),r&&i({data:a.data,headers:a.headers}),i(a.data)}).catch(a=>{Cr.isCancel(a)?s(new j(O.OPERATION_ABORTED,"cancel token canceled")):a.code==="ECONNABORTED"?s(new j(O.NETWORK_TIMEOUT,a.message)):a.response?s(new j(O.NETWORK_RESPONSE_ERROR,a.response.status)):s(new j(O.NETWORK_ERROR,a.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t(Z){var oe=0;return function(){return oe<Z.length?{done:!1,value:Z[oe++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(Z,oe,ge){return Z==Array.prototype||Z==Object.prototype||(Z[oe]=ge.value),Z},r,i=function(Z){Z=[typeof globalThis=="object"&&globalThis,Z,typeof window=="object"&&window,typeof self=="object"&&self,typeof f=="object"&&f];for(var oe=0;oe<Z.length;++oe){var ge=Z[oe];if(ge&&ge.Math==Math)return ge}throw Error("Cannot find global object")}(this);function s(Z,oe){if(oe)e:{var ge=i;Z=Z.split(".");for(var $=0;$<Z.length-1;$++){var v=Z[$];if(!(v in ge))break e;ge=ge[v]}(oe=oe($=ge[Z=Z[Z.length-1]]))!=$&&oe!=null&&n(ge,Z,{configurable:!0,writable:!0,value:oe})}}function a(Z){return(Z={next:Z})[Symbol.iterator]=function(){return this},Z}function d(Z){var oe=typeof Symbol<"u"&&Symbol.iterator&&Z[Symbol.iterator];return oe?oe.call(Z):{next:t(Z)}}if(s("Symbol",function(Z){function oe(v,P){this.A=v,n(this,"description",{configurable:!0,writable:!0,value:P})}if(Z)return Z;oe.prototype.toString=function(){return this.A};var ge="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",$=0;return function v(P){if(this instanceof v)throw new TypeError("Symbol is not a constructor");return new oe(ge+(P||"")+"_"+$++,P)}}),s("Symbol.iterator",function(Z){if(Z)return Z;Z=Symbol("Symbol.iterator");for(var oe="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),ge=0;ge<oe.length;ge++){var $=i[oe[ge]];typeof $=="function"&&typeof $.prototype[Z]!="function"&&n($.prototype,Z,{configurable:!0,writable:!0,value:function(){return a(t(this))}})}return Z}),typeof Object.setPrototypeOf=="function")r=Object.setPrototypeOf;else{var l;e:{var h={};try{h.__proto__={a:!0},l=h.a;break e}catch{}l=!1}r=l?function(Z,oe){if(Z.__proto__=oe,Z.__proto__!==oe)throw new TypeError(Z+" is not extensible");return Z}:null}var p=r;function _(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function m(Z){if(Z.m)throw new TypeError("Generator is already running");Z.m=!0}function g(Z,oe){return Z.h=3,{value:oe}}function w(Z){this.g=new _,this.G=Z}function R(Z,oe,ge,$){try{var v=oe.call(Z.g.j,ge);if(!(v instanceof Object))throw new TypeError("Iterator result "+v+" is not an object");if(!v.done)return Z.g.m=!1,v;var P=v.value}catch(U){return Z.g.j=null,Z.g.s(U),y(Z)}return Z.g.j=null,$.call(Z.g,P),y(Z)}function y(Z){for(;Z.g.h;)try{var oe=Z.G(Z.g);if(oe)return Z.g.m=!1,{value:oe.value,done:!1}}catch(ge){Z.g.v=void 0,Z.g.s(ge)}if(Z.g.m=!1,Z.g.l){if(oe=Z.g.l,Z.g.l=null,oe.F)throw oe.D;return{value:oe.return,done:!0}}return{value:void 0,done:!0}}function b(Z){this.next=function(oe){return Z.o(oe)},this.throw=function(oe){return Z.s(oe)},this.return=function(oe){return function(ge,$){m(ge.g);var v=ge.g.j;return v?R(ge,"return"in v?v.return:function(P){return{value:P,done:!0}},$,ge.g.return):(ge.g.return($),y(ge))}(Z,oe)},this[Symbol.iterator]=function(){return this}}function N(Z,oe){return oe=new b(new w(oe)),p&&Z.prototype&&p(oe,Z.prototype),oe}if(_.prototype.o=function(Z){this.v=Z},_.prototype.s=function(Z){this.l={D:Z,F:!0},this.h=this.C||this.u},_.prototype.return=function(Z){this.l={return:Z},this.h=this.u},w.prototype.o=function(Z){return m(this.g),this.g.j?R(this,this.g.j.next,Z,this.g.o):(this.g.o(Z),y(this))},w.prototype.s=function(Z){return m(this.g),this.g.j?R(this,this.g.j.throw,Z,this.g.o):(this.g.s(Z),y(this))},s("Array.prototype.entries",function(Z){return Z||function(){return function(oe,ge){oe instanceof String&&(oe+="");var $=0,v=!1,P={next:function(){if(!v&&$<oe.length){var U=$++;return{value:ge(U,oe[U]),done:!1}}return v=!0,{done:!0,value:void 0}}};return P[Symbol.iterator]=function(){return P},P}(this,function(oe,ge){return[oe,ge]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var L=function(Z,oe){for(var ge=0;ge<Z.length;ge++)oe(Z[ge])},x=function(Z){return Z.replace(/\r?\n|\r/g,`\r
`)},F=function(Z,oe,ge){return oe instanceof Blob?(ge=ge!==void 0?ge+"":typeof oe.name=="string"?oe.name:"blob",oe.name===ge&&Object.prototype.toString.call(oe)!=="[object Blob]"||(oe=new File([oe],ge)),[String(Z),oe]):[String(Z),String(oe)]},M=function(Z,oe){if(Z.length<oe)throw new TypeError(oe+" argument required, but only "+Z.length+" present.")},B=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,J=B.FormData,ee=B.XMLHttpRequest&&B.XMLHttpRequest.prototype.send,pe=B.Request&&B.fetch,Pe=B.navigator&&B.navigator.sendBeacon,Ne=B.Element&&B.Element.prototype,Ge=B.Symbol&&Symbol.toStringTag;Ge&&(Blob.prototype[Ge]||(Blob.prototype[Ge]="Blob"),"File"in B&&!File.prototype[Ge]&&(File.prototype[Ge]="File"));try{new File([],"")}catch{B.File=function(oe,ge,$){return oe=new Blob(oe,$||{}),Object.defineProperties(oe,{name:{value:ge},lastModified:{value:+($&&$.lastModified!==void 0?new Date($.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Ge&&Object.defineProperty(oe,Ge,{value:"File"}),oe}}var Fe=function(Z){return Z.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},st=function(Z){this.i=[];var oe=this;Z&&L(Z.elements,function(ge){if(ge.name&&!ge.disabled&&ge.type!=="submit"&&ge.type!=="button"&&!ge.matches("form fieldset[disabled] *"))if(ge.type==="file"){var $=ge.files&&ge.files.length?ge.files:[new File([],"",{type:"application/octet-stream"})];L($,function(v){oe.append(ge.name,v)})}else ge.type==="select-multiple"||ge.type==="select-one"?L(ge.options,function(v){!v.disabled&&v.selected&&oe.append(ge.name,v.value)}):ge.type==="checkbox"||ge.type==="radio"?ge.checked&&oe.append(ge.name,ge.value):($=ge.type==="textarea"?x(ge.value):ge.value,oe.append(ge.name,$))})};if((e=st.prototype).append=function(Z,oe,ge){M(arguments,2),this.i.push(F(Z,oe,ge))},e.delete=function(Z){M(arguments,1);var oe=[];Z=String(Z),L(this.i,function(ge){ge[0]!==Z&&oe.push(ge)}),this.i=oe},e.entries=function Z(){var oe,ge=this;return N(Z,function($){if($.h==1&&(oe=0),$.h!=3)return oe<ge.i.length?$=g($,ge.i[oe]):($.h=0,$=void 0),$;oe++,$.h=2})},e.forEach=function(Z,oe){M(arguments,1);for(var ge=d(this),$=ge.next();!$.done;$=ge.next()){var v=d($.value);$=v.next().value,v=v.next().value,Z.call(oe,v,$,this)}},e.get=function(Z){M(arguments,1);var oe=this.i;Z=String(Z);for(var ge=0;ge<oe.length;ge++)if(oe[ge][0]===Z)return oe[ge][1];return null},e.getAll=function(Z){M(arguments,1);var oe=[];return Z=String(Z),L(this.i,function(ge){ge[0]===Z&&oe.push(ge[1])}),oe},e.has=function(Z){M(arguments,1),Z=String(Z);for(var oe=0;oe<this.i.length;oe++)if(this.i[oe][0]===Z)return!0;return!1},e.keys=function Z(){var oe,ge,$,v,P=this;return N(Z,function(U){if(U.h==1&&(oe=d(P),ge=oe.next()),U.h!=3)return ge.done?void(U.h=0):($=ge.value,v=d($),g(U,v.next().value));ge=oe.next(),U.h=2})},e.set=function(Z,oe,ge){M(arguments,2),Z=String(Z);var $=[],v=F(Z,oe,ge),P=!0;L(this.i,function(U){U[0]===Z?P&&(P=!$.push(v)):$.push(U)}),P&&$.push(v),this.i=$},e.values=function Z(){var oe,ge,$,v,P=this;return N(Z,function(U){if(U.h==1&&(oe=d(P),ge=oe.next()),U.h!=3)return ge.done?void(U.h=0):($=ge.value,(v=d($)).next(),g(U,v.next().value));ge=oe.next(),U.h=2})},st.prototype._asNative=function(){for(var Z=new J,oe=d(this),ge=oe.next();!ge.done;ge=oe.next()){var $=d(ge.value);ge=$.next().value,$=$.next().value,Z.append(ge,$)}return Z},st.prototype._blob=function(){var Z="----formdata-polyfill-"+Math.random(),oe=[],ge="--"+Z+`\r
Content-Disposition: form-data; name="`;return this.forEach(function($,v){return typeof $=="string"?oe.push(ge+Fe(x(v))+`"\r
\r
`+x($)+`\r
`):oe.push(ge+Fe(x(v))+'"; filename="'+Fe($.name)+`"\r
Content-Type: `+($.type||"application/octet-stream")+`\r
\r
`,$,`\r
`)}),oe.push("--"+Z+"--"),new Blob(oe,{type:"multipart/form-data; boundary="+Z})},st.prototype[Symbol.iterator]=function(){return this.entries()},st.prototype.toString=function(){return"[object FormData]"},Ne&&!Ne.matches&&(Ne.matches=Ne.matchesSelector||Ne.mozMatchesSelector||Ne.msMatchesSelector||Ne.oMatchesSelector||Ne.webkitMatchesSelector||function(Z){for(var oe=(Z=(this.document||this.ownerDocument).querySelectorAll(Z)).length;0<=--oe&&Z.item(oe)!==this;);return-1<oe}),Ge&&(st.prototype[Ge]="FormData"),ee){var Ut=B.XMLHttpRequest.prototype.setRequestHeader;B.XMLHttpRequest.prototype.setRequestHeader=function(Z,oe){Ut.call(this,Z,oe),Z.toLowerCase()==="content-type"&&(this.B=!0)},B.XMLHttpRequest.prototype.send=function(Z){Z instanceof st?(Z=Z._blob(),this.B||this.setRequestHeader("Content-Type",Z.type),ee.call(this,Z)):ee.call(this,Z)}}pe&&(B.fetch=function(Z,oe){return oe&&oe.body&&oe.body instanceof st&&(oe.body=oe.body._blob()),pe.call(this,Z,oe)}),Pe&&(B.navigator.sendBeacon=function(Z,oe){return oe instanceof st&&(oe=oe._asNative()),Pe.call(this,Z,oe)}),B.FormData=st}})();const kh=()=>{const e=A("AREAS");return e.length===0&&e.push(at.GLOBAL),Oi(e).call(e,(t,n,r)=>{const i=KM(n);return i?r===0?i:"".concat(t,",").concat(i):t},"")},KM=e=>e===at.OVERSEA?"".concat(qn.ASIA,",").concat(qn.EUROPE,",").concat(qn.AFRICA,",").concat(qn.NORTH_AMERICA,",").concat(qn.SOUTH_AMERICA,",").concat(qn.OCEANIA):qn[e],LQ=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(n=>{const r=um[n],i=Object.keys(r);i&&i.map(s=>{s!=="CODE"&&(t[s]=t[s].concat(r[s]))})}),t},Rm={GLOBAL:{ASIA:[at.CHINA,at.JAPAN,at.INDIA,at.KOREA,at.HKMC],EUROPE:[],NORTH_AMERICA:[at.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},ym=Object.keys(Rm[at.GLOBAL]),ry=[at.CHINA,at.NORTH_AMERICA,at.EUROPE,at.ASIA,at.JAPAN,at.INDIA,at.OCEANIA,at.SOUTH_AMERICA,at.AFRICA,at.KOREA,at.HKMC,at.US],kQ=function(e,t){let n=[];if(te(e).call(e,at.GLOBAL)){const s=[at.GLOBAL,at.OVERSEA],a=Object.keys(um);if(t===at.GLOBAL)throw new j(O.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===at.CHINA)n=[at.OVERSEA];else if(i=t,te(ym).call(ym,i)){const d=(r=t,Rm[at.GLOBAL][r]||[]),l=[...s,t,...d];n=a.filter(h=>!te(l).call(l,h))}else if(function(d){let l=!1;return ym.forEach(h=>{var p;te(p=Rm[at.GLOBAL][h]).call(p,d)&&(l=!0)}),l}(t)){const d=function(h){let p;return ym.forEach(_=>{var m;te(m=Rm[at.GLOBAL][_]).call(m,h)&&(p=_)}),p}(t),l=[...s,d,t];n=a.filter(h=>!te(l).call(l,h))}else n=e;n=function(d){const l=[];return ry.forEach(h=>{te(d).call(d,h)&&l.push(h)}),l.concat(d.filter(h=>!te(ry).call(ry,h)))}(n)}else n=e;var r,i;return n};function YM(e){var t,n;if(!e&&te(t=A("AREAS")).call(t,at.EXTENSIONS))return T.debug("update area from ap : reset"),void iy(WJ,!0);if(!te(n=A("AREAS")).call(n,at.GLOBAL)||!e)return;let r=um.EXTENSIONS;r&&(r={CODE:KM(at.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},T.debug("update area from ap success: ".concat(e,",config is "),r),St("AREAS",[at.EXTENSIONS],!0),Object.keys(r).map(i=>{i==="LOG_UPLOAD_SERVER"||i==="EVENT_REPORT_DOMAIN"||i==="EVENT_REPORT_BACKUP_DOMAIN"||i==="PROXY_SERVER_TYPE3"?St(i,r[i][0]):St(i,r[i])}))}function iy(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=Se.reportApiInvoke(null,{name:kt.SET_AREA,options:e,tag:yt.TRACER});try{let r=[];if(typeof e=="string"&&(r=[e]),Array.isArray(e)&&(e.forEach(s=>{if(!te(_M).call(_M,s))throw new j(O.INVALID_PARAMS,"invalid area code")}),r=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:s,excludedArea:a}=e;if(!s)throw new j(O.INVALID_PARAMS,"area code is needed");let d=s;typeof s=="string"&&(d=[s]),r=a?kQ(d,a):d}if(!t){if(li.AREAS){const s=new j(O.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(s),void T.warning("setArea is prohibited because of config-distribute")}if(te(r).call(r,at.GLOBAL)&&A("AREAS")===at.EXTENSIONS){const s=new j(O.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(s),void T.warning("setArea is prohibited because of ap extensions")}}St("AREAS",r,t);const i=LQ(r);Object.keys(i).map(s=>{s==="LOG_UPLOAD_SERVER"||s==="EVENT_REPORT_DOMAIN"||s==="EVENT_REPORT_BACKUP_DOMAIN"||s==="PROXY_SERVER_TYPE3"?St(s,i[s][0]):St(s,i[s])}),T.debug("set area success:",r.join(","))}catch(r){throw n.onError(r),r}n.onSuccess()}function zM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function _s(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?zM(Object(n),!0).forEach(function(r){I(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zM(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let oy=1;function MQ(e,t,n,r,i){oy+=1;const s={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:oy,requestId:oy,version:Di,cname:n.cname},a={service_name:t,json_body:JSON.stringify(s)};let d,l,h=e[0];return Do(async()=>{d=Date.now();const p=await xo(h,{data:a,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(l=Date.now()-d,p.code!==0){const g=new j(O.UNEXPECTED_RESPONSE,"live streaming ap error, code"+p.code,{retry:!0,responseTime:l});throw T.error(g.toString()),g}const _=JSON.parse(p.json_body);if(_.code!==200){const g=new j(O.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(_.code,", reason: ").concat(_.reason),{code:_.code,responseTime:l});throw T.error(g.toString()),g}if(!_.servers||_.servers.length===0){const g=new j(O.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:_.code,responseTime:l});throw T.error(g.toString()),g}const m=function(g,w){return{addressList:g.servers.map(R=>"wss://".concat(R.address.replace(/\./g,"-"),".").concat(A("WORKER_DOMAIN"),":").concat(R.wss,"?serviceName=").concat(encodeURIComponent(w))),workerToken:g.workerToken,vid:g.vid}}(_,t);return A("LIVE_STREAMING_ADDRESS")&&(m.addressList=A("LIVE_STREAMING_ADDRESS")instanceof Array?A("LIVE_STREAMING_ADDRESS"):[A("LIVE_STREAMING_ADDRESS")]),_s(_s({},m),{},{responseTime:l})},(p,_)=>(Se.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(p.addressList),firstSuccess:_===0,responseTime:l,serverIp:e[_%e.length]}),!1),(p,_)=>(Se.apworkerEvent(n.sid,{success:!1,sc:p.data&&p.data.code||200,serviceName:t,responseTime:l,serverIp:e[_%e.length]}),!!(p.code!==O.OPERATION_ABORTED&&p.code!==O.UNEXPECTED_RESPONSE||p.data&&p.data.retry)&&(h=e[(_+1)%e.length],!0)),i)}let sy=1;function qM(e,t,n,r){let{url:i,areaCode:s}=e;const{clientId:a,sid:d}=t,l=Date.now();let h;const p=t.role,[_,m]=cy(t,s,[rn.CHOOSE_SERVER]);let g=Ht.networkState;return Do(async()=>{g&&Ht.networkState===fr.OFFLINE&&Ht.onlineWaiter&&await ae.race([Ht.onlineWaiter,Tn(r&&r.maxRetryTimeout||nn.maxRetryTimeout)]),g=Ht.networkState;const{data:w,headers:R}=await xo(i,{data:_,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);h=R.http3==="1"?1:-1,Se.reportResourceTiming(i,d),JM(w,i,t,l,[rn.CHOOSE_SERVER],h);const y=bh(w,rn.CHOOSE_SERVER);return ay(y),zR(y,i)},w=>(w&&Se.joinChooseServer(d,{role:p,lts:l,succ:!0,csAddr:i,opid:m,serverList:w.gatewayAddrs.map(R=>R.address),ec:null,cid:w.cid.toString(),uid:w.uid.toString(),csIp:w.csIp,unilbsServerIds:[rn.CHOOSE_SERVER].toString(),isHttp3:h,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:w.res.detail&&w.res.detail[38],vid:w.vid}),!1),w=>w.code!==O.OPERATION_ABORTED&&(w.code===O.CAN_NOT_GET_GATEWAY_SERVER?w.data.retry:(Se.joinChooseServer(d,{role:p,lts:l,succ:!1,csAddr:i,serverList:null,opid:m,ec:w.code,csIp:w.data&&w.data.csIp,unilbsServerIds:[rn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:g}),isHttp3:h,corssRegionTagReq:t.apRequestDetail}),T.warning("[".concat(a||"sid-".concat(d.slice(0,6)),"] Choose server network error, retry"),w),!0)),r)}function XM(e,t,n,r){let i,{url:s,areaCode:a,serviceIds:d}=e;const l=Date.now(),h=t.role,[p,_]=cy(t,a,d);let m;return Do(async()=>{m&&Ht.networkState===fr.OFFLINE&&Ht.onlineWaiter&&await ae.race([Ht.onlineWaiter,Tn(r&&r.maxRetryTimeout||nn.maxRetryTimeout)]),m=Ht.networkState;const{data:g,headers:w}=await xo(s,{data:p,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i=w.http3==="1"?1:-1,Se.reportResourceTiming(s,t.sid),JM(g,s,t,l,d,i);const R=bh(g,rn.CHOOSE_SERVER),y=bh(g,t.cloudProxyServer==="proxy5"?rn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?rn.CLOUD_PROXY:rn.CLOUD_PROXY_FALLBACK),b=performance.getEntriesByName(s),N=b[b.length-1];let L;return N&&(L={name:N.name,protocol:"nextHopProtocol"in N?N.nextHopProtocol:"",dnscost:"domainLookupEnd"in N&&"domainLookupStart"in N&&typeof N.domainLookupEnd=="number"&&typeof N.domainLookupStart=="number"?N.domainLookupEnd-N.domainLookupStart:-1,tcpTlsCost:"connectEnd"in N&&"connectStart"in N&&typeof N.connectEnd=="number"&&typeof N.connectStart=="number"?N.connectEnd-N.connectStart:-1,reqCost:"requestStart"in N&&typeof N.requestStart=="number"&&"responseEnd"in N&&typeof N.responseEnd=="number"?N.responseEnd-N.requestStart:-1,handleCost:"leave_ts"in g&&"enter_ts"in g&&typeof g.leave_ts=="number"&&typeof g.enter_ts=="number"?g.leave_ts-g.enter_ts:-1}),ay(R),{gatewayInfo:zR(R,s),proxyInfo:y,url:s,resourceTimingInfo:L}},g=>{var w;return g.gatewayInfo&&Se.joinChooseServer(t.sid,{role:h,lts:l,succ:!0,csAddr:s,serverList:g.gatewayInfo.gatewayAddrs.map(R=>R.address),ec:null,opid:_,cid:g.gatewayInfo.cid.toString(),uid:g.gatewayInfo.uid.toString(),csIp:g.gatewayInfo.csIp,unilbsServerIds:d.toString(),isHttp3:i,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:g.gatewayInfo.res.detail&&g.gatewayInfo.res.detail[38],vid:(w=g.gatewayInfo)===null||w===void 0?void 0:w.vid,resourceTimingInfo:g.resourceTimingInfo?JSON.stringify(g.resourceTimingInfo):void 0}),g.proxyInfo&&Se.joinWebProxyAP(t.sid,{lts:l,sucess:1,apServerAddr:s,turnServerAddrList:g.proxyInfo.addresses.map(R=>R.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:d.toString()}),!1},g=>g.code!==O.OPERATION_ABORTED&&(g.code===O.CAN_NOT_GET_GATEWAY_SERVER?g.data.retry:(Se.joinWebProxyAP(t.sid,{lts:l,sucess:0,apServerAddr:s,turnServerAddrList:null,errorCode:g.code,eventType:t.cloudProxyServer,unilbsServerIds:d.toString(),extend:JSON.stringify({networkState:m})}),T.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),g),!0)),r)}const JM=(e,t,n,r,i,s)=>{const{sid:a,clientId:d,cloudProxyServer:l}=n,h=[],p=_=>{_.flag===4096?Se.joinChooseServer(a,{role:n.role,lts:r,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:_.error.message,csIp:_.error.data&&_.error.data.csIp,unilbsServerIds:i.toString(),isHttp3:s,corssRegionTagReq:n.apRequestDetail}):_.flag!==1048576&&_.flag!==4194304&&_.flag!==4194310||Se.joinWebProxyAP(a,{lts:r,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:_.error.code,eventType:l,unilbsServerIds:i.toString()})};if(e.response_body.forEach(_=>{const m=_.buffer.code;if(_.uri===23&&m===0&&!_.buffer.edges_services)if(_.buffer.flag===4194310)T.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),_.buffer.edges_services=[];else{const g={error:new j(O.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:A("NO_EDGES_RETRY"),csIp:e.detail[502]}),flag:_.buffer.flag};h.push(g),p(g)}if(m!==0){const g=Dl(m),w={error:new j(O.CAN_NOT_GET_GATEWAY_SERVER,g.desc,{desc:g.desc,retry:g.retry,csIp:e.detail[502]}),flag:_.buffer.flag};_.buffer.flag===4194310?T.warning(w.error.toString()):h.push(w),p(w)}}),h.length)throw T.warning("[".concat(d||"sid-".concat(a.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(h.map(_=>"flag: ".concat(_.flag,", message: ").concat(_.error.message,", retry: ").concat(_.error.data.retry)).join(" | "))),new j(O.CAN_NOT_GET_GATEWAY_SERVER,h.map(_=>"flag: ".concat(_.flag,", message: ").concat(_.error.message)).join(" | "),{retry:!!h.find(_=>_.error.data.retry),csIp:e.detail[502],desc:[...new Set(h.map(_=>{var m;return _==null||(m=_.error)===null||m===void 0||(m=m.data)===null||m===void 0?void 0:m.desc}).filter(_=>!!_))]})},ay=e=>{var t,n,r,i;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new j(O.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(A("AP_AREA")&&((r=e.detail)!==null&&r!==void 0&&r[23]&&typeof((i=e.detail)===null||i===void 0?void 0:i[23])=="string"?YM(e.detail[23].toLowerCase()):YM()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((n=e.detail)===null||n===void 0?void 0:n[19])=="string"){const a=e.detail[19],d=a==null?void 0:a.split(";");for(let l=0;l<d.length;l++){var s;const h=hr(s=d[l]).call(s);e.addresses[l]&&d&&(e.addresses[l].fingerprint=h)}}if(A("GATEWAY_ADDRESS")&&A("GATEWAY_ADDRESS").length>0){T.debug("assign gateway address to",A("GATEWAY_ADDRESS"));const a=A("GATEWAY_ADDRESS").map(d=>{var l,h;const p=(l=(h=e.addresses.find(_=>_.ip===d.ip&&_.port===d.port))===null||h===void 0?void 0:h.fingerprint)!==null&&l!==void 0?l:"";return{ip:d.ip,port:d.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:d.fingerprint||p}});e.addresses=a}},UQ=(e,t)=>{if(e.response_body&&e.response_body.length){const n=e.response_body[0];if(n.buffer.code!==0){const r=Dl(n.buffer.code);throw new j(O.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(r.desc),{retry:r.retry})}return n.buffer.ticket}throw T.debug("update ticket request received ap response without response body:",t),new j(O.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},cy=(e,t,n)=>{const r=Math.floor(Math.random()*1e12),i=e.role==="host"?"1":e.role==="audience"?"2":void 0,s={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:_s(_s(_s({6:e.stringUid,11:t,12:A("USE_NEW_TOKEN")?"1":void 0},i?{17:i}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};s.request_bodies.forEach(d=>{e.multiIP&&e.multiIP.gateway_ip&&(d.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const a=new FormData;return a.append("request",JSON.stringify(s)),[a,r]},xQ=(e,t)=>{const n=Math.floor(Math.random()*1e12),r={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(s=>({ip:s.ip,port:s.port}))}}]},i=new FormData;return i.append("request",JSON.stringify(r)),[i,n]};let kl=0;function Ml(e){return ae.all(e.map(t=>t.then(n=>{throw n},n=>n))).then(t=>{throw t},t=>t)}const Mh=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:r,allFailedhandler:i,promisesCollector:s}=e,a=0;const d=t;let l,h=0;const p=async()=>{const _=(()=>{const m=a*d,g=m+d;return n.slice(m,g).map(r)})();s&&s.push(..._);try{l=await Ml(_)}catch(m){if(h+=d,a++,!(h>=n.length))return void await p();i(m)}_.forEach(m=>m.cancel())};return await p(),l},QM=async e=>{let{referenceList:t,asyncMapHandler:n,closeFn:r}=e;const i=t.length;let s=0;const a=async()=>{const d=n(t.shift());try{return await d}catch(l){if(s++,s>=i||r!=null&&r(l))throw l;return a()}};return a()};async function VQ(){if(typeof VideoDecoder>"u")return!0;let e;const t=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],n=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],r=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],i=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],s=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],a=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new ae((l,h)=>{let p;(async function(){e&&e.state!=="closed"||await async function(){e=new VideoDecoder({output:m=>{m.close(),clearTimeout(p),l(!0)},error:m=>{clearTimeout(p),l(!1)}}),await e.configure({codec:"av01.0.05M.08",width:160,height:90})}();const _=[t,n,r,i,s,a];for(let m=0;m<_.length;m++){const g=new EncodedVideoChunk({type:m==0?"key":"delta",timestamp:33333*m,duration:33333,data:new Uint8Array(_[m])});try{await e.decode(g)}catch{return void l(!1)}}})(),p=setTimeout(()=>{l(!1)},5e3)})}async function Cm(e,t,n,r){return{gatewayInfo:await async function(s,a,d,l){let h=null;const p=[],_=async()=>{const g=A("WEBCS_DOMAIN").slice(0,A("AJAX_REQUEST_CONCURRENT")).map(y=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(y+"/api/v2/transpond/webrtc?v=2"):"https://".concat(y,"/api/v2/transpond/webrtc?v=2"),areaCode:kh()})),w=l.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:g.map(y=>y.url)}),R=await Mh({fragementLength:A("FRAGEMENT_LENGTH"),referenceList:g,asyncMapHandler:y=>(T.debug("[".concat(s.clientId,"] Connect to choose_server:"),y.url),qM(y,s,a,d)),allFailedhandler:y=>{throw l.recordJoinChannelService({endTs:Date.now(),status:"error",errors:y},w),y[0]},promisesCollector:p});return l.recordJoinChannelService({endTs:Date.now(),status:"success"},w),R},m=async()=>{if(await Tn(1e3),h!==null)return h;const g=A("WEBCS_DOMAIN_BACKUP_LIST").map(y=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(y+"/api/v2/transpond/webrtc?v=2"):"https://".concat(y,"/api/v2/transpond/webrtc?v=2"),areaCode:kh()})),w=l.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:g.map(y=>y.url)}),R=await Mh({fragementLength:A("FRAGEMENT_LENGTH"),referenceList:g,asyncMapHandler:y=>(T.debug("[".concat(s.clientId,"] Connect to backup choose_server:"),y.url),qM(y,s,a,d)),allFailedhandler:y=>{throw l.recordJoinChannelService({endTs:Date.now(),status:"error",errors:y},w),y[0]},promisesCollector:p});return l.recordJoinChannelService({endTs:Date.now(),status:"success"},w),R};try{return h=await Ml([_(),m()]),p.length&&p.forEach(g=>g.cancel&&typeof g.cancel=="function"&&g.cancel()),h}catch(g){throw g[0]}}(e,t,n,r)}}async function ZM(e,t,n,r,i){const s=e.cloudProxyServer;if(s==="disabled"){if(e.useLocalAccessPoint)return await Cm(e,t,n,i);if(A("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:m,proxyInfo:g}=await tU(e,t,n,i);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:m};const w=g.map(R=>({turnServerURL:R.address,tcpport:R.tcpport||Gn.tcpport,udpport:R.udpport||Gn.udpport,username:R.username||Gn.username,password:R.password||Gn.password,forceturn:!1,security:!0}));if(i.useP2P){var a;const R=(a=e.uid)!==null&&a!==void 0?a:m.uid,y="glb:".concat(R.toString()),b=await Hv(y),N=g.map(L=>({turnServerURL:L.address,tcpport:L.tcpport||Gn.tcpport,udpport:L.udpport||Gn.udpport,username:y,password:b,forceturn:!1,security:!0}));w.push(...N)}return e.turnServer={mode:"manual",servers:w},{gatewayInfo:m}}return await Cm(e,t,n,i)}const{proxyInfo:d,gatewayInfo:l}=await tU(e,t,n,i),h={gatewayInfo:l},p=d.map(m=>({turnServerURL:m.address,tcpport:s==="proxy3"?void 0:m.tcpport?m.tcpport:Gn.tcpport,udpport:s==="proxy4"?void 0:m.udpport?m.udpport:Gn.udpport,username:m.username||Gn.username,password:m.password||Gn.password,forceturn:s!=="proxy4",security:s==="proxy5"}));if(i.useP2P){var _;const m=(_=e.uid)!==null&&_!==void 0?_:l.uid,g="glb:".concat(m.toString()),w=await Hv(g),R=d.map(y=>({turnServerURL:y.address,tcpport:s==="proxy3"?void 0:y.tcpport||Gn.tcpport,udpport:s==="proxy4"?void 0:y.udpport||Gn.udpport,username:g,password:w,forceturn:s!=="proxy4",security:s==="proxy5"}));p.push(...R)}return e.turnServer={mode:"manual",servers:p},T.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(s)),h}async function $M(e,t,n,r,i){const s=A("ACCOUNT_REGISTER").slice(0,A("AJAX_REQUEST_CONCURRENT"));let a=[];a=t.proxyServer?s.map(l=>"https://".concat(t.proxyServer,"/ap/?url=").concat(l+"/api/v1")):s.map(l=>"https://".concat(l,"/api/v1"));const d=i==null?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:a});try{const l=await async function(h,p,_,m,g){const w=Date.now(),R={sid:_.sid,opid:10,appid:_.appId,string_uid:p};let y=h[0];const b=await Do(()=>xo(y+"".concat(y.indexOf("?")===-1?"?":"&","action=stringuid"),{data:R,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(N,L)=>{if(N.code===0){if(N.uid<=0||N.uid>=Math.pow(2,32))throw T.error("Invalid Uint Uid ".concat(p," => ").concat(N.uid),N),Se.reqUserAccount(R.sid,{lts:w,success:!1,serverAddr:y,stringUid:R.string_uid,uid:N.uid,errorCode:O.INVALID_UINT_UID_FROM_STRING_UID,extend:R}),new j(O.INVALID_UINT_UID_FROM_STRING_UID);return Se.reqUserAccount(R.sid,{lts:w,success:!0,serverAddr:y,stringUid:R.string_uid,uid:N.uid,errorCode:null,extend:R}),!1}const x=Dl(N.code);return x.retry&&(y=h[(L+1)%h.length]),Se.reqUserAccount(R.sid,{lts:w,success:!1,serverAddr:y,stringUid:R.string_uid,uid:N.uid,errorCode:x.desc,extend:R}),x.retry},(N,L)=>N.code!==O.OPERATION_ABORTED&&(Se.reqUserAccount(R.sid,{lts:w,success:!1,serverAddr:y,stringUid:R.string_uid,uid:null,errorCode:N.code,extend:R}),y=h[(L+1)%h.length],!0),g);if(b.code!==0){const N=Dl(b.code);throw new j(O.UNEXPECTED_RESPONSE,N.desc)}return b}(a,e,t,n,r);return i==null||i.recordJoinChannelService({status:"success",endTs:Date.now()},d),l.uid}catch(l){throw i==null||i.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[l]},d),l}}async function FQ(e,t,n){const r=A("ACCOUNT_REGISTER");let i=[];i=t.proxyServer?r.map(s=>"https://".concat(t.proxyServer,"/ap/?url=").concat(s+"/api/v1")):r.map(s=>"https://".concat(s,"/api/v1"));try{return await QM({referenceList:i,asyncMapHandler:a=>async function(d,l,h,p){const _=Date.now(),m={sid:h.sid,opid:10,appid:h.appId,string_uid:l};try{const g=await xo(d+"".concat(d.indexOf("?")===-1?"?":"&","action=stringuid"),{data:m,cancelToken:p,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(g.code!==0){const w=Dl(g.code);throw new j(O.UNEXPECTED_RESPONSE,"preload sua error:".concat(w.desc),w)}if(g.uid<=0||g.uid>=Math.pow(2,32))throw new j(O.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:_,url:d,req:m,uid:g.uid,elapse:Date.now()-_}}catch(g){throw g}}(a,e,t,n),closeFn:a=>a.code===O.OPERATION_ABORTED||a.code===O.UNEXPECTED_RESPONSE&&!a.data.retry})}catch(s){throw s}}async function BQ(e,t,n){const r=A("CDS_AP").slice(0,A("AJAX_REQUEST_CONCURRENT")).map(l=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(l+"/api/v1"):"https://".concat(l,"/api/v1?action=config")),i=r.map(l=>function(h,p,_,m){const g=rt(),w={flag:64,cipher_method:0,features:_s(_s(_s(_s(_s({install_id:rR(),device:g.name,system:g.os,system_general:navigator.userAgent,vendor:p.appId,version:Di,cname:p.cname,session_id:p.sid,proxyServer:p.proxyServer,sdk_type:NQ.WEB_RTC,browser_name:g.name,browser_version:g.version,user_agent:navigator.userAgent,channel_name:p.cname},p.stringUid&&{string_uid:p.stringUid}),p.uid&&{uid:p.uid+""}),g.os&&{os_name:g.os}),g.osVersion&&{os_version:g.osVersion}),{},{detail:""})};return Do(()=>xo(h,{data:w,timeout:1e3,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,R=>R.code!==O.OPERATION_ABORTED,m)}(l,e,t,n));let s=null,a=null,d={};try{s=await Ml(i)}catch(l){if(l.code===O.OPERATION_ABORTED)throw l;a=l}if(i.forEach(l=>l.cancel()),Se.reportApiInvoke(e.sid,{name:kt.REQUEST_CONFIG_DISTRIBUTE,options:{error:a,res:s}}).onSuccess(),s&&s.test_tags)try{d=function(l){if(!l.test_tags)return{};const h=l.test_tags,p=Object.keys(h),_={};return p.forEach(m=>{var g;const w=hr(g=m.slice(4)).call(g),R=JSON.parse(h[m]),y=R[1];_[w]={tag:R[0]||"",value:y}}),_}(s)}catch{}return d}async function eU(e,t){const n=A("WEBCS_DOMAIN").concat(A("WEBCS_DOMAIN_BACKUP_LIST")).map(r=>({url:"https://".concat(r,"/api/v2/transpond/webrtc?v=2"),areaCode:kh(),serviceIds:[rn.CHOOSE_SERVER,rn.CLOUD_PROXY_FALLBACK]}));try{return await QM({referenceList:n,asyncMapHandler:i=>async function(s,a,d){let l,{url:h,areaCode:p,serviceIds:_}=s;const m=Date.now(),[g,w]=cy(a,p,_);let R=Ht.networkState;try{R&&Ht.networkState===fr.OFFLINE&&Ht.onlineWaiter&&await ae.race([Ht.onlineWaiter,Tn(nn.maxRetryTimeout)]),R=Ht.networkState;const{data:y,headers:b}=await xo(h,{data:g,cancelToken:d,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);l=b.http3==="1"?1:-1,(F=>{const M=[];if(F.response_body.forEach(B=>{const J=B.buffer.code;if(B.uri===23&&J===0&&!B.buffer.edges_services)if(B.buffer.flag===4194310)B.buffer.edges_services=[];else{const ee={error:new j(O.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:A("NO_EDGES_RETRY"),csIp:F.detail[502]}),flag:B.buffer.flag};M.push(ee)}if(J!==0){const ee=Dl(J),pe={error:new j(O.CAN_NOT_GET_GATEWAY_SERVER,ee.desc,{desc:ee.desc,retry:ee.retry,csIp:F.detail[502]}),flag:B.buffer.flag};B.buffer.flag===4194310?T.warning(pe.error.toString()):M.push(pe)}}),M.length)throw new j(O.CAN_NOT_GET_GATEWAY_SERVER,M.map(B=>"flag: ".concat(B.flag,", message: ").concat(B.error.message)).join(" | "),{retry:!!M.find(B=>B.error.data.retry),csIp:F.detail[502],desc:[...new Set(M.map(B=>{var J;return B==null||(J=B.error)===null||J===void 0||(J=J.data)===null||J===void 0?void 0:J.desc}).filter(B=>!!B))]})})(y);const L=bh(y,rn.CHOOSE_SERVER),x=bh(y,rn.CLOUD_PROXY_FALLBACK);return ay(L),{gatewayInfo:zR(L,h),proxyInfo:x,opid:w,requestTime:m,url:h,isHttp3:l,elapse:Date.now()-m}}catch(y){throw y}}(i,e,t),closeFn:i=>i.code===O.OPERATION_ABORTED||i.code===O.CAN_NOT_GET_GATEWAY_SERVER&&!i.data.retry})}catch(r){throw r}}async function tU(e,t,n,r){const i=A("PROXY_SERVER_TYPE3"),s=(g,w,R)=>{let y=R||i;return Array.isArray(y)&&(y=w%2==0&&i[1]||i[0]),"https://".concat(y,"/ap/?url=").concat(g)};let a=null;const d=[],l=async()=>{const g=A("WEBCS_DOMAIN").slice(0,A("AJAX_REQUEST_CONCURRENT")).map((y,b)=>{let N;return N=e.cloudProxyServer==="disabled"&&e.proxyServer?s("".concat(y,"/api/v2/transpond/webrtc?v=2"),b,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(y,"/api/v2/transpond/webrtc?v=2"):s("".concat(y,"/api/v2/transpond/webrtc?v=2"),b),{url:N,areaCode:kh(),serviceIds:[rn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?rn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?rn.CLOUD_PROXY:rn.CLOUD_PROXY_FALLBACK]}}),w=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:g.map(y=>y.url)}),R=await Mh({fragementLength:A("FRAGEMENT_LENGTH"),referenceList:g,asyncMapHandler:y=>(T.debug("[".concat(e.clientId,"] Connect to choose_server:"),y.url),XM(y,e,t,n)),allFailedhandler:y=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:y},w),y[0]},promisesCollector:d});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},w),R},h=async()=>{if(await Tn(1e3),a!==null)return a;const g=A("WEBCS_DOMAIN_BACKUP_LIST").map((y,b)=>{let N;return N=e.cloudProxyServer==="disabled"&&e.proxyServer?s("".concat(y,"/api/v2/transpond/webrtc?v=2"),b,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(y,"/api/v2/transpond/webrtc?v=2"):s("".concat(y,"/api/v2/transpond/webrtc?v=2"),b),{url:N,areaCode:kh(),serviceIds:[rn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?rn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?rn.CLOUD_PROXY:rn.CLOUD_PROXY_FALLBACK]}}),w=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:g.map(y=>y.url)}),R=await Mh({fragementLength:A("FRAGEMENT_LENGTH"),referenceList:g,asyncMapHandler:y=>(T.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),y.url),XM(y,e,t,n)),allFailedhandler:y=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:y},w),y[0]},promisesCollector:d});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},w),R};let p,_,m;try{({gatewayInfo:p,proxyInfo:_,url:m}=await Ml([l(),h()]))}catch(g){throw g[0]}if(d.length&&d.forEach(g=>g.cancel&&typeof g.cancel=="function"&&g.cancel()),!p||!_)throw new j(O.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=m,e.cloudProxyServer!=="disabled"&&Array.isArray(i)&&m){const g=/^https?:\/\/(.+?)(\/.*)?$/.exec(m)[1];te(i).call(i,g)&&(e.proxyServer=g,T.setProxyServer(g),Se.setProxyServer(g))}return a={gatewayInfo:p,proxyInfo:await IM(_,p.uid)},a}async function jQ(e,t,n){const r=A("UAP_AP").slice(0,A("AJAX_REQUEST_CONCURRENT")).map(s=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(s+"/api/v1?action=uap"):"https://".concat(s,"/api/v1?action=uap")),i=r.map(s=>function(a,d,l,h){const p={command:"convergeAllocateEdge",sid:d.sid,appId:d.appId,token:d.token,ts:Date.now(),version:Di,cname:d.cname,uid:d.uid.toString(),requestId:sy,seq:sy};sy+=1;const _={service_name:"tele_channel",json_body:JSON.stringify(p)};return Do(async()=>{const m=await xo(a,{data:_,cancelToken:l,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(m.code!==0){const w=new j(O.UNEXPECTED_RESPONSE,"cross channel ap error, code"+m.code,{retry:!0});throw T.error(w.toString()),w}const g=JSON.parse(m.json_body);if(g.code!==200){const w=new j(O.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(g.code,", reason: ").concat(g.reason));throw T.error(w.toString()),w}if(!g.servers||g.servers.length===0){const w=new j(O.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw T.error(w.toString()),w}return{vid:g.vid,workerToken:g.workerToken,addressList:(A("CHANNEL_MEDIA_RELAY_SERVERS")||g.servers).map(w=>"wss://".concat(w.address.replace(/\./g,"-"),".").concat(A("WORKER_DOMAIN"),":").concat(w.wss))}},void 0,m=>!!(m.code!==O.OPERATION_ABORTED&&m.code!==O.UNEXPECTED_RESPONSE||m.data&&m.data.retry),h)}(s,e,t,n));try{const s=await Ml(i);return i.forEach(a=>a.cancel()),s}catch(s){throw s[0]}}async function GQ(e,t,n){let r=null;const i=[],s=async a=>{const d=A(a?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(l=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(l+"/api/v2/transpond/webrtc?v=2"):"https://".concat(l,"/api/v2/transpond/webrtc?v=2"));return a&&(await Tn(1e3),r!==null)?r:await Mh({fragementLength:A("FRAGEMENT_LENGTH"),referenceList:d,asyncMapHandler:l=>(T.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(a?"backup":""," choose_server:"),l),function(h,p,_,m){const[g]=xQ(p,[rn.CHOOSE_SERVER]);let w=Ht.networkState;return Do(async()=>{w&&Ht.networkState===fr.OFFLINE&&Ht.onlineWaiter&&await ae.race([Ht.onlineWaiter,Tn(m&&m.maxRetryTimeout||nn.maxRetryTimeout)]),w=Ht.networkState;const R=await xo(h,{data:g,cancelToken:_,headers:{"Content-Type":"multipart/form-data;"}},!0);return UQ(R,h)},()=>!1,R=>R.code!==O.OPERATION_ABORTED&&(R.code===O.UPDATE_TICKET_FAILED?R.data.retry:(T.warning("[".concat(p.clientId,"] update ticket network error, retry"),R),!0)),m)}(l,e,t,n)),allFailedhandler:l=>{throw l[0]},promisesCollector:i})};try{return r=await Ml([s(!1),s(!0)]),i.length&&i.forEach(a=>a.cancel&&typeof a.cancel=="function"&&a.cancel()),r}catch(a){throw a[0]}}function nU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function dy(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?nU(Object(n),!0).forEach(function(r){I(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class WQ extends Vt{get isSuccess(){return!!this.configs}constructor(t,n){super(),I(this,"configs",void 0),I(this,"store",void 0),I(this,"joinInfo",void 0),I(this,"cancelToken",void 0),I(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),I(this,"interval",void 0),I(this,"mutex",void 0),I(this,"mutableParamsRead",!1),I(this,"configCache",{}),I(this,"limit_bitrate",void 0),this.mutex=new bn("config-distribute",t),this.store=n}startGetConfigDistribute(t,n){this.joinInfo=t,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),A("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},A("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Se.reportApiInvoke(null,{options:void 0,name:kt.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:yt.TRACER}).onSuccess(JSON.stringify(li))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void T.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const n=await this.mutex.lock();try{t=await BQ(this.joinInfo,this.cancelToken,this.retryConfig),T.debug("[config-distribute] get config distribute",JSON.stringify(t));const r=function(i){var s;const a=Ec(s=Object.keys(i).filter(h=>/^webrtc_ng_global_parameter/.test(h))).call(s);for(let h=0;h<a.length;h++)for(let p=a.length-1;p>h;p--){const _=a[p],m=i[_].value;if(typeof m.__priority=="number"){const g=m.__priority,w=a[p-1],R=i[w].value;if(typeof R.__priority=="number"){if(!(g>R.__priority))continue;{const y=_;a[p]=a[p-1],a[p-1]=y}}else{const y=_;a[p]=a[p-1],a[p-1]=y}}}const d=Date.now(),l={};return a.forEach(h=>{const p=i[h].value.__expires;p&&p<=d||(l[h]=i[h])}),l}(t);this.cacheGlobalParameterConfig(r),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=r}catch(r){const i=new j(O.NETWORK_RESPONSE_ERROR,r);T.warning("[config-distribute] ".concat(i.toString()))}finally{n()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){mM(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(ko.UPDATE_BITRATE_LIMIT,t):this.emit(ko.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&dy({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{const n={},r=Object.keys(t),i=[];r.forEach(s=>{const a=t[s].value;n[s]=a;const d=a.__id;if(d&&this.configCache[s]&&this.configCache[s].__id===d)return;const l=a.__type,h=t[s].value,p=t[s].tag;let _=0;l?l===ML.REALTIME&&(_=1):Object.keys(h).some(m=>Object.prototype.hasOwnProperty.call(aR,m)||!MR()&&Object.prototype.hasOwnProperty.call(j_,m)?(_=1,!0):void 0),i.push({tag:p,isApplied:_,feature:s,params:JSON.stringify(a)})}),i.forEach(s=>{let{tag:a,feature:d,params:l,isApplied:h}=s;this.store.sessionId&&Se.abTest(this.store.sessionId,{intSucc:1,isApplied:h,tag:a,feature:d,params:l,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=n}catch(n){T.debug("handleABTestConfigDistribute error",n)}}cacheGlobalParameterConfig(t){const n=function(i){const s={};return Object.keys(i).forEach(a=>{const d=i[a].value,l=d.__expires,h=d.__type;Object.keys(d).forEach(p=>{p==="__id"||p==="__type"||p==="__priority"||p==="__expires"||Object.prototype.hasOwnProperty.call(s,p)||(s[p]=dy(dy({value:d[p]},l&&{expires:l}),h&&{type:h}))})}),s}(t);try{var r;const i=(r=n.LIMIT_BITRATE)===null||r===void 0?void 0:r.value;delete n.LIMIT_BITRATE,i&&mM(i)&&this.handleBitrateLimit(i),this.limit_bitrate=i,this.handleGlobalParameterConfig(n),this.handleABTestConfigDistribute(t),function(d){try{const l=Date.now();Object.keys(d).forEach(h=>{const{value:p,type:_,expires:m}=d[h];m&&m<=l||((_===ML.REALTIME||Object.prototype.hasOwnProperty.call(aR,h))&&(li[h]=p,pt[h]=p,T.debug("Update realtime parameters from config distribute",h,p)),_||MR()||!Object.prototype.hasOwnProperty.call(j_,h)||(li[h]=p,pt[h]=p,T.debug("Update gateway parameters from config distribute",h,p)))})}catch(l){T.error("Error update config immediately: ".concat(d),l.message)}}(n);const s=JSON.stringify(n),a=window.btoa(s);window.localStorage.setItem("websdk_ng_global_parameter",a),T.debug("Caching global parameters ".concat(s))}catch(i){T.error("Error caching global parameters:",i.message)}}handleGlobalParameterConfig(t){try{const n=Date.now();Object.keys(t).forEach(r=>{switch(r){case"CLIENT_ROLE_OPTIONS":if(Object.prototype.hasOwnProperty.call(pt,r)){const{value:s,expires:a}=t[r];if(a&&a<=n)return;Xv(pt[r],s)||(li[r]=s,pt[r]=s,this.emit(ko.UPDATE_CLIENT_ROLE_OPTIONS,s),T.debug("Updating client role options: ".concat(JSON.stringify(s))))}break;case"REMOTE_VIDEO_STREAM_TYPE":if(Object.prototype.hasOwnProperty.call(pt,r)){var i;const{value:s,expires:a}=t[r];if(a&&a<=n)return;typeof s=="number"&&te(i=[0,1,4,5,6,7,8,9]).call(i,s)&&(li[r]={value:s},pt[r]=s,this.emit(ko.UPDATE_REMOTE_VIDEO_STREAM_TYPE,s),T.debug("Updating client remote stream type: ".concat(JSON.stringify(s))))}break;case"ENABLE_FORCE_HLS":if(Object.prototype.hasOwnProperty.call(pt,r)){const{value:s,expires:a}=t[r];if(a&&a<=n)return;Xv(pt[r],s)||(li[r]=s,pt[r]=s,this.emit(ko.FALLBACK_TO_HLS,s),T.debug("Updating enable force hls: ".concat(JSON.stringify(s))))}break;case"VOS_CONFIGURE":if(Object.prototype.hasOwnProperty.call(pt,r)){const{value:s,expires:a}=t[r];if(a&&a<=n)return;Xv(pt[r],s)||(li[r]=s,pt[r]=s,this.emit(ko.UPDATE_VOS_CONFIGURE,s),T.debug("Updating vos configure: ".concat(JSON.stringify(s))))}}})}catch(n){T.error("Error handling global parameter config:",n.message)}}}class HQ extends Vt{constructor(){super(...arguments),I(this,"resultStorage",new Map)}setLocalAudioStats(t,n,r){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(r,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(r,n))}setLocalVideoStats(t,n,r){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(r,n)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(r,n)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(r)),!n.muted&&this.record("VIDEO_ENCODE_FAILED",t,this.checResolutionSent(r))}setRemoteAudioStats(t,n){const r=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",r,this.checkAudioOutputLevel(n))}setRemoteVideoStats(t,n){const r=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",r,this.checkVideoDecode(n))}record(t,n,r){if(A("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const i=this.resultStorage.get(t);if(!i)return;i.result.push(r);const s=t==="VIDEO_ENCODE_FAILED"?A("ENCODE_EXCEPTION_TIMES"):5;if(i.result.length>=s){var a;const d=te(a=i.result).call(a,!0);i.isPrevNormal&&!d&&this.emit("exception",ly[t],t,n),!i.isPrevNormal&&d&&this.emit("exception",ly[t]+2e3,t+"_RECOVER",n),i.isPrevNormal=d,i.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,n){return n instanceof fn&&!n.isActive||!!n.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,n){let r=null;n._encoderConfig&&n._encoderConfig.frameRate&&(r=br(n._encoderConfig.frameRate));const i=t.captureFrameRate;return!r||!i||!(r>10&&i<5||r<10&&r>=5&&i<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checResolutionSent(t){var n;return!(!t.codecType||te(n=A("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(n,t.codecType.toLocaleLowerCase()))||!t.captureFrameRate||t.sendFrameRate!==0||t.sendResolutionWidth!==0||t.sendResolutionHeight!==0}checkSendVideoBitrate(t,n){return!!n.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,n){return n instanceof fn&&!n.isActive||!!n.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const ly={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},Xn=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}};function rU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Yc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?rU(Object(n),!0).forEach(function(r){I(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class Uh{constructor(t){I(this,"store",void 0),I(this,"onStatsException",void 0),I(this,"onUploadPublishDuration",void 0),I(this,"onStatsChanged",void 0),I(this,"onVideoCodecChanged",void 0),I(this,"localStats",new Map),I(this,"remoteStats",new Map),I(this,"updateStatsInterval",void 0),I(this,"trafficStats",void 0),I(this,"trafficStatsPeerList",[]),I(this,"uplinkStats",void 0),I(this,"exceptionMonitor",void 0),I(this,"p2pChannel",void 0),I(this,"scalabilityMode",F_.L1T1),I(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new HQ,this.exceptionMonitor.on("exception",(n,r,i)=>{this.onStatsException&&this.onStatsException(n,r,i)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(ne.LocalAudioTrack)||Yc({},pR)}getLocalVideoTrackStats(){return this.localStats.get(ne.LocalVideoTrack)||Yc({},fR)}getRemoteAudioTrackStats(t){const n=(s,a)=>{if(!this.trafficStats)return a;const d=this.trafficStats.peer_delay.find(l=>l.peer_uid===s);return d&&(a.publishDuration=d.B_ppad+(Date.now()-this.trafficStats.timestamp)),a},r={};if(t){var i;const s=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.audioStats;s&&(r[t]=n(t,s))}else Array.from(this.remoteStats.entries()).forEach(s=>{let[a,{audioStats:d}]=s;d&&(r[a]=n(a,d))});return r}getRemoteNetworkQualityStats(t){const n={};if(t){var r;const i=(r=this.remoteStats.get(t))===null||r===void 0?void 0:r.networkStats;i&&(n[t]=i)}else Array.from(this.remoteStats.entries()).forEach(i=>{let[s,{networkStats:a}]=i;a&&(n[s]=a)});return n}getNetworkQuality(){let t=0,n=0;return this.trafficStats&&(t=_m(this.trafficStats.B_unq),n=_m(this.trafficStats.B_dnq)),{uplinkNetworkQuality:t,downlinkNetworkQuality:n}}getRemoteVideoTrackStats(t){const n=(s,a)=>{if(!this.trafficStats)return a;const d=this.trafficStats.peer_delay.find(l=>l.peer_uid===s);return d&&(a.publishDuration=d.B_ppvd+(Date.now()-this.trafficStats.timestamp)),a},r={};if(t){var i;const s=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.videoStats;s&&(r[t]=n(t,s))}else Array.from(this.remoteStats.entries()).forEach(s=>{let[a,{videoStats:d}]=s;d&&(r[a]=n(a,d))});return r}getRTCStats(){let t=0,n=0,r=0,i=0;const s=this.localStats.get(ne.LocalAudioTrack);s&&(t+=s.sendBytes,n+=s.sendBitrate);const a=this.localStats.get(ne.LocalVideoTrack);a&&(t+=a.sendBytes,n+=a.sendBitrate);const d=this.localStats.get(ne.LocalVideoLowTrack);d&&(t+=d.sendBytes,n+=d.sendBitrate),this.remoteStats.forEach(h=>{let{audioStats:p,videoStats:_}=h;p&&(r+=p.receiveBytes,i+=p.receiveBitrate),_&&(r+=_.receiveBytes,i+=_.receiveBitrate)});let l=1;return this.trafficStats&&(l+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:l,SendBitrate:n,SendBytes:t,RecvBytes:r,RecvBitrate:i,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),t.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var r;const i=(r=this.p2pChannel)===null||r===void 0?void 0:r.getRemoteMedia(n.peer_uid),s=i!=null&&i.videoSSRC?Xn.measureFromSubscribeStart(this.store.clientId,i.videoSSRC):0,a=i!=null&&i.audioSSRC?Xn.measureFromSubscribeStart(this.store.clientId,i.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,s>a?s:a),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&T.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,n,r){if(!t)return!1;const i=!!r&&n.framesDecodeFreezeTime>r.framesDecodeFreezeTime,s=!r||n.framesDecodeCount>r.framesDecodeCount;return i||!s}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(n=>{let[r,i]=n;switch(r){case ne.LocalVideoTrack:case ne.LocalVideoLowTrack:{const d=i,l=Yc({},fR),h=t.getStats(),p=t.getLocalMedia(r);if(h){const _=h.videoSend.find(m=>m.ssrc===(p==null?void 0:p.ssrcs[0].ssrcId));if(_){const m=t.getLocalVideoSize(),g=t.getEncoderConfig(ne.LocalVideoTrack);var s;(_.codec==="H264"||_.codec==="H265"||_.codec==="VP8"||_.codec==="VP9"||_.codec==="AV1X"||_.codec==="AV1")&&(l.codecType=_.codec,(d==null?void 0:d.codecType)!==_.codec&&((s=this.onVideoCodecChanged)===null||s===void 0||s.call(this,_.codec.toLocaleLowerCase()))),l.sendBytes=_.bytes,l.sendBitrate=d?8*Math.max(0,l.sendBytes-d.sendBytes):0,_.inputFrame?(l.captureFrameRate=_.inputFrame.frameRate,l.captureResolutionHeight=_.inputFrame.height,l.captureResolutionWidth=_.inputFrame.width):m&&(l.captureResolutionWidth=m.width,l.captureResolutionHeight=m.height),_.sentFrame?(l.sendFrameRate=_.sentFrame.frameRate,l.sendResolutionHeight=_.sentFrame.height,l.sendResolutionWidth=_.sentFrame.width):m&&(l.sendResolutionWidth=m.width,l.sendResolutionHeight=m.height),_.avgEncodeMs&&(l.encodeDelay=_.avgEncodeMs),g&&g.bitrateMax?l.targetSendBitrate=1e3*g.bitrateMax:_.targetBitrate&&(l.targetSendBitrate=_.targetBitrate),l.sendPackets=_.packets,l.sendPacketsLost=_.packetsLost,l.sendJitterMs=_.jitterMs,l.sendRttMs=_.rttMs,l.totalDuration=d?d.totalDuration+1:1,l.totalFreezeTime=d?d.totalFreezeTime:0,this.isLocalVideoFreeze(_)&&(l.totalFreezeTime+=1),_.scalabilityMode&&this.scalabilityMode!==_.scalabilityMode&&(T.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(_.scalabilityMode)),this.scalabilityMode=_.scalabilityMode)}this.trafficStats&&(l.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var a;this.localStats.set(r,l),((d==null?void 0:d.sendResolutionWidth)!==l.sendResolutionWidth||(d==null?void 0:d.sendResolutionHeight)!==l.sendResolutionHeight)&&((a=this.onStatsChanged)===null||a===void 0||a.call(this,"resolution",{width:l.sendResolutionWidth,height:l.sendResolutionHeight})),l&&p&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,p.track,l);break}case ne.LocalAudioTrack:{const d=i,l=Yc({},pR),h=t.getStats(),p=t.getLocalMedia(r);if(h){const _=h.audioSend.find(m=>m.ssrc===(p==null?void 0:p.ssrcs[0].ssrcId));if(_){if(_.codec!=="opus"&&_.codec!=="aac"&&_.codec!=="PCMU"&&_.codec!=="PCMA"&&_.codec!=="G722"||(l.codecType=_.codec),_.inputLevel)l.sendVolumeLevel=Math.round(32767*_.inputLevel);else{const m=t.getLocalAudioVolume();m&&(l.sendVolumeLevel=Math.round(32767*m))}l.sendBytes=_.bytes,l.sendPackets=_.packets,l.sendPacketsLost=_.packetsLost,l.sendJitterMs=_.jitterMs,l.sendRttMs=_.rttMs,l.sendBitrate=d?8*Math.max(0,l.sendBytes-d.sendBytes):0}}this.trafficStats&&(l.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(ne.LocalAudioTrack,l),l&&p&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,p.track,l);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(n=>{var r,i;let[s,{videoStats:a,audioStats:d,videoPcStats:l}]=n;const h=d,p=a,_=l,m=Yc({},XL),g=Yc({},JL),w=Yc({},OJ),{audioTrack:R,videoTrack:y,audioSSRC:b,videoSSRC:N}=t.getRemoteMedia(s);let L;L=this.store.useP2P?t.getStats(!0):t.getStats();const x=(r=L)===null||r===void 0?void 0:r.audioRecv.find(J=>J.ssrc===b),F=(i=L)===null||i===void 0?void 0:i.videoRecv.find(J=>J.ssrc===N),M=this.trafficStats&&this.trafficStats.peer_delay.find(J=>J.peer_uid===s);if(x&&(x.codec!=="opus"&&x.codec!=="aac"&&x.codec!=="PCMU"&&x.codec!=="PCMA"&&x.codec!=="G722"||(m.codecType=x.codec),x.outputLevel?m.receiveLevel=Math.round(32767*x.outputLevel):R&&(m.receiveLevel=Math.round(32767*R.getVolumeLevel())),m.receiveBytes=x.bytes,m.receivePackets=x.packets,m.receivePacketsLost=x.packetsLost,m.receivePacketsDiscarded=x.packetsDiscarded,m.packetLossRate=m.receivePacketsLost/(m.receivePackets+m.receivePacketsLost),m.receiveBitrate=h?8*Math.max(0,m.receiveBytes-h.receiveBytes):0,m.totalDuration=h?h.totalDuration+1:1,m.totalFreezeTime=h?h.totalFreezeTime:0,m.freezeRate=m.totalFreezeTime/m.totalDuration,m.receiveDelay=x.jitterBufferMs,m.totalDuration>10&&Uh.isRemoteAudioFreeze(R)&&(m.totalFreezeTime+=1)),F){var B;F.codec!=="H264"&&F.codec!=="H265"&&F.codec!=="VP8"&&F.codec!=="VP9"&&F.codec!=="AV1X"&&F.codec!=="AV1"||(g.codecType=F.codec),g.receiveBytes=F.bytes,g.receiveBitrate=p?8*Math.max(0,g.receiveBytes-p.receiveBytes):0,g.decodeFrameRate=F.decodeFrameRate<0?0:F.decodeFrameRate,g.renderFrameRate=F.decodeFrameRate<0?0:F.decodeFrameRate,F.outputFrame&&(g.renderFrameRate=F.outputFrame.frameRate),F.receivedFrame?(g.receiveFrameRate=F.receivedFrame.frameRate,g.receiveResolutionHeight=F.receivedFrame.height,g.receiveResolutionWidth=F.receivedFrame.width):y&&(g.receiveResolutionHeight=y._videoHeight||0,g.receiveResolutionWidth=y._videoWidth||0),F.framesRateFirefox!==void 0&&(g.receiveFrameRate=Math.round(F.framesRateFirefox)),g.receivePackets=F.packets,g.receivePacketsLost=F.packetsLost,g.packetLossRate=g.receivePacketsLost/(g.receivePackets+g.receivePacketsLost);const J=p?p.totalFreezeTime:0,ee=p?p.totalDuration:0;g.totalDuration=p?p.totalDuration+1:1,g.totalFreezeTime=(B=F.totalFreezesDuration)!==null&&B!==void 0?B:J||0,g.receiveDelay=F.jitterBufferMs||0;const pe=!!N&&t.getRemoteVideoIsReady(N);F.totalFreezesDuration===void 0&&y&&pe&&Uh.isRemoteVideoFreeze(y,F,_)&&(g.totalFreezeTime+=1),g.freezeRate=Math.max(0,Math.min((g.totalFreezeTime-J)/(g.totalDuration-ee),1))}M&&(m.end2EndDelay=M.B_ad,g.end2EndDelay=M.B_vd,m.transportDelay=M.B_ed,g.transportDelay=M.B_ed,m.currentPacketLossRate=M.B_ealr4/100,g.currentPacketLossRate=M.B_evlr4/100,w.uplinkNetworkQuality=M.B_punq?M.B_punq:0,w.downlinkNetworkQuality=M.B_pdnq?M.B_pdnq:0),this.remoteStats.set(s,{audioStats:m,videoStats:g,videoPcStats:F,networkStats:w}),R&&this.exceptionMonitor.setRemoteAudioStats(R,m),y&&this.exceptionMonitor.setRemoteVideoStats(y,g)})}}class iU{constructor(){I(this,"destChannelMediaInfos",new Map),I(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){fM(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){fM(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){cm(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function oU(e){if(!(e instanceof iU))return new j(O.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();if(!t)return new j(O.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new j(O.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Oa{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,n){I(this,"uid",void 0),I(this,"_uintid",void 0),I(this,"_trust_in_room_",!0),I(this,"_trust_audio_enabled_state_",!0),I(this,"_trust_video_enabled_state_",!0),I(this,"_trust_audio_mute_state_",!0),I(this,"_trust_video_mute_state_",!0),I(this,"_audio_muted_",!1),I(this,"_video_muted_",!1),I(this,"_audio_enabled_",!0),I(this,"_video_enabled_",!0),I(this,"_audio_added_",!1),I(this,"_video_added_",!1),I(this,"_is_pre_created",!1),I(this,"_video_pre_subscribed",!1),I(this,"_audio_pre_subscribed",!1),I(this,"_trust_video_stream_added_state_",!0),I(this,"_trust_audio_stream_added_state_",!0),I(this,"_audioTrack",void 0),I(this,"_videoTrack",void 0),I(this,"_dataChannels",[]),I(this,"_audioSSRC",void 0),I(this,"_videoSSRC",void 0),I(this,"_audioOrtc",void 0),I(this,"_videoOrtc",void 0),I(this,"_cname",void 0),I(this,"_rtxSsrcId",void 0),I(this,"_videoMid",void 0),I(this,"_audioMid",void 0),this.uid=t,this._uintid=n}}function sU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function uy(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?sU(Object(n),!0).forEach(function(r){I(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const KQ=e=>`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1 2
a=msid-semantic: WMS
a=ice-lite`.concat(e?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:2
`),Im="9",hy=2e4,wm=4e4;let aU=class{get localCapabilities(){return Dt(this._localCapabilities)}get rtpCapabilities(){return Dt(this._rtpCapabilities)}get candidates(){return Dt(this._candidates)}get iceParameters(){return Dt(this._iceParameters)}get dtlsParameters(){return Dt(this._dtlsParameters)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],n=arguments.length>2&&arguments[2]!==void 0&&arguments[2],r=arguments.length>3&&arguments[3]!==void 0&&arguments[3];I(this,"sessionDesc",void 0),I(this,"_localCapabilities",void 0),I(this,"_rtpCapabilities",void 0),I(this,"_candidates",void 0),I(this,"_originCandidates",void 0),I(this,"_iceParameters",void 0),I(this,"_isUseExtmapAllowMixed",void 0),I(this,"_isUseLocalCodecs",void 0),I(this,"_isUseDataChannel",void 0),I(this,"_dtlsParameters",void 0),I(this,"setup",void 0),I(this,"currentMidIndex",void 0),I(this,"cname",void 0),I(this,"useLocalCodecsMids",[]),I(this,"preloadSsrcs",[]),I(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=t,this._isUseLocalCodecs=n,this._isUseDataChannel=r,e=Dt(e);const{iceParameters:i,dtlsParameters:s,candidates:a,rtpCapabilities:d,setup:l,localCapabilities:h,cname:p}=e;this._rtpCapabilities=d,this._candidates=a,this._originCandidates=Dt(a),this._iceParameters=i,this._dtlsParameters=s,this._localCapabilities=h,this.setup=l,this.cname=p,[this.sessionDesc]=this.updateRemoteRTPCapabilities(d),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(e){return e.length===this.preloadSsrcs.length&&e.every(t=>{var n;return te(n=this.preloadSsrcs).call(n,t)})}preloadRemoteMedia(e){let t=0;const n=[],r=[];for(;e>0;){const i=[uy({ssrcId:wm+t},A("USE_SUB_RTX")?{rtx:wm+t+1}:{})],s="".concat(wm+t,"_").concat(hy+t),{ssrcs:a,ssrcGroups:d}=Dh(i,this.cname,A("SYNC_GROUP")?s:void 0),l=this.preCreateOrRecycleSendMedia("video",a,d,void 0),h=[{ssrcId:hy+t}],p="".concat(wm+t,"_").concat(hy+t),{ssrcs:_,ssrcGroups:m}=Dh(h,this.cname,A("SYNC_GROUP")?p:void 0),g=this.preCreateOrRecycleSendMedia("audio",_,m,void 0);e--,t+=2,n.push(l,g),r.push(a[0].ssrcId,_[0].ssrcId)}return this.useLocalCodecsMids.push(...n),this.preloadSsrcs=r,{mids:n,preSSRCs:r,isAvailable:!0}}preCreateOrRecycleSendMedia(e,t,n,r){const i=this.rtpCapabilities.send.videoCodecs,s=this._isUseLocalCodecs||i.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;T.debug("create or recycle send media without remote rtp capabilities, ssrcs ",t[0].ssrcId);const a=e===_e.VIDEO?s.videoCodecs:s.audioCodecs,d=e===_e.VIDEO?s.videoExtensions:s.audioExtensions;this.currentMidIndex+=1;const l="".concat(this.currentMidIndex);let h={media:{mediaType:e,port:Im,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.map(p=>p.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:d,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:a,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(l)}};return h=this.mungSendMediaDesc(h,r),this.sessionDesc.mediaDescriptions.push(h),this.updateBundleMids(),l}toString(){return Fs(this.sessionDesc)}send(e,t,n,r){const{ssrcs:i,ssrcGroups:s}=Dh(t,this.cname,A("SYNC_GROUP")?n:void 0),a=this.findPreloadMediaDesc(i);if(a){if(Nt()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,a.attributes.mid),r&&(r.twcc||r.remb)){const d=this.sessionDesc.mediaDescriptions.indexOf(a);return this.sessionDesc.mediaDescriptions[d]=this.mungSendMediaDesc(a,r),{mid:a.attributes.mid,needExchangeSDP:!0}}return{mid:a.attributes.mid,needExchangeSDP:!1}}{const d=this.findAvailableMediaIndex(e,i);let l;return d===-1||d===1&&(An()||function(){const h=rt();return!(h.name!==ot.CHROME||!h.osVersion)&&Number(h.version)<=90}()||No(143)||Ta(143)||A("RESERVE_MID_1_MLINE")||A("ENABLE_ENCODED_TRANSFORM")&&xs())||d===0&&!function(h){const p=rt();return!(p.name!==ot.FIREFOX||!p.osVersion)&&Number(p.version)===h}(138)&&A("USE_SUB_RTX")||nL()?(l=this.createOrRecycleSendMedia(e,i,s,"sendonly",r),this.updateBundleMids()):(l=Dt(this.sessionDesc.mediaDescriptions[d]),l.attributes.direction="sendonly",l.attributes.ssrcs=i,l.attributes.ssrcGroups=s,this.sessionDesc.mediaDescriptions[d]=this.mungSendMediaDesc(l,r)),Nt()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,l.attributes.mid),{mid:l.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:e,needExchangeSDP:t}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:e.attributes.mid,needExchangeSDP:t}}batchSend(e){const t=e.map(i=>{let{kind:s,ssrcMsg:a,mslabel:d}=i;return this.send(s,a,d)}),n=[];let r=!1;return t.forEach(i=>{let{mid:s,needExchangeSDP:a}=i;a&&(r=!0),n.push(s)}),{mids:n,needExchangeSDP:r}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(n=>{n.attributes.mid==="0"||Nt()||nL()?n.attributes.ssrcs=[]:(n.attributes.ssrcs=[],n.attributes.direction="inactive",n.media.port="0")}),this.updateBundleMids()}mute(e){const t=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>te(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>te(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="recvonly"})}receive(e,t,n,r){e.forEach((i,s)=>{this.createOrRecycleRecvMedia(i,[],"recvonly",t,n,r[s])}),this.updateBundleMids()}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(e){const t=this.sessionDesc||_r((n=this._isUseExtmapAllowMixed,this._isUseDataChannel?KQ(n):`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(n?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var n;this._rtpCapabilities=e;let r=!1;const i=this.rtpCapabilities.send,s=this.localCapabilities.send,a=this.localCapabilities.recv,d=a.videoCodecs,l=a.audioCodecs,h=a.videoExtensions,p=a.audioExtensions;for(const w of t.mediaDescriptions){var _;if(w.attributes.direction!=="sendonly"||typeof w.attributes.mid!="string"||!te(_=this.useLocalCodecsMids).call(_,w.attributes.mid)){if(r=!0,w.attributes.iceUfrag=this._iceParameters.iceUfrag,w.attributes.icePwd=this._iceParameters.icePwd,w.attributes.fingerprints=this._dtlsParameters.fingerprints,w.attributes.candidates=this._candidates,w.attributes.setup=this.setup,w.media.mediaType==="application"&&(w.attributes.sctpPort="5000"),w.media.mediaType==="video")if(this._isUseLocalCodecs&&w.attributes.direction==="sendonly"){var m;w.media.fmts=d.map(y=>y.payloadType.toString(10)),w.attributes.payloads=d,w.attributes.extmaps=h;const R=w.attributes.mid;typeof R!="string"||te(m=this.useLocalCodecsMids).call(m,R)||this.useLocalCodecsMids.push(R)}else if(i.videoCodecs.length===0){const R=s.videoCodecs.filter(y=>{var b,N;return(b=y.rtpMap)===null||b===void 0?void 0:te(N=b.encodingName.toLowerCase()).call(N,"vp8")});R.length===0&&R.push(s.videoCodecs[0]),w.media.fmts=R.map(y=>y.payloadType.toString(10)),w.attributes.payloads=R,w.attributes.extmaps=[]}else w.media.fmts=i.videoCodecs.map(R=>R.payloadType.toString(10)),w.attributes.payloads=i.videoCodecs,w.attributes.extmaps=i.videoExtensions;if(w.media.mediaType==="audio")if(this._isUseLocalCodecs&&w.attributes.direction==="sendonly"){var g;w.media.fmts=l.map(y=>y.payloadType.toString(10)),w.attributes.payloads=l,w.attributes.extmaps=p;const R=w.attributes.mid;typeof R!="string"||te(g=this.useLocalCodecsMids).call(g,R)||this.useLocalCodecsMids.push(R)}else if(i.audioCodecs.length===0){const R=s.audioCodecs.filter(y=>{var b,N;return(b=y.rtpMap)===null||b===void 0?void 0:te(N=b.encodingName.toLowerCase()).call(N,"opus")})||[s.audioCodecs[0]];w.media.fmts=R.map(y=>y.payloadType.toString(10)),w.attributes.payloads=R,w.attributes.extmaps=[]}else w.media.fmts=i.audioCodecs.map(R=>R.payloadType.toString(10)),w.attributes.payloads=i.audioCodecs,w.attributes.extmaps=i.audioExtensions,Ll(w)}}return this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1,[this.sessionDesc,r]}updateCandidates(e){const t=this._originCandidates.filter(r=>r.transport==="udp"),n=[];if(t.forEach(r=>{n.push(uy(uy({},r),{},{foundation:"tcpcandidate",priority:Number(r.priority)-1+"",transport:"tcp",port:Number(r.port)+90+""}))}),t.length!==0){switch(e){case On.TCP_RELAY:this._candidates=n;break;case On.UDP_TCP_RELAY:case On.RELAY:this._candidates=[...t,...n];break;default:this._candidates=t}for(const r of this.sessionDesc.mediaDescriptions)r.attributes.candidates=this.candidates}}restartICE(e){e=Dt(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex(n=>{const r=n.media.mediaType===e&&n.media.port!=="0"&&(n.attributes.direction==="sendonly"||n.attributes.direction==="sendrecv")&&n.attributes.ssrcs.length===0;if(Nt()){if(r){const i=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(i||n.attributes.mid!=="0"&&n.attributes.mid!=="1")||!(!i||i!==n.attributes.mid)}return!1}return r})}createOrRecycleDataChannel(){for(const n of this.sessionDesc.mediaDescriptions)if(n.media.mediaType==="application")return{mediaDesc:n,needExchangeSDP:!1};this.currentMidIndex+=1;const e="".concat(this.currentMidIndex),t={media:{mediaType:"application",port:Im,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(e),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(t),{mediaDesc:t,needExchangeSDP:!0}}createOrRecycleRecvMedia(e,t,n,r,i,s){const a=e._mediaStreamTrack.kind,d=this.rtpCapabilities.recv,l=Lh(a,d,this.localCapabilities.send,a===_e.VIDEO?r:i),h=a===_e.VIDEO?d.videoExtensions:d.audioExtensions;this.currentMidIndex+=1;const p="".concat(this.currentMidIndex);let _={media:{mediaType:a,port:Im,protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(g=>g.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:h,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(p)}};_=this.mungRecvMediaDsec(_,e,s);const m=this.findFirstClosedMedia(a);if(m){const g=this.sessionDesc.mediaDescriptions.indexOf(m);this.sessionDesc.mediaDescriptions[g]=_}else this.sessionDesc.mediaDescriptions.push(_);return _}updateRemoteDtlsParameters(e){const t=new Set(this._dtlsParameters.fingerprints.map(i=>i.fingerprint)),n=new Set(e.map(i=>i.fingerprint));let r=!1;t.size!==n.size&&(r=!0);for(const i of t)n.has(i)||(r=!0);return r}updateRemoteCodec(e,t,n){const r=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(_=>_.rtpMap&&_.rtpMap.encodingName.toLowerCase()||"").filter(_=>{var m;return te(m=Object.keys(kc)).call(m,_)}))],i=new Set(t);if(r.every(_=>i.has(_)))return T.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t)),!1;const s=this._rtpCapabilities.recv.videoCodecs.filter(_=>t.some(m=>{var g;return te(g=_.rtpMap&&_.rtpMap.encodingName.toLowerCase()||"").call(g,m)}));if(s.length===0)return T.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(r," codecs: ").concat(t)),!1;const a=[...new Set(s.map(_=>_.rtpMap&&_.rtpMap.encodingName.toLowerCase()||""))];let d;if(T.debug("updateRemoteCodec, from ".concat(r," to ").concat(a)),e.length===0)d=this.sessionDesc.mediaDescriptions.filter(_=>_.media.mediaType==="video"&&_.attributes.direction==="recvonly");else if(d=this.sessionDesc.mediaDescriptions.filter(_=>_.attributes.mid&&_.media.mediaType==="video"&&te(e).call(e,_.attributes.mid)&&_.attributes.direction==="recvonly"),d.length!==e.length)return T.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(t)),!1;if(A("USE_PUB_RTX")||A("USE_SUB_RTX")){const _=ba(s,this.rtpCapabilities.recv.videoCodecs);s.push(..._)}this._rtpCapabilities.recv.videoCodecs=s;const l=this.localCapabilities.send,h=this.rtpCapabilities.recv,p=Lh(_e.VIDEO,h,l,n);return d.forEach(_=>{const m=p.map(g=>g.payloadType.toString(10));T.debug("updateRemoteCodec mid: ".concat(_.attributes.mid,", from"),_.attributes.payloads,"to",p),_.attributes.payloads=p,_.media.fmts=m}),T.debug("updateRemoteCodec success, mids: ".concat(e,", codecs: ").concat(t,", remote recv: ").concat(this._rtpCapabilities.recv.videoCodecs.length,", remote send: ").concat(this._rtpCapabilities.send.videoCodecs.length)),!0}createOrRecycleSendMedia(e,t,n,r,i){const s=this.rtpCapabilities.send.videoCodecs,a=this._isUseLocalCodecs||s.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,d=e===_e.VIDEO?a.videoCodecs:a.audioCodecs,l=e===_e.VIDEO?a.videoExtensions:a.audioExtensions;this.currentMidIndex+=1;const h="".concat(this.currentMidIndex);let p={media:{mediaType:e,port:Im,protos:["UDP","TLS","RTP","SAVPF"],fmts:d.map(m=>m.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:l,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:d,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(h)}};p=this.mungSendMediaDesc(p,i);const _=this.findFirstClosedMedia(e);if(_){const m=this.sessionDesc.mediaDescriptions.indexOf(_);this.sessionDesc.mediaDescriptions[m]=p}else this.sessionDesc.mediaDescriptions.push(p);return p}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}mungRecvMediaDsec(e,t,n){const r=Dt(e);return JR(r),Kc(r,t),QR(r,t),MM(r),gm(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){const n=Dt(e);return n.attributes&&n.attributes.payloads&&Array.isArray(n.attributes.payloads)&&n.attributes.payloads.length>0&&n.attributes.payloads.forEach(r=>{r.rtpMap&&r.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&A("ENABLE_DOWN_SPS_PPS")&&(r.fmtp&&r.fmtp.parameters||(r.fmtp={parameters:{}}),r.fmtp.parameters["sps-pps-idr-in-keyframe"]="1")}),gm(n,t,this.localCapabilities.recv),Ll(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===e);if(n!==-1){const r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=r}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>Nt()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return((n=t.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===e[0].ssrcId})}getSSRC(e){var t;return(t=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===e))===null||t===void 0?void 0:t.attributes.ssrcs}};function cU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Ws(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?cU(Object(n),!0).forEach(function(r){I(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var Ul=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(Ul||{});const Am=new Map;function dU(e,t,n,r){let{scale:i}=e;if(i===0&&r===Ul.UP||i>=t.length-1&&r===Ul.DOWN)return e;let s=Ws(Ws({},e),{},{scale:r===Ul.DOWN?++i:--i});switch(n){case"maintain-framerate":s=Ws(Ws({},s),t[i].motion);break;case"maintain-resolution":s=Ws(Ws({},s),t[i].detail);break;case"balanced":s=Ws(Ws({},s),t[i].balanced)}return s}function lU(e,t){if(t){const n={overUse:0,underUse:0,adaptationList:uU(t)};Am.set(e,n)}else Am.delete(e)}function uU(e){const t=Ws({},e),{bitrateMax:n,frameRate:r,scaleResolutionDownBy:i,bitrateMin:s}=t,{MIN_FRAME_RATE:a,MAX_THRESHOLD_FRAMERATE:d,MAX_SCALE:l,BITRATE_MIN_THRESHOLD:h,BITRATE_MAX_THRESHOLD:p,BWE_SCALE_UP_THRESHOLD:_,BWE_SCALE_DOWN_THRESHOLD:m,PERF_SCALE_DOWN_THRESHOLD:g,PERF_SCALE_UP_THRESHOLD:w,BALANCE_BITRATE_FACTOR:R,BALANCE_FRAMERATE_FACTOR:y,BALANCE_RESOLUTION_FACTOR:b,MOTION_RESOLUTION_FACTOR:N,MOTION_BITRATE_FACTOR:L,DETAIL_FRAMERATE_FACTOR:x,DETAIL_BITRATE_FACTOR:F}=oR,M=Math.min(t.frameRate,d),B=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(m,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(g,1)*M),fps_up:r},balanced:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:s},motion:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:s},detail:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:s}}];for(let J=1;J<=l;J++){const ee={bwe_up:Math.round(Math.pow(_,J)*n),bwe_down:Math.round(Math.pow(m,J+1)*n),fps_up:Math.round(Math.pow(w,J)*M),fps_down:Math.round(Math.pow(g,J+1)*M)},pe={scaleResolutionDownBy:i/Math.pow(b,J),frameRate:Math.max(Math.round(Math.pow(y,J)*r),a),bitrateMax:Math.max(Math.round(Math.pow(R,J)*n),p),bitrateMin:Math.max(Math.round(Math.pow(R,J)*s),h)},Pe={scaleResolutionDownBy:i/Math.pow(N,J),frameRate:r,bitrateMax:Math.max(Math.round(Math.pow(L,J)*n),p),bitrateMin:Math.max(Math.round(Math.pow(L,J)*s),h)},Ne={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(x,J)*r),a),bitrateMax:Math.max(Math.round(Math.pow(F,J)*n),p),bitrateMin:Math.max(Math.round(Math.pow(F,J)*s),h)};B.push({scale:J,threshold:ee,balanced:pe,motion:Pe,detail:Ne})}return B}function YQ(e,t,n,r,i,s){const a=Am.get(e)||{overUse:0,underUse:0,adaptationList:uU(i)},{adaptationList:d}=a;Am.set(e,a);const{OVERUSE_TIMES_THRESHOLD:l,UNDERUSE_TIMES_THRESHOLD:h}=oR,{scale:p}=r;let _,m;return typeof t=="number"&&t>0&&function(g,w,R,y){if(w>=R.length)return!1;let{threshold:{fps_down:b}}=R[w];return A("FORCE_AG_HIGH_FRAMERATE")&&y==="maintain-framerate"&&(b=R[0].threshold.fps_down),g<b}(t,p,d,s)&&(a.overUse++,m=fl.CPU,a.overUse>l)||typeof n=="number"&&n>0&&function(g,w,R){if(w>=R.length)return!1;const{threshold:{bwe_down:y}}=R[w];return g<y}(n,p,d)&&(a.overUse++,m=fl.BANDWIDTH,a.overUse>l)?(a.overUse=0,a.underUse=0,_=dU(r,d,s,Ul.DOWN),[_,m]):(typeof t=="number"&&t>0&&typeof n=="number"&&n>0&&function(g,w,R,y){if(w===0)return;let{threshold:{fps_up:b}}=R[w];return A("FORCE_AG_HIGH_FRAMERATE")&&y==="maintain-framerate"&&(b=R[1].threshold.fps_up),g>b}(t,p,d,s)&&function(g,w,R){if(w===0)return;const{threshold:{bwe_up:y}}=R[w];return g>y}(n,p,d)&&(a.underUse++,a.underUse>h&&(a.overUse=0,a.underUse=0,_=dU(r,d,s,Ul.UP),_.scale===0&&(m=fl.NONE))),[_,m])}function hU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function py(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?hU(Object(n),!0).forEach(function(r){I(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function pU(e){var t;return!!A("ENABLE_AG_ADAPTATION")&&!!(e instanceof Q_||te(t=e._hints).call(t,lt.CUSTOM_TRACK))&&(!!A("FORCE_SUPPORT_AG_ADAPTATION")||!!(eL(14,0,!1)&&tL(17,4,!0)||$P(14)&&Fv(17,4,!0)))}const bm=new Map;function fU(e,t,n,r,i,s){if(xl(e,n),i(t),r!=="balanced"&&r!=="maintain-framerate"&&r!=="maintain-resolution")return;let a=-1;lU(e,t);const d=window.setInterval(()=>{const h=bm.get(e);if(!A("ENABLE_AG_ADAPTATION")||!h)return xl(e,n),void i(t);const p=s();if(p.sendPackets>0&&p.OutgoingAvailableBandwidth>0){if(a===-1)return void(a=Date.now());if(Date.now()-a<1e3)return;const _=p.sendFrameRate,m=p.OutgoingAvailableBandwidth,[g,w]=YQ(e,_,m,h.adaptationConfig,t,r);w&&(n.qualityLimitationReason=w),g&&h.adaptationConfig.scale!==g.scale&&(T.debug("[".concat(e,"] applyAdaptation: ").concat(n.qualityLimitationReason,`
           sendFps `).concat(_,", bwe ").concat(m,", switch from ").concat(h.adaptationConfig.scale," to ").concat(g.scale," ")),h.adaptationConfig=py(py({},h.adaptationConfig),g),i(g))}},A("CHECK_LOCAL_STATS_INTERVAL")),l=py({},t);bm.set(e,{timer:d,adaptationConfig:l,originConfig:t,adaptationFunc:i}),T.debug("[".concat(e,"] start adaptation, originConfig: ").concat(JSON.stringify(t),", degradationPreference: ").concat(r))}function xl(e,t){const n=bm.get(e);if(n){const{timer:r}=n;window.clearTimeout(r),bm.delete(e)}t.qualityLimitationReason=fl.NONE,lU(e)}function zQ(e,t){var n;let r;switch(t){case ne.LocalAudioTrack:r=ft.Audio;break;case ne.LocalVideoTrack:r=te(n=e._hints).call(n,lt.SCREEN_TRACK)?ft.Screen:ft.High;break;case ne.LocalVideoLowTrack:r=ft.Low}return r}function fy(e){const t=qe();if(e.some(n=>n._bypassWebAudio))throw new Y(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new Y(O.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function _y(e,t){fy(e);const n=new fn;return e.forEach(r=>n.addAudioTrack(r)),n}const qQ=!qe().supportUnifiedPlan||A("CHROME_FORCE_PLAN_B")&&as();function xh(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.useDcSignal)return n={spec:t,store:e},Uo("DataChannelConnection").create(n);var n;return qQ?function(i){return Uo("PlanBConnection").create(i)}({spec:t,store:e}):new Ei(t,e)}function my(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function Ey(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(Ac(e.turnServer.servers))return!1;if(A("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(t=>t.forceturn))return!0}return!1}catch{return!1}}var et;function _U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Vo(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?_U(Object(n),!0).forEach(function(r){I(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_U(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let Ei=(et=class dd extends hm{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return te(n=Object.keys(kc)).call(n,t)}))]}constructor(t,n){super(t,n),I(this,"id",ht(5,"connection-")),I(this,"store",void 0),I(this,"peerConnection",void 0),I(this,"forceTurn",!1),I(this,"remoteSDP",void 0),I(this,"initialOffer",void 0),I(this,"transportEventReceiver",void 0),I(this,"statsFilter",void 0),I(this,"extension",{useXR:A("USE_XR")}),I(this,"localCapabilities",void 0),I(this,"remoteCodecs",void 0),I(this,"localCandidateCount",0),I(this,"allCandidatesReceived",!1),I(this,"isPreallocation",!1),I(this,"isPreRender",!1),I(this,"preMediaMap",new Map),I(this,"dataStreamChannelMap",new Map),I(this,"establishPromise",void 0),I(this,"recoveredDataChannelIds",[]),I(this,"currentDataChannelId",1),I(this,"supportAV1RtpSpec",!1),I(this,"mutex",void 0),I(this,"qualityLimitationReason",fl.NONE),I(this,"isFirstConnected",!1),this.store=n,this.forceTurn=Ey(t),this.mutex=new bn("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(dd.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=B_(this.peerConnection,A("STATS_UPDATE_INTERVAL"),void 0,Nt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,n){if(this.remoteCodecs=n,!this.remoteSDP)return void T.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(t,n,this.store.codec)){const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r);const s=this.remoteSDP.toString();i==null||i(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}else T.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=ps(n.sdp),i=await $R({filterRTX:!A("USE_PUB_RTX")&&!A("USE_SUB_RTX"),filterVideoFec:A("FILTER_VIDEO_FEC"),filterAudioFec:A("FILTER_AUDIO_FEC"),filterVideoCodec:A("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:A("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:A("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=Ph(i),this.initialOffer=n,A("ENABLE_SVC")&&this.store.codec=="av1"){const a=await UM();var t;a&&(this.supportAV1RtpSpec=!0,(t=i.send)===null||t===void 0||t.videoExtensions.push(a))}let s;return n.sdp&&Sm(n.sdp)&&(s=Dt(i),bM(s)),Vo(Vo({},r),{},{rtpCapabilities:s||i,offerSDP:n.sdp})}catch(n){throw new Y(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&Sm(this.initialOffer.sdp)&&OM(t.rtpCapabilities,this.localCapabilities),this.remoteSDP=new aU(Vo(Vo({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!A("ENABLE_PRE_SUB_WITH_PRE_PC")||!A("PRE_USE_LOCAL_CODECS"))&&yh(this.store)),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const n=this.remoteSDP.toString(),r=ey(this.initialOffer.sdp,this.extension),i=this.logSDPExchange(r||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),i==null||i(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n});const s=this.peerConnection.getTransceivers()[0];if(s!=null&&s.receiver&&this.tryBindTransportEvents(s.receiver),yh(this.store))if(t.preallocation&&A("ENABLE_PRE_SUB_WITH_PRE_PC")){const a=A("PRE_SUB_NUM"),{mids:d,preSSRCs:l}=this.remoteSDP.preloadRemoteMedia(a);await Vr(this.peerConnection,this.remoteSDP,this.extension),T.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(l)),this.presetMedia(d,l)}else{const{preSSRCs:a=[]}=t,d=a.map(h=>h.ssrcMsg[0].ssrcId);if(a.length===0)return;const{mids:l}=this.remoteSDP.batchSend(a.map(h=>Object.assign({},h)));await Vr(this.peerConnection,this.remoteSDP,this.extension),T.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(d)),this.presetMedia(l,d)}}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}presetMedia(t,n){t.forEach((r,i)=>{this.peerConnection.getTransceivers().forEach(s=>{if(s.mid!=null&&r===s.mid&&s.receiver.track){const a=s.receiver.track;let d;a.kind==="video"&&A("ENABLE_PRE_RENDER")&&(d=new J_({trackId:"track-".concat(a.kind,"-unknown-").concat(this.store.clientId,"_").concat(ht(5,""))},!0),d.updateVideoTrack(a),d.onFirstVideoFrameRender=()=>{var l;const h=this.preMediaMap.get(n[i]);h&&(h.firstVideoRender=Date.now()),(l=this.onFirstVideoRender)===null||l===void 0||l.call(this,n[i])},d.onVideoBufferReady=()=>{var l;(l=this.onFirstVideoBufferReady)===null||l===void 0||l.call(this,n[i])},d.play(this.store.sessionId||void 0),this.isPreRender=!0),this.preMediaMap.set(n[i],{mid:r,track:a,player:d,transceiver:s})}}),this.store.peerReceiver()})}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let n=!1;const{rtpCapabilities:r}=t;if([,n]=this.remoteSDP.updateRemoteRTPCapabilities(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const a=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);n=n||a}const{preSSRCs:i=[]}=t,s=i.map(a=>a.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(s)){const a=[],d=[];if(Array.from(this.preMediaMap.entries()).every(l=>{let[h,{mid:p,player:_,track:m}]=l;return a.push(p),d.push(h),this.preMediaMap.delete(h),_&&_.destroy(),!0}),a.length>0&&(this.remoteSDP.stopSending(a),await Vr(this.peerConnection,this.remoteSDP,this.extension),T.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(d)),Se.reportApiInvoke(this.store.sessionId,{name:kt.PRELOAD_MEDIA_FAILED,options:[i,d],tag:yt.TRACER}).onSuccess()),i.length>0){const{mids:l}=this.remoteSDP.batchSend(i.map(h=>Object.assign({},h)));await Vr(this.peerConnection,this.remoteSDP,this.extension),T.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(s)),this.presetMedia(l,s)}}n?(await Vr(this.peerConnection,this.remoteSDP,this.extension),T.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):T.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}}send(t,n,r){var i=this;return yr(function*(){const s=yield He(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const a=[],d=Oh();t.forEach(y=>{const b=i.peerConnection.addTransceiver(y._mediaStreamTrack,Vo({direction:"sendonly"},y.trackMediaType==="video"&&i.supportAV1RtpSpec&&d?{sendEncodings:[{scalabilityMode:d}]}:{}));a.push(b),y._updateRtpTransceiver(b)}),Nt()&&A("SIMULCAST")===!0&&(yield He(i.applySimulcastForFirefox(a,t)));const l=yield He(i.peerConnection.createOffer()),h=i.remoteSDP.predictReceivingMids(t.length),p=i.mungSendOfferSDP(l.sdp,t,h),_=_r(p),m=h.map(y=>{const b=_.mediaDescriptions.find(N=>N.attributes.mid===y);if(!b)throw new Error("Cannot extract ssrc from mediaDescription.");return XR(b,A("USE_PUB_RTX"))});let g;try{g=yield m}catch(y){g=[],i.remoteSDP.receive(t,n,r,g);const b=i.remoteSDP.toString();throw yield He(i.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield He(i.peerConnection.setRemoteDescription({type:"answer",sdp:b})),yield He(i.stopSending(h,!0)),y}i.remoteSDP.receive(t,n,r,g);const w=i.remoteSDP.toString(),R=i.logSDPExchange(p,"offer","local","send");return yield He(i.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield He(i.applySimulcastEncodings(a,t)),yield He(i.applySendEncodings(a,t)),R==null||R(w),yield He(i.peerConnection.setRemoteDescription({type:"answer",sdp:w})),a.map((y,b)=>{const N=h[b];return{localSSRC:m[b],id:N,transceiver:y}})}catch(a){throw a instanceof Y?a:new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(a.toString()))}finally{s()}})()}async createDataChannels(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let r=this.dataStreamChannelMap.get(t);if(r&&r.readyState==="open")T.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const s=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof s!="number")throw new Error("create DataChannel error, because cannot get dc id");r=this.peerConnection.createDataChannel("datastream-channel",{id:s,negotiated:!0,ordered:!1,maxRetransmits:A("DATASTREAM_MAX_RETRANSMITS")}),r.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,r)}n.forEach(s=>{s._updateOriginDataChannel(r)});const{needExchangeSDP:i}=this.remoteSDP.sendDataChannel();if(i){const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const a=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(a),T.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else T.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(r){throw r instanceof Y?r:new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(r.toString()))}}async stopDataChannels(t){try{const n=this.dataStreamChannelMap.get(t);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(t)}catch(n){throw n instanceof Y?n:new Y(O.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(t,n){const r=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter(l=>t.indexOf(l.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(l=>{var h;xl(this.id+l.mid,this),l.direction="inactive",(h=l.stop)===null||h===void 0||h.call(l)});const s=await this.peerConnection.createOffer(),a=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(t);const d=this.remoteSDP.toString();a==null||a(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(i){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{r&&r()}}async receive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:s,needExchangeSDP:a}=this.remoteSDP.send(t,n,r,i);a&&(await Vr(this.peerConnection,this.remoteSDP,this.extension),T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));const d=this.peerConnection.getTransceivers().find(l=>l.mid===s);if(!d)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:d.receiver.track,id:s,transceiver:d}}catch(s){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:r}=this.remoteSDP.batchSend(t);return r&&(await Vr(this.peerConnection,this.remoteSDP,this.extension),T.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map(i=>{const s=this.peerConnection.getTransceivers().find(a=>a.mid===i);if(!s)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,id:i,transceiver:s}})}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(s=>{Array.from(this.preMediaMap.entries()).some(a=>{let[d,{mid:l,player:h}]=a;if(l===s)return this.preMediaMap.delete(d),h&&h.destroy(),!0})}),this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(a=>a.mid&&t.indexOf(a.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(a=>{a.direction="inactive"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const s=this.remoteSDP.toString();i==null||i(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(a=>a.mid&&t.indexOf(a.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(a,d)=>{a.direction="sendonly"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);const s=this.remoteSDP.toString();i==null||i(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return yr(function*(){const r=yield He(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const i=qe().supportPCSetConfiguration,s=A("FORCE_TURN_TCP")||n.forceTurn;if(t===On.RELAY&&!i)return;if(i&&!s){const _=t===On.RELAY?"relay":"all",m=n.peerConnection.getConfiguration();m.iceTransportPolicy!==_&&(T.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(m.iceTransportPolicy,"] to [").concat(_,"]")),m.iceTransportPolicy=_,n.peerConnection.setConfiguration(m))}n.remoteSDP.updateCandidates(t);const a=yield He(n.peerConnection.createOffer({iceRestart:!0}));if(!a.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=ps(a.sdp),{remoteIceParameters:l}=yield d.iceParameters;n.remoteSDP.restartICE(l);const h=n.remoteSDP.toString(),p=n.logSDPExchange(a.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield He(n.peerConnection.setLocalDescription(a)),p==null||p(h),yield He(n.peerConnection.setRemoteDescription({type:"answer",sdp:h}))}catch(i){T.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),i)}finally{r()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const t=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(On.TCP_RELAY),await Vr(this.peerConnection,this.remoteSDP,this.extension)}catch(n){T.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),n)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(n=>{xl(this.id+n.mid,this)}),this.preMediaMap.forEach(n=>{let{player:r}=n;r&&r.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Vo(Vo({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const s=this.remoteSDP.toString(),a=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),a==null||a(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new Y(O.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getTransceivers().filter(i=>i.mid===t);r.length===1&&(this.isVP8Simulcast(n)?Nt()||await this.applySimulcastEncodings(r,[n]):await this.applySendEncodings(r,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getTransceivers().find(i=>i.mid===n);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:r,remote:i}=n.getSelectedCandidatePair();return{local:Vo(Vo({},ro),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:Vo(Vo({},ro),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var n;const r="code: ".concat(t.errorCode,", message: ").concat(t.errorText),i=t.port?"local: ".concat(t.port):"",s=hs(t.url||"");T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(r,"), url: ").concat(s||"",", host_candidate:").concat(i)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,r)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},A("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]},r=t.cloudProxyServer||"disabled";return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&(Ac(t.turnServer.servers)?n.iceServers=t.turnServer.servers:A("NEW_TURN_MODE")&&n.iceServers&&r==="disabled"?(A("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&n.iceServers.push(...dd.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):n.iceServers.push(...dd.newTurnServerConfigToIceServers(t.turnServer.servers)),A("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(n.iceServers&&n.iceServers.push(...dd.turnServerConfigToIceServers(t.turnServer.servers)),A("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...dd.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),A("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),A("ENABLE_ENCODED_TRANSFORM")&&qe().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(co(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!A("FORCE_TURN_TCP")&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}static newTurnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{const i=A("NEW_TURN_MODE");i===1?n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=udp")}):i===2?n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=tcp")}):i===3?n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(co(r.turnServerURL),":443?transport=tcp")}):i===4&&(n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=udp")}),n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=tcp")}),n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(co(r.turnServerURL),":443?transport=tcp")}))}),n}tryBindTransportEvents(t){const n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var i;n!=null&&n.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,n.state))},n.onerror=i=>{var s;(s=this.onDTLSTransportError)===null||s===void 0||s.call(this,"error"in i?i.error:i)};const r=n.iceTransport;r&&(r.onstatechange=()=>{const i=n==null?void 0:n.iceTransport.state;var s;i&&((s=this.onICETransportStateChange)===null||s===void 0||s.call(this,i))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){const{local:i,remote:s}=r.getSelectedCandidatePair()||{};if(i&&s){const a=i.address+":"+i.port,d=s.address+":"+s.port;T.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(hs(a)),", remote ").concat(JSON.stringify(hs(d))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var r,i;if(n||(n=this.peerConnection.getSenders().find(y=>y.track===t._mediaStreamTrack)),!n)return T.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return T.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!qe().supportSetRtpSenderParameters)return T.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const s={},a={};switch(t._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;case"balanced":s.degradationPreference="balanced"}const d=wM(this.peerConnection,t._mediaStreamTrack),l=_k(t);if(pU(t)&&d&&n&&l&&this.getLocalVideoStats&&te(r=["vp8","vp9"]).call(r,this.store.codec)){var h;const R=s.degradationPreference||(te(h=t._hints).call(h,lt.CUSTOM_TRACK)?A("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");fU(this.id+d.mid,l,this,R,y=>{n&&this.updateAdaptation(n,y)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var p;const{bitrateMax:R,frameRate:y,scaleResolutionDownBy:b}=t._encoderConfig;R&&(a.maxBitrate=1e3*R),(te(p=t._hints).call(p,lt.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(y&&(a.maxFramerate=br(y)),b&&b>=1&&(a.scaleResolutionDownBy=b))}const{maxFramerate:_}=A("ENCODER_CONFIG_LIMIT");if(_&&typeof _=="number"&&(a.maxFramerate=a.maxFramerate?Math.min(a.maxFramerate,_):_),A("DSCP_TYPE")&&as()){var m;const R=A("DSCP_TYPE");te(m=["very-low","low","medium","high"]).call(m,R)&&(a.networkPriority=R)}const g=n.getParameters(),w=(i=g.encodings)===null||i===void 0?void 0:i[0];Nt()&&!w&&(s.encodings=[a]),w&&Object.assign(w,a),Object.assign(g,s),T.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(g.encodings))),await n.setParameters(g),await FM(this.store.codec,n,A("SVC_MODE"))}async updateAdaptation(t,n){var r,i;if(!t)return T.debug("[updateAdaptation] no rtpSender found");if(!qe().supportSetRtpSenderParameters)return T.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const s={},{bitrateMax:a,frameRate:d,scaleResolutionDownBy:l}=n;a&&(s.maxBitrate=1e3*a),d&&(s.maxFramerate=br(d)),l&&l>=1&&te(r=["vp8","vp9"]).call(r,this.store.codec)&&(s.scaleResolutionDownBy=l);const h=t.getParameters(),p=(i=h.encodings)===null||i===void 0?void 0:i[0];p&&Object.assign(p,s),Object.assign(h,{});try{await t.setParameters(h),T.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(h.encodings)))}catch(_){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?T.debug("[updateAdaptation] peerConnection not connected}"):T.debug("[updateAdaptation] updateRtpSenderEncodings failed",_):T.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,n){try{if(!qe().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const i=t[r],s=n[r];s instanceof Ct&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,i.sender)}}catch{T.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,r){if(A("FORBID_MODIFY_LOCAL_OFFER_SDP"))return t;const i=_r(t);return n.forEach((s,a)=>{const d=r[a],l=i.mediaDescriptions.find(h=>h.attributes.mid===d);l&&(Kc(l,s),ZR(l,s,this.store.codec))}),Fs(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let l=0;l<t.length;l++){var r,i,s,a,d;const h=t[l],p=n[l];if(p instanceof Ct&&!te(r=p._hints).call(r,lt.LOW_STREAM)&&(i=p._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=p._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(a=p._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((d=p._scalabilityMode)===null||d===void 0?void 0:d.numSpatialLayers)>1&&this.store.codec==="vp8"){const _={},m={high:1e3*(p._encoderConfig.bitrateMax-50),medium:5e4};_.encodings=[{rid:"m",active:!0,maxBitrate:m.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:m.high}];const g=h.sender.getParameters();await h.sender.setParameters(Object.assign(g,_))}}}async applySimulcastEncodings(t,n){if(!Nt()&&t.length===n.length)for(let r=0;r<t.length;r++){const i=n[r];if(i instanceof Ct&&this.isVP8Simulcast(i)){const s=t[r],a={},d={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};a.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:d.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:d.medium,scaleResolutionDownBy:4}];const l=s.sender.getParameters();await s.sender.setParameters(Object.assign(l,a))}}}isVP8Simulcast(t){var n,r,i,s,a;return!!(t instanceof Ct&&A("SIMULCAST")&&this.store.codec==="vp8"&&!te(n=t._hints).call(n,lt.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(s=t._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((a=t._scalabilityMode)===null||a===void 0?void 0:a.numSpatialLayers)>1)}logSDPExchange(t,n,r,i){if(A("SDP_LOGGING"))return T.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(n," SDP during P2PConnection.").concat(i,`
`),t),n==="offer"?s=>{this.logSDPExchange(s,"answer",r==="local"?"remote":"local",i)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(t){if(qe().supportPCSetConfiguration){const n=dd.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}t.isPreallocation&&(this.isPreallocation=!0)}},ce(et.prototype,"updateRemoteRTPCapabilities",[Or],Object.getOwnPropertyDescriptor(et.prototype,"updateRemoteRTPCapabilities"),et.prototype),ce(et.prototype,"connect",[Or],Object.getOwnPropertyDescriptor(et.prototype,"connect"),et.prototype),ce(et.prototype,"updateRemoteConnect",[Or],Object.getOwnPropertyDescriptor(et.prototype,"updateRemoteConnect"),et.prototype),ce(et.prototype,"createDataChannels",[Or],Object.getOwnPropertyDescriptor(et.prototype,"createDataChannels"),et.prototype),ce(et.prototype,"receive",[Or],Object.getOwnPropertyDescriptor(et.prototype,"receive"),et.prototype),ce(et.prototype,"batchReceive",[Or],Object.getOwnPropertyDescriptor(et.prototype,"batchReceive"),et.prototype),ce(et.prototype,"stopReceiving",[Or],Object.getOwnPropertyDescriptor(et.prototype,"stopReceiving"),et.prototype),ce(et.prototype,"muteRemote",[Or],Object.getOwnPropertyDescriptor(et.prototype,"muteRemote"),et.prototype),ce(et.prototype,"unmuteRemote",[Or],Object.getOwnPropertyDescriptor(et.prototype,"unmuteRemote"),et.prototype),ce(et.prototype,"muteLocal",[Or],Object.getOwnPropertyDescriptor(et.prototype,"muteLocal"),et.prototype),ce(et.prototype,"unmuteLocal",[Or],Object.getOwnPropertyDescriptor(et.prototype,"unmuteLocal"),et.prototype),ce(et.prototype,"close",[Or],Object.getOwnPropertyDescriptor(et.prototype,"close"),et.prototype),ce(et.prototype,"updateEncoderConfig",[Or],Object.getOwnPropertyDescriptor(et.prototype,"updateEncoderConfig"),et.prototype),ce(et.prototype,"updateSendParameters",[Or],Object.getOwnPropertyDescriptor(et.prototype,"updateSendParameters"),et.prototype),ce(et.prototype,"replaceTrack",[Or],Object.getOwnPropertyDescriptor(et.prototype,"replaceTrack"),et.prototype),ce(et.prototype,"updateAdaptation",[Or],Object.getOwnPropertyDescriptor(et.prototype,"updateAdaptation"),et.prototype),ce(et.prototype,"getRemoteSSRC",[Or],Object.getOwnPropertyDescriptor(et.prototype,"getRemoteSSRC"),et.prototype),et);function Or(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("From P2PConnection.".concat(t));try{for(var a=arguments.length,d=new Array(a),l=0;l<a;l++)d[l]=arguments[l];return await r.apply(this,d)}finally{s()}},n}function gy(e,t){let n=document.createElement("video"),r=document.createElement("canvas");n.setAttribute("style","display:none"),r.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),r.width=br(t.width),r.height=br(t.height);const i=br(t.framerate||15);document.body.append(n),document.body.append(r);let s=e._mediaStreamTrack;n.srcObject=new MediaStream([s]),n.play().catch(Sh);const a=r.getContext("2d");if(!a)throw new j(O.UNEXPECTED_ERROR,"can not get canvas context");const d=qe(),l=r.captureStream(d.supportRequestFrame?0:i).getVideoTracks()[0];l.canvas||(l.canvas=r),r.startCapture=()=>{if(!n)return r.stopCapture&&r.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const p=n.videoWidth,_=n.videoHeight/p,m=r.width*_;Math.abs(m-r.height)>=2&&(T.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(m)),r.height=m)}a.drawImage(n,0,0,r.width,r.height),l.requestFrame&&l.requestFrame(),s!==e._mediaStreamTrack&&(s=e._mediaStreamTrack,n.srcObject=new MediaStream([s]))},r.stopCapture=gR(()=>r.startCapture&&r.startCapture(),i);const h=l.stop;return l.stop=()=>{h.call(l),n&&(n.remove(),n.srcObject=null,n=null),r&&(r.width=0,r.remove(),r.stopCapture&&r.stopCapture(),r.startCapture=void 0,r.stopCapture=void 0,r=null),T.debug("clean low stream renderer")},l}var mU=function(e){return e[e.Video_Send_Type=190]="Video_Send_Type",e}(mU||{}),Fo=function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e}(Fo||{}),Ve=function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e}(Ve||{}),yn=function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e[e.Audio_Recv_AV_Sync_TIME=2237]="Audio_Recv_AV_Sync_TIME",e}(yn||{}),xn=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(xn||{}),Vl=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e[e.PAGE_VISIBILITY=2233]="PAGE_VISIBILITY",e}(Vl||{}),Sy=function(e){return e[e.Transport_Send_Bitrate=2234]="Transport_Send_Bitrate",e[e.Transport_Recv_Bitrate=2235]="Transport_Recv_Bitrate",e}(Sy||{});const zc=1e3,Om=6,Vh=3,XQ=Math.max(Om,Vh,60);function be(e,t,n){n!=null&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function EU(e){const t={[xn.CONN_TYPE]:0,[xn.RTT]:e.rtt,[xn.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=e.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(t[xn.CONN_TYPE]=1),n==="tcp"&&(t[xn.CONN_TYPE]=3),n==="tls"&&(t[xn.CONN_TYPE]=4);break}case"srflx":t[xn.CONN_TYPE]=2;break;case"unknown":t[xn.CONN_TYPE]=5;break;default:t[xn.CONN_TYPE]=0}return t}function gU(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class SU extends Vt{constructor(t){super(),I(this,"store",void 0),I(this,"uploadWRTCStatsTimer",void 0),I(this,"uploadOutboundDenoiserStatsTimer",void 0),I(this,"uploadExtStatsTimer",void 0),I(this,"uploadExtUsageStatsTimer",void 0),I(this,"uploadInboundExtStatsTimer",void 0),I(this,"requestStats",void 0),I(this,"requestTransportStats",void 0),I(this,"requestLocalMedia",void 0),I(this,"requestRemoteMedia",void 0),I(this,"requestAllTracks",void 0),I(this,"requestVideoIsReady",void 0),I(this,"requestUploadStats",void 0),I(this,"requestUpload",void 0),I(this,"uploadOutboundStarted",!1),I(this,"uploadInboundStarted",!1),I(this,"uploadTransportStarted",!1),I(this,"uploadBaseStatsStarted",!1),I(this,"uploadExtensionUsageStarted",!1),I(this,"lastRecvStats",void 0),I(this,"lastSendStats",void 0),I(this,"lastRefRecvStats",void 0),I(this,"lastRefSendStats",void 0),I(this,"lastNormalRecvStats",void 0),I(this,"lastNormalSendStats",void 0),I(this,"lastExtendStats",{}),I(this,"needUploadStats",{}),I(this,"needUploadRenderFreezeTime",!0),I(this,"lastUploadCompensateTime",-1),I(this,"uploadCompensateDeltaTime",0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;const n=t%Vh==0,r=t%Om==0,i=t%60==0;let s,a;if(this.uploadTransportStarted&&(s=this.requestStats(),this.store.useP2P&&(a=this.requestStats(!0))),!s&&this.uploadOutboundStarted&&(s=this.requestStats()),!a&&this.uploadInboundStarted&&(a=this.requestStats(!0)),s||a){var d;const l={};if(this.uploadTransportStarted&&s){const p=this.getTransportStats(s,n?this.lastRefSendStats:void 0,a,n);p&&(l.misc=[p])}if(this.uploadOutboundStarted&&s){const p=this.getOutboundStats(s,r?this.lastNormalSendStats:void 0,n?this.lastRefSendStats:void 0,this.lastSendStats,i);p&&(l.outbound=[p])}if(this.uploadInboundStarted&&a){this.uploadCompensateStats(t);const p=this.getInboundStats(a,r?this.lastNormalRecvStats:void 0,n?this.lastRefRecvStats:void 0,this.lastRecvStats);p&&(l.inbound=p)}const h=(d=this.requestTransportStats)===null||d===void 0?void 0:d.call(this).connectState;if(h&&(Array.isArray(l.misc)?l.misc[0]&&l.misc[0].addition&&(l.misc[0].addition[Vl.RTC_PEER_CONNECTION_STATE]=nR[h]):l.misc=[{addition:{[Vl.RTC_PEER_CONNECTION_STATE]:nR[h]}}]),$r.needUploadStats.length>0||r){const p=$r.needUploadStats.shift()||($r.visibility==="visible"?1:0);Array.isArray(l.misc)?l.misc[0]&&l.misc[0].addition&&(l.misc[0].addition[Vl.PAGE_VISIBILITY]=p):l.misc=[{addition:{[Vl.PAGE_VISIBILITY]:p}}]}this.needUploadStats.sendType&&(Array.isArray(l.outbound)&&l.outbound[0]&&l.outbound[0].high&&(l.outbound[0].high[mU.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(l)}this.lastRecvStats=a,this.lastSendStats=s,r&&(this.lastNormalRecvStats=a,this.lastNormalSendStats=s),n&&(this.lastRefRecvStats=a,this.lastRefSendStats=s)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0,$r.startCollectStats();let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var n,r;const i=(n=this.requestTransportStats)===null||n===void 0?void 0:n.call(this);return void(i&&((r=this.requestUploadStats)===null||r===void 0||r.call(this,{misc:[{addition:{[Vl.RTC_PEER_CONNECTION_STATE]:nR[i.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===XQ+1&&(t=1)},zc)}uploadCompensateStats(t){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const n=t%Vh==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!n)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const r=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=r,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const i=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*i;const s=this.requestStats(!0);new Array(i).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const a={};if(this.uploadInboundStarted&&s){const d=this.requestRemoteMedia()||[],l=[];d.forEach(h=>{let[p,_]=h;const m={peer:p.uid};if(p._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(p._videoSSRC)&&_.has(_e.VIDEO)&&p.videoTrack){const g=function(w,R,y){if(!R.videoRecv.find(N=>N.ssrc===w))return;const b={};if(y&&y._player){const N=y._player,{renderFreezeAccTime2:L,videoElementStatus:x}=N;if($r.visibility==="visible"&&x===zn.PLAYING&&qe().supportRequestVideoFrameCallback){const F=Math.min(6e3,L);N.renderFreezeAccTime2=Math.max(0,L-F),be(b,Fo.Video_Render_Freeze_Time_Render2,F),A("USE_NEW_RENDER_FREEZE_TIME")&&be(b,Fo.Video_Render_Freeze_Time_Render,F)}}return b}(p._videoSSRC,s,p.videoTrack);g&&(m.video=g)}m.video&&l.push(m)}),l.length>0&&(a.inbound=l,this.requestUploadStats(a))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(t,n,r,i){if(!this.requestStats)return;if(!i)return t.rtt==null?void 0:{addition:{[xn.RTT]:t.rtt,[xn.CONN_TYPE]:void 0,[xn.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};const s=EU(t);if(this.store.useP2P){if(r){const a=EU(r);s[xn.CONN_TYPE]&&a[xn.CONN_TYPE]&&(s[xn.CONN_TYPE]+=a[xn.CONN_TYPE]<<3)}s[xn.CONN_TYPE]?s[xn.CONN_TYPE]+=110:s[xn.CONN_TYPE]=110}else{s[xn.CONN_TYPE]?s[xn.CONN_TYPE]+=100:s[xn.CONN_TYPE]=100;const a=function(d,l){return l?[Math.ceil(8*(d.transport.bytesSent-l.transport.bytesSent)/(d.timestamp-l.timestamp)),Math.ceil(8*(d.transport.bytesReceived-l.transport.bytesReceived)/(d.timestamp-l.timestamp))]:[0,0]}(t,n);s[Sy.Transport_Send_Bitrate]=a[0],s[Sy.Transport_Recv_Bitrate]=a[1]}return{addition:s}}getOutboundStats(t,n,r,i,s){if(!this.requestUploadStats||!this.requestLocalMedia)return;const a=this.requestLocalMedia();if(!a||a.length===0)return;let d,l,h;return a.forEach(p=>{let[_,{track:m,ssrcs:g}]=p;switch(_){case ne.LocalVideoLowTrack:case ne.LocalVideoTrack:if(_===ne.LocalVideoTrack){var w;const R=function(L,x,F,M,B,J){const ee=x.videoSend.find(Ge=>Ge.ssrc===L);if(!ee)return;const pe={},{sentFrame:Pe,inputFrame:Ne}=ee;if(M&&(be(pe,Fo.Video_Send_Qp_Sum,ee.qpSumPerFrame),Ne&&Pe)){const Ge=Ne.frameRate,Fe=Pe.frameRate;pe[Fo.Video_Send_Freeze]=function(st,Ut){let Z=!0;return Z=!(st<=5)&&(st<=10?Ut<3:st<=20?Ut<4:Ut<5),Z}(Ge,Fe)?1:0}if(B){switch(Pe&&(be(pe,Ve.Video_Send_Height,Pe.height),be(pe,Ve.Video_Send_Width,Pe.width),be(pe,Ve.Video_Send_Frame_Rate,Pe.frameRate)),pe[Ve.Video_Send_Disabled]=F._originMediaStreamTrack&&!F._originMediaStreamTrack.enabled||F._mediaStreamTrack&&!F._mediaStreamTrack.enabled?1:0,ee.adaptionChangeReason){case"none":pe[Ve.Video_Send_Adaptation]=0;break;case"cpu":pe[Ve.Video_Send_Adaptation]=1;break;case"bandwidth":pe[Ve.Video_Send_Adaptation]=2;break;case"other":pe[Ve.Video_Send_Adaptation]=3}let Ge=0;ee.adaptionChangeReason&&(Ge+=gU(ee.adaptionChangeReason)),x.qualityLimitationReason&&(Ge+=gU(x.qualityLimitationReason)<<3),pe[Ve.Video_Send_Adaptation]=Ge,pe[Ve.Video_Send_Player_Status]=_R[F._player?F._player.videoElementStatus:"uninit"],be(pe,Ve.Video_Send_Nacks,ee.nacksCount),be(pe,Ve.Video_Send_Plis,ee.plisCount),be(pe,Ve.Video_Send_Firs,ee.firsCount),be(pe,Ve.Video_Send_Avg_Encode,ee.avgEncodeMs),be(pe,Ve.Video_Send_Huge_Frame_Sent,ee.hugeFramesSent),be(pe,Ve.Video_Send_Bytes_Retransmit,ee.retransmittedBytesSent),be(pe,Ve.Video_Send_Packages_Retransmit,ee.retransmittedPacketsSent),be(pe,Ve.Video_Send_Key_Frames_Encoded,ee.keyFramesEncoded);const Fe=B.videoSend.find(st=>st.ssrc===L);if(Fe){let st=zc*Vh;Fe.timestamp&&ee.timestamp&&(st=ee.timestamp-Fe.timestamp),Fe.packets!=null&&ee.packets!=null&&be(pe,Ve.Video_Send_Package_Rate,1e3*(ee.packets-Fe.packets)/st),ee.packetsLost!=null&&Fe.packetsLost!=null&&be(pe,Ve.Video_Send_Package_Lost,ee.packetsLost-Fe.packetsLost),Fe.bytes!=null&&ee.bytes!=null&&be(pe,Ve.Video_Send_Bitrate,8*(ee.bytes-Fe.bytes)/st)}}return pe}(g[0].ssrcId,t,m,n,r),y=m.__className__==="CameraVideoTrack"?3:te(w=m._hints).call(w,lt.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==y||s)&&(this.needUploadStats={sendType:y},this.lastExtendStats.sendType=y);const b=m&&function(L,x,F,M){const B=x.videoSend.find(ee=>ee.ssrc===L);if(!B)return null;const J={};if(M){const ee=B.inputFrame,pe=ee&&ee.height||F.videoHeight||0,Pe=ee&&ee.width||F.videoWidth||0,Ne=ee&&ee.frameRate||0;be(J,Ve.Video_Capture_Height,pe),be(J,Ve.Video_Capture_Width,Pe),be(J,Ve.Video_Capture_Frame_Rate,Ne)}return J}(g[0].ssrcId,t,m,!!r),N=function(L,x){const F={};return x&&(be(F,Ve.Video_Send_Retransmit,L.bitrate.retransmit),be(F,Ve.Video_Send_Target_Encoded,L.bitrate.targetEncoded),be(F,Ve.Video_Send_Actual_Encoded,L.bitrate.actualEncoded),be(F,Ve.Video_Send_Transmit,L.bitrate.transmit),be(F,Ve.Video_Send_Bandwidth,L.sendBandwidth)),F}(t,!!r);l=Object.assign({},R,b,N)}else h=function(R,y,b,N,L){const x=y.videoSend.find(M=>M.ssrc===R);if(!x)return;const F={};if(N){const M=x.sentFrame;M&&(be(F,Ve.Video_Send_Low_Height,M.height),be(F,Ve.Video_Send_Low_Width,M.width),be(F,Ve.Video_Send_Low_Frame_Rate,M.frameRate));const B=N.videoSend.find(J=>J.ssrc===R);if(B){let J=zc*Om;B.timestamp&&x.timestamp&&(J=x.timestamp-B.timestamp),B.packets!=null&&x.packets!=null&&be(F,Ve.Video_Send_Low_Package_Rate,1e3*(x.packets-B.packets)/J),x.packetsLost!=null&&B.packetsLost!=null&&be(F,Ve.Video_Send_Low_Package_Lost,x.packetsLost-B.packetsLost),B.bytes!=null&&x.bytes!=null&&be(F,Ve.Video_Send_Low_Bitrate,8*(x.bytes-B.bytes)/J)}}return F}(g[0].ssrcId,t,0,r);break;case ne.LocalAudioTrack:d=m&&function(R,y,b,N,L,x){const F=y.audioSend.find(B=>B.ssrc===R);if(!F)return;const M={};if(L){M[Ve.Audio_Send_Disabled]=b._originMediaStreamTrack&&!b._originMediaStreamTrack.enabled||b._mediaStreamTrack&&!b._mediaStreamTrack.enabled?1:0;const B=100*b._source.getAccurateVolumeLevel(),J=F.inputLevel;if(J!=null){const pe=Math.ceil(50*Math.log10(100*J+1));be(M,Ve.Audio_Send_Level,pe)}be(M,Ve.Audio_Capture_PCM_Level,B),be(M,Ve.Audio_Send_AEC_Return_Loss,F.aecReturnLoss),be(M,Ve.Audio_Send_AEC_Return_Loss_Enhancement,F.aecReturnLossEnhancement),be(M,Ve.Audio_Send_Bytes_Retransmit,F.retransmittedBytesSent),be(M,Ve.Audio_Send_Packages_Retransmit,F.retransmittedPacketsSent),M[Ve.Audio_Send_Freeze]=0;const ee=L.audioSend.find(pe=>pe.ssrc===R);if(ee){let pe=zc*Om;ee.timestamp&&F.timestamp&&(pe=F.timestamp-ee.timestamp),ee.bytes!=null&&F.bytes!=null&&be(M,Ve.Audio_Send_Bitrate,8*(F.bytes-ee.bytes)/pe),ee.packets!=null&&F.packets!=null&&be(M,Ve.Audio_Send_Package_Rate,1e3*(F.packets-ee.packets)/pe)}}return M}(g[0].ssrcId,t,m,0,r)}}),{high:l,low:h,audio:d}}getInboundStats(t,n,r,i){if(!this.requestRemoteMedia)return;const s=this.requestRemoteMedia()||[],a=[];return s.forEach(d=>{let[l,h]=d;const p={peer:l.uid};let _;if(h.has(_e.VIDEO)&&l.videoTrack){const m=l._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(l._videoSSRC)||!1,g=l.videoTrack?function(w,R,y,b,N,L,x,F){const M=R.videoRecv.find(Fe=>Fe.ssrc===w);if(!M)return;const B={},{receivedFrame:J,outputFrame:ee,decodeFrameRate:pe}=M;be(B,yn.Video_Render_Frame_Rate_Decode,pe),M.framesRateFirefox&&be(B,yn.Video_Recv_Frame_Rate,M.framesRateFirefox),J&&be(B,yn.Video_Recv_Frame_Rate,J.frameRate),be(B,yn.Video_Recv_Frame_Dropped,M.framesDroppedCount),be(B,yn.Video_Recv_Bytes_Retransmit,M.retransmittedBytesReceived),be(B,yn.Video_Recv_Packages_Retransmit,M.retransmittedPacketsReceived),be(B,yn.Video_Recv_Packages_Discarded,M.packetsDiscarded),be(B,yn.Video_Recv_Avg_Decode,M.avgDecodeMs),be(B,yn.Video_Recv_Avg_Processing_Delay,M.avgProcessingDelayMs),be(B,yn.Video_Recv_Avg_Assembly_Time,M.avgFramesAssembledFromMultiplePacketsMs),be(B,yn.Video_Recv_Avg_Inter_Frame_Delay,M.avgInterFrameDelayMs),be(B,yn.Video_Recv_Key_Frames_Decoded,M.keyFramesDecoded);const Pe=F&&F.videoRecv.find(Fe=>Fe.ssrc===w);if(Pe){const Fe=R.timestamp-F.timestamp||zc;M.packetsLost!=null&&Pe.packetsLost!=null&&be(B,yn.Video_Recv_Package_Lost,M.packetsLost-Pe.packetsLost),Pe.bytes!=null&&M.bytes!=null&&be(B,yn.Video_Recv_Bitrate,8*(M.bytes-Pe.bytes)/Fe),Pe.packets!=null&&M.packets!=null&&be(B,yn.Video_Recv_Package_Rate,1e3*(M.packets-Pe.packets)/Fe)}const Ne=L&&L.videoRecv.find(Fe=>Fe.ssrc===w);if(Ne&&(be(B,Fo.Video_Recv_Qp_Sum,M.qpSumPerFrame),B[Fo.Video_Recv_Freeze]=b&&Uh.isRemoteVideoFreeze(y,M,Ne)?1:0),x){var Ge;const Fe=x.videoRecv.find(Ut=>Ut.ssrc===w);J?(be(B,Ve.Video_Recv_Height,J.height),be(B,Ve.Video_Recv_Width,J.width)):y&&(be(B,Ve.Video_Recv_Height,y._videoHeight||0),be(B,Ve.Video_Recv_Width,y._videoWidth||0)),ee&&be(B,Ve.Video_Recv_Frame_Rate_Output,ee.frameRate);const st=(Ge=y._player)===null||Ge===void 0?void 0:Ge.rendFrameRate.toFixed(0);if(st&&be(B,Ve.Video_Render_Frame_Rate_Render,+st),be(B,Ve.Video_Recv_Jitter_Buffer,M.jitterBufferMs),be(B,Ve.Video_Recv_Current_Delay,M.currentDelayMs),be(B,Ve.Video_Recv_Firs,M.firsCount),be(B,Ve.Video_Recv_Nacks,M.nacksCount),be(B,Ve.Video_Recv_Plis,M.plisCount),y){B[Ve.Video_Recv_Disabled]=y._originMediaStreamTrack.enabled&&y._mediaStreamTrack.enabled?0:1;const Ut=y._player;if(Ut){const{freezeTimeCounterList:Z,renderFreezeAccTime:oe,renderFreezeAccTime2:ge,videoElementStatus:$}=Ut;if(Z&&Z.length>0&&be(B,Fo.Video_Render_Freeze_Time,Z.splice(0,1)[0]),N&&$r.visibility==="visible"&&$===zn.PLAYING&&qe().supportRequestVideoFrameCallback){const v=Math.min(6e3,ge);Ut.renderFreezeAccTime2=Math.max(0,ge-v),be(B,Fo.Video_Render_Freeze_Time_Render2,v);const P=Math.min(6e3,oe);Ut.renderFreezeAccTime=Math.max(0,oe-P),be(B,Fo.Video_Render_Freeze_Time_Render,A("USE_NEW_RENDER_FREEZE_TIME")?v:P)}if(typeof M.totalFreezesDuration=="number"){const v=Fe&&Fe.totalFreezesDuration?M.totalFreezesDuration-Fe.totalFreezesDuration:M.totalFreezesDuration;be(B,Ve.Video_Render_Freeze_Duration,1e3*v)}}}if(B[Ve.Video_Recv_Player_Status]=_R[y._player?y._player.videoElementStatus:"uninit"],Fe&&M.totalInterFrameDelay!==void 0&&M.totalSquaredInterFrameDelay!==void 0&&Fe.totalInterFrameDelay!==void 0&&Fe.totalSquaredInterFrameDelay!==void 0){const Ut=M.totalInterFrameDelay-Fe.totalInterFrameDelay,Z=M.totalSquaredInterFrameDelay-Fe.totalSquaredInterFrameDelay,oe=M.framesDecodeCount-Fe.framesDecodeCount,ge=Ut/oe*1e3,$=Math.round(1e3*Math.sqrt((Z-Math.pow(Ut,2)/oe)/oe));!isNaN($)&&ge+$>Math.max(3*ge,ge+150)&&(B[Ve.Video_Recv_I_Frame_Delay]=$)}}return B}(l._videoSSRC,t,l.videoTrack,m===!0,this.needUploadRenderFreezeTime,n,r,i):void 0;if(g&&(p.video=g),l.videoTrack){const w=t.videoRecv.find(R=>R.ssrc===l._videoSSRC);w&&w.estimatedPlayoutTimestamp&&(_=w.estimatedPlayoutTimestamp)}}if(h.has(_e.AUDIO)&&l.audioTrack){const m=l.audioTrack?function(g,w,R,y,b,N){const L=w.audioRecv.find(B=>B.ssrc===g);if(!L)return;const x={};be(x,yn.Audio_Recv_Jitter,L.jitterMs),be(x,yn.Audio_Recv_Bytes_Retransmit,L.retransmittedBytesReceived),be(x,yn.Audio_Recv_Packages_Retransmit,L.retransmittedPacketsReceived),be(x,yn.Audio_Recv_Packages_Discarded,L.packetsDiscarded),be(x,yn.Audio_Recv_Avg_Processing_Delay,L.avgProcessingDelayMs);const F=N&&N.audioRecv.find(B=>B.ssrc===g);if(F){const B=zc;L.packets!=null&&F.packets!=null&&be(x,yn.Audio_Recv_Package_Rate,1e3*(L.packets-F.packets)/B),L.packetsLost!=null&&F.packetsLost!=null&&be(x,yn.Audio_Recv_Package_Lost,L.packetsLost-F.packetsLost)}if(y){const{receivedFrames:B,droppedFrames:J}=L;B!=null&&J!=null&&(x[Fo.Audio_Recv_Freeze]=(M=B)===0||100*J/M>20?1:0)}var M;if(b){const B=100*R._source.getAccurateVolumeLevel(),J=L.outputLevel;if(J!=null){const pe=Math.ceil(50*Math.log10(100*J+1));be(x,Ve.Audio_Render_Level,pe)}be(x,Ve.Audio_Recv_PCM_Level,B),R&&(x[Ve.Audio_Recv_Disabled]=R._originMediaStreamTrack.enabled&&R._mediaStreamTrack.enabled?0:1),be(x,Ve.Audio_Recv_Jitter_Buffer,L.jitterBufferMs),be(x,Ve.Audio_Recv_Current_Delay,L.jitterBufferMs),x[Ve.Audio_Recv_Player_Status]=_R[or.getPlayerState(R.getTrackId())];const ee=b.audioRecv.find(pe=>pe.ssrc===g);if(ee){ee.bytes!=null&&L.bytes!=null&&be(x,Ve.Audio_Recv_Bitrate,8*(L.bytes-ee.bytes)/(zc*Vh));const pe=L.concealedSamples-ee.concealedSamples;pe>0&&be(x,Ve.Audio_Recv_Concealed_Samples,pe);const Pe=L.totalSamplesReceived-ee.totalSamplesReceived;Pe>0&&be(x,Ve.Audio_Recv_Total_Samples_Received,Pe);const Ne=L.freezeSamples80-ee.freezeSamples80;Ne>0&&be(x,Ve.Audio_Render_Freeze_Samples_80ms,Ne);const Ge=L.freezeSamples200-ee.freezeSamples200;Ge>0&&be(x,Ve.Audio_Render_Freeze_Samples_200ms,Ge);const Fe=L.freezeMs80-ee.freezeMs80;be(x,Ve.Audio_Render_Freeze_Time_80ms,Fe<0?0:Fe);const st=L.freezeMs200-ee.freezeMs200;be(x,Ve.Audio_Render_Freeze_Time_200ms,st<0?0:st)}}return x}(l._audioSSRC,t,l.audioTrack,n,r,i):void 0;if(m&&(p.audio=m),l.audioTrack&&_){const g=t.audioRecv.find(w=>w.ssrc===l._audioSSRC);if(g&&g.estimatedPlayoutTimestamp){const w=g.estimatedPlayoutTimestamp-_;p.audio?p.audio[yn.Audio_Recv_AV_Sync_TIME]=w:p.audio={[yn.Audio_Recv_AV_Sync_TIME]:w}}}}(p.video||p.audio)&&a.push(p)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,a}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const t=(this.requestAllTracks()||[]).find(n=>n instanceof Ih);if(t&&t._external.getDenoiserStats){const n=t._external.getDenoiserStats();n&&this.requestUpload(Wc.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[n,r]=t;r.has(_e.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)}),r.has(_e.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const n=Date.now(),r={connectionInterval:A("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let i=[];const s=this.requestAllTracks&&this.requestAllTracks()||[];for(const h of s)!h.muted&&h.enabled&&(i=i.concat(await h.getProcessorUsage()));const a=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[h,p]of a)p.has(_e.VIDEO)&&h.videoTrack&&(i=i.concat(await h.videoTrack.getProcessorUsage())),p.has(_e.AUDIO)&&h.audioTrack&&(i=i.concat(await h.audioTrack.getProcessorUsage()));if(i.length===0)return;r.details=function(h,p){const _={};for(const{id:R,value:y,level:b,direction:N}of h){var m;const L=(m=p.get(R))!==null&&m!==void 0?m:0,x=y===2?L+A("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:L;var g,w;p.set(R,x),_[R]?(y===2&&(_[R].value=y),b>_[R].level&&(_[R].level=b),N==="remote"&&(_[R].remoteUidCount+=1),_[R].totalTs=(g=p.get(R))!==null&&g!==void 0?g:0):_[R]={value:y,level:b,remoteUidCount:N==="local"?0:1,totalTs:(w=p.get(R))!==null&&w!==void 0?w:0}}return Object.keys(_).map(R=>{const{level:y,value:b,totalTs:N}=_[R];return{id:R,level:y,value:b,totalTs:N}})}(i,t);const d=Date.now(),l=d>n?d:n+1;this.requestUpload&&this.requestUpload(Wc.EXTENSION_USAGE_STATS,{usageStats:r,sendTs:l})},A("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1,$r.stopCollectStats()}}const JQ=A("ICE_RESTART_INTERVAL");let Nm=new Map,Fl=new Map,Na=[On.UDP_TCP_RELAY,On.TCP_RELAY,On.RELAY],Ty=A("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&qe().supportPCSetConfiguration;function TU(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=Nm.get(e.id);n&&(window.clearTimeout(n),Nm.delete(e.id));const r=Fl.get(e.id);t&&r&&r.index===Na.length-1&&(T.debug("[".concat(e.id,"] reset ICE restart policy")),Fl.delete(e.id))}function vU(e,t,n){if(Nm.size===0&&Fl.size===0&&(Array.isArray(A("RESTART_SEQUENCE"))&&A("RESTART_SEQUENCE").length>0&&!function(d,l){if(d.length!==l.length)return!1;for(let h=0;h<d.length;h+=1){const p=d[h];if(d.filter(_=>_===p).length!==l.filter(_=>_===p).length)return!1}return!0}(Na,A("RESTART_SEQUENCE"))&&(Na=A("RESTART_SEQUENCE").filter(d=>{var l;if(te(l=Object.values(On)).call(l,d))return!0}),T.debug("use reconnection policy from config distribution, queues: ".concat(Na.join(" => ")))),Ty=A("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&qe().supportPCSetConfiguration),Na.length===0)return void n();let r,{index:i=0,type:s}=Fl.get(e.id)||{};if(Ty&&s===On.RELAY)return void n();let a=s&&i>=Na.length-1;if(Ty)s=On.RELAY;else{if(a)return void n();s?(i++,s=Na[i]):(s=Na[0],i=0)}T.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(s,", index: ").concat(i)),t(s),Fl.set(e.id,{index:i,type:s}),r=window.setTimeout(()=>vU(e,t,n),JQ),Nm.set(e.id,r)}var Je;function RU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function ms(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?RU(Object(n),!0).forEach(function(r){I(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):RU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function yU(e){var t,n,r,i=2;for(typeof Symbol<"u"&&(n=y_,r=Symbol.iterator);i--;){if(n&&(t=e[n])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new Dm(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function Dm(e){function t(n){if(Object(n)!==n)return ae.reject(new TypeError(n+" is not an object."));var r=n.done;return ae.resolve(n.value).then(function(i){return{value:i,done:r}})}return Dm=function(n){this.s=n,this.n=n.next},Dm.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?ae.resolve({value:n,done:!0}):t(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?ae.reject(n):t(r.apply(this.s,arguments))}},new Dm(e)}let qc=(Je=class extends Vt{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Ce.StateChange,t,this._state)}constructor(e,t){super(),I(this,"isPlanB",void 0),I(this,"store",void 0),I(this,"statsUploader",void 0),I(this,"connection",void 0),I(this,"localTrackMap",new Map),I(this,"remoteUserMap",new Map),I(this,"localDataChannels",[]),I(this,"remoteDataChannelMap",new Map),I(this,"pendingLocalTracks",[]),I(this,"pendingRemoteTracks",[]),I(this,"pendingLocalDataChannels",[]),I(this,"pendingRemoteDataChannels",[]),I(this,"statsCollector",void 0),I(this,"shouldForwardP2PCreation",void 0),I(this,"iceFailedCount",0),I(this,"dtlsFailedCount",0),I(this,"mutex",void 0),I(this,"_state",dt.Disconnected),I(this,"_pcStatsUploadType",A("NEW_ICE_RESTART")?Gs.FIRST_CONNECTION:Gs.OLD_FIRST_CONNECTION),I(this,"_isStartRestartIce",!1),I(this,"_restartTimer",void 0),I(this,"_isTryConnecting",!1),I(this,"_iceError",null),I(this,"_forceTurn",!1),I(this,"_isWaitPcToRePub",!1),I(this,"handleMuteLocalTrack",async(n,r,i)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==dt.Connected)return void i(new Y(O.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const a=this.filterTobeMutedTracks(n);if(a.length===0)return void r();const d=a.find(h=>h[0]==="videoLowTrack");if(d){const h=d[1];this.store.enableInstantMuteRestore?(h.track._originMediaStreamTrack.enabled=!1,T.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):h.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?T.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(a.map(h=>{let[,{id:p}]=h;return p}));const l=this.createMuteMessage(a);await wt(this,Ce.RequestMuteLocal,l),r()}catch(a){i(a)}finally{s()}}),I(this,"handleUnmuteLocalTrack",async(n,r,i)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==dt.Connected)return void i(new Y(O.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const a=this.filterTobeUnmutedTracks(n);if(a.length===0)return void r();const d=a.find(h=>h[0]==="videoLowTrack");if(d){const h=d[1];if(this.store.enableInstantMuteRestore)h.track._originMediaStreamTrack.enabled=!0,T.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(h.track._originMediaStreamTrack.stop(),!A("DISABLE_DUAL_STREAM_USE_ENCODING")&&qe().supportDualStreamEncoding){const p=n._mediaStreamTrack.clone();h.track._mediaStreamTrack=p,h.track._originMediaStreamTrack=p}else{const p=gy(n,Oc(this,Ce.RequestLowStreamParameter));h.track._mediaStreamTrack=p,h.track._originMediaStreamTrack=p}await new ae((p,_)=>{this.handleReplaceTrack(h.track,p,_,!0)})}}this.store.enableInstantMuteRestore?T.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(a.map(h=>{let[,{id:p}]=h;return p}));const l=this.createUnmuteMessage(a);await wt(this,Ce.RequestUnmuteLocal,l),r()}catch(a){i(a)}finally{s()}}),I(this,"handleUpdateVideoEncoder",async(n,r,i,s)=>{let a;s||(a=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const l=this.localTrackMap.get(ne.LocalVideoTrack);if(!this.connection||!l||l.track!==n||this.state!==dt.Connected)return void r();const{id:h,track:p}=l;await this.connection.updateSendParameters(h,p),await this.connection.updateEncoderConfig(h,p),this.emit(Ce.UpdateVideoEncoder,p),r()}catch(l){i(l)}finally{var d;(d=a)===null||d===void 0||d()}}),I(this,"handleUpdateVideoSendParameters",async(n,r,i)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const a=this.localTrackMap.get(ne.LocalVideoTrack);if(!this.connection||!a||a.track!==n||this.state!==dt.Connected)return void r();const{id:d,track:l}=a;await this.connection.updateSendParameters(d,l),r()}catch(a){i(a)}finally{s()}}),I(this,"handleReplaceMixingTrack",async(n,r,i,s)=>{if(!this.connection||this.state!==dt.Connected)return void r();const a=_y([n]);let d;T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(a.getTrackId(),"]")),typeof s=="boolean"&&s||(d=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,a),r()}catch(h){i(h)}finally{var l;(l=d)===null||l===void 0||l()}}),I(this,"handleReplaceTrack",async(n,r,i,s)=>{let a;T.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof s=="boolean"&&s||(a=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var d;const h=Array.from(this.localTrackMap.entries()).find(p=>{let[,{track:_}]=p;return n===_});if(!this.connection||!h||this.state!==dt.Connected)return void r();if(await((d=this.connection)===null||d===void 0?void 0:d.replaceTrack(n,h[1].id)),this.isPlanB){const p=h[1];p.id=n._mediaStreamTrack.id,this.localTrackMap.set(h[0],p)}if(h[0]===ne.LocalVideoTrack&&!A("DISABLE_DUAL_STREAM_USE_ENCODING")&&qe().supportDualStreamEncoding){const p=this.localTrackMap.get(ne.LocalVideoLowTrack);if(p){const _=n._mediaStreamTrack.clone();p.track._originMediaStreamTrack.stop(),p.track._mediaStreamTrack=_,p.track._originMediaStreamTrack=_,await new ae((m,g)=>{this.handleReplaceTrack(p.track,m,g,!0)})}}r()}catch(h){i(h)}finally{var l;(l=a)===null||l===void 0||l()}}),I(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),I(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),I(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),I(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),I(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new SU(this.store),this.bindStatsUploaderEvents(),this.mutex=new bn("P2PChannel-mutex",this.store.clientId),this.isPlanB=!qe().supportUnifiedPlan||A("CHROME_FORCE_PLAN_B")&&as(),this.shouldForwardP2PCreation=A("FORWARD_P2P_CREATION")&&qe().supportPCSetConfiguration&&sL(),this.shouldForwardP2PCreation&&(this.connection=xh(this.store),this.emit(Ce.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var n;this.state=dt.New,this._forceTurn=Ey(e),T.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const r=this.shouldForwardP2PCreation&&((n=this.connection)===null||n===void 0?void 0:n.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||r||t)&&((r||t)&&this.connection&&(T.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=xh(this.store,e),this.emit(Ce.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Y(O.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=A("NEW_ICE_RESTART")?Gs.FIRST_CONNECTION:Gs.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new Y(O.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(!this.isPreallocation()||this.state!==dt.Connected){this.store.peerConnectionStart();const t=await this.connection.connect(e);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=dt.Connected,t}if(this.connection instanceof Ei&&this.connection.checkDtlsParameters(e.dtlsParameters.fingerprints))return T.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),Se.reportApiInvoke(this.store.sessionId,{name:kt.MISMATCH_DTLS_PARAMETERS,options:[e.dtlsParameters.fingerprints],tag:yt.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(Ce.RequestReconnect)});await this.connection.updateRemoteConnect(e)}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter(i=>{var s;let[a]=i;return te(s=[ne.LocalVideoLowTrack,ne.LocalVideoTrack]).call(s,a)}),n=t.map(i=>{let[,{id:s}]=i;return s}),r=t.map(i=>{let[s]=i;return s});if(this.connection instanceof Ei||this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"){if(Se.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(r),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!te(e).call(e,this.store.codec)){const i=["vp9","vp8","h264"].find(s=>te(e).call(e,s));i&&(this.store.codec=i,T.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(i,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}}async getEstablishParams(){var e;return this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"&&this.connection.peerConnectionState!=="closed"||this.connection instanceof Ei&&this.connection.peerConnectionState!=="closed"&&te(e=[dt.New,dt.Connected]).call(e,this.state)?this.connection.establishPromise:void 0}async publishDataChannel(e){if(!this.connection||this.state!==dt.Connected){if(this.state===dt.Disconnected)throw new Y(O.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(n=>{var r;te(r=this.pendingLocalDataChannels).call(r,n)||this.pendingLocalDataChannels.push(n)}),[]}const t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(n=>{const r=Date.now();this.store.publish(n.id.toString(),"datachannel",r)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(n=>{this.localDataChannels.push(n);const r=Date.now();this.store.publish(n.id+"","datachannel",void 0,r)}),e.map(n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId})))}publish(e,t,n){var r=this;return yr(function*(){const i=yield He(r.mutex.lock("From P2PChannel.publish"));try{var s;const a=r.connection&&te(s=["disconnected","failed"]).call(s,r.connection.peerConnectionState);if(!r.connection||r.state!==dt.Connected||a){if(r.state===dt.Disconnected)throw new Y(O.UNEXPECTED_ERROR,"PeerConnection already disconnected.");r.throwIfTrackTypeNotMatch(e);const l=e.filter(h=>r.pendingLocalTracks.indexOf(h)===-1);return r.pendingLocalTracks=r.pendingLocalTracks.concat(l),void(a&&(r._isWaitPcToRePub=!0))}r.store.pubId=r.store.pubId+1,Xn.markPublishStart(r.store.clientId,r.store.pubId);const d=r.filterTobePublishedTracks(e,t,n);if(d.length===0)return void(yield He(r.tryToUnmuteAudio(e)));yield*cl(yU(r.doPublish(r.connection,d)))}finally{i()}})()}doPublish(e,t){var n=this;return yr(function*(){t.forEach(m=>{let{track:g,type:w}=m;const R=Date.now();n.store.publish(g.getTrackId(),w===ne.LocalAudioTrack?"audio":"video",R)}),n.bindLocalTrackEvents(t);const r=t.map(m=>{let{track:g}=m;return g}),i=yield He(e.send(r,n.store.codec,n.store.audioCodec)),s=(yield He(i.next())).value,a=n.createGatewayPublishMessage(t,s);let d;try{d=yield a}catch(m){throw i.throw(m),(m==null?void 0:m.code)===O.WS_ABORT&&t.forEach(g=>{let{track:w}=g;n.pendingLocalTracks.indexOf(w)===-1&&n.pendingLocalTracks.push(w)}),n.unbindLocalTrackEvents(t),m}const l=n.mapPubResToRemoteConfig(a,d,r),h=(yield He(i.next(l))).value;if(n.state===dt.Disconnected)throw new Y(O.UNEXPECTED_ERROR,"PeerConnection already disconnected.");A("ENABLE_VIDEO_SEI");const p=A("ENABLE_ENCODED_TRANSFORM"),_=A("ENABLE_AUDIO_METADATA");r.forEach(async m=>{const g=m.getRTCRtpTransceiver();if(!g||!p)return;const{interceptLocalVideoFrame:w,interceptLocalAudioFrame:R}=Tm();m.trackMediaType===_e.VIDEO?await w(g.sender,m):m.trackMediaType===_e.AUDIO&&await R(g.sender,{metadata:_?()=>{const y=m.metadata.shift();return y&&y.value}:void 0})}),t.forEach(m=>{let{type:g}=m;n.statsCollector.addLocalStats(g)}),n.assignLocalTracks(t,h),n.statsUploader.startUploadOutboundStats(),t.forEach(m=>{let{track:g,type:w}=m;const R=Date.now();n.store.publish(g.getTrackId(),w===ne.LocalAudioTrack?"audio":"video",void 0,R)})})()}async updateVideoStreamParameter(e,t){const n=this.localTrackMap.get(t);if(!n||!this.connection)return;if(!(n.track instanceof Ct))return T.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:r}=n,i=function(s,a){const d={};return s.height&&s.width&&(d.scaleResolutionDownBy=qR(s,a)),d.maxFramerate=s.framerate?br(s.framerate):void 0,d.maxBitrate=s.bitrate?1e3*s.bitrate:void 0,d}(e,r);if(r._encoderConfig||(r._encoderConfig={}),t!==ne.LocalVideoLowTrack||!A("DISABLE_DUAL_STREAM_USE_ENCODING")&&qe().supportDualStreamEncoding)i.scaleResolutionDownBy!=null&&(r._encoderConfig.scaleResolutionDownBy=i.scaleResolutionDownBy);else{const s=r._originMediaStreamTrack;if(!s.canvas)return T.warn("[".concat(r.getTrackId(),"] no canvas on track"));(function(a,d){const l=a.canvas;d.width&&(l.width=br(d.width)),d.height&&(l.height=br(d.height)),d.framerate&&(l.stopCapture&&l.stopCapture(),l.stopCapture=gR(()=>{!l.startCapture&&l.stopCapture&&l.stopCapture(),l.startCapture&&l.startCapture()},br(d.framerate)))})(s,e)}i.maxBitrate!=null&&(r._encoderConfig.bitrateMax=i.maxBitrate/1e3),i.maxFramerate!=null&&(r._encoderConfig.frameRate&&typeof r._encoderConfig.frameRate=="object"?r._encoderConfig.frameRate.max=i.maxFramerate:r._encoderConfig.frameRate={max:i.maxFramerate}),T.debug("[".concat(r.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(r._encoderConfig))),await this.connection.updateRtpSenderEncodings(r)}publishLowStream(e){var t=this;return yr(function*(){if(!t.connection||t.state!==dt.Connected)return;const n=yield He(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const i=t.localTrackMap.get(ne.LocalVideoTrack);if(!i)throw new Y(O.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(ne.LocalVideoLowTrack))throw new Y(O.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const s=[{track:t.getLowVideoTrack(i.track,e),type:ne.LocalVideoLowTrack}];if(yield*cl(yU(t.doPublish(t.connection,s))),i.track.muted||!i.track.enabled){var r;const a=(r=t.localTrackMap.get(ne.LocalVideoLowTrack))===null||r===void 0?void 0:r.id;a!==void 0&&(yield He(t.connection.muteLocal([a])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(T.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await dn(this,Ce.RequestRePublish,this.pendingLocalTracks),this.emit(Ce.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(T.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await dn(this,Ce.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:n,kind:r}=this.pendingRemoteTracks[t];(r!==_e.AUDIO||n._audio_added_&&n._audioSSRC)&&(r!==_e.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await dn(this,Ce.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===_e.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:n}=t;this.emit(Ce.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==dt.Connected)return void e.forEach(r=>{const i=this.pendingLocalTracks.indexOf(r);i!==-1&&this.pendingLocalTracks.splice(i,1)});const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(r=>r[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==dt.Connected)return void e.forEach(n=>{const r=this.pendingLocalDataChannels.indexOf(n);r!==-1&&this.pendingLocalDataChannels.splice(r,1)});const t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(n=>{const r=this.localDataChannels.indexOf(n);r!==-1&&this.localDataChannels.splice(r,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(n=>n.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==dt.Connected)return;const e=this.localTrackMap.get(ne.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[ne.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(r=>{let[,{id:i}]=r;return i})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(r=>{let[i,{track:s}]=r;return{type:i,track:s}})),t.forEach(r=>{let[i]=r;this.statsCollector.removeLocalStats(i)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(e,t){if(!this.connection||this.state!==dt.Connected)throw new Y(O.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=t.filter(r=>{var i;return!((i=this.remoteDataChannelMap.get(e))!==null&&i!==void 0&&i.get(r.id))});if(n.length!==0)return await this.connection.createDataChannels(e.uid,n),n.forEach(r=>{var i;this.remoteDataChannelMap.has(e)?(i=this.remoteDataChannelMap.get(e))===null||i===void 0||i.set(r.id,r):this.remoteDataChannelMap.set(e,new Map([[r.id,r]]));const s=this.pendingRemoteDataChannels.findIndex(a=>{let{user:d,id:l}=a;return d.uid===e.uid&&l===r.id});s!==-1&&this.pendingRemoteDataChannels.splice(s,1)}),n.map(r=>r.id)}async subscribe(e,t,n,r,i){var s;if(!this.connection||this.state!==dt.Connected)throw new Y(O.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((s=this.remoteUserMap.get(e))!==null&&s!==void 0&&s.has(t))return;let a,d,l,h;const p=this.connection.getPreMedia(n);if(p)T.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),l=p.transceiver,a=p.track,d=p.mid,h=p.player,p.firstVideoRender&&this.store.firstVideoFrameDecoded(e.uid,{firstPreRender:p.firstVideoRender});else if(i){const g=i.find(R=>{let{stream_type:y}=R;return y===t});if(!g)throw new Y(O.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const w=await this.connection.receive(t,g.ssrcs,String(e._uintid),g.attributes);(this.connection instanceof Ei||"name"in this.connection&&this.connection.name==="DataChannelConnection")&&(l=w.transceiver),a=w.track,d=w.id}else{const g=await this.connection.receive(t,[{ssrcId:n,rtx:r}],String(e._uintid),void 0);(this.connection instanceof Ei||"name"in this.connection&&this.connection.name==="DataChannelConnection")&&(l=g.transceiver),a=g.track,d=g.id}if(t===_e.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(a):(e._audioTrack=new Il(a,e.uid,e._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),l&&e._audioTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(a):(e._videoTrack=new Cl(a,e.uid,e._uintid,this.store,h),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId())),e._videoTrack.once(Li.PLAY_START,()=>{this.store.firstVideoFrameDecoded(e.uid,{playStart:Date.now()})}),e._videoTrack.once(Li.PLAY_END,()=>{this.store.firstVideoFrameDecoded(e.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(e)}),h?e._videoTrack.once(Li.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)}):e._videoTrack.once(Li.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)})),l&&e._videoTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(e,e._videoTrack)),l&&A("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:g,interceptRemoteAudioFrame:w}=Tm();t==_e.VIDEO?await g(l.receiver,{onSei:A("ENABLE_VIDEO_SEI")&&(R=>{var y;return(y=e._videoTrack)===null||y===void 0?void 0:y._onSei(R)}),onFirstFrame:R=>{var y;const b=Array.from(nr(y=this.remoteUserMap).call(y)).find(N=>N._videoSSRC===R.ssrc);b&&this.store.firstVideoFrameDecoded(b.uid,{firstReceivedEncodedFrame:Date.now(),frameType:R.type,rtpTimestamp:R.rtpTimestamp,framePayloadType:R.payloadType,frameDataLength:R.length,mimeType:R.mimeType})}}):t==_e.AUDIO&&await w(l.receiver,{enableTopn:!!A("ENABLE_AUDIO_TOPN"),enableMetadata:!!A("ENABLE_AUDIO_METADATA"),enablePts:!!A("ENABLE_AUDIO_PTS"),onMetadata:R=>{this.safeEmit(Ce.AudioMetadata,R)},onPts:R=>{this.safeEmit(Ce.AudioPts,R)}})}const _=this.remoteUserMap.get(e);_?_.set(t,d):this.remoteUserMap.set(e,new Map([[t,d]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const m=this.pendingRemoteTracks.findIndex(g=>{let{user:w,kind:R}=g;return w.uid===e.uid&&t===R});m!==-1&&(this.pendingRemoteTracks.splice(m,1),this.emit(Ce.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==dt.Connected)throw new Y(O.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(i=>{var s;let{user:a,mediaType:d}=i;return!((s=this.remoteUserMap.get(a))!==null&&s!==void 0&&s.has(d))});const t=[],n=new Map;e.forEach(i=>{if(!this.connection)return;const s=this.connection.getPreMedia(i.ssrcId);if(s){const{track:a,mid:d,transceiver:l,player:h}=s;n.set(i.ssrcId,{track:a,id:d,transceiver:l,player:h})}else t.push(i)});const r=await this.connection.batchReceive(t.map(i=>{let{user:s,mediaType:a,ssrcId:d,rtxSsrcId:l}=i;return{kind:a,ssrcMsg:[{ssrcId:d,rtx:l}],mslabel:String(s._uintid)}}));t.forEach((i,s)=>{n.set(i.ssrcId,r[s])});for(const{user:i,mediaType:s,ssrcId:a}of e){const d=n.get(a);if(!d)return void T.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(i.uid," subscribe data,").concat(s,", ").concat(a));const{track:l,id:h,transceiver:p,player:_}=d;if(p&&A("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:w,interceptRemoteAudioFrame:R}=Tm();s==_e.VIDEO?await w(p.receiver,{onSei:A("ENABLE_VIDEO_SEI")&&(y=>{var b;return(b=i._videoTrack)===null||b===void 0?void 0:b._onSei(y)}),onFirstFrame:y=>{var b;const N=Array.from(nr(b=this.remoteUserMap).call(b)).find(L=>L._videoSSRC===y.ssrc);N&&this.store.firstVideoFrameDecoded(N.uid,{firstReceivedEncodedFrame:Date.now(),frameType:y.type,rtpTimestamp:y.rtpTimestamp,framePayloadType:y.payloadType,frameDataLength:y.length,mimeType:y.mimeType})}}):s==_e.AUDIO&&await R(p.receiver,{enableTopn:!!A("ENABLE_AUDIO_TOPN"),enableMetadata:!!A("ENABLE_AUDIO_METADATA"),enablePts:!!A("ENABLE_AUDIO_PTS"),onMetadata:y=>{this.safeEmit(Ce.AudioMetadata,y)},onPts:y=>{this.safeEmit(Ce.AudioPts,y)}})}if(s===_e.AUDIO?(i._audioTrack?i._audioTrack._updateOriginMediaStreamTrack(l):(i._audioTrack=new Il(l,i.uid,i._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(i._audioTrack.getTrackId()))),p&&i._audioTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(i,i._audioTrack)):(i._videoTrack?i._videoTrack._updateOriginMediaStreamTrack(l):(i._videoTrack=new Cl(l,i.uid,i._uintid,this.store,_),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(i._videoTrack.getTrackId()))),p&&i._videoTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(i,i._videoTrack)),A("ENABLE_VIDEO_SEI")&&p){const{interceptRemoteVideoFrame:w,interceptRemoteAudioFrame:R}=Tm();s==_e.VIDEO?await w(p.receiver,{onSei:y=>{var b;(b=i._videoTrack)===null||b===void 0||b._onSei(y)},onFirstFrame:y=>{var b;const N=Array.from(nr(b=this.remoteUserMap).call(b)).find(L=>L._videoSSRC===y.ssrc);N&&this.store.firstVideoFrameDecoded(N.uid,{firstReceivedEncodedFrame:Date.now(),frameType:y.type,rtpTimestamp:y.rtpTimestamp,framePayloadType:y.payloadType,frameDataLength:y.length,mimeType:y.mimeType})}}):s==_e.AUDIO&&await R(p.receiver)}const m=this.remoteUserMap.get(i);m?m.set(s,h):this.remoteUserMap.set(i,new Map([[s,h]])),this.statsCollector.addRemoteStats(i.uid),this.statsUploader.startUploadInboundStats();const g=this.pendingRemoteTracks.findIndex(w=>{let{user:R,kind:y}=w;return R.uid===i.uid&&s===y});g!==-1&&(this.pendingRemoteTracks.splice(g,1),this.emit(Ce.MediaReconnectEnd,i.uid))}}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter(a=>{let{user:d,kind:l}=a;return t!==void 0?d.uid===e.uid&&t===l:d.uid===e.uid});if(r.forEach(a=>{const d=this.pendingRemoteTracks.indexOf(a);this.pendingRemoteTracks.splice(d,1)}),this.connection&&this.state===dt.Connected||n||r.forEach(a=>{let{kind:d}=a;var l;if(d===_e.AUDIO)(l=e._audioTrack)===null||l===void 0||l._destroy(),e._audioTrack=void 0;else if(d===_e.VIDEO){var h;(h=e._videoTrack)===null||h===void 0||h._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==dt.Connected)return;const i=this.filterTobeUnSubscribedTracks(e,t);if(i.length===0)return;await this.connection.stopReceiving(i.map(a=>{let[,{id:d}]=a;return d}));const s=this.createUnsubscribeMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(a=>{let[d,{kind:l}]=a;var h,p;if(l===_e.VIDEO&&d._videoSSRC&&((h=this.connection)===null||h===void 0||h.setStatsRemoteVideoIsReady(d._videoSSRC,!1)),l===_e.VIDEO)this.unbindRemoteTrackEvents(d._videoTrack),n||((p=d._videoTrack)===null||p===void 0||p._destroy(),d._videoTrack=void 0);else if(l===_e.AUDIO){var _;this.unbindRemoteTrackEvents(d._audioTrack),!n&&((_=d._audioTrack)===null||_===void 0||_._destroy(),d._audioTrack=void 0)}}),s}async unsubscribeDataChannel(e,t){if(t.forEach(i=>{const s=this.pendingRemoteDataChannels.findIndex(a=>a.id===i.id);s!==-1&&this.pendingRemoteDataChannels.splice(s,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(e,t);if(n.length===0)return;t.forEach(i=>{i._close()});const r=this.remoteDataChannelMap.get(e);return n.forEach(i=>{r&&r.delete(i.id)}),r&&r.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),n.map(i=>i.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:i,mediaType:s}of e){const a=this.pendingRemoteTracks.filter(d=>{let{user:l,kind:h}=d;return s!==void 0?l.uid===i.uid&&s===h:l.uid===i.uid});a.forEach(d=>{const l=this.pendingRemoteTracks.indexOf(d);this.pendingRemoteTracks.splice(l,1)}),t=t.concat(a)}if(!this.connection||this.state!==dt.Connected)return void t.forEach(i=>{let{user:s,kind:a}=i;var d;if(a===_e.AUDIO)(d=s._audioTrack)===null||d===void 0||d._destroy(),s._audioTrack=void 0;else if(a===_e.VIDEO){var l;(l=s._videoTrack)===null||l===void 0||l._destroy(),s._videoTrack=void 0}});const n=Oi(e).call(e,(i,s)=>{let{user:a,mediaType:d}=s;const l=this.filterTobeUnSubscribedTracks(a,d);return i.concat(l)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(i=>{let[,{id:s}]=i;return s}));const r=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(i=>{let[s,{kind:a}]=i;var d,l;if(a===_e.VIDEO&&s._videoSSRC&&((d=this.connection)===null||d===void 0||d.setStatsRemoteVideoIsReady(s._videoSSRC,!1)),a===_e.VIDEO)this.unbindRemoteTrackEvents(s._videoTrack),(l=s._videoTrack)===null||l===void 0||l._destroy(),s._videoTrack=void 0;else if(a===_e.AUDIO){var h;this.unbindRemoteTrackEvents(s._audioTrack),(h=s._audioTrack)===null||h===void 0||h._destroy(),s._audioTrack=void 0}}),r}isPreSubScribe(e){return!this.connection||this.state!==dt.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void T.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void T.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===_e.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.connection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void T.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||T.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){const t=this.localTrackMap.get(ne.LocalAudioTrack),n=t&&t.track;n&&n.metadata.push(e)}getAllTracks(e){const t=this.localTrackMap.get(ne.LocalAudioTrack);if((t==null?void 0:t.track)instanceof fn){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[i]=r;return i!==ne.LocalAudioTrack}).filter(r=>{let[i]=r;return!(e&&i===ne.LocalVideoLowTrack)}).map(r=>{let[,{track:i}]=r;return i}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[r]=n;return!(e&&r===ne.LocalVideoLowTrack)}).map(n=>{let[,{track:r}]=n;return r})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,r,i){if(e){const a=this.localTrackMap.get(ne.LocalAudioTrack),d=r?this.localTrackMap.get(ne.LocalVideoLowTrack):this.localTrackMap.get(ne.LocalVideoTrack);Se.publish(this.store.sessionId,{eventElapse:Xn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:a==null?void 0:a.track.getTrackLabel(),videoName:d==null?void 0:d.track.getTrackLabel(),screenshare:(d==null?void 0:d.track._hints.indexOf(lt.SCREEN_TRACK))!==-1,audio:!!a,video:!!d,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var s;n||(n=[]);const a=n.find(l=>l instanceof Xt),d=r?(s=this.localTrackMap.get(ne.LocalVideoTrack))===null||s===void 0?void 0:s.track:n.find(l=>l instanceof Ct);Se.publish(this.store.sessionId,{eventElapse:Xn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:a==null?void 0:a.getTrackLabel(),videoName:d==null?void 0:d.getTrackLabel(),screenshare:(d==null?void 0:d._hints.indexOf(lt.SCREEN_TRACK))!==-1,audio:!!a,video:!!d,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){const i=r===_e.VIDEO?n._videoSSRC:n._audioSSRC;i&&Se.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===_e.VIDEO,audio:r===_e.AUDIO,peerid:n.uid,subscribeRequestid:i,p2pid:this.store.p2pId,eventElapse:Xn.measureFromSubscribeStart(this.store.clientId,i),preSsrc:this.isPreSubScribe(i)})}reset(){T.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new bn("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=xh(this.store),this.emit(Ce.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(ne.LocalAudioTrack);if((e==null?void 0:e.track)instanceof fn){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=dt.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(ne.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(ne.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof Ct||t&&t.track instanceof Xt?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(nr(t=this.remoteUserMap).call(t)).find(r=>r.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[r]=n;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(ne.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Ec(e).call(e,(n,r)=>n.level-r.level),e}async disconnectForReconnect(){this.connection&&(T.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=dt.Reconnecting,A("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=xh(this.store),this.emit(Ce.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:r}]=e;switch(n){case ne.LocalVideoTrack:te(t=r._hints).call(t,lt.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case ne.LocalAudioTrack:r instanceof fn?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case ne.LocalVideoLowTrack:}}),this.emit(Ce.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(nr(n).call(n)).forEach(r=>{this.setPendingRemoteMedia(t,r)}),this.emit(Ce.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,n]=e;Array.from(nr(n).call(n)).forEach(r=>{this.setPendingRemoteDataChannel(t,r)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),T.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const n of this.pendingRemoteDataChannels){const{user:r,id:i}=n;if((e instanceof Oa?e.uid:e)===r.uid&&i===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((e instanceof Oa?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return yr(function*(){if(!t.connection||t.state!==dt.Connected)return;const n=yield He(t.mutex.lock("From P2PChannel.restartICE"));let r;try{r=yield He(t.connection.restartICE(e));const s=yield He(r.next());if(s.done)return;const a=s.value,d=yield a;switch(my(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case On.UDP_TCP_RELAY:t._pcStatsUploadType=Gs.UDP_TCP_RESTART;break;case On.TCP_RELAY:t._pcStatsUploadType=Gs.TCP_RESTART;break;case On.RELAY:t._pcStatsUploadType=Gs.RELAY_RESTART;break;default:t._pcStatsUploadType=Gs.OLD_RESTART}t._isTryConnecting=!0,r.next(d)}catch(s){var i;(i=r)===null||i===void 0||i.throw(s)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(ne.LocalVideoTrack),n=this.localTrackMap.get(ne.LocalAudioTrack),r=e.videoSend.find(g=>g.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),i=e.audioSend.find(g=>g.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId));if(!r||!i)return 1;const s=Zr(this,Ce.NeedSignalRTT),a=r?r.rttMs:void 0,d=i?i.rttMs:void 0,l=a&&d?(a+d)/2:a||d,h=(l&&s?(l+s)/2:l||s)||0,p=100*e.sendPacketLossRate*.7/50+.3*h/1500,_=p<.17?1:p<.36?2:p<.59?3:p<.1?4:5,m=t==null?void 0:t.track;if(m&&m._encoderConfig&&m._hints.indexOf(lt.SCREEN_TRACK)===-1){const g=m._encoderConfig.bitrateMax,w=e.bitrate.actualEncoded;if(g&&w){const R=(1e3*g-w)/(1e3*g);return dM[R<.15?0:R<.3?1:R<.45?2:R<.6?3:4][_]}}return _}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r]=n;const i=r._audioSSRC,s=r._videoSSRC,a=e.audioRecv.find(w=>w.ssrc===i),d=e.videoRecv.find(w=>w.ssrc===s);if(!a&&!d)return void(t+=1);const l=Zr(this,Ce.NeedSignalRTT),h=e.rtt,p=(h&&l?(h+l)/2:h||l)||0,_=a?a.jitterMs:void 0,m=e.recvPacketLossRate;let g=.7*m*100/50+.3*p/1500;_&&(g=.6*m*100/50+.2*p/1500+.2*_/400),t+=g<.1?1:g<.17?2:g<.36?3:g<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new ae((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}async replaceTrack(e,t){var n;if(T.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==dt.Connected)return;const r=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:a}]=s;return e===a});if(!r)return;const i=r[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:i}]),this.bindLocalTrackEvents([{track:t,type:i}]),r[1].track=t),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(t,r[1].id)),this.isPlanB){const s=r[1];s.id=t._mediaStreamTrack.id,this.localTrackMap.set(i,s)}if(i===ne.LocalVideoTrack&&!A("DISABLE_DUAL_STREAM_USE_ENCODING")&&qe().supportDualStreamEncoding){const s=this.localTrackMap.get(ne.LocalVideoLowTrack);if(s){const a=e._mediaStreamTrack.clone();s.track._originMediaStreamTrack.stop(),s.track._mediaStreamTrack=a,s.track._originMediaStreamTrack=a,await new ae((d,l)=>{this.handleReplaceTrack(s.track,d,l,!0)})}}}filterTobePublishedTracks(e,t,n){const r=[],i=this.getAllTracks();e=ul(e=e.filter(l=>i.indexOf(l)===-1));let s,a=!1;const d=this.localTrackMap.get(ne.LocalAudioTrack);for(const l of e){if(l instanceof Ct&&(this.localTrackMap.has(ne.LocalVideoTrack)||a?new Y(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:l,type:ne.LocalVideoTrack}),a=!0),t)){const h=this.getLowVideoTrack(l,n);r.push({track:h,type:ne.LocalVideoLowTrack})}if(l instanceof Xt)if(d){const h=d.track;if(h instanceof fn)fy([l]),h.addAudioTrack(l),this.bindLocalAudioTrackEvents(l,!0);else{const p=_y([h,l]);T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(p.getTrackId(),"]")),this.replaceTrack(h,p)}}else s instanceof fn?(fy([l]),s.addAudioTrack(l)):s||!l._useAudioElement&&qe().webAudioMediaStreamDest&&!l._bypassWebAudio?s=_y(s?[l,s]:[l]):s=l}return s&&(T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(s.getTrackId(),"]")),r.push({track:s,type:ne.LocalAudioTrack})),r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=ul(e=e.filter(r=>n.indexOf(r)!==-1));for(const r of e){if(r instanceof Xt){const i=this.localTrackMap.get(ne.LocalAudioTrack);if(!i)continue;i.track instanceof fn?(i.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),i.track.trackList.length===0&&(t.push([ne.LocalAudioTrack,i]),i.track.close())):t.push([ne.LocalAudioTrack,i])}if(r instanceof Ct){const i=this.localTrackMap.get(ne.LocalVideoTrack);if(!i)continue;t.push([ne.LocalVideoTrack,i]);const s=this.localTrackMap.get(ne.LocalVideoLowTrack);s&&t.push([ne.LocalVideoLowTrack,s])}}return t}filterTobePublishedDataChannels(e){return e=(e=ul(e)).filter(t=>this.localDataChannels.findIndex(n=>n.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=ul(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:r}=t;switch(r){case ne.LocalVideoTrack:n.addListener(Te.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Te.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(Te.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Te.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Te.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Te.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Te.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Te.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Te.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ne.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case ne.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof fn?e.trackList.forEach(n=>{n.addListener(Te.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Te.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Te.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Te.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Te.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Te.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Te.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Te.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Te.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Te.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(Te.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(Te.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:r}]=t;return{track:r,type:n}})),e.forEach(t=>{let{track:n,type:r}=t;switch(r){case ne.LocalVideoTrack:n.off(Te.GET_STATS,this.handleGetLocalVideoStats),n.off(Te.GET_RTC_STATS,this.handleGetRTCStats),n.off(Te.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Te.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Te.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Te.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Te.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Te.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Te.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ne.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case ne.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof fn?e.trackList.forEach(t=>{t.off(Te.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Te.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Te.GET_STATS,this.handleGetLocalAudioStats),t.off(Te.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Te.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Te.GET_STATS,this.handleGetLocalAudioStats),e.off(Te.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Te.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Te.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Te.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(Te.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Te.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Cl&&t.addListener(Te.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof Il&&t.addListener(Te.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Te.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(_e.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(_e.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,r)=>{var i;let s,a,{track:d,type:l}=n;switch(l){case ne.LocalAudioTrack:s=ft.Audio,a={dtx:d instanceof Ih&&d._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case ne.LocalVideoTrack:s=te(i=d._hints).call(i,lt.SCREEN_TRACK)?ft.Screen:ft.High,a=ms(ms({},CM(d)),{},{codec:this.store.codec,svc_mode:Oh()});break;case ne.LocalVideoLowTrack:s=ft.Low,a=ms(ms({},CM(d)),{},{codec:this.store.codec,svc_mode:Oh()})}return{stream_type:s,attributes:a,ssrcs:t[r]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let r,[i,{track:s,ssrcs:a,id:d}]=t;switch(i){case ne.LocalVideoTrack:r=te(n=s._hints).call(n,lt.SCREEN_TRACK)?ft.Screen:ft.High;break;case ne.LocalAudioTrack:r=ft.Audio;break;case ne.LocalVideoLowTrack:r=ft.Low}return{stream_type:r,ssrcs:a,mid:d}})}assignLocalTracks(e,t){e.forEach((n,r)=>{let{track:i,type:s}=n;this.localTrackMap.set(s,{track:i,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(Ce.PeerConnectionStateChange,t),t==="connecting"&&e instanceof Ei&&!Nt()&&A("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{t==="connecting"&&e.extendCandidate()},A("FIRST_TCP_CANDIDATE_INTERVAL")),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof Ei&&TU(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=Gs.DISCONNECTED_OR_FAILED,Zr(this,Ce.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const n=this.pendingLocalTracks.map(i=>i.getTrackId()),r=this.pendingLocalDataChannels.map(i=>"dc_".concat(i.id));Se.reportApiInvoke(this.store.sessionId,{name:kt.REPUB_AFTER_PC_CONNECTED,options:n.concat(r),tag:yt.TRACER}).onSuccess(),this.republish()}if(A("NEW_ICE_RESTART")&&e instanceof Ei&&!Nt()&&!this._forceTurn&&!this.store.useDcSignal){if(te(gM).call(gM,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const n=i=>{my(e)&&(T.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(i)),Zr(this,Ce.QueryClientConnectionState)==="CONNECTED"&&this.emit(Ce.RequestRestartICE,i))},r=()=>{my(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),T.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Ce.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{vU(e,n,r)},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&A("ICE_RESTART")&&Zr(this,Ce.QueryClientConnectionState)==="CONNECTED"&&this.emit(Ce.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Ce.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Ce.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),Se.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:yt.TRACER}).onSuccess(),this.emit(Ce.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const r=Array.from(nr(n=this.remoteUserMap).call(n)).find(s=>s._audioSSRC===t);var i;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(i=r.audioTrack)===null||i===void 0||i.emit(Li.FIRST_FRAME_DECODED),Se.firstRemoteFrame(this.store.sessionId,pn.FIRST_AUDIO_DECODE,Mt.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:Xn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const r=Array.from(nr(n=this.remoteUserMap).call(n)).find(i=>i._audioSSRC===t);r&&Se.firstRemoteFrame(this.store.sessionId,pn.FIRST_AUDIO_RECEIVED,Mt.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:Xn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,r)=>{var i;const s=Array.from(nr(i=this.remoteUserMap).call(i)).find(a=>a._videoSSRC===t);s&&this.store.firstVideoFrameDecoded(s.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(t,n,r)},e.onFirstVideoRender=t=>{var n;const r=Array.from(nr(n=this.remoteUserMap).call(n)).find(i=>i._videoSSRC===t);r&&(this.store.firstVideoFrameDecoded(r.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(r),this.emit(Ce.FirstVideoPreRender,r.uid,t))},e.onFirstVideoReceived=t=>{var n;const r=Array.from(nr(n=this.remoteUserMap).call(n)).find(i=>i._videoSSRC===t);r&&(this.store.firstVideoFrameDecoded(r.uid,{firstReceived:Date.now()}),Se.firstRemoteFrame(this.store.sessionId,pn.FIRST_VIDEO_RECEIVED,Mt.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:Xn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstVideoBufferReady=t=>{var n;const r=Array.from(nr(n=this.remoteUserMap).call(n)).find(i=>i._videoSSRC===t);r&&this.emit(Ce.FirstVideoBufferReady,r.uid,t)},e.onSelectedLocalCandidateChanged=(t,n)=>{const r=t.candidateType==="relay",i=n.candidateType==="relay";n.candidateType!=="unknown"&&r===i||this.emit(Ce.ConnectionTypeChange,r),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Aa(n))," -> ").concat(JSON.stringify(Aa(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Aa(n))," -> ").concat(JSON.stringify(Aa(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const t=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return ms(ms({},t),n)},e.onICECandidateError=t=>{this._iceError=t}}fallbackConnection(){T.debug("[".concat(this.store.clientId,"] [P2PChannel] try to fallback connection")),this.state===dt.Connected?(T.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&this.resetConnection(this.connection),this.shouldForwardP2PCreation&&(this.connection=xh(this.store),this.emit(Ce.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)))}resetConnection(e){e instanceof Ei&&function(t){Fl.delete(t.id),TU(t)}(e),e.close(),this.emit(Ce.PeerConnectionStateChange,"closed"),function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(ne.LocalAudioTrack);if(e instanceof Xt&&(n==null?void 0:n.track)instanceof fn)return n.track.isActive||t.push([ne.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:s}]=i;return e===s});if(r&&(t.push(r),r[0]===ne.LocalVideoTrack)){const i=this.localTrackMap.get(ne.LocalVideoLowTrack);i&&t.push([ne.LocalVideoLowTrack,i])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(ne.LocalAudioTrack);if(e instanceof Xt&&(n==null?void 0:n.track)instanceof fn)return n.track.isActive&&t.push([ne.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:s}]=i;return e===s});if(r)if(r[0]===ne.LocalVideoTrack){t.push(r);const i=this.localTrackMap.get(ne.LocalVideoLowTrack);i&&t.push([ne.LocalVideoLowTrack,i])}else t.push(r);return t}createMuteMessage(e){return e.map(t=>{var n;let r,[i,{track:s,ssrcs:a,id:d}]=t;switch(i){case ne.LocalAudioTrack:r=ft.Audio;break;case ne.LocalVideoTrack:r=te(n=s._hints).call(n,lt.SCREEN_TRACK)?ft.Screen:ft.High;break;case ne.LocalVideoLowTrack:r=ft.Low}return{stream_type:r,ssrcs:a,mid:d}})}createUnmuteMessage(e){return e.map(t=>{var n;let r,[i,{track:s,ssrcs:a,id:d}]=t;switch(i){case ne.LocalAudioTrack:r=ft.Audio;break;case ne.LocalVideoTrack:r=te(n=s._hints).call(n,lt.SCREEN_TRACK)?ft.Screen:ft.High;break;case ne.LocalVideoLowTrack:r=ft.Low}return{stream_type:r,ssrcs:a,mid:d}})}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach(i=>{let[s,a]=i;n.push([e,{kind:s,id:a}])});return n}filterTobeUnSubscribedDataChannels(e,t){const n=[];return t.forEach(r=>{var i;(i=this.remoteDataChannelMap.get(e))!==null&&i!==void 0&&i.has(r.id)&&n.push(r)}),n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[r,{kind:i,id:s}]=n;switch(i){case _e.VIDEO:return void(r._videoSSRC&&t.push({stream_type:_e.VIDEO,ssrcId:r._videoSSRC}));case _e.AUDIO:return void(r._audioSSRC&&t.push({stream_type:_e.AUDIO,ssrcId:r._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(n=>{let[r,{kind:i}]=n;if(t.has(r)){let s=t.get(r);i===_e.VIDEO?s|=Rn.Video:s|=Rn.Audio,t.set(r,s)}else i===_e.VIDEO?t.set(r,Rn.Video):t.set(r,Rn.Audio)}),{users:Array.from(t.entries()).map(n=>{let[r,i]=n;return{stream_id:r.uid,stream_type:i}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:r}]=t;const i=this.remoteUserMap.get(n);i&&(i.delete(r),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(ne.LocalVideoTrack),n=this.localTrackMap.get(ne.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new ae((r,i)=>{this.handleUpdateVideoEncoder(t.track,r,i,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new ae((r,i)=>{this.handleUpdateVideoEncoder(n.track,r,i,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return!(!this.connection||!("name"in this.connection)||this.connection.name!=="DataChannelConnection"||this.connection.peerConnectionState==="closed")||this.connection instanceof Ei&&this.connection.isPreallocation}isPreSub(){return(this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"&&this.connection.peerConnectionState!=="closed"||this.connection instanceof Ei)&&this.connection.isPreSub()}isPreRender(){return this.connection instanceof Ei&&this.connection.isPreRender}mapPubResToRemoteConfig(e,t,n){return e.map((r,i)=>{var s;let{stream_type:a}=r;const d=(s=t.find(l=>{let{stream_type:h}=l;return a===h}))===null||s===void 0?void 0:s.attributes;if(d&&A("DISABLE_SCREEN_SHARE_REMB")){const l=n[i]._hints;(te(l).call(l,lt.SCREEN_TRACK)||te(l).call(l,lt.SCREEN_LOW_TRACK))&&(d.remb=!1,T.debug("disable remb for screen share, hints:",l))}return d})}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof Xt){var t;const r=this.filterTobeUnmutedTracks(e[n]);if(r.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(r.map(s=>{let[,{id:a}]=s;return a})));const i=this.createUnmuteMessage(r);return void await wt(this,Ce.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Ce.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Ce.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Tn(U_(this.dtlsFailedCount,nn)),this.emit(Ce.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await dn(this,Ce.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(Ce.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(ne.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Ct)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof Ct).length>1)throw new Y(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Xt).length>1&&(e.some(t=>t instanceof Xt&&t._bypassWebAudio)||!qe().webAudioMediaStreamDest))throw new Y(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof Ct&&this.pendingLocalTracks.some(n=>n instanceof Ct))throw new Y(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Xt&&this.pendingLocalTracks.some(n=>n instanceof Xt)&&(!qe().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof Xt&&n._bypassWebAudio)))throw new Y(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var n;const r=!A("DISABLE_DUAL_STREAM_USE_ENCODING")&&qe().supportDualStreamEncoding,i=ms(ms({},{width:160,height:120,framerate:15,bitrate:50}),t);let s;s=r?e._mediaStreamTrack.clone():gy(e,i);const a=ht(8,"track-low-"),d=new Ct(s,ms(ms({},r&&{scaleResolutionDownBy:qR(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,a);return d.on(Uc.TRANSCEIVER_UPDATED,l=>{e._updateRtpTransceiver(l,gl.LOW_STREAM)}),d._hints.push(lt.LOW_STREAM),te(n=e._hints).call(n,lt.SCREEN_TRACK)&&d._hints.push(lt.SCREEN_LOW_TRACK),e.on("sei-to-send",l=>{d.emit("sei-to-send",l)}),e.addListener(Te.NEED_CLOSE,()=>{d.close()}),d}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Ei){var i,s,a,d;const l=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:h,dtlsTransportState:p,peerConnectionState:_}=this.connection,{local:m,remote:g}=await this.connection.getSelectedCandidatePair();Se.pcStats(this.store.sessionId,{startTime:l,eventElapse:e-l||0,iceconnectionsate:h,dtlsstate:p,connectionstate:_,intSucc:t?1:2,error:this._iceError||r||"",selectedLocalCandidateProtocol:(i=m==null?void 0:m.protocol)!==null&&i!==void 0?i:"",selectedLocalCandidateType:(s=m.candidateType)!==null&&s!==void 0?s:"",selectedLocalCandidateAddress:"".concat(m.address,":").concat(m.port),selectedRemoteCandidateProtocol:(a=g.protocol)!==null&&a!==void 0?a:"",selectedRemoteCandidateType:(d=g.candidateType)!==null&&d!==void 0?d:"",selectedRemoteCandidateAddress:"".concat(g.address,":").concat(g.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(e){const t=this.store.keyMetrics,n=t.firstVideoFrameDecoded.find(p=>p.userId===e.uid);if(!n)return;const{isInternalUpload:r,isExternalUpload:i}=n;if(r&&i)return;const{subscribeEnd:s,firstPreRender:a,peerPublishDuration:d,peerPubStatusMs:l}=n;let{firstRender:h=0}=n;if(s&&(h||a)&&d&&l){n.isInternalUpload=!0;const{playEnd:p}=n;p&&(n.isExternalUpload=!0);const{firstPreRender:_=0}=n;h=_||h;const m=e.videoTrack,g={peer:e._uintid,width:(m==null?void 0:m._videoWidth)||0,height:(m==null?void 0:m._videoHeight)||0,ssrc:e._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:d,peerPubStatusMs:l,joinChannelStart:t.joinStart||0,preloadStart:t.preloadStart||0,preloadEnd:t.preloadEnd||0,apStart:t.requestAPStart||0,apEnd:t.requestAPEnd||0,suaEnd:t.requestSUAEnd||0,beforeConnect:t.beforeConnect||0,peerReceiver:t.peerReceiver||0,ice:t.iceConnectionEnd||0,pc:t.peerConnectionEnd||0,signalConnected:t.signalConnected||0,joinReq:t.joinReq||0,joinRes:t.joinRep||0,userJoinNotify:n.userJoinNotify||0,videoAddNotify:n.videoAddNotify||0,subscribeStart:n.subscribeStart||0,subscribeEnd:n.subscribeEnd||0,firstReceived:n.firstReceived||0,firstDecoded:n.firstDecoded||0,firstPreRender:_||0,firstRender:p?Math.max(h,p):Math.max(h,s),playStart:n.playStart||0,playEnd:n.playEnd||0,isPreSub:!(!e._videoSSRC||!this.isPreSubScribe(e._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:HL(this.store),firstReceivedEncodedFrame:n.firstReceivedEncodedFrame||0,frameType:n.frameType||"",rtpTimestamp:n.rtpTimestamp||0,framePayloadType:n.framePayloadType||0,frameDataLength:n.frameDataLength||0,mimeType:n.mimeType||""};Se.firstXLAPeerFirstVideoFrame(this.store.sessionId,g)}}reportVideoFirstFrameDecoded(e,t,n,r){var i;const s=Array.from(nr(i=this.remoteUserMap).call(i)).find(a=>a._videoSSRC===e);if(s){r||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const a=this.store.keyMetrics,d=a.subscribe.find(l=>l.userId===s.uid&&l.type==="video");Se.firstRemoteVideoDecode(this.store.sessionId,pn.FIRST_VIDEO_DECODE,Mt.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:t,videoheight:n,subscribeElapse:Xn.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:a.requestAPEnd||0,apStart:a.requestAPStart||0,joinGwEnd:a.joinGatewayEnd||0,joinGwStart:a.joinGatewayStart||0,pcEnd:a.peerConnectionEnd||0,pcStart:a.peerConnectionStart||0,subscriberEnd:(d==null?void 0:d.subscribeEnd)||0,subscriberStart:(d==null?void 0:d.subscribeStart)||0,videoAddNotify:(d==null?void 0:d.streamAdded)||0,state:r?1:0,firstFrame:(d==null?void 0:d.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const s=await this.connection.getRemoteSSRC(i);return s!==void 0&&s!==n}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===ne.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,gl.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},ce(Je.prototype,"startP2PConnection",[sr],Object.getOwnPropertyDescriptor(Je.prototype,"startP2PConnection"),Je.prototype),ce(Je.prototype,"connect",[sr],Object.getOwnPropertyDescriptor(Je.prototype,"connect"),Je.prototype),ce(Je.prototype,"updateRemoteRTPCapabilities",[sr],Object.getOwnPropertyDescriptor(Je.prototype,"updateRemoteRTPCapabilities"),Je.prototype),ce(Je.prototype,"publishDataChannel",[sr],Object.getOwnPropertyDescriptor(Je.prototype,"publishDataChannel"),Je.prototype),ce(Je.prototype,"unpublish",[sr],Object.getOwnPropertyDescriptor(Je.prototype,"unpublish"),Je.prototype),ce(Je.prototype,"unpublishDataChannel",[sr],Object.getOwnPropertyDescriptor(Je.prototype,"unpublishDataChannel"),Je.prototype),ce(Je.prototype,"unpublishLowStream",[sr],Object.getOwnPropertyDescriptor(Je.prototype,"unpublishLowStream"),Je.prototype),ce(Je.prototype,"subscribeDataChannel",[sr],Object.getOwnPropertyDescriptor(Je.prototype,"subscribeDataChannel"),Je.prototype),ce(Je.prototype,"subscribe",[sr],Object.getOwnPropertyDescriptor(Je.prototype,"subscribe"),Je.prototype),ce(Je.prototype,"massSubscribe",[sr],Object.getOwnPropertyDescriptor(Je.prototype,"massSubscribe"),Je.prototype),ce(Je.prototype,"unsubscribe",[sr],Object.getOwnPropertyDescriptor(Je.prototype,"unsubscribe"),Je.prototype),ce(Je.prototype,"unsubscribeDataChannel",[sr],Object.getOwnPropertyDescriptor(Je.prototype,"unsubscribeDataChannel"),Je.prototype),ce(Je.prototype,"massUnsubscribe",[sr],Object.getOwnPropertyDescriptor(Je.prototype,"massUnsubscribe"),Je.prototype),ce(Je.prototype,"muteRemote",[sr],Object.getOwnPropertyDescriptor(Je.prototype,"muteRemote"),Je.prototype),ce(Je.prototype,"unmuteRemote",[sr],Object.getOwnPropertyDescriptor(Je.prototype,"unmuteRemote"),Je.prototype),ce(Je.prototype,"hasRemoteMediaWithLock",[sr],Object.getOwnPropertyDescriptor(Je.prototype,"hasRemoteMediaWithLock"),Je.prototype),ce(Je.prototype,"disconnectForReconnect",[sr],Object.getOwnPropertyDescriptor(Je.prototype,"disconnectForReconnect"),Je.prototype),ce(Je.prototype,"updateBitrateLimit",[sr],Object.getOwnPropertyDescriptor(Je.prototype,"updateBitrateLimit"),Je.prototype),ce(Je.prototype,"remoteMediaSsrcChanged",[sr],Object.getOwnPropertyDescriptor(Je.prototype,"remoteMediaSsrcChanged"),Je.prototype),Je);function sr(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("From P2PChannel.".concat(t));try{for(var a=arguments.length,d=new Array(a),l=0;l<a;l++)d[l]=arguments[l];return await r.apply(this,d)}finally{s()}},n}function CU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function IU(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?CU(Object(n),!0).forEach(function(r){I(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):CU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const QQ=Date.now(),ZQ=20,vy=new Map,Pm=new Map;async function wU(e){const t=vy.get(e),n=Array.isArray(t)&&t[t.length-1],r=Pm.get(e);if(!n)return void(r.isSyncing=!1);const i={uid:n.uid,payload:n.payload};r.firstRecvTs===0&&(r.firstRecvTs=n.recvTs,r.firstSendTs=n.sendTs);const s=n.sendTs-r.firstSendTs,a=s-(Date.now()-r.firstRecvTs);a>0&&(r.firstRecvTs=Date.now()-s);let d=n.mediaDelay+a;d<=0?(t.pop(),AU(n.context,i),d=0):d=Math.min(d,ZQ),setTimeout(()=>t.length&&wU(e),d)}function AU(e,t){e.safeEmit(Ye.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function $Q(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return AU(n,{uid:e.uid,payload:e.payload});const r="".concat(n.id,"-").concat(e.uid),i=vy.get(r)||[],s=i.findIndex(h=>e.sendTs>=h.sendTs),a=IU(IU({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});s===-1?i.push(a):i.splice(s,0,a),vy.set(r,i);let d=!1;var l;Pm.has(r)?d=!((l=Pm.get(r))===null||l===void 0||!l.isSyncing):Pm.set(r,{isSyncing:d,firstRecvTs:0,firstSendTs:0}),d||wU(r)}const eZ=rt().name;function bU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function OU(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?bU(Object(n),!0).forEach(function(r){I(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const Bl="websdk_ng_cache_parameter",tZ=A("MAX_PRELOAD_ASYNC_LENGTH"),nZ=1e4,Xc=new Map,Jc=[];let Ry=null,yy=0,Cy=0;const Lm=new Map,NU=new Uint8Array([241,141,127,212,103,139,200,225,251,157,127,139,143,2,22,163]),rZ=function(e,t){const n=[];let r=0;const i=async()=>{const s=n.shift();s&&await s(),n.length>0&&r<t?i():r--};return async function(){for(var s=arguments.length,a=new Array(s),d=0;d<s;d++)a[d]=arguments[d];return new ae(async(l,h)=>{n.push(async()=>{try{const p=await e(...a);l(p)}catch(p){h(p)}}),r<t&&(r++,i())})}}(wy,tZ),Iy=Cr.CancelToken.source();class iZ{constructor(){I(this,"_audioContext",null)}createMuteAudioTrack(){this._audioContext=new AudioContext;const t=this._audioContext.sampleRate,n=10*t,r=this._audioContext.createBuffer(2,n,t),i=this._audioContext.createBufferSource();i.buffer=r;const s=this._audioContext.createMediaStreamDestination();return i.connect(s),i.start(),s.stream.getAudioTracks()[0]}close(){this._audioContext&&(this._audioContext.close(),this._audioContext=null)}}async function wy(e,t,n,r,i,s,a){try{if(!A("ENABLE_PRELOAD"))return;if(!qe().supportWebCrypto)return void va(()=>{T.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new Y(O.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Mn(n,"token",1,2047),Mn(e,"appid",1,2047),cm(t),r&&dm(r);const d=Pc();T.debug("preload channel ".concat(t,", uid is ").concat(r));const l={appId:e,cname:t,token:n||e,uid:typeof r!="string"?r:null,sid:d,proxyServer:i,role:a};let h,p;typeof r=="string"?(l.stringUid=r,[p,h]=await ae.all([FQ(r,{sid:d,appId:e},Iy.token),eU(OU(OU({},l),{},{token:n||e,uid:0}),Iy.token)]),l.uid=p.uid,h.gatewayInfo.uid=l.uid,h.gatewayInfo.res.uid=l.uid):(s&&(l.stringUid=s),h=await eU(l,Iy.token));const _={sid:d,appId:e,cname:t,token:n||e,uid:l.stringUid||r,intUid:l.uid||h.gatewayInfo.uid,stringUid:l.stringUid,ts:Date.now(),sua:p,ap:h};await by(_),yy++}catch(d){throw Cy++,function(l){Ry||(Ry=window.setTimeout(()=>{let p="";Lm.forEach((_,m)=>{p+="".concat(m,": ").concat(_," ;")}),Se.reportApiInvoke(null,{name:kt.PRELOAD,options:{success:yy,failed:Cy,err:p}}).onError(l),yy=0,Cy=0,Lm.clear(),Ry=null},nZ));const h=Lm.get(l.code)||0;Lm.set(l.code,h+1)}(d),d}}async function Ay(e){try{if(A("AP_REQUEST_DETAIL")||A("ENABLE_ROLE_SELECT_EDGE"))return;const t=DU(e);if(!t||e.cloudProxyServer!=="disabled")return;const n=await async function(r,i){try{const s=await window.crypto.subtle.importKey("raw",gL(i),"AES-GCM",!1,["decrypt"]),a=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:NU},s,Dc(r));return JSON.parse(window.atob(Ra(new Uint8Array(a))))}catch{return}}(t,e.token||e.appId);if(!n||!function(r,i){return r.cname===i.cname&&r.appId===i.appId&&r.token===i.token?i.stringUid?r.stringUid===i.stringUid:typeof i.uid=="number"?r.uid===i.uid:r.uid==i.uid:!1}(n,e))return;if(n&&Date.now()-n.ts<A("AP_CACHE_LIFETIME"))return n}catch(t){T.warn("Error get preloadInfo",t.message)}}function DU(e){let t;try{if(t=kU(Bl),!t)return;const n=JSON.parse(t),r=MU(e),i=function(a,d){for(let l=a.length-1;l>=0;l--)if(d(a[l]))return l;return-1}(n,a=>r in a);if(i===-1)return;const s=n.splice(i,1)[0];return km(Bl,JSON.stringify(n)),s[r]}catch(n){T.warn("Error delete preload info: ".concat(t),n.message),km(Bl,"")}}async function by(e){let t;try{e.uid&&DU({appId:e.appId,cname:e.cname,token:e.token,uid:e.uid,stringUid:e.stringUid});const n=MU(e),r=await async function(s,a){try{const d=await window.crypto.subtle.importKey("raw",gL(a),"AES-GCM",!1,["encrypt"]),l=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:NU},d,Dc(window.btoa(JSON.stringify(s))));return Ra(new Uint8Array(l))}catch{return}}(e,e.token||e.appId);if(!r)return;t=kU(Bl);const i=t?JSON.parse(t):[];i.push({[n]:r}),i.length>A("AP_CACHE_NUM")&&i.shift(),km(Bl,JSON.stringify(i))}catch(n){T.warn("Error caching server parameters:",n.message),km(Bl,"")}}function Oy(e){if(e){let t=Xc.get(e);t&&(window.clearTimeout(t),t=null,Xc.delete(e)),te(Jc).call(Jc,e)||e.cloudProxyServer!=="disabled"||Jc.push(e)}if(Xc.size<A("AP_CACHE_NUM")&&Jc.length>0){const t=Jc.shift();Xc.set(t,window.setTimeout(async()=>{const{appId:n,cname:r,token:i,stringUid:s,uid:a,proxyServer:d,role:l}=t;try{await rZ(n,r,i,a,d,s,l),Xc.has(t)&&Oy(t)}catch(h){T.warn("update preload failed",h.message),PU(t)}},A("AP_UPDATE_INTERVAL")))}}function PU(e){const t=Jc.indexOf(e);t!==-1&&Jc.splice(t,1);let n=Xc.get(e);n&&(window.clearTimeout(n),n=null,Xc.delete(e),Oy())}function LU(e,t){const n=e.sua,r=e.ap;t&&n&&Se.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),Se.reportResourceTiming(e.ap.url,e.sid),Se.joinWebProxyAP(e.sid,{lts:r.requestTime,elapse:r.elapse,sucess:1,apServerAddr:r.url,turnServerAddrList:r.proxyInfo.addresses.map(i=>i.ip).join(","),eventType:"disabled",unilbsServerIds:[rn.CHOOSE_SERVER,rn.CLOUD_PROXY_FALLBACK].toString()}),Se.joinChooseServer(e.sid,{lts:r.requestTime,elapse:r.elapse,succ:!0,csAddr:r.url,opid:r.opid,serverList:r.gatewayInfo.gatewayAddrs.map(i=>i.address),ec:null,cid:r.gatewayInfo.cid.toString(),uid:r.gatewayInfo.uid.toString(),csIp:r.gatewayInfo.csIp,unilbsServerIds:[rn.CHOOSE_SERVER].toString(),isHttp3:r.isHttp3})}function kU(e){return window.atob(window.localStorage.getItem(e)||"")}function km(e,t){window.localStorage.setItem(e,window.btoa(t))}function MU(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),IL(t)}function oZ(e){let t=function(){const n=cZ.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,r){let i=n.appId;i!==void 0&&(on(r,10),Da(r,i));let s=n.cid;s!==void 0&&(on(r,16),on(r,s));let a=n.cname;a!==void 0&&(on(r,26),Da(r,a));let d=n.deviceId;d!==void 0&&(on(r,34),Da(r,d));let l=n.elapse;l!==void 0&&(on(r,40),Pa(r,l));let h=n.fileSize;h!==void 0&&(on(r,48),Pa(r,jl(h)));let p=n.height;p!==void 0&&(on(r,56),Pa(r,jl(p)));let _=n.jpg;_!==void 0&&(on(r,66),on(r,_.length),xU(r,_));let m=n.networkType;m!==void 0&&(on(r,72),Pa(r,jl(m)));let g=n.osType;g!==void 0&&(on(r,80),Pa(r,jl(g)));let w=n.requestId;w!==void 0&&(on(r,90),Da(r,w));let R=n.sdkVersion;R!==void 0&&(on(r,98),Da(r,R));let y=n.sequence;y!==void 0&&(on(r,104),Pa(r,jl(y)));let b=n.sid;b!==void 0&&(on(r,114),Da(r,b));let N=n.timestamp;N!==void 0&&(on(r,120),Pa(r,N));let L=n.uid;L!==void 0&&(on(r,128),on(r,L));let x=n.vid;x!==void 0&&(on(r,136),on(r,x));let F=n.width;F!==void 0&&(on(r,144),Pa(r,jl(F)));let M=n.service;M!==void 0&&(on(r,152),on(r,M));let B=n.callbackData;B!==void 0&&(on(r,162),on(r,B.length),xU(r,B));let J=n.ticket;J!==void 0&&(on(r,170),Da(r,J));let ee=n.vendorConfigs;ee!==void 0&&(on(r,178),Da(r,ee))}(e,t),function(n){let r=n.bytes,i=n.limit;return r.length===i?r:r.subarray(0,i)}(t)}function sZ(e){return function(n){let r={};e:for(;!dZ(n);){let i=Fh(n);switch(i>>>3){case 0:break e;case 1:r.code=Fh(n);break;case 2:r.msg=VU(n,Fh(n));break;case 3:r.requestId=VU(n,Fh(n));break;case 4:r.timestamp=lZ(n,!1);break;default:aZ(n,7&i)}}return r}({bytes:t=e,offset:0,limit:t.length});var t}function aZ(e,t){switch(t){case 0:for(;128&uo(e););break;case 2:Ny(e,Fh(e));break;case 5:Ny(e,4);break;case 1:Ny(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function jl(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let cZ=[];function Ny(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function dZ(e){return e.offset>=e.limit}function Mm(e,t){let n=e.bytes,r=e.offset,i=e.limit,s=r+t;if(s>n.length){let a=new Uint8Array(2*s);a.set(n),e.bytes=a}return e.offset=s,s>i&&(e.limit=s),r}function UU(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function xU(e,t){let n=Mm(e,t.length);e.bytes.set(t,n)}function VU(e,t){let n=UU(e,t),r=String.fromCharCode,i=e.bytes,s="",a="";for(let d=0;d<t;d++){let l,h,p,_,m=i[d+n];128&m?(224&m)==192?d+1>=t?a+=s:(l=i[d+n+1],(192&l)!=128?a+=s:(_=(31&m)<<6|63&l,_<128?a+=s:(a+=r(_),d++))):(240&m)==224?d+2>=t?a+=s:(l=i[d+n+1],h=i[d+n+2],(49344&(l|h<<8))!=32896?a+=s:(_=(15&m)<<12|(63&l)<<6|63&h,_<2048||_>=55296&&_<=57343?a+=s:(a+=r(_),d+=2))):(248&m)==240?d+3>=t?a+=s:(l=i[d+n+1],h=i[d+n+2],p=i[d+n+3],(12632256&(l|h<<8|p<<16))!=8421504?a+=s:(_=(7&m)<<18|(63&l)<<12|(63&h)<<6|63&p,_<65536||_>1114111?a+=s:(_-=65536,a+=r(55296+(_>>10),56320+(1023&_)),d+=3))):a+=s:a+=r(m)}return a}function Da(e,t){let n=t.length,r=0;for(let a=0;a<n;a++){let d=t.charCodeAt(a);d>=55296&&d<=56319&&a+1<n&&(d=(d<<10)+t.charCodeAt(++a)-56613888),r+=d<128?1:d<2048?2:d<65536?3:4}on(e,r);let i=Mm(e,r),s=e.bytes;for(let a=0;a<n;a++){let d=t.charCodeAt(a);d>=55296&&d<=56319&&a+1<n&&(d=(d<<10)+t.charCodeAt(++a)-56613888),d<128?s[i++]=d:(d<2048?s[i++]=d>>6&31|192:(d<65536?s[i++]=d>>12&15|224:(s[i++]=d>>18&7|240,s[i++]=d>>12&63|128),s[i++]=d>>6&63|128),s[i++]=63&d|128)}}function uo(e){return e.bytes[UU(e,1)]}function FU(e,t){let n=Mm(e,1);e.bytes[n]=t}function Fh(e){let t,n=0,r=0;do t=uo(e),n<32&&(r|=(127&t)<<n),n+=7;while(128&t);return r}function on(e,t){for(t>>>=0;t>=128;)FU(e,127&t|128),t>>>=7;FU(e,t)}function lZ(e,t){let n,r=0,i=0,s=0;return n=uo(e),r=127&n,128&n&&(n=uo(e),r|=(127&n)<<7,128&n&&(n=uo(e),r|=(127&n)<<14,128&n&&(n=uo(e),r|=(127&n)<<21,128&n&&(n=uo(e),i=127&n,128&n&&(n=uo(e),i|=(127&n)<<7,128&n&&(n=uo(e),i|=(127&n)<<14,128&n&&(n=uo(e),i|=(127&n)<<21,128&n&&(n=uo(e),s=127&n,128&n&&(n=uo(e),s|=(127&n)<<7))))))))),{low:r|i<<28,high:i>>>4|s<<24,unsigned:t}}function Pa(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,s=i===0?r===0?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,a=Mm(e,s),d=e.bytes;switch(s){case 10:d[a+9]=i>>>7&1;case 9:d[a+8]=s!==9?128|i:127&i;case 8:d[a+7]=s!==8?r>>>21|128:r>>>21&127;case 7:d[a+6]=s!==7?r>>>14|128:r>>>14&127;case 6:d[a+5]=s!==6?r>>>7|128:r>>>7&127;case 5:d[a+4]=s!==5?128|r:127&r;case 4:d[a+3]=s!==4?n>>>21|128:n>>>21&127;case 3:d[a+2]=s!==3?n>>>14|128:n>>>14&127;case 2:d[a+1]=s!==2?n>>>7|128:n>>>7&127;case 1:d[a]=s!==1?128|n:127&n}}const BU={},jU={},Um=4294967296,uZ=Um*Um,GU=uZ/2;HU(0,!0);const WU=HU(0),hZ=Bh(0,-2147483648,!1),pZ=Bh(-1,2147483647,!1);function HU(e,t){let n,r,i;return t?(i=0<=(e>>>=0)&&e<256)&&(r=jU[e],r)?r:(n=Bh(e,0,!0),i&&(jU[e]=n),n):(i=-128<=(e|=0)&&e<128)&&(r=BU[e],r)?r:(n=Bh(e,e<0?-1:0,!1),i&&(BU[e]=n),n)}function Bh(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function KU(e,t){if(isNaN(e))return WU;{if(e<=-GU)return hZ;if(e+1>=GU)return pZ}return e<0?WU:Bh(e%Um|0,e/Um|0,t)}function YU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}class Dy extends Vt{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(Mo.CONNECTION_STATE_CHANGE,t,n)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var n;super(),I(this,"name","AgoraRTCImageModeration"),I(this,"_connectionState",Ui.CONNECTING),I(this,"_sequence",0),I(this,"_moderationStartTime",void 0),I(this,"_workerConnection",void 0),I(this,"_workerMessageLengthLimit",void 0),I(this,"_qualityRatio",void 0),I(this,"_connectInfo",void 0),I(this,"_cancelTokenSource",Cr.CancelToken.source()),I(this,"_retryConfig",void 0),I(this,"_moderationInterval",void 0),I(this,"_moderationTimer",null),I(this,"_moderationMode",1),I(this,"_quality",1),I(this,"_qualityTimer",null),I(this,"_ticket",void 0),I(this,"_moderationIntervalMinimum",void 0),I(this,"_uploadFailedNum",0),I(this,"_uploadNum",0),I(this,"_uploadTimer",null),I(this,"_extraInfo",void 0),I(this,"_vendor",""),I(this,"_encoder",new TextEncoder),I(this,"_moderationId",void 0),I(this,"inspectImage",()=>{if(this.connectionState!==Ui.CONNECTED)throw new j(O.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Ui.CONNECTED?this.requestToInspectImage():T.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=ht(5,"image-moderation-"),this._workerMessageLengthLimit=A("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=A("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=A("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Ah("worker-"+this._moderationId,nn),this.on(Mo.STATE_CHANGE,(r,i)=>{T.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Ol[r]," ").concat(i||""))}),this.handleWorkerEvents()}async init(t,n){this.emit(Mo.STATE_CHANGE,Ol.CONNECT_AP),this._connectInfo=t;const r=this._cancelTokenSource.token;return this._retryConfig=n,new ae((i,s)=>{this.on(Mo.CONNECTION_STATE_CHANGE,(a,d)=>{a===Ui.CONNECTED&&i()}),this.requestAP(t,r,n).then(a=>{this.connectWorker(a)}).catch(a=>{s(a)})})}updateConfig(t){var n;this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),T.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===Ui.CONNECTED&&this.inspectImage()}async requestAP(t,n,r){const i=A("WEBCS_DOMAIN").map(l=>"https://".concat(l,"/api/v1")),s=await function(l,h,p,_){let{appId:m,areaCode:g,cname:w,sid:R,token:y,uid:b}=h;kl++;const N="moderation_plugin",L={service_name:N,json_body:JSON.stringify({appId:m,areaCode:g,cname:w,command:"allocateEdge",requestId:kl,seq:kl,sid:R,appToken:y,ts:Date.now(),uid:b+""})};let x,F,M=l[0];return Do(async()=>{x=Date.now();const B=await xo(M,{data:L,cancelToken:p,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(F=Date.now()-x,B.code!==0){const Ne=new j(O.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+B.code,{retry:!0,responseTime:F});throw T.error(Ne.toString()),Ne}const J=JSON.parse(B.json_body);if(J.code!==200){const Ne=new j(O.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(J.code,", reason: ").concat(J.reason),{code:J.code,responseTime:F});throw T.error(Ne.toString()),Ne}if(!J.servers||!Array.isArray(J.servers)||J.servers.length===0){const Ne=new j(O.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:J.code,responseTime:F});throw T.error(Ne.toString()),Ne}if(!J.servers.some(Ne=>!!Ne.wss)){const Ne=new j(O.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:J.code,responseTime:F});throw T.error(Ne.toString()),Ne}const ee=A("IMAGE_MODERATION_WORKER_WSS");if(ee)return{addressList:[ee],workerToken:J.workerToken,vid:J.vid,responseTime:F};const pe=A("IMAGE_MODERATION_WORKER_HOST");return{addressList:J.servers.map(Ne=>{let{address:Ge,wss:Fe}=Ne;if(Ge&&Fe)return"wss://".concat(Ge.replace(/\./g,"-"),".").concat(pe,":").concat(Fe,"/moderation")}).filter(Ne=>!!Ne),workerToken:J.workerToken,vid:J.vid,ticket:J.appTicket,responseTime:F}},(B,J)=>(Se.apworkerEvent(R,{success:!0,sc:200,serviceName:N,responseDetail:JSON.stringify(B.addressList),firstSuccess:J===0,responseTime:F,serverIp:l[J%l.length]}),!1),(B,J)=>(Se.apworkerEvent(R,{success:!1,sc:B.data&&B.data.code||200,serviceName:N,responseTime:F,serverIp:l[J%l.length]}),!!(B.code!==O.OPERATION_ABORTED&&B.code!==O.UNEXPECTED_RESPONSE||B.data&&B.data.retry)&&(M=l[(J+1)%l.length],!0)),_)}(i,t,n,r);this.emit(Mo.STATE_CHANGE,Ol.AP_CONNECTED);const{addressList:a,ticket:d}=s;return this._ticket=d,a}async connectWorker(t){this.emit(Mo.STATE_CHANGE,Ol.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(Be.CONNECTED,async()=>{this.emit(Mo.STATE_CHANGE,Ol.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Ui.CONNECTED}),this._workerConnection.on(Be.CLOSED,()=>{this.connectionState=Ui.CLOSED}),this._workerConnection.on(Be.FAILED,()=>{this.connectionState=Ui.CLOSED}),this._workerConnection.on(Be.RECONNECTING,()=>{this.connectionState=this.connectionState===Ui.CONNECTED?Ui.RECONNECTING:Ui.CONNECTING}),this._workerConnection.on(Be.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const n=sZ(new Uint8Array(t.data));A("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&T.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,T.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Se.reportApiInvoke(this._connectInfo.sid||null,{name:kt.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:yt.TRACER}).onError(new j(O.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},A("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else T.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Be.WILL_RECONNECT,(t,n,r)=>{t==="recover"&&r(t),r("tryNext")}),this._workerConnection.on(Be.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=Zr(this,Mo.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(A("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&T.debug("Only the track being played can be inspected"));this._sequence++;const r=await this.generateRequestData(t,n);this._workerConnection.sendMessage(r,!0,!0)}else A("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&T.debug("Only the track being published can be inspected")}async generateRequestData(t,n){let{appId:r,cname:i,cid:s,vid:a,sid:d,uid:l}=n;const h=Date.now(),p=await t.getCurrentFrameImage("image/jpeg",this.quality),_=await mk(p,r,i),m=this._sequence+"-"+s+"-"+l+"-"+h+"-"+ht(12,""),g={appId:r,cid:s,cname:i,deviceId:"",elapse:Dy.intToLong(Number(h-this._moderationStartTime)),fileSize:p.buffer.byteLength,height:p.height,width:p.width,jpg:_,networkType:6,osType:7,requestId:m,sdkVersion:"4.24.2",sequence:this._sequence,sid:d,timestamp:KU(h),uid:l,vid:a,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete g.callbackData;const w=oZ(g);if(w.byteLength<this._workerMessageLengthLimit){if(A("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const R=function(y){for(var b=1;b<arguments.length;b++){var N=arguments[b]!=null?arguments[b]:{};b%2?YU(Object(N),!0).forEach(function(L){I(y,L,N[L])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(N)):YU(Object(N)).forEach(function(L){Object.defineProperty(y,L,Object.getOwnPropertyDescriptor(N,L))})}return y}({},g);delete R.jpg,T.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(R))}return w}{const R=this.quality*this._qualityRatio;return this.quality=R,await this.generateRequestData(t,{appId:r,cname:i,cid:s,vid:a,sid:d,uid:l})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Cr.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Ui.CLOSED,this.emit(Mo.STATE_CHANGE,Ol.CLOSED)}}function zU(e){if(Rt(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new j(O.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new j(O.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const fZ={name:"ImageModeration",create:function(e){let{config:t}=e;return zU(t),new Dy(t)}};var qU,XU,JU,QU,ZU,$U,e2,t2,n2,r2,i2,o2,s2,a2,c2,d2,l2,u2,h2,p2,f2,_2,m2,E2,g2,S2,T2,v2,R2,y2,C2,I2,w2,A2,b2,O2,N2,D2,P2,L2,k2,M2,fe;function U2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function ho(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?U2(Object(n),!0).forEach(function(r){I(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}bn.setLogger(T);let _Z=(qU=Ae(),XU=Ae({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof vl))return[t];t=[t]}return t.map(n=>n?Object(n).toString():"null")}}),JU=Ae({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==Tl.DATA?(Array.isArray(t)||(t=[t]),t.map(n=>n.getTrackId())):[t.getChannelId()])}),QU=Ae({argsMap:(e,t,n,r)=>[typeof t=="object"?t.uid:t,n,r]}),ZU=Ae({argsMap:(e,t,n)=>[t,n]}),$U=Ae({argsMap:(e,t)=>t.map(n=>{let{user:r,mediaType:i}=n;return[r==null?void 0:r.uid,i]})}),e2=Ae({argsMap:(e,t,n,r)=>[typeof t=="object"?t.uid:t,n,r]}),t2=Ae({argsMap:(e,t)=>t.map(n=>{let{user:r,mediaType:i}=n;return{uid:r==null?void 0:r.uid,mediaType:i}})}),n2=Ae(),r2=Ae(),i2=Ae(),o2=Ae(),s2=Ae(),a2=Ae(),c2=Ae(),d2=Ae(),l2=Ae(),u2=Ae(),h2=Ae(),p2=Ae(),f2=Ae(),_2=Ae(),m2=Ae(),E2=Ae(),g2=Ae({argsMap:(e,t)=>[t]}),S2=Ae(),T2=Ae(),v2=Ae(),R2=Ae(),y2=Ae(),C2=Ae(),I2=Ae(),w2=Ae(),A2=Ae({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),b2=Ae(),O2=Ae(),N2=Ae(),D2=Ae(),P2=Ae(),L2=Ae(),k2=Ae({reportResult:!0}),M2=Ae(),fe=class extends Vt{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let n;if(super(),I(this,"store",void 0),I(this,"_uid",void 0),I(this,"_channelName",void 0),I(this,"_uintUid",void 0),I(this,"_users",[]),I(this,"_config",void 0),I(this,"_clientId",void 0),I(this,"_appId",void 0),I(this,"_sessionId",null),I(this,"_key",void 0),I(this,"_rtmConfig",{}),I(this,"_joinInfo",void 0),I(this,"_gateway",void 0),I(this,"_statsCollector",void 0),I(this,"_configDistribute",void 0),I(this,"_leaveMutex",void 0),I(this,"_publishMutex",void 0),I(this,"_renewTokenMutex",void 0),I(this,"_subscribeMutex",void 0),I(this,"_encryptionMode","none"),I(this,"_encryptionSecret",null),I(this,"_encryptionSalt",null),I(this,"_encryptDataStream",!1),I(this,"_encryptDataStreamKey",null),I(this,"_encryptDataStreamIv",null),I(this,"_proxyServer",void 0),I(this,"_turnServer",{servers:[],mode:"auto"}),I(this,"_cloudProxyServerMode","disabled"),I(this,"_isDualStreamEnabled",!1),I(this,"_defaultStreamFallbackType",void 0),I(this,"_lowStreamParameter",void 0),I(this,"_streamFallbackTypeCacheMap",new Map),I(this,"_remoteStreamTypeCacheMap",new Map),I(this,"_axiosCancelSource",Cr.CancelToken.source()),I(this,"_audioVolumeIndicationInterval",void 0),I(this,"_networkQualityInterval",void 0),I(this,"_userOfflineTimeout",void 0),I(this,"_streamRemovedTimeout",void 0),I(this,"_rteDetailInterval",void 0),I(this,"_liveTranscodeStreamingClient",void 0),I(this,"_liveRawStreamingClient",void 0),I(this,"_channelMediaRelayClient",void 0),I(this,"_networkQualitySensitivity","normal"),I(this,"_p2pChannel",void 0),I(this,"_useLocalAccessPoint",!1),I(this,"_setLocalAPVersion",void 0),I(this,"_joinAndNotLeaveYet",!1),I(this,"_numberOfJoinCount",0),I(this,"_joinResponse",null),I(this,"_remoteDefaultVideoStreamType",void 0),I(this,"_inspect",void 0),I(this,"_moderation",void 0),I(this,"_license",void 0),I(this,"_pendingPublishedUsers",[]),I(this,"ntpAlignErrorCount",0),I(this,"remoteInboundOffset",0),I(this,"_peerConnectionState",void 0),I(this,"_pendingRtpCapabilityChange",void 0),I(this,"_fallbackServerInfo",void 0),I(this,"_dualStreamMode",void 0),I(this,"_handleLocalTrackEnable",(i,s,a)=>{this.publish(i,!1).then(s).catch(a)}),I(this,"_handleLocalTrackDisable",(i,s,a)=>{this.unpublish(i).then(s).catch(a)}),I(this,"_handleUserOnline",i=>{if(A("BLOCK_LOCAL_CLIENT")&&Gc(i.uid,this.channelName))return void T.debug("[".concat(i.uid,"] will be ignored in local"));this.isStringUID&&typeof i.uid!="string"&&T.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const s=this._users.find(a=>a.uid===i.uid);if(s)s._trust_in_room_=!0,s._is_pre_created&&(s._is_pre_created=!1,this.safeEmit(Ye.USER_JOINED,s));else{const a=new Oa(i.uid,i.uint_id||i.uid);this._users.push(a),T.debug("[".concat(this._clientId,"] user online"),i.uid),this.store.firstVideoFrameDecoded(a.uid,{userJoinNotify:Date.now()}),this.safeEmit(Ye.USER_JOINED,a)}}),I(this,"_handleUserOffline",i=>{if(A("BLOCK_LOCAL_CLIENT")&&Gc(i.uid,this.channelName))return;const s=this._users.find(a=>a.uid===i.uid);s&&(this._handleRemoveStream(i),this._handleRemoveDataChannels(i),s._audio_pre_subscribed||s._video_pre_subscribed?s._is_pre_created=!0:k_(this._users,s),this._remoteStreamTypeCacheMap.delete(s.uid),this._streamFallbackTypeCacheMap.delete(s.uid),T.debug("[".concat(this._clientId,"] user offline"),i.uid,"reason:",i.reason),this.safeEmit(Ye.USER_LEAVED,s,i.reason))}),I(this,"_handleAddAudioOrVideoStream",(i,s,a,d,l,h,p,_)=>{if(A("BLOCK_LOCAL_CLIENT")&&Gc(s,this.channelName))return;const m=this._users.find(R=>R.uid===s);if(!m)return void T.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));T.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(i)),this.store.subscribe(m.uid,i,void 0,void 0,void 0,Date.now()),i==="video"&&this.store.firstVideoFrameDecoded(m.uid,{videoAddNotify:Date.now()});const g=i==="audio"?m.hasAudio:m.hasVideo;m._uintid||(m._uintid=h||s),i==="audio"?m._trust_audio_stream_added_state_=!0:m._trust_video_stream_added_state_=!0,i==="audio"?(m._audio_added_=!0,a!==void 0&&(m._audioSSRC=a),d!==void 0&&(m._cname=d),p&&(m._audioOrtc=p)):(m._video_added_=!0,a!==void 0&&(m._videoSSRC=a),d!==void 0&&(m._cname=d),_!==void 0&&(m._rtxSsrcId=_),p&&(m._videoOrtc=p)),(i==="audio"?m.hasAudio:m.hasVideo)&&!g&&(T.info("[".concat(this._clientId,"] remote user ").concat(m.uid," published ").concat(i)),this.safeEmit(Ye.USER_PUBLISHED,m,i)),i==="video"?Se.onGatewayStream(this._sessionId,pn.ON_ADD_VIDEO_STREAM,Mt.ON_ADD_VIDEO_STREAM,{peer:h||s,ssrc:m._videoSSRC}):Se.onGatewayStream(this._sessionId,pn.ON_ADD_AUDIO_STREAM,Mt.ON_ADD_AUDIO_STREAM,{peer:h||s,ssrc:m._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(m,i,a).then(R=>{if(R&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(m.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof qc))return this._p2pChannel.unsubscribe(m,i,!0).then(()=>this._subscribe(m,i,!0).catch(y=>{T.error("[".concat(this._clientId,"] resubscribe error"),y.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(m,i)&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(m.uid," after reconnect.")),this._subscribe(m,i,!0).catch(R=>{T.error("[".concat(this._clientId,"] resubscribe error"),R.toString())}));const w=this._getEncodingName(l);i==="video"&&(w==="unknown"?this.safeEmit(Ye.AV1_DECODABLE_RESULT,!1):An()||tr()||(w==null?void 0:w.toLocaleLowerCase())!==kc.av1||VQ().then(R=>{A("FLS_ENABLE_AV1_DECODE_DETECT")&&this.safeEmit(Ye.AV1_DECODABLE_RESULT,R),R||this._gateway.downgradeCodec(w)}))}),I(this,"_handleRemoveStream",i=>{if(A("BLOCK_LOCAL_CLIENT")&&Gc(i.uid,this.channelName))return;const s=this._users.find(d=>d.uid===i.uid);if(!s)return void T.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));T.debug("[".concat(this._clientId,"] stream removed with uid ").concat(i.uid));let a=()=>{};s.hasAudio&&s.hasVideo?a=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished audio track")),this.safeEmit(Ye.USER_UNPUBLISHED,s,"audio"),T.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished video track")),this.safeEmit(Ye.USER_UNPUBLISHED,s,"video")}:s.hasVideo?a=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished video track")),this.safeEmit(Ye.USER_UNPUBLISHED,s,"video")}:s.hasAudio&&(a=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished audio track")),this.safeEmit(Ye.USER_UNPUBLISHED,s,"audio")}),s._video_pre_subscribed||s._audio_pre_subscribed||(s._trust_audio_stream_added_state_=!0,s._trust_video_stream_added_state_=!0,s._audio_added_=!1,s._video_added_=!1,this._p2pChannel instanceof qc&&this._p2pChannel.unsubscribe(s).then(d=>{if(d)return this._gateway.unsubscribe(d,s.uid)}),s._audioSSRC=void 0,s._videoSSRC=void 0,s._audioOrtc=void 0,s._videoOrtc=void 0,s._rtxSsrcId=void 0),Se.onGatewayStream(this._sessionId,pn.ON_REMOVE_STREAM,Mt.ON_REMOVE_STREAM,{peer:i.uint_id||i.uid}),a()}),I(this,"_handleSetStreamLocalEnable",(i,s,a)=>{if(A("BLOCK_LOCAL_CLIENT")&&Gc(s,this.channelName))return;const d=this._users.find(p=>p.uid===s);if(!d)return void T.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));T.debug("[".concat(this._clientId,"] local ").concat(i," ").concat(a?"enabled":"disabled"," with uid ").concat(s));const l=i==="audio"?d.hasAudio:d.hasVideo;if(i==="audio"){d._trust_audio_enabled_state_=!0;const p=d._audio_enabled_;if(d._audio_enabled_=a,d._audio_enabled_===p)return;{const _=d._audio_enabled_?"enable-local-audio":"disable-local-audio";T.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(s,", msg: ").concat(_)),this.safeEmit(Ye.USER_INFO_UPDATED,s,_)}}else{d._trust_video_enabled_state_=!0;const p=d._video_enabled_;if(d._video_enabled_=a,d._video_enabled_===p)return;{const _=d._video_enabled_?"enable-local-video":"disable-local-video";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(s,", msg: ").concat(_)),this.safeEmit(Ye.USER_INFO_UPDATED,s,_)}}const h=i==="audio"?d.hasAudio:d.hasVideo;return l!==h?!l&&h?(T.info("[".concat(this._clientId,"] remote user ").concat(s," published ").concat(i)),void this.safeEmit(Ye.USER_PUBLISHED,d,i)):(i==="video"&&d._videoTrack&&d._videoTrack._destroy(),i==="audio"&&d._audioTrack,this._p2pChannel.muteRemote(d,i),T.info("[".concat(this._clientId,"] remote user ").concat(s," unpublished ").concat(i)),void this.safeEmit(Ye.USER_UNPUBLISHED,d,i)):void 0}),I(this,"_handleMuteStream",(i,s,a)=>{if(A("BLOCK_LOCAL_CLIENT")&&Gc(i,this.channelName))return;T.debug("[".concat(this._clientId,"] receive mute message"),i,s,a);const d=this._users.find(p=>p.uid===i);if(!d)return void T.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i));const l=s==="audio"?d.hasAudio:d.hasVideo;if(s==="audio"){d._trust_audio_mute_state_=!0;const p=d._audio_muted_;if(d._audio_muted_=a,d._audio_muted_===p)return;{const _=d._audio_muted_?"mute-audio":"unmute-audio";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(_)),this.safeEmit(Ye.USER_INFO_UPDATED,i,_)}}else{d._trust_video_mute_state_=!0;const p=d._video_muted_;if(d._video_muted_=a,d._video_muted_===p)return;{const _=d._video_muted_?"mute-video":"unmute-video";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(_)),this.safeEmit(Ye.USER_INFO_UPDATED,i,_)}}const h=s==="audio"?d.hasAudio:d.hasVideo;if(l!==h){if(!l&&h)return(s==="audio"?d._audioSSRC:d._videoSSRC)?(T.info("[".concat(this._clientId,"] remote user ").concat(i," published ").concat(s)),void this.safeEmit(Ye.USER_PUBLISHED,d,s)):void T.warning("[".concat(this._clientId,"] remote user ").concat(i," receive ").concat(s," unmute message  before add stream message, ").concat(s," SSRC doesn't exist yet."));s==="video"&&d._videoTrack&&!d._video_pre_subscribed&&d._videoTrack._destroy(),s==="audio"&&d._audioTrack,this._p2pChannel.muteRemote(d,s),T.info("[".concat(this._clientId,"] remote user ").concat(i," unpublished ").concat(s)),this.safeEmit(Ye.USER_UNPUBLISHED,d,s)}}),I(this,"_handleP2PLost",async i=>{T.debug("[".concat(this._clientId,"] receive p2p lost"),i),parseInt(i.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():T.warning("[".concat(this._clientId,"] P2PLost stream not found"),i)}),I(this,"_handleTokenWillExpire",()=>{T.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Ye.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),I(this,"_handleBeforeUnload",i=>{i.type==="beforeunload"&&i.returnValue!==void 0&&i.returnValue!==""||(this.leave(),T.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),I(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(Ye.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const i={downlinkNetworkQuality:0,uplinkNetworkQuality:0};i.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),i.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Ye.NETWORK_QUALITY,i)}),I(this,"_handleP2PAddAudioOrVideoStream",(i,s,a,d)=>{const l=this._users.find(p=>p.uid===s);if(!l)return void T.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));T.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(i)),this.store.subscribe(l.uid,i,void 0,void 0,void 0,Date.now());const h=i==="audio"?l.hasAudio:l.hasVideo;i==="audio"?l._trust_audio_stream_added_state_=!0:l._trust_video_stream_added_state_=!0,i==="audio"?(l._audio_added_=!0,a!==void 0&&(l._audioSSRC=a),d!==void 0&&(l._audioMid=d)):(l._video_added_=!0,a!==void 0&&(l._videoSSRC=a),d!==void 0&&(l._videoMid=d)),(i==="audio"?l.hasAudio:l.hasVideo)&&!h&&(T.info("[".concat(this._clientId,"] remote user ").concat(l.uid," published ").concat(i)),this.safeEmit(Ye.USER_PUBLISHED,l,i)),this._p2pChannel.hasPendingRemoteMedia(l,i)&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(l.uid," after reconnect.")),this._subscribe(l,i,!0).catch(p=>{T.error("[".concat(this._clientId,"] resubscribe error"),p.toString())}))}),this._config=e,this._clientId=t||ht(5,"client-"),this.store=new class{constructor(i,s,a,d,l){xe(this,"state",void 0),this.state={codec:i,audioCodec:s,mode:a,clientId:d,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:Lc.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,rteUrl:void 0,rteSid:void 0,autoSubscribe:!1,enableInstantMuteRestore:!1,networkQualityProbe:!1,useDcSignal:!!l}}dispatch(i){this.state=function(s,a){switch(a.type){case ke.SET_SESSION_ID:return ie(ie({},s),{},{sessionId:a.sessionId});case ke.SET_P2P_ID:return ie(ie({},s),{},{p2pId:a.p2pId});case ke.SET_UID:return ie(ie({},s),{},{uid:a.uid});case ke.SET_INT_UID:return ie(ie({},s),{},{intUid:a.intUid});case ke.SET_PUB_ID:return ie(ie({},s),{},{pubId:a.pubId});case ke.KEY_METRIC_CLIENT_CREATED:return ie(ie({},s),{},{keyMetrics:ie(ie({},s.keyMetrics),{},{clientCreated:a.metric})});case ke.KEY_METRIC_JOIN_START:return ie(ie({},s),{},{keyMetrics:ie(ie({},s.keyMetrics),{},{joinStart:a.metric})});case ke.KEY_METRIC_PRELOAD_START:return ie(ie({},s),{},{keyMetrics:ie(ie({},s.keyMetrics),{},{preloadStart:a.metric})});case ke.KEY_METRIC_PRELOAD_END:return ie(ie({},s),{},{keyMetrics:ie(ie({},s.keyMetrics),{},{preloadEnd:a.metric})});case ke.KEY_METRIC_JOIN_END:return ie(ie({},s),{},{keyMetrics:ie(ie({},s.keyMetrics),{},{joinEnd:a.metric})});case ke.KEY_METRIC_REQUEST_AP_START:return ie(ie({},s),{},{keyMetrics:ie(ie({},s.keyMetrics),{},{requestAPStart:a.metric})});case ke.KEY_METRIC_REQUEST_AP_END:return ie(ie({},s),{},{keyMetrics:ie(ie({},s.keyMetrics),{},{requestAPEnd:a.metric})});case ke.KEY_METRIC_REQUEST_SUA_END:return ie(ie({},s),{},{keyMetrics:ie(ie({},s.keyMetrics),{},{requestSUAEnd:a.metric})});case ke.KEY_METRIC_BEFORE_CONNECT:return ie(ie({},s),{},{keyMetrics:ie(ie({},s.keyMetrics),{},{beforeConnect:a.metric})});case ke.KEY_METRIC_PEER_RECEIVER:return ie(ie({},s),{},{keyMetrics:ie(ie({},s.keyMetrics),{},{peerReceiver:a.metric})});case ke.KEY_METRIC_SIGNAL_CONNECTED:return ie(ie({},s),{},{keyMetrics:ie(ie({},s.keyMetrics),{},{signalConnected:a.metric})});case ke.KEY_METRIC_JOIN_REQ:return ie(ie({},s),{},{keyMetrics:ie(ie({},s.keyMetrics),{},{joinReq:a.metric})});case ke.KEY_METRIC_JOIN_REP:return ie(ie({},s),{},{keyMetrics:ie(ie({},s.keyMetrics),{},{joinRep:a.metric})});case ke.KEY_METRIC_JOIN_GATEWAY_START:return ie(ie({},s),{},{keyMetrics:ie(ie({},s.keyMetrics),{},{joinGatewayStart:a.metric})});case ke.KEY_METRIC_JOIN_GATEWAY_END:return ie(ie({},s),{},{keyMetrics:ie(ie({},s.keyMetrics),{},{joinGatewayEnd:a.metric})});case ke.KEY_METRIC_PEER_CONNECTION_START:return ie(ie({},s),{},{keyMetrics:ie(ie({},s.keyMetrics),{},{peerConnectionStart:a.metric})});case ke.KEY_METRIC_PEER_CONNECTION_END:return ie(ie({},s),{},{keyMetrics:ie(ie({},s.keyMetrics),{},{peerConnectionEnd:a.metric})});case ke.KEY_METRIC_DESCRIPTION_START:return ie(ie({},s),{},{keyMetrics:ie(ie({},s.keyMetrics),{},{descriptionStart:a.metric})});case ke.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return ie(ie({},s),{},{keyMetrics:ie(ie({},s.keyMetrics),{},{signalChannelOpen:a.metric})});case ke.KEY_METRIC_ICE_CONNECTION_END:return ie(ie({},s),{},{keyMetrics:ie(ie({},s.keyMetrics),{},{iceConnectionEnd:a.metric})});case ke.KEY_METRIC_PUBLISH:{const d=s.keyMetrics.publish,l=d.findIndex(h=>h.trackId===a.metric.trackId);return l!==-1?(d[l]=ie(ie({},d[l]),a.metric),ie(ie({},s),{},{keyMetrics:ie(ie({},s.keyMetrics),{},{publish:[...d]})})):ie(ie({},s),{},{keyMetrics:ie(ie({},s.keyMetrics),{},{publish:[...s.keyMetrics.publish,a.metric]})})}case ke.KEY_METRIC_SUBSCRIBE:{const d=s.keyMetrics.subscribe,l=d.findIndex(h=>h.userId===a.metric.userId&&h.type===a.metric.type);return l!==-1?(d[l]=ie(ie({},d[l]),a.metric),ie(ie({},s),{},{keyMetrics:ie(ie({},s.keyMetrics),{},{subscribe:[...d]})})):ie(ie({},s),{},{keyMetrics:ie(ie({},s.keyMetrics),{},{subscribe:[...s.keyMetrics.subscribe,a.metric]})})}case ke.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const d=s.keyMetrics.firstVideoFrameDecoded,l=d.findIndex(h=>h.userId===a.metric.userId);return l!==-1?(d[l]=ie(ie({},d[l]),a.metric),ie(ie({},s),{},{keyMetrics:ie(ie({},s.keyMetrics),{},{firstVideoFrameDecoded:[...d]})})):ie(ie({},s),{},{keyMetrics:ie(ie({},s.keyMetrics),{},{firstVideoFrameDecoded:[...s.keyMetrics.firstVideoFrameDecoded,a.metric]})})}case ke.RESET_FIRST_VIDEO_FRAME_DECODED:return s.keyMetrics.firstVideoFrameDecoded=[],s;case ke.SET_CLOUD_PROXY_SERVER_MODE:return s.cloudProxyServerMode=a.mode,s;case ke.RECORD_JOIN_CHANNEL_SERVICE:return typeof a.index!="number"?s.joinChannelServiceRecords=[...s.joinChannelServiceRecords,a.record]:(s.joinChannelServiceRecords[a.index]=ie(ie({},s.joinChannelServiceRecords[a.index]),a.record),s.joinChannelServiceRecords=[...s.joinChannelServiceRecords]),s;case ke.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return s.joinChannelServiceRecords=[],s;case ke.RESET_KEY_METRICS:return s.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},s;case ke.SET_USE_P2P:return ie(ie({},s),{},{useP2P:a.val});case ke.SET_TRANSPORT_TYPE:return ie(ie({},s),{},{p2pTransport:a.val});case ke.SET_RTE_URL:return ie(ie({},s),{},{rteUrl:a.rteUrl});case ke.SET_RTE_SID:return ie(ie({},s),{},{rteSid:a.rteSid});default:return s}}(this.state,i)}get useDcSignal(){return this.state.useDcSignal}set useDcSignal(i){this.state.useDcSignal=i}set autoSubscribe(i){this.state.autoSubscribe=i}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(i){this.state.enableInstantMuteRestore=i}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set networkQualityProbe(i){this.state.networkQualityProbe=i}get networkQualityProbe(){return this.state.networkQualityProbe}set sessionId(i){this.dispatch({type:ke.SET_SESSION_ID,sessionId:i})}get sessionId(){return this.state.sessionId}set rteUrl(i){this.dispatch({type:ke.SET_RTE_URL,rteUrl:i})}get rteUrl(){return this.state.rteUrl}set rteSid(i){this.dispatch({type:ke.SET_RTE_SID,rteSid:i})}get rteSid(){return this.state.rteSid}set cid(i){this.state.cid=i}get cid(){return this.state.cid}set codec(i){this.state.codec=i}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(i){this.dispatch({type:ke.SET_P2P_ID,p2pId:i})}get p2pId(){return this.state.p2pId}set dcId(i){this.dispatch({type:ke.SET_DC_ID,dcId:i})}get dcId(){return this.state.dcId}set uid(i){this.dispatch({type:ke.SET_UID,uid:i})}get uid(){return this.state.uid}set intUid(i){this.dispatch({type:ke.SET_INT_UID,intUid:i})}get intUid(){return this.state.intUid}set pubId(i){this.dispatch({type:ke.SET_PUB_ID,pubId:i})}get pubId(){return this.state.pubId}set cloudProxyServerMode(i){this.dispatch({type:ke.SET_CLOUD_PROXY_SERVER_MODE,mode:i})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(i){this.dispatch({type:ke.SET_USE_P2P,val:i})}get useP2P(){return this.state.useP2P}set p2pTransport(i){this.dispatch({type:ke.SET_TRANSPORT_TYPE,val:i})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(i){this.state.hasStartJoinChannel=i}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(i){this.state.isABTestSuccess=i}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:ke.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:ke.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:ke.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:ke.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:ke.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:ke.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:ke.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:ke.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:ke.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:ke.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:ke.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:ke.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:ke.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:ke.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:ke.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:ke.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:ke.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(i,s){this.dispatch({type:ke.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:ie({userId:i},s)})}descriptionStart(){this.dispatch({type:ke.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:ke.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:ke.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(i,s,a,d){this.dispatch({type:ke.KEY_METRIC_PUBLISH,metric:ie(ie({trackId:i,type:s},a&&{publishStart:a}),d&&{publishEnd:d})})}subscribe(i,s,a,d,l,h,p){this.dispatch({type:ke.KEY_METRIC_SUBSCRIBE,metric:ie(ie(ie(ie(ie({userId:i,type:s},a&&{subscribeStart:a}),d&&{subscribeEnd:d}),l&&{firstFrame:l}),h&&{streamAdded:h}),p&&{firstDecoded:p})})}massSubscribe(i,s,a,d){i.forEach(l=>{this.dispatch({type:ke.KEY_METRIC_SUBSCRIBE,metric:ie(ie(ie({userId:l.userId,type:l.type},s&&{subscribeStart:s}),a&&{subscribeEnd:a}),d&&{firstFrame:d})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(i,s){i.service==="gateway"&&Array.isArray(i.urls)&&(i.urls=i.urls.map(a=>a.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof s!="number"?(this.dispatch({type:ke.RECORD_JOIN_CHANNEL_SERVICE,record:ie(ie({},i),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(s<0||s>=this.state.joinChannelServiceRecords.length||this.dispatch({type:ke.RECORD_JOIN_CHANNEL_SERVICE,record:i,index:s}),s)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:ke.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:ke.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:ke.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId,A("SIGNAL_CHANNEL")===1),this._leaveMutex=new bn("client-leave",this._clientId),this._publishMutex=new bn("client-publish",this._clientId),this._renewTokenMutex=new bn("client-renewtoken",this._clientId),this._subscribeMutex=new bn("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),T.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Di," build: ").concat(sR,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{Kv(e.clientRoleOptions),n=Object.assign({},e.clientRoleOptions)}catch(i){T.warning("[".concat(this._clientId,"] ").concat(i.toString()))}var r;this._statsCollector=new Uh(this.store),this._statsCollector.onStatsException=(i,s,a)=>{T.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(i,", msg: ").concat(s,", uid: ").concat(a)),i===ly.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(d=>{d instanceof Q_&&A("ENABLE_ENCODE_EXCEPTION")&&d.findClosestProfile()}),this.safeEmit(Ye.EXCEPTION,{code:i,msg:s,uid:a})},this._statsCollector.onUploadPublishDuration=(i,s,a,d)=>{const l=this._users.find(h=>h.uid===i);l&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(l.uid,{peerPublishDuration:a,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(l)),Se.peerPublishStatus(this._sessionId,{subscribeElapse:d,audioPublishDuration:s,videoPublishDuration:a,peer:l._uintid}))},this._statsCollector.onVideoCodecChanged=i=>{if(A("VIDEO_STANDARD_BITRATE_VERSION")&&(i==="av1"||i==="h265"||i==="h264")){const s=this.localTracks.find(a=>a instanceof Ct);s&&s._saveEncodeBitrateRatio!==1&&s.setSaveEncodeBitrateRatio(i==="h264"?A("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=e.mode==="p2p",this._gateway=new PQ(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||nn,httpRetryConfig:e.httpRetryConfig||nn,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:n}),this._configDistribute=new WQ(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(r={store:this.store,statsCollector:this._statsCollector},Uo("P2PChannel").create(r)),this._handleP2PEvents()):this._p2pChannel=new qc(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,n,r,i){let s=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],a=arguments.length>6&&arguments[6]!==void 0&&arguments[6];St("JOIN_GATEWAY_USE_443PORT_ONLY",s),St("JOIN_GATEWAY_USE_DUAL_DOMAIN",a);const d=this._gateway.signal.websocket;return d instanceof KR&&(d.use443PortOnly=s,d.tryDoubleDomain=a),async function(l,h,p){N_.get(l)||N_.set(l,[]),D_.get(l)||D_.set(l,h),ss.get(l)||ss.set(l,0);const _=N_.get(l),m=D_.get(l);if(!_||!m)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(ss.get(l)===m){const b=fh();_.push(b),await b.promise}ss.set(l,ss.get(l)+1);for(var g=arguments.length,w=new Array(g>3?g-3:0),R=3;R<g;R++)w[R-3]=arguments[R];const y=await p(...w);return ss.set(l,ss.get(l)-1),ss.get(l)===m-1&&_.length>0&&(_[0].resolve(),_.shift()),ss.get(l)===0&&(N_.set(l,[]),D_.set(l,0),ss.set(l,0)),y}("client.join",A("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,n,r,i)}async join(e,t,n,r,i){const s=++this._numberOfJoinCount;this.store.joinStart(),r&&(this.store.uid=r);const a=(x_||x_||(x_=(window.location.protocol.split(":")[0]||"").toUpperCase(),x_))==="HTTPS",d=AL()?window.isSecureContext:"Browser Not Support";(!AL()&&!a||!window.isSecureContext)&&T.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let l;Se.setAppId(e);try{if(!n&&n!==null)throw new j(O.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));if(n&&Mn(n,"token",1,2047),Mn(e,"appid",1,2047),cm(t),r&&dm(r),i)if(typeof i=="string")Mn(i,"optionalInfo",1,256),l=i;else{if(typeof i!="object")throw new j(O.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:y,enableInstantMuteRestore:b,networkQualityProbe:N}=i;y&&(to(y,"autoSubscribe"),T.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(y)),this.store.autoSubscribe=y),b&&(to(b,"enableInstantMuteRestore"),T.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(b)),this.store.enableInstantMuteRestore=b),N&&(to(N,"networkQualityProbe"),T.info("[".concat(this._clientId,"] join: networkQualityProbe: ").concat(N)),this.store.networkQualityProbe=N)}}}catch(y){throw Se.reportApiInvoke(Pc(),{name:kt.JOIN,options:[e,t,n,r],states:{isHttps:a,isSecureContext:d},tag:yt.TRACER}).onError(y),y}if(this._leaveMutex.isLocked&&(T.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),T.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const y=new j(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw Se.reportApiInvoke(Pc(),{name:kt.JOIN,options:[e,t,n,r],states:{isHttps:a,isSecureContext:d},tag:yt.TRACER}).onError(y),y}this._gateway.state="CONNECTING",this.store.preloadStart();const h=await Ay({appId:e,cname:t,uid:r,stringUid:typeof r=="string"?r:void 0,token:n||e,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new j(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const p=(h==null?void 0:h.sid)||Pc();T.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(s)),this._sessionId||(this._sessionId=p,this.store.sessionId=this._sessionId);const _=Se.reportApiInvoke(this._sessionId,{id:this._clientId,name:kt.JOIN,options:[e,t,n,r],states:{isHttps:a,isSecureContext:d},tag:yt.TRACER}),m=ho(ho(ho({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof r!="string"?r:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:l,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!h},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:A("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(m.setLocalAPVersion=this._setLocalAPVersion),typeof r=="string"&&(m.stringUid=r,this._uintUid?(m.uid=this._uintUid,this._uintUid=void 0):m.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(m.aesmode=this._encryptionMode,m.aespassword=await(async y=>{const b=function(F){const M=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),B=new Uint8Array(new ArrayBuffer(M.length));for(let J=0;J<M.length;J+=1)B[J]=M.charCodeAt(J);return B}(),N=await window.crypto.subtle.importKey("spki",b,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),L=Wv(y),x=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},N,L);return function(F){let M="";for(let B=0;B<F.length;B+=1)M+=String.fromCharCode(F[B]);return window.btoa(M)}(new Uint8Array(x))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new j(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(m.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const y=new TextEncoder,b=A("USE_PURE_ENCRYPTION_MASTER_KEY")?y.encode(m.appId+this._encryptionSecret+this._encryptionSecret):y.encode(m.appId+m.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(N,L,x){const F=await window.crypto.subtle.importKey("raw",L,"PBKDF2",!1,["deriveBits","deriveKey"]),M=N==="aes-128-gcm2"?128:256,B=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:xL,hash:"SHA-256",salt:x},F,M+lJ);return new Uint8Array(B).subarray(M/8)}(this._encryptionMode,b,Dc(this._encryptionSalt)),this._encryptDataStreamKey=await async function(N,L,x){const F=await window.crypto.subtle.importKey("raw",L,"PBKDF2",!1,["deriveBits","deriveKey"]),M=N==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:xL,hash:"SHA-256",salt:x},F,{name:"AES-GCM",length:M},!0,["encrypt","decrypt"])}(this._encryptionMode,b,Dc(this._encryptionSalt))}else d?T.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):T.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,T.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:m.stringUid});const g=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&g===this._sessionId&&Se.joinChannelTimeout(this._sessionId,5)},5e3);try{var w;let y;const b=m.cloudProxyServer;if(te(w=["proxy3","proxy4","proxy5"]).call(w,b)){const M=A("PROXY_SERVER_TYPE3");Array.isArray(M)?m.proxyServer=M[0]:m.proxyServer=M}if(Se.setProxyServer(m.proxyServer),T.setProxyServer(m.proxyServer),this.store.requestAPStart(),h){if(T.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(m.stringUid?", ".concat(m.stringUid," => ").concat(h.intUid):""," ")),m.stringUid&&!m.uid&&(m.uid=h.intUid),y={gatewayInfo:h.ap.gatewayInfo},A("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&m.turnServer.mode==="auto")if(h.ap.proxyInfo.addresses.length===0)T.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const M=(await IM(h.ap.proxyInfo,h.ap.gatewayInfo.uid)).map(B=>({turnServerURL:B.address,tcpport:B.tcpport||Gn.tcpport,udpport:B.udpport||Gn.udpport,username:B.username||Gn.username,password:B.password||Gn.password,forceturn:!1,security:!0}));m.turnServer={mode:"manual",servers:M}}LU(h,m.stringUid)}else{if(m.stringUid&&!m.uid){let M;[M,y]=await ae.all([$M(m.stringUid,m,this._axiosCancelSource.token,this._config.httpRetryConfig||nn,this.store).finally(()=>{this.store.requestSUAEnd()}),ZM(m,this._axiosCancelSource.token,this._config.httpRetryConfig||nn,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),T.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(m.stringUid," => ").concat(M)),m.uid=M,y.gatewayInfo.uid=M,y.gatewayInfo.res.uid=M}else y=await ZM(m,this._axiosCancelSource.token,this._config.httpRetryConfig||nn,!0,this.store);if(!this._joinAndNotLeaveYet)throw new j(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(m,this._axiosCancelSource.token),this._configDistribute.on(ko.UPDATE_BITRATE_LIMIT,M=>{this._p2pChannel.updateBitrateLimit(M)}),this._configDistribute.on(ko.UPDATE_CLIENT_ROLE_OPTIONS,M=>{this._setClientRoleOptions(M)}),this._configDistribute.on(ko.UPDATE_REMOTE_VIDEO_STREAM_TYPE,M=>{var B;te(B=[0,1,4,5,6,7,8,9]).call(B,M)&&(this.remoteUsers.forEach(J=>{this._remoteStreamTypeCacheMap.get(J.uid)!==M&&this.setRemoteVideoStreamType(J.uid,M)}),this.setRemoteDefaultVideoStreamType(M))}),this._configDistribute.on(ko.FALLBACK_TO_HLS,M=>{M&&this.safeEmit(Ye.FALLBACK_TO_HLS,Yv.CONFIG)}),this._configDistribute.on(ko.UPDATE_VOS_CONFIGURE,M=>{this._gateway.setConfigure(M).catch(B=>{T.debug("[".concat(this._clientId,"] auto set vos config failed"),B)})})},0),this._key=n||e;const N=y.gatewayInfo,L=m.uid?m.uid:N.uid;this._joinInfo=ho(ho({},m),{},{cid:N.cid,uid:L,vid:N.vid,apResponse:N.res,apGatewayAddress:N.apGatewayAddress,uni_lbs_ip:N.uni_lbs_ip,gatewayAddrs:N.gatewayAddrs}),this.store.intUid=L,this.store.cid=N.cid;const x=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new j(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));_.onSuccess(x),this._appId=e,this._channelName=m.cname,this._uid=x,this.store.uid=x,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),!An()&&this.store.useDcSignal?(window.addEventListener("beforeunload",this._handleBeforeUnload),window.addEventListener("pagehide",this._handleBeforeUnload)):window.addEventListener(An()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const F=m.stringUid?"string uid: ".concat(m.stringUid,",uid: ").concat(m.uid):"uid: ".concat(this._uid);return T.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(F)),setTimeout(()=>{T.startUpload()},5e3),this.store.joinEnd(),R=this,te(jc).call(jc,R)||jc.push(R),this._cloudProxyServerMode==="disabled"&&qe().supportWebCrypto&&A("ENABLE_PRELOAD")&&Oy(this._joinInfo),this._rteDetailInterval&&(window.clearInterval(this._rteDetailInterval),this._rteDetailInterval=void 0),this._sessionId&&Se.reportRteDetail(this._sessionId),this._rteDetailInterval=window.setInterval(()=>{this._sessionId&&Se.reportRteDetail(this._sessionId)},A("RTE_DETAIL_REPORT_INTERVAL")||6e4),x}catch(y){const b=Array.isArray(y)?y[0]:y;throw b&&b.code===O.OPERATION_ABORTED?T.warning("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),b):T.error("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),b),b.code!==O.OPERATION_ABORTED&&this._numberOfJoinCount===s&&(this._gateway.state="DISCONNECTED",this._reset()),_.onError(b),b}var R}async _joinGateway(){if(!this._joinInfo||!this._key)throw new j(O.INVALID_OPERATION);try{return await this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!A("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}catch(e){if(e.code===O.INIT_DATACHANNEL_TIMEOUT){if(this._gateway.leave(!0,Qe.FALLBACK),T.debug("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new j(O.INVALID_OPERATION);return Se.reportApiInvoke(this._sessionId,{name:kt.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:yt.TRACER}).onSuccess(),await this._joinGateway()}throw e}}async leave(){T.info("[".concat(this._clientId,"] Leaving channel"));const e=()=>{!An()&&this.store.useDcSignal?(window.addEventListener("beforeunload",this._handleBeforeUnload),window.addEventListener("pagehide",this._handleBeforeUnload)):window.addEventListener(An()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(n){const r=jc.indexOf(n);r!==-1&&jc.splice(r,1)}(this),this._statsCollector.stopUpdateStats()};this.store.useDcSignal||e();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return T.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED",Qe.LEAVE),T.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t(),this.store.useDcSignal&&e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof vl))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new j(O.INVALID_PARAMS,"param list is empty");const n=e;if(this._gateway.role==="audience")throw new j(O.INVALID_OPERATION,"audience can not publish stream");for(const i of n){if(!(i instanceof vl))throw new j(O.INVALID_PARAMS,"parameter is not local track");if(!i._enabled&&t)throw new j(O.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(i.getTrackId()))}T.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(i=>"".concat(i.getTrackId()," "))));const r=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&n.forEach(i=>{const s=this._configDistribute.getBitrateLimit();i instanceof Ct&&s&&i.setBitrateLimit(s.uplink)});try{await this._publishHighStream(n),T.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(i=>"".concat(i.getTrackId()," "))))}catch(i){throw T.error("[".concat(this._clientId,"] publish error"),i.toString()),i}finally{r()}}async _publishDataChannel(e){if(e==null)throw new j(O.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(e)));Rt(e.id,"id",0,65535,!0),to(e.ordered,"ordered"),Mn(e.metadata,"metadata",0,512),T.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(i=>i.id===e.id)!==-1)throw new j(O.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new j(O.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new j(O.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&A("FORCE_TURN")&&!A("TURN_ENABLE_TCP")&&!A("TURN_ENABLE_UDP"))throw new j(O.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=function(i){return WM(i,!1)}(e),r=await this._p2pChannel.publishDataChannel([n]);if(r.length>0){if(typeof n._originDataChannelId!="number")throw T.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new j(O.CREATE_DATACHANNEL_ERROR);try{await ae.all(r.map(i=>this._uid&&this._gateway.publishDataChannel(this._uid,i,!0))),await n._waitTillOpen()}catch(i){if(i.code!==O.DISCONNECT_P2P)throw i}}return T.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw T.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new j(O.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof vl))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);T.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(r=>"".concat(r.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this.store.useP2P){const r=await this._p2pChannel.unpublish(t);r&&await this._gateway.sendExtensionMessage(Zt.UNPUBLISH,{unpubMsg:r},!0)}else{const r=await this._p2pChannel.unpublish(t);r&&await this._gateway.unpublish(r,this._uid),T.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(i=>"".concat(i.getTrackId()))))}}catch(r){throw T.error("[".concat(this._clientId,"] unpublish error"),r.toString()),r}finally{n&&n()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),T.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(n=>"".concat(n.id," "))," "));const t=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(e);n&&await this._gateway.unpublishDataChannel(n),T.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(r=>"".concat(r.id))))}catch(n){throw T.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{t&&t()}}async subscribe(e,t,n){if(!(e instanceof Oa)){const r=this.remoteUsers.find(i=>i.uid===e);if(!r)throw new j(O.INVALID_REMOTE_USER,"user is not in the channel");e=r}return t==="datachannel"?this._subscribeDataChannel(e,n):this._subscribe(e,t)}async presubscribe(e,t){if(tn(t,"mediaType",["audio","video"]),this.store.useP2P)throw new j(O.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new j(O.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new j(O.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=t===_e.AUDIO,r=t===_e.VIDEO,i=await this._subscribeMutex.lock();try{const{ssrcId:s,ortc:a,rtxSsrcId:d,cname:l,uint_id:h}=await this._gateway.presubscribe(e,t,!0);if(s==null)throw new j(O.UNEXPECTED_RESPONSE,"no ssrc id");let p=this._users.find(m=>m.uid===e);p||(p=new Oa(e,h||e),p._is_pre_created=!0,this._users.push(p)),l&&(p._cname=l),p._uintid||(p._uintid=h||e),n&&(p._audioSSRC=s,p._audio_pre_subscribed=!0,a&&(p._audioOrtc=a)),r&&(p._videoSSRC=s,p._video_pre_subscribed=!0,a&&(p._videoOrtc=a),d!=null&&(p._rtxSsrcId=d)),T.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(s)),await this._p2pChannel.subscribe(p,t,s,d,a);const _=n?p._audioTrack:p._videoTrack;if(!_)throw new j(O.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(p._trust_audio_stream_added_state_=!0,p._audio_added_=!0),r&&(p._trust_video_stream_added_state_=!0,p._video_added_=!0),_}catch(s){throw T.error("[".concat(this._clientId,"] presub user ").concat(e," error"),s),s}finally{i()}}async _subscribeDataChannel(e,t){var n;if(Rt(t,"channelId",0,65535,!0),!this._joinInfo)throw new j(O.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new j(O.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(d=>d===e))throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new j(O.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new j(O.INVALID_REMOTE_USER,"user is not published");const i=(n=e._dataChannels)===null||n===void 0?void 0:n.find(d=>d.id===t);if(!i)throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new j(O.REMOTE_USER_IS_NOT_PUBLISHED);const s=await this._subscribeMutex.lock();T.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const d=await this._p2pChannel.subscribeDataChannel(e,[i]);if(d&&te(d).call(d,i.id))try{var a;if(typeof i._originDataChannelId!="number")throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new j(O.CREATE_DATACHANNEL_ERROR);const l={id:i.id,datachannelId:i._originDataChannelId,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:(a=i.metadata)!==null&&a!==void 0?a:""};await this._gateway.subscribeDataChannel(e.uid,l,!0),await i._waitTillOpen()}catch(l){if((l==null?void 0:l.code)!==O.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[i]),l;await this._p2pChannel.unsubscribeDataChannel(e,[i]),this._p2pChannel.setPendingRemoteDataChannel(e,i.id)}return T.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),i}finally{s()}}async _p2pSubscribe(e,t,n){if(tn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new j(O.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new j(O.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(s=>s===e)){const s=new j(O.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),s}if(!e.hasAudio&&!e.hasVideo){const s=new j(O.INVALID_REMOTE_USER,"user is not published");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),s}if(!n&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){const s=new j(O.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),s}const i=await this._subscribeMutex.lock();T.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const a=t==="audio"?e._audioSSRC:e._videoSSRC,d=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,a,d)}catch(a){throw a}T.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType!==void 0&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(a=>{T.warning("[".concat(this._clientId,"] auto set fallback failed"),a)});const s=t==="audio"?e._audioTrack:e._videoTrack;if(!s)throw new j(O.UNEXPECTED_ERROR,"can not find remote track in user object");return s}catch(s){throw T.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),s),s}finally{i()}}async _subscribe(e,t,n){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(tn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new j(O.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new j(O.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(h=>h===e)){const h=new j(O.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),h}if(!e.hasAudio&&!e.hasVideo){const h=new j(O.INVALID_REMOTE_USER,"user is not published");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),h}if(!(n||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const h=new j(O.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),h}let i=t==="audio"?e._audioSSRC:e._videoSSRC,s=t==="audio"?e._audioOrtc:e._videoOrtc,a=t==="video"?e._rtxSsrcId:void 0,d={stream_type:t==="audio"?_e.AUDIO:_e.VIDEO,ssrcId:i};t==="video"&&this.store.firstVideoFrameDecoded(e.uid,{subscribeStart:Date.now()});const l=await this._subscribeMutex.lock();T.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const p=t==="audio"?e._audioSSRC:e._videoSSRC;p!==void 0&&p!==i&&(i=p,s=t==="audio"?e._audioOrtc:e._videoOrtc,a=t==="video"?e._rtxSsrcId:void 0,d={stream_type:t==="audio"?_e.AUDIO:_e.VIDEO,ssrcId:i}),Xn.markSubscribeStart(this.store.clientId,i),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,i,a,s);try{this._p2pChannel.isPreSubScribe(i)||await this._gateway.subscribe(e.uid,d,!0)}catch(_){if((_==null?void 0:_.code)!==O.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),_;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(p){throw this._p2pChannel.reportSubscribeEvent(!1,p==null?void 0:p.code,e,t),p}T.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType!==void 0&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(p=>{T.warning("[".concat(this._clientId,"] auto set fallback failed"),p)});const h=t==="audio"?e._audioTrack:e._videoTrack;if(!h)throw new j(O.UNEXPECTED_ERROR,"can not find remote track in user object");return t==="video"&&(this.store.firstVideoFrameDecoded(e.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(e)),h}catch(h){throw T.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),h),h}finally{l()}}async massSubscribe(e){if(Vs(e,"subscribeList"),!this._joinInfo)throw new j(O.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new j(O.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,r=await this._subscribeMutex.lock();T.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(d=>{let{user:l,mediaType:h}=d;return"user: ".concat(l==null?void 0:l.uid,", mediaType: ").concat(h)}).join("; ")));const i=(e=[...e]).map(d=>{let{user:l,mediaType:h}=d;return{user:l,mediaType:h}}),s=await this._p2pChannel.globalLock();try{var a;for(let l=e.length-1;l>=0;l--){const h=e[l],{user:p,mediaType:_}=h;if(tn(_,"mediaType",["audio","video"]),!p){const R=new j(O.INVALID_PARAMS,"user property does not exist in subscribeList item");throw T.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),R}if(!this._users.find(R=>R===p)){const R=new j(O.INVALID_REMOTE_USER,"user is not in the channel");T.error("[".concat(this._clientId,"] can not massSubscribe ").concat(p.uid,", this user is not in the channel")),i[l].error=R,e.splice(l,1);continue}if(_==="audio"&&(!p.hasAudio||p._audioSSRC===void 0)||_==="video"&&(!p.hasVideo||p._videoSSRC===void 0)){const R=new j(O.REMOTE_USER_IS_NOT_PUBLISHED);T.error("[".concat(this._clientId,"] can not subscribe ").concat(p.uid," with mediaType ").concat(_,", remote user is not published")),i[l].error=R,e.splice(l,1);continue}const g=Rn.Video|Rn.LwoVideo,w=n.get(p);if(w){if(_==="video"?w&g:w&Rn.Audio){e.splice(l,1),T.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(p.uid,", mediaType:").concat(_," twice"));continue}n.set(p,w|(_==="video"?g:Rn.Audio))}else n.set(p,_==="video"?g:Rn.Audio)}for(let l=e.length-1;l>=0;l--){const h=e[l],{user:p,mediaType:_}=h,m=Rn.Video|Rn.LwoVideo;if(this._p2pChannel.hasRemoteMedia(p,_)){await this._p2pChannel.unmuteRemoteNoLock(p,_);const g=n.get(p);n.set(p,_==="video"?g^m:g^Rn.Audio),e.splice(l,1)}}this.store.massSubscribe(e.map(l=>({userId:l.user.uid,type:l.mediaType})),t);let d=Oi(a=Array.from(n.entries())).call(a,(l,h)=>{let[p,_]=h;if(_===0)return l;const m={stream_id:p.uid,stream_type:_};return _&Rn.Audio&&(m.audio_ssrc=p._audioSSRC),_&Rn.Video&&(m.video_ssrc=p._videoSSRC),l.push(m),l},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(h=>{let{user:p,mediaType:_}=h;return{user:p,mediaType:_,ssrcId:_===_e.VIDEO?p._videoSSRC:p._audioSSRC,rtxSsrcId:_===_e.VIDEO?p._rtxSsrcId:void 0}}));const l=new Map;if(d=d.filter(h=>h.video_ssrc&&!this._p2pChannel.isPreSubScribe(h.video_ssrc)||h.audio_ssrc&&!this._p2pChannel.isPreSubScribe(h.audio_ssrc)||!h.video_ssrc&&!h.audio_ssrc),d.length>0){const h=await this._gateway.subscribeAll(d,!0);((h==null?void 0:h.users)||[]).forEach(p=>{let{stream_id:_,video_error_code:m,audio_error_code:g,error_code:w}=p;(m||g||w)&&l.set(_,{video_error_code:m,audio_error_code:g,error_code:w})})}if(Array.from(l.entries()).length>0){const h=[];Array.from(l.entries()).forEach(p=>{let[_,m]=p;const g=this.remoteUsers.find(w=>w.uid===_);if(g){let w;m.error_code||m.video_error_code&&m.audio_error_code?w=void 0:m.video_error_code?w=_e.VIDEO:m.audio_error_code&&(w=_e.AUDIO),h.push({user:g,mediaType:w})}}),h.length>0&&await this._p2pChannel.massUnsubscribeNoLock(h)}for(const h of i){const p=l.get(h.user.uid);if(p){const _=p.error_code||h.mediaType==="audio"&&p.audio_error_code||h.mediaType==="video"&&p.video_error_code;if(_){const m=Hc(_);T.error("user:".concat(h.user.uid," mediaType:").concat(h.mediaType," has massSubscribe error ").concat(m.desc)),h.error=new j(O.SUBSCRIBE_FAILED,"code ".concat(_,": ").concat(m.desc))}}h.error||(h.mediaType==="video"?h.track=h.user.videoTrack:h.track=h.user.audioTrack)}return this.store.massSubscribe(i.filter(h=>!h.error).map(h=>({userId:h.user.uid,type:h.mediaType})),void 0,Date.now()),i.forEach(h=>{var p;Se.subscribe(this.store.sessionId,{succ:!!h.error,ec:((p=h.error)===null||p===void 0?void 0:p.code)||null,video:h.mediaType===_e.VIDEO,audio:h.mediaType===_e.AUDIO,peerid:h.user.uid,subscribeRequestid:h.mediaType===_e.VIDEO?h.user._videoSSRC:h.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(h.user._videoSSRC)},!0)}),T.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(h=>{let{user:p,mediaType:_}=h;return"user: ".concat(p==null?void 0:p.uid,", mediaType: ").concat(_)}).join("; "))),i}catch(l){throw await this._p2pChannel.massUnsubscribeNoLock(e),l}}finally{s(),r()}}async unsubscribe(e,t,n){if(!(e instanceof Oa)){const s=this.remoteUsers.find(a=>a.uid===e);if(!s)throw new j(O.INVALID_REMOTE_USER,"user is not in the channel");e=s}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,n)}else await this._unsubscribeDataChannel(e,n);if(t&&tn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new j(O.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(s=>s===e)){const s=new j(O.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),s}T.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const i=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{const s=await this._p2pChannel.unsubscribe(e,t);s&&await this._gateway.unsubscribe(s,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&k_(this._users,e),T.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(s){if(s.code===O.DISCONNECT_P2P)return void T.warning("disconnecting p2p, abort unsubscribe request.");throw T.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),s.toString()),s}finally{i()}}async _unsubscribeDataChannel(e,t){if(t&&Rt(t,"id",0,65535,!0),!this._joinInfo)throw new j(O.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(i=>i===e)){const i=new j(O.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),i}let r;if(typeof t=="number"){const i=e._dataChannels.find(s=>s.id===t);i&&(r=[i])}else r=e._dataChannels;if(r===void 0){const i=new j(O.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),i}T.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(r.map(i=>i.id)));try{const i=await this._p2pChannel.unsubscribeDataChannel(e,r);i&&await this._gateway.unsubscribeDataChannel(i,e.uid),T.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(i))}catch(i){if(i.code===O.DISCONNECT_P2P)return void T.warning("disconnecting p2p, abort unsubscribe request.");throw T.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),i.toString()),i}}async massUnsubscribe(e){if(Vs(e,"unsubscribeList"),!this._joinInfo)throw new j(O.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");T.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(n=>{let{user:r,mediaType:i}=n;return"user: ".concat(r==null?void 0:r.uid,", mediaType: ").concat(i,";")}).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:r,mediaType:i}=e[n];if(!r){const d=new j(O.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw T.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),d}if(tn(i,"mediaType",["video","audio",void 0]),!this._users.find(d=>d===r)){T.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),e.splice(n,1);continue}const a=Rn.Video|Rn.LwoVideo;if(t.has(r)){const d=t.get(r);let l;switch(i){case"video":l=d&a;break;case"audio":l=d&Rn.Audio;break;default:l=d&(Rn.Audio|a)}if(l){T.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(r.uid,",mediaType:").concat(i," twice.")),e.splice(n,1);continue}i?i==="audio"?t.set(r,d|Rn.Audio):i==="video"&&t.set(r,d|a):t.set(r,d|Rn.Audio|a)}else i?i==="audio"?t.set(r,Rn.Audio):i==="video"&&t.set(r,a):t.set(r,Rn.Audio|a)}try{const n=await this._p2pChannel.massUnsubscribe(e);n&&await this._gateway.massUnsubscribe(n),T.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(r=>{let{user:i,mediaType:s}=r;return"user: ".concat(i==null?void 0:i.uid,", mediaType: ").concat(s,";")}).join()))}catch(n){if(n.code===O.DISCONNECT_P2P)return void T.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw T.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(e){(function(n){if(!n)throw new Y(O.INVALID_PARAMS);Wt(n.width)||jv(n.width,"streamParameter.width"),Wt(n.height)||jv(n.height,"streamParameter.height"),Wt(n.framerate)||jv(n.framerate,"streamParameter.framerate"),Wt(n.bitrate)||Rt(n.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&T.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),T.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,ne.LocalVideoLowTrack)}async setDualStreamMode(e,t){tn(e,"mode",[0,1,-1]);try{switch(t&&await this.setLowStreamParameter(t),this._dualStreamMode=e,this._joinInfo?this._gateway.setDualStreamMode(e).catch(n=>{T.warning("[".concat(this._clientId,"] set dual stream mode failed"),n.toString())}):T.debug("[".concat(this._clientId,"] haven't joined yet, cache dual stream mode ").concat(e)),e){case ll.AUTO_SIMULCAST_STREAM:T.info("[".concat(this._clientId,"] set dual stream mode to ").concat(e));break;case ll.DISABLE_SIMULCAST_STREM:return this.disableDualStream();case ll.ENABLE_SIMULCAST_STREAM:return this.enableDualStream()}}catch(n){throw T.error("[".concat(this._clientId,"] set dual stream mode error"),n.toString()),n}}async enableDualStream(){if(!qe().supportDualStream)throw Se.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new j(O.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new j(O.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw Se.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,this._dualStreamMode=ll.ENABLE_SIMULCAST_STREAM,this._joinInfo&&this._gateway.setDualStreamMode(this._dualStreamMode,!0,!0).catch(e=>{T.debug("[".concat(this._clientId,"] try to inform gateway to set dual stream mode to ").concat(this._dualStreamMode," ,but failed"),e.toString())}),Se.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),T.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)return this._isDualStreamEnabled=!1,void T.info("[".concat(this._clientId,"] disable dual stream before join"));if(this._p2pChannel.getLocalMedia(ne.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw Se.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,this._dualStreamMode=ll.DISABLE_SIMULCAST_STREM,this._joinInfo&&this._gateway.setDualStreamMode(this._dualStreamMode,!0,!0).catch(e=>{T.debug("[".concat(this._clientId,"] try to inform gateway to set dual stream mode to ").concat(this._dualStreamMode," ,but failed"),e.toString())}),Se.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),T.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(r){tn(r,"role",["audience","host"])}(e),t&&Kv(t),this.mode==="rtc"||this.mode==="p2p")throw T.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new j(O.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new j(O.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new j(O.INVALID_OPERATION,"can not set client role to audience when publishing stream");const n=this._config.role;if(this._joinInfo&&(this._joinInfo.role=e),e!==n&&A("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",jn.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),T.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level)),n==="audience"&&e!=="audience"&&this._pendingRtpCapabilityChange&&this._p2pChannel instanceof qc){const{video_codec:r}=this._pendingRtpCapabilityChange;this._p2pChannel.updateRemoteRTPCapabilities(r.map(i=>i.toLowerCase()).filter(i=>{var s;return te(s=Object.keys(kc)).call(s,i)}))}}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&Kv(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{T.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(Mn(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new j(O.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new j(O.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,Se.setProxyServer(this._proxyServer),T.setProxyServer(this._proxyServer),T.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new j(O.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new j(O.INVALID_OPERATION,"You have already set the proxy")}if(Ac(e))return this._turnServer={servers:e,mode:"original-manual"},void T.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(n=>n.urls).join(","),"."));e.forEach(n=>_L(n)),this._turnServer={servers:e,mode:"manual"},T.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new j(O.INVALID_OPERATION,"you should set license before join channel");if(Mn(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new j(O.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,T.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new j(O.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new j(O.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(e===void 0&&(e=3),e){case 1:case 2:throw new j(O.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new j(O.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,T.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new j(O.INVALID_OPERATION,"Stop proxy server after leave channel");Se.setProxyServer(),T.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",T.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new j(O.INVALID_PARAMS,"accessPoints is required.");Vs(e.accessPoints.serverList,"accessPoints.serverList"),Mn(e.accessPoints.domain,"accessPoints.domain");const t=(m,g)=>{Rt(m,g,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new j(O.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");A("CLOSE_AFB_FOR_LOCAL_AP")&&(St("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),St("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i=e.accessPoints.domain,s=e.accessPoints.serverList.map(m=>r.test(m)?"".concat(m.replace(/\./g,"-"),".").concat(i):m),a=s.map(m=>"".concat(m,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,St("WEBCS_DOMAIN",a),St("WEBCS_DOMAIN_BACKUP_LIST",a),St("GATEWAY_DOMAINS",[i]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(Vs(e.report.hostname,"report.hostname"),St("EVENT_REPORT_DOMAIN",e.report.hostname[0]),St("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(St("EVENT_REPORT_DOMAIN",s[0]),St("EVENT_REPORT_BACKUP_DOMAIN",s[1]||s[0]));let d=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),d=e.report.port),St("STATS_COLLECTOR_PORT",d),e.report?St("ENABLE_EVENT_REPORT",!0):St("ENABLE_EVENT_REPORT",!1);let l="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(Vs(e.log.hostname,"log.hostname"),l=e.log.hostname[0]):l=s[0];let h=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),h=e.log.port),St("LOG_UPLOAD_SERVER","".concat(l,":").concat(h));let p=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(Vs(e.cds.hostname,"cds.hostname"),p=e.cds.hostname):p=s;let _=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),_=e.cds.port),St("CDS_AP",p.map(m=>"".concat(m,":").concat(_))),e.cds?St("ENABLE_CONFIG_DISTRIBUTE",!0):St("ENABLE_CONFIG_DISTRIBUTE",!1),T.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(Vs(e,"serverList"),Mn(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new j(O.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(r=>n.test(r)?"".concat(r.replace(/\./g,"-"),".").concat(t):r),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,St("WEBCS_DOMAIN",e),St("WEBCS_DOMAIN_BACKUP_LIST",e),St("GATEWAY_DOMAINS",[t]),St("EVENT_REPORT_DOMAIN",e[0]),St("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),St("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),T.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(tn(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw T.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else T.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){tn(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const n=this._users.find(r=>r.uid===e);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw T.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}T.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){tn(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(n){throw T.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}T.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n,r){(function(s){tn(s,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),Mn(t,"secret");const i=["aes-128-gcm2","aes-256-gcm2"];if(te(i).call(i,e)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new j(O.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new j(O.INVALID_PARAMS,"current encrypt mode does not need salt");if(r){if(to(r,"encryptDataStream"),!te(i).call(i,e))throw new j(O.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||T.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=Ra(n))}async renewToken(e){if(Mn(e,"token",1,2047),!this._key||!this._joinInfo)throw new j(O.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(A("USE_NEW_TOKEN")){T.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const r=await GQ(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||nn);T.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:r})}else T.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});T.debug("[".concat(this._clientId,"] renewToken success"))}catch(r){throw this._key=t,this._joinInfo.token=t,T.error("[".concat(this._clientId,"] renewToken failed"),r.toString()),r}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?T.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(Ye.VOLUME_INDICATOR,e)},A("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new j(O.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new j(O.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new j(O.LIVE_STREAMING_TASK_CONFLICT);const n=t?Bs.TRANSCODE:Bs.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(Bs.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(e));if(!t.length)throw new j(O.INVALID_PARAMS,"can not find live streaming url to stop");await ae.all(t.map(n=>n&&n.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){oU(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){oU(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof qc&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new j(O.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const i=new TextEncoder;e.payload=i.encode(e.payload)}let r=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&te(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(r=!0,e.payload=await async function(i,s,a){var d;const l=Oi(d=Array.from(a)).call(d,(R,y)=>R+y,0),h={serverTs:0,seq:uJ++,length:a.length,checkSum:l},p=new Uint8Array(CL(l,2)),_=new ArrayBuffer(ml),m=new DataView(_);m.setUint32(0,h.serverTs),m.setUint16(4,h.seq),m.setUint16(6,h.length),m.setUint16(8,h.checkSum);const g=16-a.length%16;a=SL(a,new Uint8Array(g));const w=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i,tagLength:UL,additionalData:p},s,a);return SL(new Uint8Array(_),new Uint8Array(w))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new j(O.INVALID_PARAMS,r?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(ye.DATA_STREAM,{payload:Ra(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-QQ},!n)}sendMetadata(e){if(!this._joinInfo)throw new j(O.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new j(O.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(ye.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Ra(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(TJ),!this._joinInfo)throw new j(O.INVALID_OPERATION,"can not send custom report, not joined");await Se.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const e=this._statsCollector.getRemoteNetworkQualityStats();if(A("DELETE_NEQ_AFTER_USER_LEAVE")){const t=this._users.map(n=>n.uid+"");Object.keys(e).forEach(n=>{te(t).call(t,n)||delete e[n]})}return e}getNetworkQuality(){return this._statsCollector.getNetworkQuality()}async pickSVCLayer(e,t){tn(t.spatialLayer,"spatialLayer",[0,1,2,3]),tn(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(n){throw T.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:n}=e;if(to(t,"apRTM"),Rt(n,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=n,T.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(T.debug("[".concat(this._clientId,"] reset client")),function(e){const t=Al.indexOf(e);t!==-1&&Al.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._pendingRtpCapabilityChange=void 0,this._axiosCancelSource.cancel(),this._axiosCancelSource=Cr.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&PU(this._joinInfo),this._rteDetailInterval&&(window.clearInterval(this._rteDetailInterval),this._rteDetailInterval=void 0,this._sessionId&&Se.reportRteDetail(this._sessionId)),this._fallbackServerInfo=void 0,this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&Se.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new bn("client-publish",this._clientId),this._subscribeMutex=new bn("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var n;const r=e||Pc();e?T.debug("[".concat(this._clientId,"] new Session ").concat(r)):T.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(r));const i=e?"":this._sessionId||"";this._sessionId=r,this.store.sessionId=r,Se.addSid(r);const s={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(t==null?void 0:t.stringUid)||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:i,clientRole:this.role==="audience"?2:1,rteUrl:this.store.rteUrl,rteSid:this.store.rteSid};Se.sessionInit(this._sessionId,ho({cname:t.channel,appid:t.appId},s)),this._joinInfo&&(this._joinInfo.sid=r),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=r)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new j(O.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new j(O.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&A("FORCE_TURN")&&!A("TURN_ENABLE_TCP")&&!A("TURN_ENABLE_UDP"))throw new j(O.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");T.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const r=(await n.next()).value;if(r){try{await this._gateway.sendExtensionMessage(Zt.PUBLISH,r,!0)}catch(i){throw n.throw(i),i}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const r=(await n.next()).value;if(r){var t;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(s){if(s.code!==O.DISCONNECT_P2P)throw n.throw(s),s}await n.next(((t=i)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const i of e)i instanceof Ct&&i._encoderConfig&&this._gateway.setVideoProfile(i._encoderConfig).catch(s=>{T.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!i.muted&&i.enabled||await this._p2pChannel.muteLocalTrack(i)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,e),(n==null?void 0:n.code)===O.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new j(O.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new j(O.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));T.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),r=(await n.next()).value;if(r){var t;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(s){if(s.code!==O.DISCONNECT_P2P)throw n.throw(s),s}n.next(((t=i)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===O.WS_ABORT)return;throw n}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new j(O.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=(r={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Uo("LiveStreaming").create(r));var r;return n.onLiveStreamError=(i,s)=>{Se.reportApiInvoke(this._sessionId,{name:kt.ON_LIVE_STREAM_ERROR,options:[i,s],tag:yt.TRACER}).onSuccess(),this.safeEmit(Ye.LIVE_STREAMING_ERROR,i,s)},n.onLiveStreamWarning=(i,s)=>{Se.reportApiInvoke(this._sessionId,{name:kt.ON_LIVE_STREAM_WARNING,options:[i,s],tag:yt.TRACER}).onSuccess(),this.safeEmit(Ye.LIVE_STREAMING_WARNING,i,s)},n.on(GR.REQUEST_WORKER_MANAGER_LIST,(i,s,a)=>{if(!this._joinInfo)return a(new j(O.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(d,l,h,p){const _=A("UAP_AP").slice(0,A("AJAX_REQUEST_CONCURRENT")).map(m=>l.proxyServer?"https://".concat(l.proxyServer,"/ap/?url=").concat(m+"/api/v1?action=uap"):"https://".concat(m,"/api/v1?action=uap"));return await MQ(_,d,l,h,p)})(i,this._joinInfo,this._axiosCancelSource.token,nn).then(s).catch(a)}),n};return e===Bs.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new j(O.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:n}=this.getLocalVideoStats(),r=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:n}},Uo("ChannelMediaRelay").create(e));r.on("state",i=>{i===xr.RELAY_STATE_FAILURE&&r&&r.dispose(),this.safeEmit(Ye.CHANNEL_MEDIA_RELAY_STATE,i)}),r.on("event",i=>{this.safeEmit(Ye.CHANNEL_MEDIA_RELAY_EVENT,i)}),this._channelMediaRelayClient=r,this._statsCollector.onStatsChanged=(i,s)=>{var a;i==="resolution"&&((a=this._channelMediaRelayClient)===null||a===void 0||a.setVideoProfile(s))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:n,deleted:r}=e,i=[];if(t){const s=[];this._users.forEach(a=>{a._dataChannels.forEach(d=>{n.every(l=>l.uid!==a._uintid||l.stream_id!==d.id)&&s.push({uid:a._uintid,stream_id:d.id,ordered:d.ordered,max_retrans_times:d.maxRetransmits,metadata:d.metadata})})}),s.length>0&&this._handleUpdateDataChannel({added:[],deleted:s})}Array.isArray(n)&&n.length>0&&n.forEach(s=>{const{uid:a,stream_id:d,ordered:l,max_retrans_times:h,metadata:p}=s,_=this._users.find(m=>m._uintid===a);if(!_)return void T.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(T.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(a)),te(i).call(i,_)||i.push(_),_._uintid||(_._uintid=a),_._dataChannels.findIndex(m=>m.id===s.stream_id)===-1){const m={id:d,ordered:!!l,maxRetransmits:h,metadata:p},g=function(w){return WM(w,!0)}(m);_._dataChannels.push(g),T.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published datachannel")),t||this.safeEmit(Ye.USER_PUBLISHED,_,"datachannel",m)}this._p2pChannel.hasPendingRemoteDataChannel(_,s.stream_id)&&(T.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(_.uid," after reconnect.")),this._subscribeDataChannel(_,s.stream_id).catch(m=>{T.error("[".concat(this._clientId,"] resubscribe datachannel error"),m.toString())}))}),t&&(this.safeEmit(Ye.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(r)&&r.length>0&&r.forEach(s=>{const{uid:a,stream_id:d}=s,l=this._users.find(p=>p._uintid===a);if(!l)return void T.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const h=l._dataChannels.find(p=>p.id===s.stream_id);h&&(T.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(a)),this._p2pChannel.unsubscribeDataChannel(l,[h]).then(p=>{if(l._dataChannels=l._dataChannels.filter(_=>_!==h),p)return this._gateway.unsubscribeDataChannel(p,l.uid)}),T.info("[".concat(this._clientId,"] remote user ").concat(a," unpublished datachannel ,id:").concat(h.id)),this.safeEmit(Ye.USER_UNPUBLISHED,l,"datachannel",h._config))})}_getEncodingName(e){var t,n;if(!this._joinResponse)return;const r=(t=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||t===void 0?void 0:t.videoCodecs;if(!r)return;for(const d of r){var i;if(d.payloadType===e)return d==null||(i=d.rtpMap)===null||i===void 0?void 0:i.encodingName}const s=(n=this._joinResponse.ortc.rtpCapabilities.recv)===null||n===void 0?void 0:n.videoCodecs;if(s)for(const d of s){var a;if(d.payloadType===e)return d==null||(a=d.rtpMap)===null||a===void 0?void 0:a.encodingName}return e===0?"unknown":void 0}_handleRemoveDataChannels(e){const t=this._users.find(n=>n.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){T.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const n=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(r=>{this.safeEmit(Ye.USER_UNPUBLISHED,t,"datachannel",r._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(r=>{if(r)return this._gateway.unsubscribeDataChannel(r,t.uid)}),n()}}else T.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Qt.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void T.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();Object.keys(t).forEach(r=>{const{value:i,type:s,expires:a}=t[r];a&&a<=n||s||MR()||!Object.prototype.hasOwnProperty.call(j_,r)||(li[r]=i,pt[r]=i,T.debug("Update gateway parameters from config distribute",r,i))})}catch(t){T.error("Error update config from local cache",t.message)}})()}),this._gateway.on(Qt.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Qt.CONNECTION_STATE_CHANGE,(e,t,n)=>{var r;if(n===Qe.FALLBACK)return;const i=()=>{this.safeEmit(Ye.CONNECTION_STATE_CHANGE,e,t,n)};if(Se.reportApiInvoke(this._sessionId||((r=this._gateway.joinInfo)===null||r===void 0?void 0:r.sid)||null,{name:kt.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:yt.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),T.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void i();if(e==="RECONNECTING")this._users.forEach(a=>{a._trust_in_room_=!1,a._trust_audio_enabled_state_=!1,a._trust_video_enabled_state_=!1,a._trust_audio_mute_state_=!1,a._trust_video_mute_state_=!1,a._trust_audio_stream_added_state_=!1,a._trust_video_stream_added_state_=!1,a._is_pre_created||(a._audio_pre_subscribed||(a._audioSSRC=void 0,a._audioOrtc=void 0),a._video_pre_subscribed||(a._videoSSRC=void 0,a._videoOrtc=void 0,a._rtxSsrcId=void 0),a._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var s;this._streamFallbackTypeCacheMap.forEach((a,d)=>{this._gateway.setStreamFallbackOption(d,a).catch(l=>{T.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),l)})}),this._remoteStreamTypeCacheMap.forEach((a,d)=>{this._gateway.setRemoteVideoStreamType(d,a).catch(l=>{T.warning("[".concat(this._clientId,"] auto set remote stream type failed"),l)})}),A("VOS_CONFIGURE")&&Array.isArray(A("VOS_CONFIGURE"))&&A("VOS_CONFIGURE").length>0&&(this._gateway.setConfigure(A("VOS_CONFIGURE")).catch(a=>{T.debug("[".concat(this._clientId,"] auto set vos config failed"),a)}),T.debug("[".concat(this._clientId,"] ws connected auto set vos config"))),this._remoteDefaultVideoStreamType!==void 0&&((s=this._joinInfo)===null||s===void 0?void 0:s.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{T.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(a=>{T.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(a))}),this._dualStreamMode&&this._gateway.setDualStreamMode(this._dualStreamMode).catch(a=>{T.warning("[".concat(this._clientId,"] auto set dual stream mode failed"),a)}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(a=>!a._trust_in_room_).forEach(a=>{T.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(a.uid)),this._handleUserOffline({uid:a.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(a=>{a._trust_audio_mute_state_||(T.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(a.uid)),this._handleMuteStream(a.uid,_e.AUDIO,!1)),a._trust_video_mute_state_||(T.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(a.uid)),this._handleMuteStream(a.uid,_e.VIDEO,!1)),a._trust_audio_enabled_state_||(T.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(a.uid)),this._handleSetStreamLocalEnable("audio",a.uid,!0)),a._trust_video_enabled_state_||(T.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(a.uid)),this._handleSetStreamLocalEnable("video",a.uid,!0)),a._trust_video_stream_added_state_||(T.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(a.uid)),this._handleResetAddStream(a,"video")),a._trust_audio_stream_added_state_||(T.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(a.uid)),this._handleResetAddStream(a,"audio")),a._video_added_||a._audio_added_||(T.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(a.uid)),this._handleRemoveStream({uid:a.uid,uint_id:a._uintid}))}))},1e3))}i()}),this._gateway.on(Qt.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new j(O.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;if(this._fallbackServerInfo)n=this._fallbackServerInfo,this._fallbackServerInfo=void 0,this._joinInfo.preload=!1,Se.reportApiInvoke(this._sessionId,{name:kt.VOS_FALLBACK_CN,options:{cur:n.gatewayInfo.gatewayAddrs,prev:this._joinInfo.gatewayAddrs,is_done:!0},tag:yt.TRACER}).onSuccess(),T.info("[".concat(this._clientId,"] use fallback cn server info"));else{const i=await Ay(ho(ho({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));i?(n=i.ap,LU(i),this._joinInfo.preload=!0):(n=await Cm(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||nn,this.store),this._joinInfo.preload=!1)}this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const r=[];n.gatewayInfo.gatewayAddrs.forEach(i=>{let{address:s}=i;const[a,d]=s.split(":");this._joinInfo&&this._joinInfo.proxyServer?r.push({proxy:this._joinInfo.proxyServer,host:a,port:d}):r.push({host:a,port:d})}),e(r)}catch(n){t(n)}}),this._gateway.on(Qt.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(Ye.NETWORK_QUALITY,e)}),this._gateway.on(Qt.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(Ye.STREAM_TYPE_CHANGED,e,t),Se.reportApiInvoke(this._sessionId,{name:kt.STREAM_TYPE_CHANGE,options:[e,t],tag:yt.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(Qt.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(Qt.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,n)=>{try{let r=await this._p2pChannel.getEstablishParams();r&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(r=await this._p2pChannel.startP2PConnection(e)),t(r)}catch(r){n(r)}}),this._gateway.on(Qt.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let n;this._joinResponse=e,e.attributes?n=e.attributes.userAttributes.preSubSsrcs:T.debug("no attributes in joinResponse");const r=LM(e.ortc,t,n);this._p2pChannel.connect(r)}),this._gateway.on(Qt.PRE_CONNECT_PC,async(e,t,n)=>{const{candidates:r,fingerprint:i,turnServer:s}=e;if(this._joinInfo&&r.length>0&&!this._p2pChannel.isPlanB){const{cert:d,cid:l}=this._joinInfo.apResponse,h="".concat(l,"_").concat(d);if(h.length<4||h.length>256)return void T.debug("[".concat(this._clientId,"] ufrag length is not valid, length: ").concat(h.length));await this._p2pChannel.startP2PConnection({turnServer:s,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var a;t(await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(l,"_").concat(d),icePwd:"".concat(l,"_").concat(d)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(a=A("FINGERPRINT"))!==null&&a!==void 0?a:i}]},candidates:r,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0}))}catch(p){p.code&&p.code===O.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:s,cloudProxyServer:this._joinInfo.cloudProxyServer},!0),n(p)}}}),this._gateway.on(Qt.VOS_FALLBACK,e=>{e==="fallback_hls"&&this.safeEmit(Ye.FALLBACK_TO_HLS,Yv.VOSERROR)}),this._gateway.on(Qt.RESET_SIGNAL,()=>{this._p2pChannel instanceof qc&&this._p2pChannel.fallbackConnection(),this._handleGatewaySignalEvents()}),this._gateway.on(Qt.DATACHANNEL_FAILBACK,()=>{Se.reportApiInvoke(this._sessionId,{name:kt.DATACHANNEL_FAILBACK,options:{},tag:yt.TRACER}).onSuccess(),this._joinGateway()})}_handleGatewaySignalEvents(){this._gateway.signal.on(Me.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Me.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Me.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc)),this._gateway.signal.on(Me.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(Me.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(Me.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(Me.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Me.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Me.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,_e.AUDIO,!0)),this._gateway.signal.on(Me.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,_e.AUDIO,!1)),this._gateway.signal.on(Me.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,_e.VIDEO,!0)),this._gateway.signal.on(Me.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,_e.VIDEO,!1)),this._gateway.signal.on(Me.RECEIVE_METADATA,e=>{const t=Dc(e.metadata);this.safeEmit(Ye.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(Me.ON_DATA_STREAM,async e=>{var t;if(!e)return;let n=Dc(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&te(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<ml)throw new j(O.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(ml));n=await async function(s,a,d){const l=d.subarray(0,ml),h=l.slice(8,ml),p=(h[0]<<8)+h[1],_=(l[6]<<8)+l[7],m=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:s,tagLength:UL,additionalData:new Uint8Array(CL(p,2))},a,d.subarray(ml));return new Uint8Array(m).subarray(0,_)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let r=0;if(e.ordered||e.syncWithAudio){const i=this._p2pChannel.getStats(),s=this.remoteUsers.find(d=>d.uid===e.uid),a=i==null?void 0:i.audioRecv.find(d=>d.ssrc===(s==null?void 0:s._audioSSRC));r=a==null?void 0:a.jitterBufferMs}(r==null||Number.isNaN(r))&&(r=0),$Q(ho(ho({},e),{},{payload:n}),r,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(Me.ON_CRYPT_ERROR,()=>{va(()=>{T.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Ye.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Me.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Me.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{T.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Qe.TOKEN_EXPIRE),this.safeEmit(Ye.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Me.ON_STREAM_FALLBACK_UPDATE,e=>{T.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(Ye.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Me.ENABLE_MULTI_STREAM,e=>{this._dualStreamMode===ll.AUTO_SIMULCAST_STREAM&&this.enableDualStream().catch(t=>{T.debug("[".concat(this._clientId,"] set dual stream mode error"),t.toString())})}),this._gateway.signal.on(Me.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),T.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(Me.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(Me.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(ve.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case ye.PUBLISH:{if(!t)return;const i=t.ortc;if(i){var n,r;const s=i.some(l=>{let{stream_type:h}=l;return h===ft.Audio}),a=i.some(l=>{let{stream_type:h}=l;return h!==ft.Audio}),d=i.some(l=>{let{stream_type:h}=l;return h===ft.Screen||h===ft.ScreenLow});t.state==="offer"&&Se.publish(this._joinInfo.sid,{eventElapse:Xn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:O.TIMEOUT,audio:s,video:a,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:d,audioName:s?(n=i.find(l=>{let{stream_type:h}=l;return h===ft.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:a?(r=i.find(l=>{let{stream_type:h}=l;return h!==ft.Audio}))===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0})}break}case ye.SUBSCRIBE:t&&Se.subscribe(this._joinInfo.sid,{succ:!1,ec:O.TIMEOUT,audio:t.stream_type===_e.AUDIO,video:t.stream_type===_e.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:Xn.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(Me.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(Me.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;A("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(r=>!Gc(r.string_id||r.stream_id,this.channelName)));const t=[],n=[];for(const r of e.users){let i=this._users.find(p=>p._uintid===r.stream_id);i?i._trust_in_room_=!0:(i=new Oa(r.string_id||r.stream_id,r.stream_id),this._users.push(i),this.store.firstVideoFrameDecoded(i.uid,{userJoinNotify:Date.now()}),this.getListeners(Ye.PUBLISHED_USER_LIST).length===0&&(T.debug("[".concat(this._clientId,"] user online"),r.stream_id),this.safeEmit(Ye.USER_JOINED,i)));const s=Rn.Audio&r.stream_type,a=(Rn.Video|Rn.LwoVideo)&r.stream_type,d=(65280&r.stream_type)!=0,l=s&&i.hasAudio,h=a&&i.hasVideo;a&&(i._trust_video_stream_added_state_=!0,i._video_added_=!0,i._videoSSRC=r.video_ssrc,i._rtxSsrcId=r.video_rtx),s&&(i._trust_audio_stream_added_state_=!0,i._audio_added_=!0,i._audioSSRC=r.audio_ssrc),s&&!l&&this.getListeners(Ye.PUBLISHED_USER_LIST).length===0&&(T.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published audio")),this.safeEmit(Ye.USER_PUBLISHED,i,"audio")),a&&!h&&this.getListeners(Ye.PUBLISHED_USER_LIST).length===0&&(T.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published video")),this.safeEmit(Ye.USER_PUBLISHED,i,"video")),(s&&!l||a&&!h||d)&&t.push(i),a&&this._p2pChannel.hasPendingRemoteMedia(i,"video")&&n.push({user:i,mediaType:"video"}),s&&this._p2pChannel.hasPendingRemoteMedia(i,"audio")&&n.push({user:i,mediaType:"audio"})}n.length>0&&(T.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(r=>"user: ".concat(r.user.uid,", mediaType: ").concat(r.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(r=>{T.error("[".concat(this._clientId,"] mass resubscribe error"),r.toString())})),this.getListeners(Ye.PUBLISHED_USER_LIST).length>0?A("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(T.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(r=>r.uid).join(", "))),this.safeEmit(Ye.PUBLISHED_USER_LIST,t)):T.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(r=>r.uid).join(", ")))}),this._gateway.signal.on(Me.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:t}=e;if(this._p2pChannel instanceof qc){if(this.role==="audience"&&A("UPDATE_RTP_CAP_IN_HOST"))return this._pendingRtpCapabilityChange=e,void T.debug("[".concat(this._clientId,"] no need to change rtp capability because of audience, params: ").concat(JSON.stringify(e)));this._p2pChannel.updateRemoteRTPCapabilities(t.map(n=>n.toLowerCase()).filter(n=>{var r;return te(r=Object.keys(kc)).call(r,n)}))}}),this._gateway.signal.on(ve.VOS_FALLBACK_PROMISE,async(e,t,n)=>{if(e==="FALLBACKCN"&&A("ENABLE_QUALITY_FALLBACK")){if(!this._joinInfo)return n(new j(O.UNEXPECTED_ERROR,"can not recover, no join info"));T.info("[".concat(this._clientId,"] try fallback to cn, start request new server info"));const i=this._joinInfo.apRequestDetail;try{this._joinInfo.apRequestDetail=e;const s=await Cm(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||nn,this.store);if(A("QUALITY_FALLBACK_REHEARSAL"))return Se.reportApiInvoke(this._sessionId,{name:kt.VOS_FALLBACK_CN,options:{cur:s.gatewayInfo.gatewayAddrs,prev:this._joinInfo.gatewayAddrs,is_done:!1},tag:yt.TRACER}).onSuccess(),this._joinInfo.apRequestDetail=i,void n();this._fallbackServerInfo=s,t()}catch(s){var r;const a=s==null||(r=s.data)===null||r===void 0?void 0:r.desc;A("QUALITY_FALLBACK_REHEARSAL")?(Se.reportApiInvoke(this._sessionId,{name:kt.VOS_FALLBACK_CN,options:{cur:"failed, errorReason: "+a||"unknown",prev:this._joinInfo.gatewayAddrs,is_done:!1},tag:yt.TRACER}).onSuccess(),this._joinInfo.apRequestDetail=i):Array.isArray(a)&&te(a).call(a,"request downgrade fallback")&&this.safeEmit(Ye.FALLBACK_TO_HLS,Yv.AP_ERROR),n(s)}}else n()})}_handleP2PEvents(){this._gateway.signal.on(Me.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Zt.PUBLISH,(e,t,n)=>{const{uid:r}=e;e.forEach(i=>{const{kind:s,ssrcs:a,mid:d,isMuted:l}=i;this._handleP2PAddAudioOrVideoStream(s,r,a[0].ssrcId,d);const h=this._users.find(p=>p.uid===r);return h&&this.store.useP2P?this._p2pChannel.mockSubscribe(h,s,a[0].ssrcId,d).then(()=>{t()}).catch(n):t(),this._handleMuteStream(r,s,!!l)})}),this._gateway.signal.on(Zt.CALL,async(e,t,n)=>{if(this.store.useP2P)try{var r;t(await this._p2pChannel.startP2P({turnServer:(r=this._joinInfo)===null||r===void 0?void 0:r.turnServer},e))}catch(i){n(i)}}),this._gateway.signal.on(ve.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(Zt.UNPUBLISH,async(e,t,n)=>{if(this.store.useP2P){const{unpubMsg:r,uid:i}=e,s=this._users.find(a=>a.uid===i);if(!s)return T.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i)),void t();try{r.forEach(async a=>{let{stream_type:d}=a;const l=d===ft.Audio?_e.AUDIO:_e.VIDEO;await this._p2pChannel.unsubscribe(s,l),this._handleMuteStream(i,l,!0)}),t()}catch(a){n(a)}}}),this._gateway.signal.on(Zt.CONTROL,async(e,t)=>{const{action:n}=e;switch(n){case wa.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,_e.VIDEO,!0);break;case wa.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,_e.AUDIO,!0);break;case wa.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,_e.VIDEO,!1);break;case wa.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,_e.AUDIO,!1)}}),this._gateway.signal.on(Zt.RESTART_ICE,async(e,t,n)=>{if(this.store.useP2P)try{const{direction:r,iceParameter:i}=e;r!==gr.SEND_ONLY||i?t(await this._p2pChannel.restartICE(r,i)):(this._p2pChannel.handleDisconnect(r),t())}catch(r){n(r)}}),this._gateway.signal.on(Zt.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:t,direction:n}=e;this._p2pChannel.addRemoteCandidate(t,n)}}),this._p2pChannel.on(Ce.RequestP2PRestartICE,async(e,t,n)=>{try{const{direction:r}=e;t(await this._gateway.sendExtensionMessage(Zt.RESTART_ICE,e,r===gr.SEND_ONLY))}catch(r){n(r)}}),this._p2pChannel.on(Ce.LocalCandidate,e=>{this._gateway.sendExtensionMessage(Zt.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(Ce.RequestP2PMuteLocal,async(e,t,n)=>{try{await this._gateway.sendExtensionMessage(Zt.CONTROL,e,!0),t()}catch(r){n(r)}}),this._p2pChannel.on(Ce.RequestP2PUnmuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===O.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(Ce.RequestP2PMuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===O.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(Ce.StateChange,(e,t)=>{t===dt.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Ce.PeerConnectionStateChange,e=>{const t=this._peerConnectionState;e!==t&&(this.safeEmit(Ye.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(Ce.RequestMuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===O.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(Ce.RequestUnmuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===O.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(Ce.RequestRePublish,(e,t,n)=>{this.publish(e,!1).then(t).catch(n)}),this._p2pChannel.on(Ce.RequestRePublishDataChannel,(e,t,n)=>{ae.all(e.map(async r=>{const i=await this._p2pChannel.publishDataChannel([r]);try{i.forEach(s=>{this._uid&&this._gateway.publishDataChannel(this._uid,s,!0)})}catch(s){if(s.code!==O.DISCONNECT_P2P)throw s}})).then(t).catch(n)}),this._p2pChannel.on(Ce.RequestReSubscribe,async(e,t,n)=>{try{for(const{user:r,kind:i}of e)i===_e.VIDEO?await this.subscribe(r,"video"):await this.subscribe(r,"audio");t()}catch(r){n(r)}}),this._p2pChannel.on(Ce.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(Ce.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(Ce.MediaReconnectStart,e=>{this.safeEmit(Ye.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Ce.MediaReconnectEnd,e=>{this.safeEmit(Ye.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Ce.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Ce.RequestRestartICE,async e=>{if(this.store.useP2P)return;const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const r=n.value;let i;try{i=await this._gateway.restartICE({iceParameters:r})}catch(a){return void t.throw(a)}const{iceParameters:s}=function(a){const d=a.iceParameters;return{iceParameters:{iceUfrag:d.iceUfrag,icePwd:d.icePwd}}}(i);await t.next({remoteIceParameters:s})}),this._p2pChannel.on(Ce.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Ce.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:i,gatewayAddress:s}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:r}),a=LM(i,s);await this._p2pChannel.connect(a),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Ce.RequestUnpublishForReconnectPC,async(e,t,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):n()}),this._p2pChannel.on(Ce.P2PLost,()=>{this.safeEmit(Ye.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Ce.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Ce.ConnectionTypeChange,e=>{this.safeEmit(Ye.IS_USING_CLOUD_PROXY,e),this._gateway.setUsingProxy(e)}),this._p2pChannel.on(Ce.FirstVideoBufferReady,(e,t)=>{this.safeEmit(Ye.FIRST_VIDEO_BUFFER_READY,e,t)}),this._p2pChannel.on(Ce.FirstVideoPreRender,(e,t)=>{this.safeEmit(Ye.FIRST_VIDEO_PRE_RENDER,e,t)}),this._p2pChannel.on(Ce.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Ce.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(Ce.AudioMetadata,e=>{this.safeEmit(Ye.AUDIO_METADATA,e)}),this._p2pChannel.on(Ce.AudioPts,e=>{this.safeEmit(Ye.AUDIO_PTS,Number(e))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new j(O.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new j(O.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(t={config:e},Uo("ContentInspect").create(t));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:r,cname:i,sid:s,token:a,uid:d,cid:l,vid:h}=this._joinInfo;await n.init({appId:r,areaCode:"",cname:i,sid:s,token:a,uid:d,cid:l,vid:h?Number(h):0},nn)}catch(n){throw Array.isArray(n)?n[0]:n}var t}handleVideoInspectEvents(e){e.on(Nn.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(Ye.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===so.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(Ye.CONTENT_INSPECT_ERROR,new j(O.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(Nn.INSPECT_RESULT,(t,n)=>{var r;if((n==null?void 0:n.code)===O.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return T.debug("Stop inspect content because that has left channel"),this==null||(r=this._inspect)===null||r===void 0||r.close(),void(this._inspect=void 0);this.safeEmit(Ye.CONTENT_INSPECT_RESULT,t,n)}),e.on(Nn.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new j(O.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(to(e,"enabled"),e){if(!t)throw new j(O.INVALID_PARAMS,"config is required");if(zU(t),!this._joinInfo)throw new j(O.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const r=(n={config:t},Uo("ImageModeration").create(n));this._moderation=r,this.handleImageModerationEvents(r);const{appId:i,cname:s,sid:a,token:d,uid:l,cid:h,vid:p}=this._joinInfo;await r.init({appId:i,areaCode:"",cname:s,sid:a,token:d,uid:l,cid:h,vid:p?Number(p):0},nn)}}catch(r){throw Array.isArray(r)?r[0]:r}}else{var n;if(!this._moderation)throw new j(O.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(r){throw Array.isArray(r)?r[0]:r}}}handleImageModerationEvents(e){e.on(Mo.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(Ye.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===Ui.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new j(O.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(Mo.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(t){tn(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new j(O.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,T.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return T.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){to(e,"enabled"),St("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_setRteInfo(e,t){this.store.rteUrl=e,this.store.rteSid=t}_isPreRender(){return"isPreRender"in this._p2pChannel&&this._p2pChannel.isPreRender()}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},ce(fe.prototype,"leave",[qU],Object.getOwnPropertyDescriptor(fe.prototype,"leave"),fe.prototype),ce(fe.prototype,"publish",[XU],Object.getOwnPropertyDescriptor(fe.prototype,"publish"),fe.prototype),ce(fe.prototype,"unpublish",[JU],Object.getOwnPropertyDescriptor(fe.prototype,"unpublish"),fe.prototype),ce(fe.prototype,"subscribe",[QU],Object.getOwnPropertyDescriptor(fe.prototype,"subscribe"),fe.prototype),ce(fe.prototype,"presubscribe",[ZU],Object.getOwnPropertyDescriptor(fe.prototype,"presubscribe"),fe.prototype),ce(fe.prototype,"massSubscribe",[$U],Object.getOwnPropertyDescriptor(fe.prototype,"massSubscribe"),fe.prototype),ce(fe.prototype,"unsubscribe",[e2],Object.getOwnPropertyDescriptor(fe.prototype,"unsubscribe"),fe.prototype),ce(fe.prototype,"massUnsubscribe",[t2],Object.getOwnPropertyDescriptor(fe.prototype,"massUnsubscribe"),fe.prototype),ce(fe.prototype,"setLowStreamParameter",[n2],Object.getOwnPropertyDescriptor(fe.prototype,"setLowStreamParameter"),fe.prototype),ce(fe.prototype,"setDualStreamMode",[r2],Object.getOwnPropertyDescriptor(fe.prototype,"setDualStreamMode"),fe.prototype),ce(fe.prototype,"enableDualStream",[i2],Object.getOwnPropertyDescriptor(fe.prototype,"enableDualStream"),fe.prototype),ce(fe.prototype,"disableDualStream",[o2],Object.getOwnPropertyDescriptor(fe.prototype,"disableDualStream"),fe.prototype),ce(fe.prototype,"setClientRole",[s2],Object.getOwnPropertyDescriptor(fe.prototype,"setClientRole"),fe.prototype),ce(fe.prototype,"_setClientRoleOptions",[a2],Object.getOwnPropertyDescriptor(fe.prototype,"_setClientRoleOptions"),fe.prototype),ce(fe.prototype,"setProxyServer",[c2],Object.getOwnPropertyDescriptor(fe.prototype,"setProxyServer"),fe.prototype),ce(fe.prototype,"setTurnServer",[d2],Object.getOwnPropertyDescriptor(fe.prototype,"setTurnServer"),fe.prototype),ce(fe.prototype,"setLicense",[l2],Object.getOwnPropertyDescriptor(fe.prototype,"setLicense"),fe.prototype),ce(fe.prototype,"startProxyServer",[u2],Object.getOwnPropertyDescriptor(fe.prototype,"startProxyServer"),fe.prototype),ce(fe.prototype,"stopProxyServer",[h2],Object.getOwnPropertyDescriptor(fe.prototype,"stopProxyServer"),fe.prototype),ce(fe.prototype,"setLocalAccessPointsV2",[p2],Object.getOwnPropertyDescriptor(fe.prototype,"setLocalAccessPointsV2"),fe.prototype),ce(fe.prototype,"setLocalAccessPoints",[f2],Object.getOwnPropertyDescriptor(fe.prototype,"setLocalAccessPoints"),fe.prototype),ce(fe.prototype,"setRemoteDefaultVideoStreamType",[_2],Object.getOwnPropertyDescriptor(fe.prototype,"setRemoteDefaultVideoStreamType"),fe.prototype),ce(fe.prototype,"setRemoteVideoStreamType",[m2],Object.getOwnPropertyDescriptor(fe.prototype,"setRemoteVideoStreamType"),fe.prototype),ce(fe.prototype,"setStreamFallbackOption",[E2],Object.getOwnPropertyDescriptor(fe.prototype,"setStreamFallbackOption"),fe.prototype),ce(fe.prototype,"setEncryptionConfig",[g2],Object.getOwnPropertyDescriptor(fe.prototype,"setEncryptionConfig"),fe.prototype),ce(fe.prototype,"renewToken",[S2],Object.getOwnPropertyDescriptor(fe.prototype,"renewToken"),fe.prototype),ce(fe.prototype,"enableAudioVolumeIndicator",[T2],Object.getOwnPropertyDescriptor(fe.prototype,"enableAudioVolumeIndicator"),fe.prototype),ce(fe.prototype,"startLiveStreaming",[v2],Object.getOwnPropertyDescriptor(fe.prototype,"startLiveStreaming"),fe.prototype),ce(fe.prototype,"setLiveTranscoding",[R2],Object.getOwnPropertyDescriptor(fe.prototype,"setLiveTranscoding"),fe.prototype),ce(fe.prototype,"stopLiveStreaming",[y2],Object.getOwnPropertyDescriptor(fe.prototype,"stopLiveStreaming"),fe.prototype),ce(fe.prototype,"startChannelMediaRelay",[C2],Object.getOwnPropertyDescriptor(fe.prototype,"startChannelMediaRelay"),fe.prototype),ce(fe.prototype,"updateChannelMediaRelay",[I2],Object.getOwnPropertyDescriptor(fe.prototype,"updateChannelMediaRelay"),fe.prototype),ce(fe.prototype,"stopChannelMediaRelay",[w2],Object.getOwnPropertyDescriptor(fe.prototype,"stopChannelMediaRelay"),fe.prototype),ce(fe.prototype,"sendCustomReportMessage",[A2],Object.getOwnPropertyDescriptor(fe.prototype,"sendCustomReportMessage"),fe.prototype),ce(fe.prototype,"pickSVCLayer",[b2],Object.getOwnPropertyDescriptor(fe.prototype,"pickSVCLayer"),fe.prototype),ce(fe.prototype,"setRTMConfig",[O2],Object.getOwnPropertyDescriptor(fe.prototype,"setRTMConfig"),fe.prototype),ce(fe.prototype,"enableContentInspect",[N2],Object.getOwnPropertyDescriptor(fe.prototype,"enableContentInspect"),fe.prototype),ce(fe.prototype,"disableContentInspect",[D2],Object.getOwnPropertyDescriptor(fe.prototype,"disableContentInspect"),fe.prototype),ce(fe.prototype,"setImageModeration",[P2],Object.getOwnPropertyDescriptor(fe.prototype,"setImageModeration"),fe.prototype),ce(fe.prototype,"setP2PTransport",[L2],Object.getOwnPropertyDescriptor(fe.prototype,"setP2PTransport"),fe.prototype),ce(fe.prototype,"getJoinChannelServiceRecords",[k2],Object.getOwnPropertyDescriptor(fe.prototype,"getJoinChannelServiceRecords"),fe.prototype),ce(fe.prototype,"setPublishAudioFilterEnabled",[M2],Object.getOwnPropertyDescriptor(fe.prototype,"setPublishAudioFilterEnabled"),fe.prototype),fe);function x2(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=ht(5,"client-"),r=Se.reportApiInvoke(null,{id:n,name:kt.CREATE_CLIENT,options:[t],tag:yt.TRACER});try{(function(i){tn(i.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),tn(i.mode,"config.mode",["rtc","live","p2p"]),i.audioCodec!==void 0&&tn(i.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),i.proxyServer!==void 0&&Mn(i.proxyServer,"config.proxyServer",1,1e4),i.turnServer!==void 0&&_L(i.turnServer),i.httpRetryConfig!==void 0&&fL(i.httpRetryConfig),i.websocketRetryConfig!==void 0&&fL(i.websocketRetryConfig)})(t)}catch(i){throw r.onError(i),i}return(tL(16,0,!0)||Fv(16,0,!0))&&(t.codec==="vp9"&&(t.codec="vp8",T.debug("browser not support vp9, force use vp8")),St("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),r.onSuccess(),new _Z(ho(ho({forceWaitGatewayResponse:!0},t),{},{role:te(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),n)}function mZ(){let e=!1;const t=rt();return(t.name===ot.CHROME&&Number(t.version)>=58&&(Oo.engine.name!=="WebKit"||function(){const n=rt();if(L_()){if(n.os===Sn.MAC_OS)return!0;if(n.os===Sn.IOS){const r=Oo.os.version&&Oo.os.version.split(".");if(r&&Number(r[0])===14&&r[1]&&Number(r[1])>=3||r&&Number(r[0])>14)return!0}}return!1}())||t.name===ot.FIREFOX&&Number(t.version)>=56||t.name===ot.OPERA&&Number(t.version)>=45||t.name===ot.SAFARI&&Number(t.version)>=11||t.name==="WebKit"&&(tr()||eo())&&t.osVersion&&Number(t.osVersion.split(".")[0])>=11||iL()||rt().name===ot.QQ)&&(e=!0),e}class jh{constructor(t,n){I(this,"id",0),I(this,"element",void 0),I(this,"peerPair",void 0),I(this,"context",void 0),I(this,"audioPlayerElement",void 0),I(this,"audioTrack",void 0),jh.count+=1,this.id=jh.count,this.element=t,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const n=document.createElement("audio");n.srcObject=new MediaStream([t.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const t=async(r,i)=>{const s=i==="offer"?await r.createOffer():await r.createAnswer();return await r.setLocalDescription(s),r.iceGatheringState==="complete"?r.localDescription:new ae(a=>{r.onicegatheringstatechange=()=>{r.iceGatheringState==="complete"&&a(r.localDescription)}})},n=async(r,i)=>await r.setRemoteDescription(i);try{const r=await t(this.peerPair[0],"offer");await n(this.peerPair[1],r);const i=await t(this.peerPair[1],"answer");await n(this.peerPair[0],i)}catch(r){throw new j(O.LOCAL_AEC_ERROR,r.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let n;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(n)}catch(i){throw new j(O.LOCAL_AEC_ERROR,i.toString()).print()}if(!n)throw new j(O.LOCAL_AEC_ERROR,"no dest node when local aec").print();const r=n.stream.getAudioTracks()[0];return this.audioTrack=r,r}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,n=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){T.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var V2,xm;I(jh,"count",0);const EZ=window.AudioContext||window.webkitAudioContext,gZ=new(V2=Ae({report:Se}),ce((xm=class{constructor(){I(this,"units",[]),I(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return T.debug("the system does not need to process local aec"),-1;this.context||(this.context=new EZ);let t=this.units.find(n=>n&&n.getElement()===e);return t||(t=new jh(e,this.context),this.units.push(t)),t.startEchoCancellation(),T.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return rt().name!==ot.SAFARI}}).prototype,"processExternalMediaAEC",[V2],Object.getOwnPropertyDescriptor(xm.prototype,"processExternalMediaAEC"),xm.prototype),xm);function F2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function B2(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?F2(Object(n),!0).forEach(function(r){I(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):F2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const Py=window||document;function j2(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!Py)return;const n=ln._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const r=i=>{if(!(i&&i.blockedURI&&(ln.onSecurityPolicyViolation||ln.getListeners(us.SECURITY_POLICY_VIOLATION).length>0)))return;const s=i.blockedURI;A("CSP_DETECTED_HOSTNAME_LIST").some(a=>te(s).call(s,a))&&(ln.onSecurityPolicyViolation&&typeof ln.onSecurityPolicyViolation=="function"&&ln.onSecurityPolicyViolation(i),ln.getListeners(us.SECURITY_POLICY_VIOLATION).length>0&&ln.safeEmit(us.SECURITY_POLICY_VIOLATION,i))};n&&Py.removeEventListener("securitypolicyviolation",n),(t||e&&typeof e=="function"||ln.getListeners(us.SECURITY_POLICY_VIOLATION).length>0)&&Py.addEventListener("securitypolicyviolation",r),ln._cspEventHandlerPointer=r}var SZ=Q,TZ=KT,G2=RegExp.prototype,vZ=function(e){return e===G2||SZ(G2,e)?TZ(e):e.flags},ar=E(vZ);function Gl(e){let t=e.length;for(;--t>=0;)e[t]=0}const Ly=256,W2=286,Gh=30,Wh=15,ky=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Vm=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),RZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),H2=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Hs=new Array(576);Gl(Hs);const Hh=new Array(60);Gl(Hh);const Kh=new Array(512);Gl(Kh);const Yh=new Array(256);Gl(Yh);const My=new Array(29);Gl(My);const Fm=new Array(Gh);function Uy(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}let K2,Y2,z2;function xy(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Gl(Fm);const q2=e=>e<256?Kh[e]:Kh[256+(e>>>7)],zh=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},gi=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,zh(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},Es=(e,t,n)=>{gi(e,n[2*t],n[2*t+1])},X2=(e,t)=>{let n=0;do n|=1&e,e>>>=1,n<<=1;while(--t>0);return n>>>1},J2=(e,t,n)=>{const r=new Array(16);let i,s,a=0;for(i=1;i<=Wh;i++)a=a+n[i-1]<<1,r[i]=a;for(s=0;s<=t;s++){let d=e[2*s+1];d!==0&&(e[2*s]=X2(r[d]++,d))}},Q2=e=>{let t;for(t=0;t<W2;t++)e.dyn_ltree[2*t]=0;for(t=0;t<Gh;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},Z2=e=>{e.bi_valid>8?zh(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},$2=(e,t,n,r)=>{const i=2*t,s=2*n;return e[i]<e[s]||e[i]===e[s]&&r[t]<=r[n]},Vy=(e,t,n)=>{const r=e.heap[n];let i=n<<1;for(;i<=e.heap_len&&(i<e.heap_len&&$2(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!$2(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r},ex=(e,t,n)=>{let r,i,s,a,d=0;if(e.sym_next!==0)do r=255&e.pending_buf[e.sym_buf+d++],r+=(255&e.pending_buf[e.sym_buf+d++])<<8,i=e.pending_buf[e.sym_buf+d++],r===0?Es(e,i,t):(s=Yh[i],Es(e,s+Ly+1,t),a=ky[s],a!==0&&(i-=My[s],gi(e,i,a)),r--,s=q2(r),Es(e,s,n),a=Vm[s],a!==0&&(r-=Fm[s],gi(e,r,a)));while(d<e.sym_next);Es(e,256,t)},Fy=(e,t)=>{const n=t.dyn_tree,r=t.stat_desc.static_tree,i=t.stat_desc.has_stree,s=t.stat_desc.elems;let a,d,l,h=-1;for(e.heap_len=0,e.heap_max=573,a=0;a<s;a++)n[2*a]!==0?(e.heap[++e.heap_len]=h=a,e.depth[a]=0):n[2*a+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=h<2?++h:0,n[2*l]=1,e.depth[l]=0,e.opt_len--,i&&(e.static_len-=r[2*l+1]);for(t.max_code=h,a=e.heap_len>>1;a>=1;a--)Vy(e,n,a);l=s;do a=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Vy(e,n,1),d=e.heap[1],e.heap[--e.heap_max]=a,e.heap[--e.heap_max]=d,n[2*l]=n[2*a]+n[2*d],e.depth[l]=(e.depth[a]>=e.depth[d]?e.depth[a]:e.depth[d])+1,n[2*a+1]=n[2*d+1]=l,e.heap[1]=l++,Vy(e,n,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((p,_)=>{const m=_.dyn_tree,g=_.max_code,w=_.stat_desc.static_tree,R=_.stat_desc.has_stree,y=_.stat_desc.extra_bits,b=_.stat_desc.extra_base,N=_.stat_desc.max_length;let L,x,F,M,B,J,ee=0;for(M=0;M<=Wh;M++)p.bl_count[M]=0;for(m[2*p.heap[p.heap_max]+1]=0,L=p.heap_max+1;L<573;L++)x=p.heap[L],M=m[2*m[2*x+1]+1]+1,M>N&&(M=N,ee++),m[2*x+1]=M,x>g||(p.bl_count[M]++,B=0,x>=b&&(B=y[x-b]),J=m[2*x],p.opt_len+=J*(M+B),R&&(p.static_len+=J*(w[2*x+1]+B)));if(ee!==0){do{for(M=N-1;p.bl_count[M]===0;)M--;p.bl_count[M]--,p.bl_count[M+1]+=2,p.bl_count[N]--,ee-=2}while(ee>0);for(M=N;M!==0;M--)for(x=p.bl_count[M];x!==0;)F=p.heap[--L],F>g||(m[2*F+1]!==M&&(p.opt_len+=(M-m[2*F+1])*m[2*F],m[2*F+1]=M),x--)}})(e,t),J2(n,h,e.bl_count)},tx=(e,t,n)=>{let r,i,s=-1,a=t[1],d=0,l=7,h=4;for(a===0&&(l=138,h=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=a,a=t[2*(r+1)+1],++d<l&&i===a||(d<h?e.bl_tree[2*i]+=d:i!==0?(i!==s&&e.bl_tree[2*i]++,e.bl_tree[32]++):d<=10?e.bl_tree[34]++:e.bl_tree[36]++,d=0,s=i,a===0?(l=138,h=3):i===a?(l=6,h=3):(l=7,h=4))},nx=(e,t,n)=>{let r,i,s=-1,a=t[1],d=0,l=7,h=4;for(a===0&&(l=138,h=3),r=0;r<=n;r++)if(i=a,a=t[2*(r+1)+1],!(++d<l&&i===a)){if(d<h)do Es(e,i,e.bl_tree);while(--d!=0);else i!==0?(i!==s&&(Es(e,i,e.bl_tree),d--),Es(e,16,e.bl_tree),gi(e,d-3,2)):d<=10?(Es(e,17,e.bl_tree),gi(e,d-3,3)):(Es(e,18,e.bl_tree),gi(e,d-11,7));d=0,s=i,a===0?(l=138,h=3):i===a?(l=6,h=3):(l=7,h=4)}};let rx=!1;const ix=(e,t,n,r)=>{gi(e,0+(r?1:0),3),Z2(e),zh(e,n),zh(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var yZ=e=>{rx||((()=>{let t,n,r,i,s;const a=new Array(16);for(r=0,i=0;i<28;i++)for(My[i]=r,t=0;t<1<<ky[i];t++)Yh[r++]=i;for(Yh[r-1]=i,s=0,i=0;i<16;i++)for(Fm[i]=s,t=0;t<1<<Vm[i];t++)Kh[s++]=i;for(s>>=7;i<Gh;i++)for(Fm[i]=s<<7,t=0;t<1<<Vm[i]-7;t++)Kh[256+s++]=i;for(n=0;n<=Wh;n++)a[n]=0;for(t=0;t<=143;)Hs[2*t+1]=8,t++,a[8]++;for(;t<=255;)Hs[2*t+1]=9,t++,a[9]++;for(;t<=279;)Hs[2*t+1]=7,t++,a[7]++;for(;t<=287;)Hs[2*t+1]=8,t++,a[8]++;for(J2(Hs,287,a),t=0;t<Gh;t++)Hh[2*t+1]=5,Hh[2*t]=X2(t,5);K2=new Uy(Hs,ky,257,W2,Wh),Y2=new Uy(Hh,Vm,0,Gh,Wh),z2=new Uy(new Array(0),RZ,0,19,7)})(),rx=!0),e.l_desc=new xy(e.dyn_ltree,K2),e.d_desc=new xy(e.dyn_dtree,Y2),e.bl_desc=new xy(e.bl_tree,z2),e.bi_buf=0,e.bi_valid=0,Q2(e)},CZ=(e,t,n,r)=>{let i,s,a=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(d=>{let l,h=4093624447;for(l=0;l<=31;l++,h>>>=1)if(1&h&&d.dyn_ltree[2*l]!==0)return 0;if(d.dyn_ltree[18]!==0||d.dyn_ltree[20]!==0||d.dyn_ltree[26]!==0)return 1;for(l=32;l<Ly;l++)if(d.dyn_ltree[2*l]!==0)return 1;return 0})(e)),Fy(e,e.l_desc),Fy(e,e.d_desc),a=(d=>{let l;for(tx(d,d.dyn_ltree,d.l_desc.max_code),tx(d,d.dyn_dtree,d.d_desc.max_code),Fy(d,d.bl_desc),l=18;l>=3&&d.bl_tree[2*H2[l]+1]===0;l--);return d.opt_len+=3*(l+1)+5+5+4,l})(e),i=e.opt_len+3+7>>>3,s=e.static_len+3+7>>>3,s<=i&&(i=s)):i=s=n+5,n+4<=i&&t!==-1?ix(e,t,n,r):e.strategy===4||s===i?(gi(e,2+(r?1:0),3),ex(e,Hs,Hh)):(gi(e,4+(r?1:0),3),((d,l,h,p)=>{let _;for(gi(d,l-257,5),gi(d,h-1,5),gi(d,p-4,4),_=0;_<p;_++)gi(d,d.bl_tree[2*H2[_]+1],3);nx(d,d.dyn_ltree,l-1),nx(d,d.dyn_dtree,h-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),ex(e,e.dyn_ltree,e.dyn_dtree)),Q2(e),r&&Z2(e)},IZ=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,t===0?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(Yh[n]+Ly+1)]++,e.dyn_dtree[2*q2(t)]++),e.sym_next===e.sym_end),wZ=e=>{gi(e,2,3),Es(e,256,Hs),(t=>{t.bi_valid===16?(zh(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},AZ={_tr_init:yZ,_tr_stored_block:ix,_tr_flush_block:CZ,_tr_tally:IZ,_tr_align:wZ},qh=(e,t,n,r)=>{let i=65535&e|0,s=e>>>16&65535|0,a=0;for(;n!==0;){a=n>2e3?2e3:n,n-=a;do i=i+t[r++]|0,s=s+i|0;while(--a);i%=65521,s%=65521}return i|s<<16|0};const bZ=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var Sr=(e,t,n,r)=>{const i=bZ,s=r+n;e^=-1;for(let a=r;a<s;a++)e=e>>>8^i[255&(e^t[a])];return-1^e},Qc={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Bm={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:OZ,_tr_stored_block:By,_tr_flush_block:NZ,_tr_tally:La,_tr_align:DZ}=AZ,{Z_NO_FLUSH:ka,Z_PARTIAL_FLUSH:PZ,Z_FULL_FLUSH:LZ,Z_FINISH:po,Z_BLOCK:ox,Z_OK:Nr,Z_STREAM_END:sx,Z_STREAM_ERROR:gs,Z_DATA_ERROR:kZ,Z_BUF_ERROR:jy,Z_DEFAULT_COMPRESSION:MZ,Z_FILTERED:UZ,Z_HUFFMAN_ONLY:jm,Z_RLE:xZ,Z_FIXED:VZ,Z_DEFAULT_STRATEGY:FZ,Z_UNKNOWN:BZ,Z_DEFLATED:Gm}=Bm,Gy=286,jZ=30,GZ=19,WZ=2*Gy+1,HZ=15,Zc=258,Ss=262,Wl=42,$c=113,Xh=666,ed=(e,t)=>(e.msg=Qc[t],t),ax=e=>2*e-(e>4?9:0),Ma=e=>{let t=e.length;for(;--t>=0;)e[t]=0},KZ=e=>{let t,n,r,i=e.w_size;t=e.hash_size,r=t;do n=e.head[--r],e.head[r]=n>=i?n-i:0;while(--t);t=i,r=t;do n=e.prev[--r],e.prev[r]=n>=i?n-i:0;while(--t)};let Ua=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const xi=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),n!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,t.pending===0&&(t.pending_out=0))},Vi=(e,t)=>{NZ(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,xi(e.strm)},Jt=(e,t)=>{e.pending_buf[e.pending++]=t},Jh=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},Wy=(e,t,n,r)=>{let i=e.avail_in;return i>r&&(i=r),i===0?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),e.state.wrap===1?e.adler=qh(e.adler,t,i,n):e.state.wrap===2&&(e.adler=Sr(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)},cx=(e,t)=>{let n,r,i=e.max_chain_length,s=e.strstart,a=e.prev_length,d=e.nice_match;const l=e.strstart>e.w_size-Ss?e.strstart-(e.w_size-Ss):0,h=e.window,p=e.w_mask,_=e.prev,m=e.strstart+Zc;let g=h[s+a-1],w=h[s+a];e.prev_length>=e.good_match&&(i>>=2),d>e.lookahead&&(d=e.lookahead);do if(n=t,h[n+a]===w&&h[n+a-1]===g&&h[n]===h[s]&&h[++n]===h[s+1]){s+=2,n++;do;while(h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&s<m);if(r=Zc-(m-s),s=m-Zc,r>a){if(e.match_start=t,a=r,r>=d)break;g=h[s+a-1],w=h[s+a]}}while((t=_[t&p])>l&&--i!=0);return a<=e.lookahead?a:e.lookahead},Hl=e=>{const t=e.w_size;let n,r,i;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Ss)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),KZ(e),r+=t),e.strm.avail_in===0)break;if(n=Wy(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=Ua(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=Ua(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Ss&&e.strm.avail_in!==0)},dx=(e,t)=>{let n,r,i,s=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,a=0,d=e.strm.avail_in;do{if(n=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i||(i=e.strm.avail_out-i,r=e.strstart-e.block_start,n>r+e.strm.avail_in&&(n=r+e.strm.avail_in),n>i&&(n=i),n<s&&(n===0&&t!==po||t===ka||n!==r+e.strm.avail_in)))break;a=t===po&&n===r+e.strm.avail_in?1:0,By(e,0,0,a),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,xi(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(Wy(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(a===0);return d-=e.strm.avail_in,d&&(d>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=d&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-d,e.strm.next_in),e.strstart),e.strstart+=d,e.insert+=d>e.w_size-e.insert?e.w_size-e.insert:d),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),a?4:t!==ka&&t!==po&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(Wy(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,s=i>e.w_size?e.w_size:i,r=e.strstart-e.block_start,(r>=s||(r||t===po)&&t!==ka&&e.strm.avail_in===0&&r<=i)&&(n=r>i?i:r,a=t===po&&e.strm.avail_in===0&&n===r?1:0,By(e,e.block_start,n,a),e.block_start+=n,xi(e.strm)),a?3:1)},Hy=(e,t)=>{let n,r;for(;;){if(e.lookahead<Ss){if(Hl(e),e.lookahead<Ss&&t===ka)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=Ua(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),n!==0&&e.strstart-n<=e.w_size-Ss&&(e.match_length=cx(e,n)),e.match_length>=3)if(r=La(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=Ua(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Ua(e,e.ins_h,e.window[e.strstart+1]);else r=La(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(Vi(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===po?(Vi(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Vi(e,!1),e.strm.avail_out===0)?1:2},Kl=(e,t)=>{let n,r,i;for(;;){if(e.lookahead<Ss){if(Hl(e),e.lookahead<Ss&&t===ka)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=Ua(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,n!==0&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-Ss&&(e.match_length=cx(e,n),e.match_length<=5&&(e.strategy===UZ||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=La(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=i&&(e.ins_h=Ua(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(Vi(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(r=La(e,0,e.window[e.strstart-1]),r&&Vi(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=La(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===po?(Vi(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Vi(e,!1),e.strm.avail_out===0)?1:2};function Ts(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}const Qh=[new Ts(0,0,0,0,dx),new Ts(4,4,8,4,Hy),new Ts(4,5,16,8,Hy),new Ts(4,6,32,32,Hy),new Ts(4,4,16,16,Kl),new Ts(8,16,32,32,Kl),new Ts(8,16,128,128,Kl),new Ts(8,32,128,256,Kl),new Ts(32,128,258,1024,Kl),new Ts(32,258,258,4096,Kl)];function YZ(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Gm,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*WZ),this.dyn_dtree=new Uint16Array(2*(2*jZ+1)),this.bl_tree=new Uint16Array(2*(2*GZ+1)),Ma(this.dyn_ltree),Ma(this.dyn_dtree),Ma(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(HZ+1),this.heap=new Uint16Array(2*Gy+1),Ma(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Gy+1),Ma(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Zh=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Wl&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==$c&&t.status!==Xh?1:0},lx=e=>{if(Zh(e))return ed(e,gs);e.total_in=e.total_out=0,e.data_type=BZ;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?Wl:$c,e.adler=t.wrap===2?0:1,t.last_flush=-2,OZ(t),Nr},ux=e=>{const t=lx(e);return t===Nr&&(n=>{n.window_size=2*n.w_size,Ma(n.head),n.max_lazy_match=Qh[n.level].max_lazy,n.good_match=Qh[n.level].good_length,n.nice_match=Qh[n.level].nice_length,n.max_chain_length=Qh[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(e.state),t},hx=(e,t,n,r,i,s)=>{if(!e)return gs;let a=1;if(t===MZ&&(t=6),r<0?(a=0,r=-r):r>15&&(a=2,r-=16),i<1||i>9||n!==Gm||r<8||r>15||t<0||t>9||s<0||s>VZ||r===8&&a!==1)return ed(e,gs);r===8&&(r=9);const d=new YZ;return e.state=d,d.strm=e,d.status=Wl,d.wrap=a,d.gzhead=null,d.w_bits=r,d.w_size=1<<d.w_bits,d.w_mask=d.w_size-1,d.hash_bits=i+7,d.hash_size=1<<d.hash_bits,d.hash_mask=d.hash_size-1,d.hash_shift=~~((d.hash_bits+3-1)/3),d.window=new Uint8Array(2*d.w_size),d.head=new Uint16Array(d.hash_size),d.prev=new Uint16Array(d.w_size),d.lit_bufsize=1<<i+6,d.pending_buf_size=4*d.lit_bufsize,d.pending_buf=new Uint8Array(d.pending_buf_size),d.sym_buf=d.lit_bufsize,d.sym_end=3*(d.lit_bufsize-1),d.level=t,d.strategy=s,d.method=n,ux(e)};var zZ=(e,t)=>{if(Zh(e)||t>ox||t<0)return e?ed(e,gs):gs;const n=e.state;if(!e.output||e.avail_in!==0&&!e.input||n.status===Xh&&t!==po)return ed(e,e.avail_out===0?jy:gs);const r=n.last_flush;if(n.last_flush=t,n.pending!==0){if(xi(e),e.avail_out===0)return n.last_flush=-1,Nr}else if(e.avail_in===0&&ax(t)<=ax(r)&&t!==po)return ed(e,jy);if(n.status===Xh&&e.avail_in!==0)return ed(e,jy);if(n.status===Wl&&n.wrap===0&&(n.status=$c),n.status===Wl){let i=Gm+(n.w_bits-8<<4)<<8,s=-1;if(s=n.strategy>=jm||n.level<2?0:n.level<6?1:n.level===6?2:3,i|=s<<6,n.strstart!==0&&(i|=32),i+=31-i%31,Jh(n,i),n.strstart!==0&&(Jh(n,e.adler>>>16),Jh(n,65535&e.adler)),e.adler=1,n.status=$c,xi(e),n.pending!==0)return n.last_flush=-1,Nr}if(n.status===57){if(e.adler=0,Jt(n,31),Jt(n,139),Jt(n,8),n.gzhead)Jt(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Jt(n,255&n.gzhead.time),Jt(n,n.gzhead.time>>8&255),Jt(n,n.gzhead.time>>16&255),Jt(n,n.gzhead.time>>24&255),Jt(n,n.level===9?2:n.strategy>=jm||n.level<2?4:0),Jt(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Jt(n,255&n.gzhead.extra.length),Jt(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=Sr(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(Jt(n,0),Jt(n,0),Jt(n,0),Jt(n,0),Jt(n,0),Jt(n,n.level===9?2:n.strategy>=jm||n.level<2?4:0),Jt(n,3),n.status=$c,xi(e),n.pending!==0)return n.last_flush=-1,Nr}if(n.status===69){if(n.gzhead.extra){let i=n.pending,s=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+s>n.pending_buf_size;){let d=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+d),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>i&&(e.adler=Sr(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex+=d,xi(e),n.pending!==0)return n.last_flush=-1,Nr;i=0,s-=d}let a=new Uint8Array(n.gzhead.extra);n.pending_buf.set(a.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending+=s,n.gzhead.hcrc&&n.pending>i&&(e.adler=Sr(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let i,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(e.adler=Sr(e.adler,n.pending_buf,n.pending-s,s)),xi(e),n.pending!==0)return n.last_flush=-1,Nr;s=0}i=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Jt(n,i)}while(i!==0);n.gzhead.hcrc&&n.pending>s&&(e.adler=Sr(e.adler,n.pending_buf,n.pending-s,s)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let i,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(e.adler=Sr(e.adler,n.pending_buf,n.pending-s,s)),xi(e),n.pending!==0)return n.last_flush=-1,Nr;s=0}i=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Jt(n,i)}while(i!==0);n.gzhead.hcrc&&n.pending>s&&(e.adler=Sr(e.adler,n.pending_buf,n.pending-s,s))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(xi(e),n.pending!==0))return n.last_flush=-1,Nr;Jt(n,255&e.adler),Jt(n,e.adler>>8&255),e.adler=0}if(n.status=$c,xi(e),n.pending!==0)return n.last_flush=-1,Nr}if(e.avail_in!==0||n.lookahead!==0||t!==ka&&n.status!==Xh){let i=n.level===0?dx(n,t):n.strategy===jm?((s,a)=>{let d;for(;;){if(s.lookahead===0&&(Hl(s),s.lookahead===0)){if(a===ka)return 1;break}if(s.match_length=0,d=La(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++,d&&(Vi(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,a===po?(Vi(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(Vi(s,!1),s.strm.avail_out===0)?1:2})(n,t):n.strategy===xZ?((s,a)=>{let d,l,h,p;const _=s.window;for(;;){if(s.lookahead<=Zc){if(Hl(s),s.lookahead<=Zc&&a===ka)return 1;if(s.lookahead===0)break}if(s.match_length=0,s.lookahead>=3&&s.strstart>0&&(h=s.strstart-1,l=_[h],l===_[++h]&&l===_[++h]&&l===_[++h])){p=s.strstart+Zc;do;while(l===_[++h]&&l===_[++h]&&l===_[++h]&&l===_[++h]&&l===_[++h]&&l===_[++h]&&l===_[++h]&&l===_[++h]&&h<p);s.match_length=Zc-(p-h),s.match_length>s.lookahead&&(s.match_length=s.lookahead)}if(s.match_length>=3?(d=La(s,1,s.match_length-3),s.lookahead-=s.match_length,s.strstart+=s.match_length,s.match_length=0):(d=La(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++),d&&(Vi(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,a===po?(Vi(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(Vi(s,!1),s.strm.avail_out===0)?1:2})(n,t):Qh[n.level].func(n,t);if(i!==3&&i!==4||(n.status=Xh),i===1||i===3)return e.avail_out===0&&(n.last_flush=-1),Nr;if(i===2&&(t===PZ?DZ(n):t!==ox&&(By(n,0,0,!1),t===LZ&&(Ma(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),xi(e),e.avail_out===0))return n.last_flush=-1,Nr}return t!==po?Nr:n.wrap<=0?sx:(n.wrap===2?(Jt(n,255&e.adler),Jt(n,e.adler>>8&255),Jt(n,e.adler>>16&255),Jt(n,e.adler>>24&255),Jt(n,255&e.total_in),Jt(n,e.total_in>>8&255),Jt(n,e.total_in>>16&255),Jt(n,e.total_in>>24&255)):(Jh(n,e.adler>>>16),Jh(n,65535&e.adler)),xi(e),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?Nr:sx)},qZ=(e,t)=>{let n=t.length;if(Zh(e))return gs;const r=e.state,i=r.wrap;if(i===2||i===1&&r.status!==Wl||r.lookahead)return gs;if(i===1&&(e.adler=qh(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){i===0&&(Ma(r.head),r.strstart=0,r.block_start=0,r.insert=0);let l=new Uint8Array(r.w_size);l.set(t.subarray(n-r.w_size,n),0),t=l,n=r.w_size}const s=e.avail_in,a=e.next_in,d=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,Hl(r);r.lookahead>=3;){let l=r.strstart,h=r.lookahead-2;do r.ins_h=Ua(r,r.ins_h,r.window[l+3-1]),r.prev[l&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=l,l++;while(--h);r.strstart=l,r.lookahead=2,Hl(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=a,e.input=d,e.avail_in=s,r.wrap=i,Nr},$h={deflateInit:(e,t)=>hx(e,t,Gm,15,8,FZ),deflateInit2:hx,deflateReset:ux,deflateResetKeep:lx,deflateSetHeader:(e,t)=>Zh(e)||e.state.wrap!==2?gs:(e.state.gzhead=t,Nr),deflate:zZ,deflateEnd:e=>{if(Zh(e))return gs;const t=e.state.status;return e.state=null,t===$c?ed(e,kZ):Nr},deflateSetDictionary:qZ,deflateInfo:"pako deflate (from Nodeca project)"};const XZ=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Wm={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const r in n)XZ(n,r)&&(e[r]=n[r])}}return e},flattenChunks:e=>{let t=0;for(let r=0,i=e.length;r<i;r++)t+=e[r].length;const n=new Uint8Array(t);for(let r=0,i=0,s=e.length;r<s;r++){let a=e[r];n.set(a,i),i+=a.length}return n}};let px=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{px=!1}const ep=new Uint8Array(256);for(let e=0;e<256;e++)ep[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;ep[254]=ep[254]=1;var tp={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,n,r,i,s,a=e.length,d=0;for(i=0;i<a;i++)n=e.charCodeAt(i),(64512&n)==55296&&i+1<a&&(r=e.charCodeAt(i+1),(64512&r)==56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),d+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(d),s=0,i=0;s<d;i++)n=e.charCodeAt(i),(64512&n)==55296&&i+1<a&&(r=e.charCodeAt(i+1),(64512&r)==56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?t[s++]=n:n<2048?(t[s++]=192|n>>>6,t[s++]=128|63&n):n<65536?(t[s++]=224|n>>>12,t[s++]=128|n>>>6&63,t[s++]=128|63&n):(t[s++]=240|n>>>18,t[s++]=128|n>>>12&63,t[s++]=128|n>>>6&63,t[s++]=128|63&n);return t},buf2string:(e,t)=>{const n=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let r,i;const s=new Array(2*n);for(i=0,r=0;r<n;){let a=e[r++];if(a<128){s[i++]=a;continue}let d=ep[a];if(d>4)s[i++]=65533,r+=d-1;else{for(a&=d===2?31:d===3?15:7;d>1&&r<n;)a=a<<6|63&e[r++],d--;d>1?s[i++]=65533:a<65536?s[i++]=a:(a-=65536,s[i++]=55296|a>>10&1023,s[i++]=56320|1023&a)}}return((a,d)=>{if(d<65534&&a.subarray&&px)return String.fromCharCode.apply(null,a.length===d?a:a.subarray(0,d));let l="";for(let h=0;h<d;h++)l+=String.fromCharCode(a[h]);return l})(s,i)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&(192&e[n])==128;)n--;return n<0||n===0?t:n+ep[e[n]]>t?n:t}},fx=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const _x=Object.prototype.toString,{Z_NO_FLUSH:JZ,Z_SYNC_FLUSH:QZ,Z_FULL_FLUSH:ZZ,Z_FINISH:$Z,Z_OK:Hm,Z_STREAM_END:e$,Z_DEFAULT_COMPRESSION:t$,Z_DEFAULT_STRATEGY:n$,Z_DEFLATED:r$}=Bm;function Km(e){this.options=Wm.assign({level:t$,method:r$,chunkSize:16384,windowBits:15,memLevel:8,strategy:n$},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new fx,this.strm.avail_out=0;let n=$h.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==Hm)throw new Error(Qc[n]);if(t.header&&$h.deflateSetHeader(this.strm,t.header),t.dictionary){let r;if(r=typeof t.dictionary=="string"?tp.string2buf(t.dictionary):_x.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,n=$h.deflateSetDictionary(this.strm,r),n!==Hm)throw new Error(Qc[n]);this._dict_set=!0}}function mx(e,t){const n=new Km(t);if(n.push(e,!0),n.err)throw n.msg||Qc[n.err];return n.result}Km.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize;let i,s;if(this.ended)return!1;for(s=t===~~t?t:t===!0?$Z:JZ,typeof e=="string"?n.input=tp.string2buf(e):_x.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(s===QZ||s===ZZ)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(i=$h.deflate(n,s),i===e$)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=$h.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===Hm;if(n.avail_out!==0){if(s>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},Km.prototype.onData=function(e){this.chunks.push(e)},Km.prototype.onEnd=function(e){e===Hm&&(this.result=Wm.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var i$={deflate:mx,deflateRaw:function(e,t){return(t=t||{}).raw=!0,mx(e,t)}};const Ym=16209;var o$=function(e,t){let n,r,i,s,a,d,l,h,p,_,m,g,w,R,y,b,N,L,x,F,M,B,J,ee;const pe=e.state;n=e.next_in,J=e.input,r=n+(e.avail_in-5),i=e.next_out,ee=e.output,s=i-(t-e.avail_out),a=i+(e.avail_out-257),d=pe.dmax,l=pe.wsize,h=pe.whave,p=pe.wnext,_=pe.window,m=pe.hold,g=pe.bits,w=pe.lencode,R=pe.distcode,y=(1<<pe.lenbits)-1,b=(1<<pe.distbits)-1;e:do{g<15&&(m+=J[n++]<<g,g+=8,m+=J[n++]<<g,g+=8),N=w[m&y];t:for(;;){if(L=N>>>24,m>>>=L,g-=L,L=N>>>16&255,L===0)ee[i++]=65535&N;else{if(!(16&L)){if(!(64&L)){N=w[(65535&N)+(m&(1<<L)-1)];continue t}if(32&L){pe.mode=16191;break e}e.msg="invalid literal/length code",pe.mode=Ym;break e}x=65535&N,L&=15,L&&(g<L&&(m+=J[n++]<<g,g+=8),x+=m&(1<<L)-1,m>>>=L,g-=L),g<15&&(m+=J[n++]<<g,g+=8,m+=J[n++]<<g,g+=8),N=R[m&b];n:for(;;){if(L=N>>>24,m>>>=L,g-=L,L=N>>>16&255,!(16&L)){if(!(64&L)){N=R[(65535&N)+(m&(1<<L)-1)];continue n}e.msg="invalid distance code",pe.mode=Ym;break e}if(F=65535&N,L&=15,g<L&&(m+=J[n++]<<g,g+=8,g<L&&(m+=J[n++]<<g,g+=8)),F+=m&(1<<L)-1,F>d){e.msg="invalid distance too far back",pe.mode=Ym;break e}if(m>>>=L,g-=L,L=i-s,F>L){if(L=F-L,L>h&&pe.sane){e.msg="invalid distance too far back",pe.mode=Ym;break e}if(M=0,B=_,p===0){if(M+=l-L,L<x){x-=L;do ee[i++]=_[M++];while(--L);M=i-F,B=ee}}else if(p<L){if(M+=l+p-L,L-=p,L<x){x-=L;do ee[i++]=_[M++];while(--L);if(M=0,p<x){L=p,x-=L;do ee[i++]=_[M++];while(--L);M=i-F,B=ee}}}else if(M+=p-L,L<x){x-=L;do ee[i++]=_[M++];while(--L);M=i-F,B=ee}for(;x>2;)ee[i++]=B[M++],ee[i++]=B[M++],ee[i++]=B[M++],x-=3;x&&(ee[i++]=B[M++],x>1&&(ee[i++]=B[M++]))}else{M=i-F;do ee[i++]=ee[M++],ee[i++]=ee[M++],ee[i++]=ee[M++],x-=3;while(x>2);x&&(ee[i++]=ee[M++],x>1&&(ee[i++]=ee[M++]))}break}}break}}while(n<r&&i<a);x=g>>3,n-=x,g-=x<<3,m&=(1<<g)-1,e.next_in=n,e.next_out=i,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=i<a?a-i+257:257-(i-a),pe.hold=m,pe.bits=g};const zm=15,s$=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),a$=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),c$=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),d$=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var np=(e,t,n,r,i,s,a,d)=>{const l=d.bits;let h,p,_,m,g,w,R=0,y=0,b=0,N=0,L=0,x=0,F=0,M=0,B=0,J=0,ee=null;const pe=new Uint16Array(16),Pe=new Uint16Array(16);let Ne,Ge,Fe,st=null;for(R=0;R<=zm;R++)pe[R]=0;for(y=0;y<r;y++)pe[t[n+y]]++;for(L=l,N=zm;N>=1&&pe[N]===0;N--);if(L>N&&(L=N),N===0)return i[s++]=20971520,i[s++]=20971520,d.bits=1,0;for(b=1;b<N&&pe[b]===0;b++);for(L<b&&(L=b),M=1,R=1;R<=zm;R++)if(M<<=1,M-=pe[R],M<0)return-1;if(M>0&&(e===0||N!==1))return-1;for(Pe[1]=0,R=1;R<zm;R++)Pe[R+1]=Pe[R]+pe[R];for(y=0;y<r;y++)t[n+y]!==0&&(a[Pe[t[n+y]]++]=y);if(e===0?(ee=st=a,w=20):e===1?(ee=s$,st=a$,w=257):(ee=c$,st=d$,w=0),J=0,y=0,R=b,g=s,x=L,F=0,_=-1,B=1<<L,m=B-1,e===1&&B>852||e===2&&B>592)return 1;for(;;){Ne=R-F,a[y]+1<w?(Ge=0,Fe=a[y]):a[y]>=w?(Ge=st[a[y]-w],Fe=ee[a[y]-w]):(Ge=96,Fe=0),h=1<<R-F,p=1<<x,b=p;do p-=h,i[g+(J>>F)+p]=Ne<<24|Ge<<16|Fe|0;while(p!==0);for(h=1<<R-1;J&h;)h>>=1;if(h!==0?(J&=h-1,J+=h):J=0,y++,--pe[R]==0){if(R===N)break;R=t[n+a[y]]}if(R>L&&(J&m)!==_){for(F===0&&(F=L),g+=b,x=R-F,M=1<<x;x+F<N&&(M-=pe[x+F],!(M<=0));)x++,M<<=1;if(B+=1<<x,e===1&&B>852||e===2&&B>592)return 1;_=J&m,i[_]=L<<24|x<<16|g-s|0}}return J!==0&&(i[g+J]=R-F<<24|64<<16|0),d.bits=L,0};const{Z_FINISH:Ex,Z_BLOCK:l$,Z_TREES:qm,Z_OK:td,Z_STREAM_END:u$,Z_NEED_DICT:h$,Z_STREAM_ERROR:fo,Z_DATA_ERROR:gx,Z_MEM_ERROR:Sx,Z_BUF_ERROR:p$,Z_DEFLATED:Tx}=Bm,Xm=16180,Jm=16190,Ks=16191,Ky=16192,Yy=16194,Qm=16199,Zm=16200,zy=16206,Pn=16209,vx=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function f$(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const nd=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<Xm||t.mode>16211?1:0},Rx=e=>{if(nd(e))return fo;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=Xm,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,td},yx=e=>{if(nd(e))return fo;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,Rx(e)},Cx=(e,t)=>{let n;if(nd(e))return fo;const r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?fo:(r.window!==null&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,yx(e))},Ix=(e,t)=>{if(!e)return fo;const n=new f$;e.state=n,n.strm=e,n.window=null,n.mode=Xm;const r=Cx(e,t);return r!==td&&(e.state=null),r};let qy,Xy,wx=!0;const _$=e=>{if(wx){qy=new Int32Array(512),Xy=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(np(1,e.lens,0,288,qy,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;np(2,e.lens,0,32,Xy,0,e.work,{bits:5}),wx=!1}e.lencode=qy,e.lenbits=9,e.distcode=Xy,e.distbits=5},Ax=(e,t,n,r)=>{let i;const s=e.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),r>=s.wsize?(s.window.set(t.subarray(n-s.wsize,n),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>r&&(i=r),s.window.set(t.subarray(n-r,n-r+i),s.wnext),(r-=i)?(s.window.set(t.subarray(n-r,n),0),s.wnext=r,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0};var m$=(e,t)=>{let n,r,i,s,a,d,l,h,p,_,m,g,w,R,y,b,N,L,x,F,M,B,J=0;const ee=new Uint8Array(4);let pe,Pe;const Ne=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(nd(e)||!e.output||!e.input&&e.avail_in!==0)return fo;n=e.state,n.mode===Ks&&(n.mode=Ky),a=e.next_out,i=e.output,l=e.avail_out,s=e.next_in,r=e.input,d=e.avail_in,h=n.hold,p=n.bits,_=d,m=l,B=td;e:for(;;)switch(n.mode){case Xm:if(n.wrap===0){n.mode=Ky;break}for(;p<16;){if(d===0)break e;d--,h+=r[s++]<<p,p+=8}if(2&n.wrap&&h===35615){n.wbits===0&&(n.wbits=15),n.check=0,ee[0]=255&h,ee[1]=h>>>8&255,n.check=Sr(n.check,ee,2,0),h=0,p=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&h)<<8)+(h>>8))%31){e.msg="incorrect header check",n.mode=Pn;break}if((15&h)!==Tx){e.msg="unknown compression method",n.mode=Pn;break}if(h>>>=4,p-=4,M=8+(15&h),n.wbits===0&&(n.wbits=M),M>15||M>n.wbits){e.msg="invalid window size",n.mode=Pn;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&h?16189:Ks,h=0,p=0;break;case 16181:for(;p<16;){if(d===0)break e;d--,h+=r[s++]<<p,p+=8}if(n.flags=h,(255&ar(n))!==Tx){e.msg="unknown compression method",n.mode=Pn;break}if(57344&ar(n)){e.msg="unknown header flags set",n.mode=Pn;break}n.head&&(n.head.text=h>>8&1),512&ar(n)&&4&n.wrap&&(ee[0]=255&h,ee[1]=h>>>8&255,n.check=Sr(n.check,ee,2,0)),h=0,p=0,n.mode=16182;case 16182:for(;p<32;){if(d===0)break e;d--,h+=r[s++]<<p,p+=8}n.head&&(n.head.time=h),512&ar(n)&&4&n.wrap&&(ee[0]=255&h,ee[1]=h>>>8&255,ee[2]=h>>>16&255,ee[3]=h>>>24&255,n.check=Sr(n.check,ee,4,0)),h=0,p=0,n.mode=16183;case 16183:for(;p<16;){if(d===0)break e;d--,h+=r[s++]<<p,p+=8}n.head&&(n.head.xflags=255&h,n.head.os=h>>8),512&ar(n)&&4&n.wrap&&(ee[0]=255&h,ee[1]=h>>>8&255,n.check=Sr(n.check,ee,2,0)),h=0,p=0,n.mode=16184;case 16184:if(1024&ar(n)){for(;p<16;){if(d===0)break e;d--,h+=r[s++]<<p,p+=8}n.length=h,n.head&&(n.head.extra_len=h),512&ar(n)&&4&n.wrap&&(ee[0]=255&h,ee[1]=h>>>8&255,n.check=Sr(n.check,ee,2,0)),h=0,p=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&ar(n)&&(g=n.length,g>d&&(g=d),g&&(n.head&&(M=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(s,s+g),M)),512&ar(n)&&4&n.wrap&&(n.check=Sr(n.check,r,g,s)),d-=g,s+=g,n.length-=g),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&ar(n)){if(d===0)break e;g=0;do M=r[s+g++],n.head&&M&&n.length<65536&&(n.head.name+=String.fromCharCode(M));while(M&&g<d);if(512&ar(n)&&4&n.wrap&&(n.check=Sr(n.check,r,g,s)),d-=g,s+=g,M)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&ar(n)){if(d===0)break e;g=0;do M=r[s+g++],n.head&&M&&n.length<65536&&(n.head.comment+=String.fromCharCode(M));while(M&&g<d);if(512&ar(n)&&4&n.wrap&&(n.check=Sr(n.check,r,g,s)),d-=g,s+=g,M)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&ar(n)){for(;p<16;){if(d===0)break e;d--,h+=r[s++]<<p,p+=8}if(4&n.wrap&&h!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Pn;break}h=0,p=0}n.head&&(n.head.hcrc=ar(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=Ks;break;case 16189:for(;p<32;){if(d===0)break e;d--,h+=r[s++]<<p,p+=8}e.adler=n.check=vx(h),h=0,p=0,n.mode=Jm;case Jm:if(n.havedict===0)return e.next_out=a,e.avail_out=l,e.next_in=s,e.avail_in=d,n.hold=h,n.bits=p,h$;e.adler=n.check=1,n.mode=Ks;case Ks:if(t===l$||t===qm)break e;case Ky:if(n.last){h>>>=7&p,p-=7&p,n.mode=zy;break}for(;p<3;){if(d===0)break e;d--,h+=r[s++]<<p,p+=8}switch(n.last=1&h,h>>>=1,p-=1,3&h){case 0:n.mode=16193;break;case 1:if(_$(n),n.mode=Qm,t===qm){h>>>=2,p-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=Pn}h>>>=2,p-=2;break;case 16193:for(h>>>=7&p,p-=7&p;p<32;){if(d===0)break e;d--,h+=r[s++]<<p,p+=8}if((65535&h)!=(h>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Pn;break}if(n.length=65535&h,h=0,p=0,n.mode=Yy,t===qm)break e;case Yy:n.mode=16195;case 16195:if(g=n.length,g){if(g>d&&(g=d),g>l&&(g=l),g===0)break e;i.set(r.subarray(s,s+g),a),d-=g,s+=g,l-=g,a+=g,n.length-=g;break}n.mode=Ks;break;case 16196:for(;p<14;){if(d===0)break e;d--,h+=r[s++]<<p,p+=8}if(n.nlen=257+(31&h),h>>>=5,p-=5,n.ndist=1+(31&h),h>>>=5,p-=5,n.ncode=4+(15&h),h>>>=4,p-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Pn;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;p<3;){if(d===0)break e;d--,h+=r[s++]<<p,p+=8}n.lens[Ne[n.have++]]=7&h,h>>>=3,p-=3}for(;n.have<19;)n.lens[Ne[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,pe={bits:n.lenbits},B=np(0,n.lens,0,19,n.lencode,0,n.work,pe),n.lenbits=pe.bits,B){e.msg="invalid code lengths set",n.mode=Pn;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;J=n.lencode[h&(1<<n.lenbits)-1],y=J>>>24,b=J>>>16&255,N=65535&J,!(y<=p);){if(d===0)break e;d--,h+=r[s++]<<p,p+=8}if(N<16)h>>>=y,p-=y,n.lens[n.have++]=N;else{if(N===16){for(Pe=y+2;p<Pe;){if(d===0)break e;d--,h+=r[s++]<<p,p+=8}if(h>>>=y,p-=y,n.have===0){e.msg="invalid bit length repeat",n.mode=Pn;break}M=n.lens[n.have-1],g=3+(3&h),h>>>=2,p-=2}else if(N===17){for(Pe=y+3;p<Pe;){if(d===0)break e;d--,h+=r[s++]<<p,p+=8}h>>>=y,p-=y,M=0,g=3+(7&h),h>>>=3,p-=3}else{for(Pe=y+7;p<Pe;){if(d===0)break e;d--,h+=r[s++]<<p,p+=8}h>>>=y,p-=y,M=0,g=11+(127&h),h>>>=7,p-=7}if(n.have+g>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Pn;break}for(;g--;)n.lens[n.have++]=M}}if(n.mode===Pn)break;if(n.lens[256]===0){e.msg="invalid code -- missing end-of-block",n.mode=Pn;break}if(n.lenbits=9,pe={bits:n.lenbits},B=np(1,n.lens,0,n.nlen,n.lencode,0,n.work,pe),n.lenbits=pe.bits,B){e.msg="invalid literal/lengths set",n.mode=Pn;break}if(n.distbits=6,n.distcode=n.distdyn,pe={bits:n.distbits},B=np(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,pe),n.distbits=pe.bits,B){e.msg="invalid distances set",n.mode=Pn;break}if(n.mode=Qm,t===qm)break e;case Qm:n.mode=Zm;case Zm:if(d>=6&&l>=258){e.next_out=a,e.avail_out=l,e.next_in=s,e.avail_in=d,n.hold=h,n.bits=p,o$(e,m),a=e.next_out,i=e.output,l=e.avail_out,s=e.next_in,r=e.input,d=e.avail_in,h=n.hold,p=n.bits,n.mode===Ks&&(n.back=-1);break}for(n.back=0;J=n.lencode[h&(1<<n.lenbits)-1],y=J>>>24,b=J>>>16&255,N=65535&J,!(y<=p);){if(d===0)break e;d--,h+=r[s++]<<p,p+=8}if(b&&!(240&b)){for(L=y,x=b,F=N;J=n.lencode[F+((h&(1<<L+x)-1)>>L)],y=J>>>24,b=J>>>16&255,N=65535&J,!(L+y<=p);){if(d===0)break e;d--,h+=r[s++]<<p,p+=8}h>>>=L,p-=L,n.back+=L}if(h>>>=y,p-=y,n.back+=y,n.length=N,b===0){n.mode=16205;break}if(32&b){n.back=-1,n.mode=Ks;break}if(64&b){e.msg="invalid literal/length code",n.mode=Pn;break}n.extra=15&b,n.mode=16201;case 16201:if(n.extra){for(Pe=n.extra;p<Pe;){if(d===0)break e;d--,h+=r[s++]<<p,p+=8}n.length+=h&(1<<n.extra)-1,h>>>=n.extra,p-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;J=n.distcode[h&(1<<n.distbits)-1],y=J>>>24,b=J>>>16&255,N=65535&J,!(y<=p);){if(d===0)break e;d--,h+=r[s++]<<p,p+=8}if(!(240&b)){for(L=y,x=b,F=N;J=n.distcode[F+((h&(1<<L+x)-1)>>L)],y=J>>>24,b=J>>>16&255,N=65535&J,!(L+y<=p);){if(d===0)break e;d--,h+=r[s++]<<p,p+=8}h>>>=L,p-=L,n.back+=L}if(h>>>=y,p-=y,n.back+=y,64&b){e.msg="invalid distance code",n.mode=Pn;break}n.offset=N,n.extra=15&b,n.mode=16203;case 16203:if(n.extra){for(Pe=n.extra;p<Pe;){if(d===0)break e;d--,h+=r[s++]<<p,p+=8}n.offset+=h&(1<<n.extra)-1,h>>>=n.extra,p-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Pn;break}n.mode=16204;case 16204:if(l===0)break e;if(g=m-l,n.offset>g){if(g=n.offset-g,g>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Pn;break}g>n.wnext?(g-=n.wnext,w=n.wsize-g):w=n.wnext-g,g>n.length&&(g=n.length),R=n.window}else R=i,w=a-n.offset,g=n.length;g>l&&(g=l),l-=g,n.length-=g;do i[a++]=R[w++];while(--g);n.length===0&&(n.mode=Zm);break;case 16205:if(l===0)break e;i[a++]=n.length,l--,n.mode=Zm;break;case zy:if(n.wrap){for(;p<32;){if(d===0)break e;d--,h|=r[s++]<<p,p+=8}if(m-=l,e.total_out+=m,n.total+=m,4&n.wrap&&m&&(e.adler=n.check=ar(n)?Sr(n.check,i,m,a-m):qh(n.check,i,m,a-m)),m=l,4&n.wrap&&(ar(n)?h:vx(h))!==n.check){e.msg="incorrect data check",n.mode=Pn;break}h=0,p=0}n.mode=16207;case 16207:if(n.wrap&&ar(n)){for(;p<32;){if(d===0)break e;d--,h+=r[s++]<<p,p+=8}if(4&n.wrap&&h!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Pn;break}h=0,p=0}n.mode=16208;case 16208:B=u$;break e;case Pn:B=gx;break e;case 16210:return Sx;default:return fo}return e.next_out=a,e.avail_out=l,e.next_in=s,e.avail_in=d,n.hold=h,n.bits=p,(n.wsize||m!==e.avail_out&&n.mode<Pn&&(n.mode<zy||t!==Ex))&&Ax(e,e.output,e.next_out,m-e.avail_out),_-=e.avail_in,m-=e.avail_out,e.total_in+=_,e.total_out+=m,n.total+=m,4&n.wrap&&m&&(e.adler=n.check=ar(n)?Sr(n.check,i,m,e.next_out-m):qh(n.check,i,m,e.next_out-m)),e.data_type=n.bits+(n.last?64:0)+(n.mode===Ks?128:0)+(n.mode===Qm||n.mode===Yy?256:0),(_===0&&m===0||t===Ex)&&B===td&&(B=p$),B},Ys={inflateReset:yx,inflateReset2:Cx,inflateResetKeep:Rx,inflateInit:e=>Ix(e,15),inflateInit2:Ix,inflate:m$,inflateEnd:e=>{if(nd(e))return fo;let t=e.state;return t.window&&(t.window=null),e.state=null,td},inflateGetHeader:(e,t)=>{if(nd(e))return fo;const n=e.state;return 2&n.wrap?(n.head=t,t.done=!1,td):fo},inflateSetDictionary:(e,t)=>{const n=t.length;let r,i,s;return nd(e)?fo:(r=e.state,r.wrap!==0&&r.mode!==Jm?fo:r.mode===Jm&&(i=1,i=qh(i,t,n,0),i!==r.check)?gx:(s=Ax(e,t,n,n),s?(r.mode=16210,Sx):(r.havedict=1,td)))},inflateInfo:"pako inflate (from Nodeca project)"},E$=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const bx=Object.prototype.toString,{Z_NO_FLUSH:g$,Z_FINISH:S$,Z_OK:rp,Z_STREAM_END:Jy,Z_NEED_DICT:Qy,Z_STREAM_ERROR:T$,Z_DATA_ERROR:Ox,Z_MEM_ERROR:v$}=Bm;function $m(e){this.options=Wm.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new fx,this.strm.avail_out=0;let n=Ys.inflateInit2(this.strm,t.windowBits);if(n!==rp)throw new Error(Qc[n]);if(this.header=new E$,Ys.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=tp.string2buf(t.dictionary):bx.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=Ys.inflateSetDictionary(this.strm,t.dictionary),n!==rp)))throw new Error(Qc[n])}function Nx(e,t){const n=new $m(t);if(n.push(e),n.err)throw n.msg||Qc[n.err];return n.result}$m.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let s,a,d;if(this.ended)return!1;for(a=t===~~t?t:t===!0?S$:g$,bx.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),s=Ys.inflate(n,a),s===Qy&&i&&(s=Ys.inflateSetDictionary(n,i),s===rp?s=Ys.inflate(n,a):s===Ox&&(s=Qy));n.avail_in>0&&s===Jy&&n.state.wrap>0&&e[n.next_in]!==0;)Ys.inflateReset(n),s=Ys.inflate(n,a);switch(s){case T$:case Ox:case Qy:case v$:return this.onEnd(s),this.ended=!0,!1}if(d=n.avail_out,n.next_out&&(n.avail_out===0||s===Jy))if(this.options.to==="string"){let l=tp.utf8border(n.output,n.next_out),h=n.next_out-l,p=tp.buf2string(n.output,l);n.next_out=h,n.avail_out=r-h,h&&n.output.set(n.output.subarray(l,l+h),0),this.onData(p)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(s!==rp||d!==0){if(s===Jy)return s=Ys.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},$m.prototype.onData=function(e){this.chunks.push(e)},$m.prototype.onEnd=function(e){e===rp&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Wm.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var R$={inflate:Nx,inflateRaw:function(e,t){return(t=t||{}).raw=!0,Nx(e,t)}};const{deflate:y$,deflateRaw:C$}=i$,{inflate:I$,inflateRaw:w$}=R$;var A$=y$,b$=C$,O$=I$,N$=w$,Dx=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(Dx||{});class D${constructor(){I(this,"_sequence",0),I(this,"_startTime",Date.now()),I(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const d=new Uint8Array(4);d.set([1,0,0,0]);const l={id:0,length:4,data:d.buffer},h={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[l]};n.commonPacketHeader.extension=1,n.extension=h,n.payload=this.compress(t),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;A("SHOW_DATASTREAM2_LOG")&&T.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const r=new ArrayBuffer(n.commonPacketHeader.length),i=new Uint8Array(r),s=new DataView(r);let a=0;if(s.setUint16(a,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),a+=2,s.setUint32(a,n.commonPacketHeader.sequence,!0),a+=4,s.setUint16(a,n.commonStreamHeader,!0),a+=2,n.extension){const d=this.serializeExtension(n.extension);i.set(new Uint8Array(d),a),a+=d.byteLength}if(i.set(new Uint8Array(n.payload),a),a+=n.payload.byteLength,a!==n.commonPacketHeader.length)throw Error("serialize error!");return r}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const n=new DataView(t);let r=0;const i=n.getUint16(r,!0);r+=2;const s={length:16383&i,reserved:(16384&i)>>14,extension:(32768&i)>>15,sequence:n.getUint16(r+2,!0)<<16|n.getUint16(r,!0)};let a,d;if(r+=4,A("SHOW_DATASTREAM2_LOG")&&T.debug("receive data header: ".concat(JSON.stringify(s))),n.getUint16(r,!0),r+=2,s.extension){d=this.deserializeExtension(t.slice(r)),r+=2+d.length,a=t.slice(r);let l=!1;if(d.datas.length>0){const h=d.datas.find(p=>p.id===0);h&&(l=(1&new DataView(h.data).getUint32(0,!0))==1)}a=l?this.decompress(a):a}else a=t.slice(8);return a}serializeExtension(t){const{profile:n,length:r,datas:i}=t,s=new ArrayBuffer(r+2),a=new Uint8Array(s),d=new DataView(s);let l=0;if(d.setUint8(l++,n),d.setUint8(l++,r),i.forEach(h=>{n?(d.setUint8(l++,h.id),d.setUint8(l++,h.length),a.set(new Uint8Array(h.data),l),l+=h.data.byteLength):(d.setUint8(l++,h.id|h.length<<4),a.set(new Uint8Array(h.data),l),l+=h.data.byteLength)}),l!==r+2)throw Error("serialize extension error, is ".concat(l,"!==").concat(r+2));return s}deserializeExtension(t){const n=new DataView(t);let r=0;const i=n.getUint8(r);r++;const s=n.getUint8(r);r++;const a=i===Dx.TWO_BYTE,d=[],l=new DataView(t,2);let h=0;for(;h<s;){let p=0,_=0,m=new ArrayBuffer(0);a?(p=l.getUint8(h),h++,_=l.getUint8(h),h++):(p=15&l.getUint8(h),_=l.getUint8(h)>>4,h++),_>0&&(m=l.buffer.slice(h+2,h+2+_),h+=m.byteLength),d.push({id:p,length:_,data:m})}if(h!==s)throw Error("parse error");return{profile:i,length:s,datas:d}}decompress(t){return O$(new Uint8Array(t))}compress(t){return A$(new Uint8Array(t))}}const P$={name:"DataStream",create:(e,t)=>{const n=t?new UJ(e):new xJ(e);return n.useDataStream(new D$),n}};class L$ extends Vt{constructor(t,n,r){super(),I(this,"ws",void 0),I(this,"requestId",1),I(this,"heartBeatTimer",void 0),I(this,"joinInfo",void 0),I(this,"clientId",void 0),I(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),I(this,"onClose",i=>{this.emit("close"),this.dispose()}),I(this,"onMessage",i=>{const s=JSON.parse(i.data);if(!s||s.command!=="serverResponse"||!s.requestId)return s&&s.command==="serverStatus"&&s.serverStatus&&s.serverStatus.command?(this.emit("status",s.serverStatus),void this.emit(s.serverStatus.command,s.serverStatus)):void 0;this.emit("req_".concat(s.requestId),s)}),this.joinInfo=t,this.clientId=n,this.ws=new Ah("cross-channel-".concat(this.clientId),r),this.ws.on(Be.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Be.CONNECTED,this.onOpen),this.ws.on(Be.ON_MESSAGE,this.onMessage),this.ws.on(Be.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const n=this.requestId++;return t.requestId=n,t.seq=n,this.ws.sendMessage(t),n}waitStatus(t){return new ae((n,r)=>{const i=window.setTimeout(()=>{r(new j(O.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,s=>{window.clearTimeout(i),s.state&&s.state!==0?r(new j(O.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(i),r(new j(O.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new j(O.WS_DISCONNECT);const n=()=>new ae((a,d)=>{this.ws.once(Be.CLOSED,()=>d(new j(O.WS_ABORT))),this.ws.once(Be.CONNECTED,a)});this.ws.state!=="connected"&&await n();const r=this.sendMessage(t),i=new ae((a,d)=>{const l=()=>{d(new j(O.WS_ABORT))};this.ws.once(Be.RECONNECTING,l),this.ws.once(Be.CLOSED,l),this.once("req_".concat(r),a),Tn(3e3).then(()=>{this.removeAllListeners("req_".concat(r)),this.ws.off(Be.RECONNECTING,l),this.ws.off(Be.CLOSED,l),d(new j(O.TIMEOUT,"cross channel ws request timeout"))})}),s=await i;if(!s||s.code!==200)throw new j(O.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(s)));return s}async connect(t){this.ws.removeAllListeners(Be.REQUEST_NEW_URLS),this.ws.on(Be.REQUEST_NEW_URLS,n=>{n(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const n=this.requestId++;return t.requestId=n,this.ws.sendMessage(t),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class k$ extends Vt{set state(t){t!==this._state&&(t!==xr.RELAY_STATE_FAILURE&&(this.errorCode=bl.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,n,r,i,s){super(),I(this,"joinInfo",void 0),I(this,"sid",void 0),I(this,"clientId",void 0),I(this,"cancelToken",Cr.CancelToken.source()),I(this,"workerToken",void 0),I(this,"requestId",0),I(this,"signal",void 0),I(this,"prevChannelMediaConfig",void 0),I(this,"httpRetryConfig",void 0),I(this,"_resolution",void 0),I(this,"_state",xr.RELAY_STATE_IDLE),I(this,"errorCode",bl.RELAY_OK),I(this,"onStatus",a=>{T.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(a))),a&&a.command&&(a.command==="onAudioPacketReceived"&&this.emit("event",js.PACKET_RECEIVED_AUDIO_FROM_SRC),a.command==="onVideoPacketReceived"&&this.emit("event",js.PACKET_RECEIVED_VIDEO_FROM_SRC),a.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=bl.SRC_TOKEN_EXPIRED,this.state=xr.RELAY_STATE_FAILURE),a.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=bl.DEST_TOKEN_EXPIRED,this.state=xr.RELAY_STATE_FAILURE))}),I(this,"onReconnect",async()=>{T.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",js.NETWORK_DISCONNECTED),this.state=xr.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(a=>{this.state!==xr.RELAY_STATE_IDLE&&(T.error("auto restart channel media relay failed",a.toString()),this.errorCode=bl.SERVER_CONNECTION_LOST,this.state=xr.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=n,this.sid=Pc(),this.signal=new L$(this.joinInfo,this.clientId,r),this.httpRetryConfig=i,this._resolution=s}async startChannelMediaRelay(t){if(this.state!==xr.RELAY_STATE_IDLE)throw new j(O.INVALID_OPERATION);this.state=xr.RELAY_STATE_CONNECTING,await this.connect(),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new j(O.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new j(O.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new j(O.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==xr.RELAY_STATE_RUNNING)throw new j(O.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==xr.RELAY_STATE_RUNNING)throw new j(O.INVALID_OPERATION);const n=this.genMessage(Ar.SetVideoProfile);await this.signal.request(n),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),T.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=xr.RELAY_STATE_IDLE,this.dispose()}dispose(){T.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Cr.CancelToken.source(),this.state=xr.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await jQ(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",js.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const n=this.genMessage(Ar.SetSdkProfile,t);await this.signal.request(n),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const r=this.genMessage(Ar.SetSourceChannel,t);await this.signal.request(r),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",js.PACKET_JOINED_SRC_CHANNEL),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const i=this.genMessage(Ar.SetSourceUserId,t);await this.signal.request(i),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const s=this.genMessage(Ar.SetDestChannel,t);await this.signal.request(s),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",js.PACKET_JOINED_DEST_CHANNEL),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const a=this.genMessage(Ar.StartPacketTransfer,t);await this.signal.request(a),this.emit("event",js.PACKET_SENT_TO_DEST_CHANNEL),this.state=xr.RELAY_STATE_RUNNING,T.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const n=this.genMessage(Ar.UpdateDestChannel,t);await this.signal.request(n),this.emit("event",js.PACKET_UPDATE_DEST_CHANNEL),T.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(Ar.StopPacketTransfer);await this.signal.request(t),T.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,n){const r=[],i=[],s=[];this.requestId+=1;const a={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Di,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};a.sdkVersion==="4.24.2"&&(a.sdkVersion="0.0.1");let d=null,l=null;switch(t){case Ar.SetSdkProfile:return a.clientRequest={command:"SetSdkProfile",type:"multi_channel"},a;case Ar.SetSourceChannel:if(l=n&&n.getSrcChannelMediaInfo(),!l)throw new j(O.UNEXPECTED_ERROR,"can not find source config");return a.clientRequest={command:"SetSourceChannel",uid:"0",channelName:l.channelName,token:l.token||this.joinInfo.appId},a;case Ar.SetSourceUserId:if(l=n&&n.getSrcChannelMediaInfo(),!l)throw new j(O.UNEXPECTED_ERROR,"can not find source config");return a.clientRequest={command:"SetSourceUserId",uid:l.uid+""},a;case Ar.SetDestChannel:if(d=n&&n.getDestChannelMediaInfo(),!d)throw new j(O.UNEXPECTED_ERROR,"can not find dest config");return d.forEach(h=>{r.push(h.channelName),i.push(h.uid+""),s.push(h.token||this.joinInfo.appId)}),a.clientRequest={command:"SetDestChannel",channelName:r,uid:i,token:s},a;case Ar.StartPacketTransfer:return a.clientRequest={command:"StartPacketTransfer"},a;case Ar.Reconnect:return a.clientRequest={command:"Reconnect"},a;case Ar.StopPacketTransfer:return a.clientRequest={command:"StopPacketTransfer"},a;case Ar.UpdateDestChannel:if(d=n&&n.getDestChannelMediaInfo(),!d)throw new j(O.UNEXPECTED_ERROR,"can not find dest config");return d.forEach(h=>{r.push(h.channelName),i.push(h.uid+""),s.push(h.token||this.joinInfo.appId)}),a.clientRequest={command:"UpdateDestChannel",channelName:r,uid:i,token:s},a;case Ar.SetVideoProfile:a.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return a}}const M$={name:"ChannelMediaRelay",create:function(e){return new k$(e.joinInfo,e.clientId,e.websocketRetryConfig||nn,e.httpRetryConfig||nn,e.resolution)}};function Px(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function ip(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Px(Object(n),!0).forEach(function(r){I(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Px(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class U$ extends Vt{constructor(t,n,r,i){super(),I(this,"spec",void 0),I(this,"token",void 0),I(this,"websocket",void 0),I(this,"pingpongTimer",void 0),I(this,"reconnectMode","retry"),I(this,"serviceMode",void 0),I(this,"reqId",0),I(this,"commandReqId",0),I(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),I(this,"handleWebSocketMessage",s=>{if(!s.data)return;const a=JSON.parse(s.data);a.requestId?this.emit("@".concat(a.requestId,"-").concat(a.sid),a):(Se.workerEvent(this.spec.sid,{actionType:"status",serverCode:a.code,workerType:this.serviceMode===Bs.TRANSCODE?1:2}),this.emit(Ca.PUBLISH_STREAM_STATUS,a))}),this.spec=n,this.token=t,this.serviceMode=i,this.websocket=new Ah("live-streaming",r),this.websocket.on(Be.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Be.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Be.REQUEST_NEW_URLS,(s,a)=>{dn(this,Ca.REQUEST_NEW_ADDRESS).then(s).catch(a)}),this.websocket.on(Be.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,n,r,i){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const s=this.commandReqId,a=this.reqId;if(!a||!this.websocket)throw new j(O.UNEXPECTED_ERROR);const d=ip({command:t,sdkVersion:Di==="4.24.2"?"0.0.1":Di,seq:a,requestId:a,allocate:r,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new j(O.WS_DISCONNECT);const l=()=>new ae((m,g)=>{this.websocket.once(Be.CLOSED,()=>g(new j(O.WS_ABORT))),this.websocket.once(Be.CONNECTED,m)});this.websocket.state!=="connected"&&await l(),d.clientRequest&&(d.clientRequest.workerToken=this.token);const h=new ae((m,g)=>{const w=()=>{g(new j(O.WS_ABORT))};this.websocket.once(Be.RECONNECTING,w),this.websocket.once(Be.CLOSED,w),this.once("@".concat(a,"-").concat(this.spec.sid),R=>{m(R)})});i&&Se.workerEvent(this.spec.sid,ip(ip({},i),{},{requestId:s,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const p=Date.now();this.websocket.sendMessage(d);let _=null;try{_=await h}catch(m){if(this.websocket.state==="closed")throw m;return await l(),await this.request(t,n,r)}return i&&Se.workerEvent(this.spec.sid,ip(ip({},i),{},{requestId:s,actionType:"response",payload:JSON.stringify(_.serverResponse),serverCode:_.code,success:_.code===200,responseTime:Date.now()-p})),_.code!==200&&this.handleResponseError(_),_}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=Di==="4.24.2"?"0.0.1":Di;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case _n.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void T.warning("live stream response already exists stream");case _n.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case _n.LIVE_STREAM_RESPONSE_BAD_STREAM:case _n.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new j(O.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case _n.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new j(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case _n.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new j(O.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case _n.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new j(O.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Ca.WARNING,n,t.serverResponse.url)}case _n.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new j(O.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Ca.WARNING,n,t.serverResponse.url)}case _n.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new j(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case _n.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new j(O.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case _n.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new j(O.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Ca.WARNING,n,t.serverResponse.url)}case _n.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new j(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case _n.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new j(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case _n.LIVE_STREAM_RESPONSE_WORKER_LOST:case _n.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new j(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case _n.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new j(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new j(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case _n.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case _n.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case _n.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case _n.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new j(O.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(Sh)},6e3)}}function Lx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Fr(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Lx(Object(n),!0).forEach(function(r){I(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Lx(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class x$ extends Vt{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:nn,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:nn;super(),I(this,"onLiveStreamWarning",void 0),I(this,"onLiveStreamError",void 0),I(this,"spec",void 0),I(this,"retryTimeout",1e4),I(this,"connection",void 0),I(this,"httpRetryConfig",void 0),I(this,"wsRetryConfig",void 0),I(this,"streamingTasks",new Map),I(this,"isStartingStreamingTask",!1),I(this,"taskMutex",new bn("live-streaming")),I(this,"cancelToken",Cr.CancelToken.source()),I(this,"transcodingConfig",void 0),I(this,"uapResponse",void 0),I(this,"lastTaskId",1),I(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=r,this.wsRetryConfig=n}async setTranscodingConfig(t){const n=Fr(Fr({},TQ),t);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(T.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(a=>Fr(Fr(Fr({},SQ),a),{},{zOrder:a.zOrder?a.zOrder+1:1}))),function(a){Wt(a.width)||Rt(a.width,"config.width",0,1e4),Wt(a.height)||Rt(a.height,"config.height",0,1e4),Wt(a.videoBitrate)||Rt(a.videoBitrate,"config.videoBitrate",1,1e6),Wt(a.videoFrameRate)||Rt(a.videoFrameRate,"config.videoFrameRate"),Wt(a.lowLatency)||to(a.lowLatency,"config.lowLatency"),Wt(a.audioSampleRate)||tn(a.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Wt(a.audioBitrate)||Rt(a.audioBitrate,"config.audioBitrate",1,128),Wt(a.audioChannels)||tn(a.audioChannels,"config.audioChannels",[1,2,3,4,5]),Wt(a.videoGop)||Rt(a.videoGop,"config.videoGop"),Wt(a.videoCodecProfile)||tn(a.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Wt(a.userCount)||Rt(a.userCount,"config.userCount",0,17),Wt(a.backgroundColor)||Rt(a.backgroundColor,"config.backgroundColor",0,16777215),Wt(a.userConfigExtraInfo)||Mn(a.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),a.transcodingUsers&&!Wt(a.transcodingUsers)&&(Vs(a.transcodingUsers,"config.transcodingUsers"),a.transcodingUsers.forEach((d,l)=>{dm(d.uid),Wt(d.x)||Rt(d.x,"transcodingUser[".concat(l,"].x"),0,1e4),Wt(d.y)||Rt(d.y,"transcodingUser[".concat(l,"].y"),0,1e4),Wt(d.width)||Rt(d.width,"transcodingUser[".concat(l,"].width"),0,1e4),Wt(d.height)||Rt(d.height,"transcodingUser[".concat(l,"].height"),0,1e4),Wt(d.zOrder)||Rt(d.zOrder-1,"transcodingUser[".concat(l,"].zOrder"),0,100),Wt(d.alpha)||Rt(d.alpha,"transcodingUser[".concat(l,"].alpha"),0,1,!1)})),Wt(a.watermark)||jR(a.watermark,"watermark"),Wt(a.backgroundImage)||jR(a.backgroundImage,"backgroundImage"),a.images&&!Wt(a.images)&&(Vs(a.images,"config.images"),a.images.forEach((d,l)=>{jR(d,"images[".concat(l,"]"))}))}(n);const r=[];n.images&&r.push(...n.images.map(a=>Fr(Fr(Fr({},BR),a),{},{zOrder:255}))),n.backgroundImage&&(r.push(Fr(Fr(Fr({},BR),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(r.push(Fr(Fr(Fr({},BR),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=r,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(a=>Fr({},a)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const i=(n.userConfigs||[]).map(a=>typeof a.uid=="number"?ae.resolve(a.uid):$M(a.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await ae.all(i)).forEach((a,d)=>{n.userConfigs&&n.userConfigs[d]&&(n.userConfigs[d].uid=a)}),this.transcodingConfig=n,this.connection)try{var s;const a=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Xr(s=this.streamingTasks).call(s)).map(d=>d.taskId).join("#")});T.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(a.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(a){if(!a.data||!a.data.retry)throw a;a.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(d=>{T.warning("[".concat(this.spec.clientId,"] live streaming receive error"),a.toString(),"try to republish",d.url),this.startLiveStreamingTask(d.url,d.mode,a).then(()=>{T.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(d.url," success"))}).catch(l=>{T.error("[".concat(this.spec.clientId,"] live streaming republish failed"),d.url,l.toString()),this.onLiveStreamError&&this.onLiveStreamError(d.url,l)})})}}async startLiveStreamingTask(t,n,r){if(!this.transcodingConfig&&n===Bs.TRANSCODE)throw new j(O.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const i={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};T.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(n));const s=await this.taskMutex.lock();if(!this.connection&&r)return void s();if(this.streamingTasks.get(t)&&!r)return s(),new j(O.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(d){throw s(),d}switch(n){case Bs.TRANSCODE:i.transcodingConfig=Fr({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(i.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const a=this.lastTaskId++;try{const d=new ae((h,p)=>{Tn(this.retryTimeout).then(()=>{if(r)return p(r);const _=this.statusError.get(t);return _?(this.statusError.delete(t),p(_)):void 0})}),l=await ae.race([this.connection.request("request",{clientRequest:i},!0,{url:t,command:"PublishStream",workerType:n===Bs.TRANSCODE?1:2,requestByUser:!r,tid:a.toString()}),d]);this.isStartingStreamingTask=!1,T.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(l.code)),this.streamingTasks.set(t,{clientRequest:i,mode:n,url:t,taskId:a}),s()}catch(d){if(s(),this.isStartingStreamingTask=!1,!d.data||!d.data.retry||r)throw d;return d.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,n,d)):await this.startLiveStreamingTask(t,n,d)}}stopLiveStreamingTask(t){return new ae((n,r)=>{const i=this.streamingTasks.get(t);if(!i||!this.connection)return new j(O.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const s=i.mode;i.abortTask=()=>{T.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:i.url}},!1,{url:t,command:"UnPublishStream",workerType:s===Bs.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(a=>{T.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(a.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()}).catch(r)})}resetAllTask(){var t;const n=Array.from(Xr(t=this.streamingTasks).call(t));this.terminate();for(const r of n)this.startLiveStreamingTask(r.url,r.mode).catch(i=>{this.onLiveStreamError&&this.onLiveStreamError(r.url,i)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Cr.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new j(O.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await dn(this,GR.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=n,this.connection=new U$(n.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(Ca.WARNING,(r,i)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(i,r)),this.connection.on(Ca.PUBLISH_STREAM_STATUS,r=>this.handlePublishStreamServer(r)),this.connection.on(Ca.REQUEST_NEW_ADDRESS,(r,i)=>{if(!this.connection)return i(new j(O.UNEXPECTED_ERROR,"can not get new live streaming address list"));dn(this,GR.REQUEST_WORKER_MANAGER_LIST,t).then(s=>{this.uapResponse=s,r(s.addressList)}).catch(i)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(t){const n=t.serverStatus&&t.serverStatus.url||"empty_url",r=this.streamingTasks.get(n),i=t.reason;switch(t.code){case _n.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case _n.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case _n.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case _n.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const a=new j(O.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(r)return T.error(a.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,a);if(!this.isStartingStreamingTask)return;this.statusError.set(n,a)}case _n.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const a=new j(O.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,i);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,a)}case _n.LIVE_STREAM_RESPONSE_WORKER_LOST:case _n.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var s;if(!this.connection)return;this.connection.tryNextAddress();const a=Array.from(Xr(s=this.streamingTasks).call(s));for(const d of a)d.abortTask?d.abortTask():(T.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",d.url),this.startLiveStreamingTask(d.url,d.mode,new j(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{T.debug("[".concat(this.spec.clientId,"] republish live stream success"),d.url)}).catch(l=>{T.error(l.toString()),this.onLiveStreamError&&this.onLiveStreamError(d.url,l)}));return}}}hasUrl(t){return this.streamingTasks.has(t)}}const V$={name:"LiveStreaming",create:function(e){return new x$(e.joinInfo,e.websocketRetryConfig||nn,e.httpRetryConfig||nn)}};function F$(e){let t=Ux();return function(n,r){let i=n.appId;i!==void 0&&(mt(r,10),vs(r,i));let s=n.cid;s!==void 0&&(mt(r,16),mt(r,s));let a=n.cname;a!==void 0&&(mt(r,26),vs(r,a));let d=n.deviceId;d!==void 0&&(mt(r,34),vs(r,d));let l=n.elapse;l!==void 0&&(mt(r,40),xa(r,l));let h=n.fileSize;h!==void 0&&(mt(r,48),xa(r,Yl(h)));let p=n.height;p!==void 0&&(mt(r,56),xa(r,Yl(p)));let _=n.jpg;_!==void 0&&(mt(r,66),mt(r,_.length),function(Ut,Z){let oe=zl(Ut,Z.length);Ut.bytes.set(Z,oe)}(r,_));let m=n.networkType;m!==void 0&&(mt(r,72),xa(r,Yl(m)));let g=n.osType;g!==void 0&&(mt(r,80),xa(r,Yl(g)));let w=n.requestId;w!==void 0&&(mt(r,90),vs(r,w));let R=n.sdkVersion;R!==void 0&&(mt(r,98),vs(r,R));let y=n.sequence;y!==void 0&&(mt(r,104),xa(r,Yl(y)));let b=n.sid;b!==void 0&&(mt(r,114),vs(r,b));let N=n.timestamp;N!==void 0&&(mt(r,120),xa(r,N));let L=n.uid;L!==void 0&&(mt(r,128),mt(r,L));let x=n.vid;x!==void 0&&(mt(r,136),mt(r,x));let F=n.width;F!==void 0&&(mt(r,144),xa(r,Yl(F)));let M=n.service;M!==void 0&&(mt(r,152),mt(r,M));let B=n.callbackData;B!==void 0&&(mt(r,162),vs(r,B));let J=n.jpgEncryption;J!==void 0&&(mt(r,168),mt(r,J));let ee=n.requestType;ee!==void 0&&(mt(r,176),mt(r,ee));let pe=n.scorePorn;pe!==void 0&&(mt(r,185),nC(r,pe));let Pe=n.scoreSexy;Pe!==void 0&&(mt(r,193),nC(r,Pe));let Ne=n.scoreNeutral;Ne!==void 0&&(mt(r,201),nC(r,Ne));let Ge=n.scene;Ge!==void 0&&(mt(r,208),mt(r,Ge));let Fe=n.ossFilePrefix;Fe!==void 0&&(mt(r,218),vs(r,Fe));let st=n.serviceVendor;if(st!==void 0)for(let Ut of st){mt(r,226);let Z=Ux();G$(Ut,Z),mt(r,Z.limit),Y$(r,Z),K$(Z)}}(e,t),function(n){let r=n.bytes,i=n.limit;return r.length===i?r:r.subarray(0,i)}(t)}function B$(e){return function(n){let r={};e:for(;!xx(n);){let i=Rs(n);switch(i>>>3){case 0:break e;case 1:r.code=Rs(n);break;case 2:r.msg=Vx(n,Rs(n));break;case 3:{let s=W$(n);r.data=j$(n),n.limit=s;break}default:kx(n,7&i)}}return r}({bytes:t=e,offset:0,limit:t.length});var t}function j$(e){let t={};e:for(;!xx(e);){let n=Rs(e);switch(n>>>3){case 0:break e;case 1:t.requestId=Vx(e,Rs(e));break;case 2:t.requestType=Rs(e)>>>0;break;case 3:t.scorePorn=tC(e);break;case 4:t.scoreSexy=tC(e);break;case 5:t.scoreNeutral=tC(e);break;case 6:t.requestScene=Rs(e)>>>0;break;case 7:t.scene=Rs(e)>>>0;break;default:kx(e,7&n)}}return t}function G$(e,t){let n=e.service;n!==void 0&&(mt(t,8),mt(t,n));let r=e.vendor;r!==void 0&&(mt(t,16),mt(t,r));let i=e.token;i!==void 0&&(mt(t,26),vs(t,i));let s=e.callbackUrl;s!==void 0&&(mt(t,34),vs(t,s))}function W$(e){let t=Rs(e),n=e.limit;return e.limit=e.offset+t,n}function kx(e,t){switch(t){case 0:for(;128&Fx(e););break;case 2:$y(e,Rs(e));break;case 5:$y(e,4);break;case 1:$y(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let H$=new Float32Array(1);new Uint8Array(H$.buffer);let Zy=new Float64Array(1),Br=new Uint8Array(Zy.buffer);function Yl(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let Mx=[];function Ux(){const e=Mx.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function K$(e){Mx.push(e)}function $y(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function xx(e){return e.offset>=e.limit}function zl(e,t){let n=e.bytes,r=e.offset,i=e.limit,s=r+t;if(s>n.length){let a=new Uint8Array(2*s);a.set(n),e.bytes=a}return e.offset=s,s>i&&(e.limit=s),r}function eC(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function Vx(e,t){let n=eC(e,t),r=String.fromCharCode,i=e.bytes,s="",a="";for(let d=0;d<t;d++){let l,h,p,_,m=i[d+n];128&m?(224&m)==192?d+1>=t?a+=s:(l=i[d+n+1],(192&l)!=128?a+=s:(_=(31&m)<<6|63&l,_<128?a+=s:(a+=r(_),d++))):(240&m)==224?d+2>=t?a+=s:(l=i[d+n+1],h=i[d+n+2],(49344&(l|h<<8))!=32896?a+=s:(_=(15&m)<<12|(63&l)<<6|63&h,_<2048||_>=55296&&_<=57343?a+=s:(a+=r(_),d+=2))):(248&m)==240?d+3>=t?a+=s:(l=i[d+n+1],h=i[d+n+2],p=i[d+n+3],(12632256&(l|h<<8|p<<16))!=8421504?a+=s:(_=(7&m)<<18|(63&l)<<12|(63&h)<<6|63&p,_<65536||_>1114111?a+=s:(_-=65536,a+=r(55296+(_>>10),56320+(1023&_)),d+=3))):a+=s:a+=r(m)}return a}function vs(e,t){let n=t.length,r=0;for(let a=0;a<n;a++){let d=t.charCodeAt(a);d>=55296&&d<=56319&&a+1<n&&(d=(d<<10)+t.charCodeAt(++a)-56613888),r+=d<128?1:d<2048?2:d<65536?3:4}mt(e,r);let i=zl(e,r),s=e.bytes;for(let a=0;a<n;a++){let d=t.charCodeAt(a);d>=55296&&d<=56319&&a+1<n&&(d=(d<<10)+t.charCodeAt(++a)-56613888),d<128?s[i++]=d:(d<2048?s[i++]=d>>6&31|192:(d<65536?s[i++]=d>>12&15|224:(s[i++]=d>>18&7|240,s[i++]=d>>12&63|128),s[i++]=d>>6&63|128),s[i++]=63&d|128)}}function Y$(e,t){let n=zl(e,t.limit),r=e.bytes,i=t.bytes;for(let s=0,a=t.limit;s<a;s++)r[s+n]=i[s]}function Fx(e){return e.bytes[eC(e,1)]}function Bx(e,t){let n=zl(e,1);e.bytes[n]=t}function tC(e){let t=eC(e,8),n=e.bytes;return Br[0]=n[t++],Br[1]=n[t++],Br[2]=n[t++],Br[3]=n[t++],Br[4]=n[t++],Br[5]=n[t++],Br[6]=n[t++],Br[7]=n[t++],Zy[0]}function nC(e,t){let n=zl(e,8),r=e.bytes;Zy[0]=t,r[n++]=Br[0],r[n++]=Br[1],r[n++]=Br[2],r[n++]=Br[3],r[n++]=Br[4],r[n++]=Br[5],r[n++]=Br[6],r[n++]=Br[7]}function Rs(e){let t,n=0,r=0;do t=Fx(e),n<32&&(r|=(127&t)<<n),n+=7;while(128&t);return r}function mt(e,t){for(t>>>=0;t>=128;)Bx(e,127&t|128),t>>>=7;Bx(e,t)}function xa(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,s=i===0?r===0?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,a=zl(e,s),d=e.bytes;switch(s){case 10:d[a+9]=i>>>7&1;case 9:d[a+8]=s!==9?128|i:127&i;case 8:d[a+7]=s!==8?r>>>21|128:r>>>21&127;case 7:d[a+6]=s!==7?r>>>14|128:r>>>14&127;case 6:d[a+5]=s!==6?r>>>7|128:r>>>7&127;case 5:d[a+4]=s!==5?128|r:127&r;case 4:d[a+3]=s!==4?n>>>21|128:n>>>21&127;case 3:d[a+2]=s!==3?n>>>14|128:n>>>14&127;case 2:d[a+1]=s!==2?n>>>7|128:n>>>7&127;case 1:d[a]=s!==1?128|n:127&n}}function jx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}const z$=new Map([["moderation",1],["supervise",2]]);class q$ extends Vt{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(Nn.CONNECTION_STATE_CHANGE,n,t)}get inspectType(){return this._inspectType}set inspectType(t){var n;this._inspectMode=Oi(n=t.map(r=>z$.get(r)||0)).call(n,(r,i)=>r+i),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),I(this,"name","AgoraRTCVideoContentInspect"),I(this,"_connectionState",so.CONNECTING),I(this,"_innerConnectionState",void 0),I(this,"sequence",0),I(this,"inspectStartTime",void 0),I(this,"workerManagerConnection",void 0),I(this,"workerConnection",void 0),I(this,"workerMessageLengthLimit",void 0),I(this,"inspectIntervalMinimum",void 0),I(this,"qualityRatio",void 0),I(this,"_connectInfo",void 0),I(this,"_cancelTokenSource",Cr.CancelToken.source()),I(this,"_retryConfig",void 0),I(this,"wmSequence",0),I(this,"inspectInterval",void 0),I(this,"inspectTimer",null),I(this,"ossFilePrefix",void 0),I(this,"extraInfo",void 0),I(this,"_inspectType",void 0),I(this,"_inspectMode",void 0),I(this,"_quality",1),I(this,"qualityTimer",null),I(this,"_inspectId",void 0),I(this,"_needWorkUrlOnly",!1),I(this,"inspectImage",()=>{if(this.connectionState!==so.CONNECTED)throw new j(O.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===so.CONNECTED?this.requestToInspectImage():T.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=ht(5,"inspect-"),this.workerMessageLengthLimit=A("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=A("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=A("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Ah("worker-manager-"+this._inspectId,nn),this.on(Nn.STATE_CHANGE,(n,r)=>{this._innerConnectionState=n,T.debug("[".concat(this._inspectId,"] Inspect operation :").concat(ao[n]," ").concat(r||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Ah("worker-"+this._inspectId,nn),this.handleWorkerEvents()}async init(t,n){this.emit(Nn.STATE_CHANGE,ao.CONNECT_AP),this._connectInfo=t;const r=this._cancelTokenSource.token;return this._retryConfig=n,new ae((i,s)=>{this.on(Nn.CONNECTION_STATE_CHANGE,(a,d)=>{d===so.CONNECTED&&i()}),this.requestAP(t,r,n).then(a=>{this.connectWorkerManager(a)}).catch(a=>{s(a)})})}async requestAP(t,n,r){const i=A("WEBCS_DOMAIN").map(d=>"https://".concat(d,"/api/v1")),s=await function(d,l,h,p){let{appId:_,areaCode:m,cname:g,sid:w,token:R,uid:y}=l;kl++;const b="image_moderation_api",N={service_name:b,json_body:JSON.stringify({appId:_,areaCode:m,cname:g,command:"allocateEdge",requestId:kl,seq:kl,sid:w,token:R,ts:Date.now(),uid:y+""})};let L,x,F=d[0];return Do(async()=>{L=Date.now();const M=await xo(F,{data:N,cancelToken:h,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(x=Date.now()-L,M.code!==0){const Ne=new j(O.UNEXPECTED_RESPONSE,"image inspect ap error, code"+M.code,{retry:!0,responseTime:x});throw T.error(Ne.toString()),Ne}const B=JSON.parse(M.json_body);if(B.code!==200){const Ne=new j(O.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(B.code,", reason: ").concat(B.reason),{code:B.code,responseTime:x});throw T.error(Ne.toString()),Ne}if(!B.servers||!Array.isArray(B.servers)||B.servers.length===0){const Ne=new j(O.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:B.code,responseTime:x});throw T.error(Ne.toString()),Ne}const J=A("VIDEO_INSPECT_WORKER_MANAGER_WSS");if(J)return{addressList:[J],workerToken:B.workerToken,vid:B.vid,responseTime:x};const ee=A("VIDEO_INSPECT_WORKER_MANAGER_HOST"),pe=A("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:B.servers.map(Ne=>{let{address:Ge,wss:Fe}=Ne;if(Ge&&Fe)return"wss://".concat(Ge.replace(/\./g,"-"),".").concat(ee,":").concat(pe||Fe)}).filter(Ne=>!!Ne),workerToken:B.workerToken,vid:B.vid,responseTime:x}},(M,B)=>(Se.apworkerEvent(w,{success:!0,sc:200,serviceName:b,responseDetail:JSON.stringify(M.addressList),firstSuccess:B===0,responseTime:x,serverIp:d[B%d.length]}),!1),(M,B)=>(Se.apworkerEvent(w,{success:!1,sc:M.data&&M.data.code||200,serviceName:b,responseTime:x,serverIp:d[B%d.length]}),!!(M.code!==O.OPERATION_ABORTED&&M.code!==O.UNEXPECTED_RESPONSE||M.data&&M.data.retry)&&(F=d[(B+1)%d.length],!0)),p)}(i,t,n,r);this.emit(Nn.STATE_CHANGE,ao.AP_CONNECTED);const{addressList:a}=s;return this.wmSequence++,a}async connectWorkerManager(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(Nn.STATE_CHANGE,ao.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Be.CONNECTED,async()=>{this.emit(Nn.STATE_CHANGE,ao.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Be.CLOSED,()=>{this._innerConnectionState<ao.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Be.FAILED,()=>{this._innerConnectionState<ao.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Be.RECONNECTING,()=>{this._innerConnectionState<ao.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Be.ON_MESSAGE,async t=>{this.emit(Nn.STATE_CHANGE,ao.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const r=JSON.parse(t.data);if(r.code!==200)throw T.error("[".concat(this._inspectId,"] Unexpected code ").concat(r.code," from worker manager")),new j(O.UNEXPECTED_RESPONSE,"response code of worker is unexpected",r);if(!(r.serverResponse&&r.serverResponse.portWss&&n))throw T.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(r))),new j(O.UNEXPECTED_RESPONSE,"response content of worker is unexpected",r);{const i=A("VIDEO_INSPECT_WORKER_PORT")||r.serverResponse.portWss,s=n.replace(/:\d+\/?$/,":".concat(i));this.emit(Nn.STATE_CHANGE,ao.CONNECT_WORKER,s),this._needWorkUrlOnly?this.emit(Nn.REQUEST_NEW_WORKER_URL,s):await this.connectWorker(s)}}),this.workerManagerConnection.on(Be.WILL_RECONNECT,(t,n,r)=>{r(t)}),this.workerManagerConnection.on(Be.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}handleWorkerEvents(){this.workerConnection.on(Be.CONNECTED,async()=>{this.emit(Nn.STATE_CHANGE,ao.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=so.CONNECTED}),this.workerConnection.on(Be.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const r=B$(new Uint8Array(t.data));if(A("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&T.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(r)),r.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Nn.INSPECT_RESULT,void 0,void 0);if(r.data&&r.data.scorePorn&&r.data.scoreSexy&&r.data.scoreNeutral){var n;const i={porn:r.data.scorePorn,sexy:r.data.scoreSexy,neutral:r.data.scoreNeutral},s=Oi(n=Object.keys(i)).call(n,(d,l)=>i[d]>i[l]?d:l,"porn"),a=Object.keys(i).find(d=>d===s);this.emit(Nn.INSPECT_RESULT,a)}else this.emit(Nn.INSPECT_RESULT,void 0,new j(O.UNEXPECTED_RESPONSE,r.code+"","There is an unexpected data on message"))}else this.emit(Nn.INSPECT_RESULT,void 0,new j(O.UNEXPECTED_RESPONSE,r.code+"",r.msg))}else T.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Nn.INSPECT_RESULT,void 0,new j(O.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Be.CLOSED,()=>{this.connectionState=so.CLOSED}),this.workerConnection.on(Be.FAILED,()=>{this.connectionState=so.CLOSED}),this.workerConnection.on(Be.RECONNECTING,()=>{this.connectionState=this.connectionState===so.CONNECTED?so.RECONNECTING:so.CONNECTING}),this.workerConnection.on(Be.WILL_RECONNECT,(t,n,r)=>{t==="recover"&&r(t),r("tryNext")}),this.workerConnection.on(Be.REQUEST_NEW_URLS,(t,n)=>{this.workerManagerConnection.close(),this.once(Nn.REQUEST_NEW_WORKER_URL,r=>{t([r])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r=>{this.connectWorkerManager(r,!0)}).catch(r=>{n(r)})})}async requestToInspectImage(){this.sequence++;const t=Zr(this,Nn.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(Nn.INSPECT_RESULT,void 0,new j(O.INVALID_OPERATION,"Only the track being played can be inspected"));const r=await this.generateRequestData(t,n);this.workerConnection.sendMessage(r,!0,!0)}else this.emit(Nn.INSPECT_RESULT,void 0,new j(O.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,n){let{appId:r,cname:i,cid:s,vid:a,sid:d,uid:l}=n;const h=Date.now(),p=await t.getCurrentFrameImage("image/jpeg",this.quality),_=await mk(p,r,i),m=this.sequence+"-"+s+"-"+l+"-"+h+"-"+ht(12,""),g={appId:r,cid:s,cname:i,deviceId:"",elapse:(w=Number(h-this.inspectStartTime),{low:w|=0,high:w>>31,unsigned:w>=0}),fileSize:_.byteLength,jpgEncryption:2,height:p.height,width:p.width,jpg:_,networkType:6,osType:7,requestId:m,sdkVersion:"4.24.2",sequence:this.sequence,sid:d,timestamp:KU(h),uid:l,vid:a,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var w;this.extraInfo===void 0&&delete g.callbackData,this.ossFilePrefix===void 0&&delete g.ossFilePrefix;const R=F$(g);if(R.byteLength<this.workerMessageLengthLimit){if(A("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const y=function(b){for(var N=1;N<arguments.length;N++){var L=arguments[N]!=null?arguments[N]:{};N%2?jx(Object(L),!0).forEach(function(x){I(b,x,L[x])}):Object.getOwnPropertyDescriptors?Object.defineProperties(b,Object.getOwnPropertyDescriptors(L)):jx(Object(L)).forEach(function(x){Object.defineProperty(b,x,Object.getOwnPropertyDescriptor(L,x))})}return b}({},g);delete y.jpg,T.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(y))}return R}{const y=this.quality*this.qualityRatio;return this.quality=y,await this.generateRequestData(t,{appId:r,cname:i,cid:s,vid:a,sid:d,uid:l})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Cr.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=so.CLOSED,this.emit(Nn.STATE_CHANGE,ao.CLOSED)}}const X$={name:"ContentInspect",create:function(e){let{config:t}=e;return function(n){if(!n)throw new j(O.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new j(O.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const r=[...new Set(n.inspectType)];r.forEach(i=>{var s;if(!te(s=["supervise","moderation"]).call(s,i))throw new j(O.INVALID_PARAMS,"".concat(i," is not a valid inspect type."))}),n.inspectType=r}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new j(O.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new q$(t)}};var Gx=E(oi.Object.getOwnPropertySymbols),J$=ut,Q$=Jg.indexOf,Z$=df,rC=_t([].indexOf),Wx=!!rC&&1/rC([1],1,-0)<0;J$({target:"Array",proto:!0,forced:Wx||!Z$("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return Wx?rC(this,e,t)||0:Q$(this,e,t)}});var $$=bi("Array","indexOf"),eee=Q,tee=$$,iC=Array.prototype,nee=function(e){var t=e.indexOf;return e===iC||eee(iC,e)&&t===iC.indexOf?tee:t},Hx=E(nee);function ree(e,t){if(e==null)return{};var n,r,i=function(a,d){if(a==null)return{};var l={};for(var h in a)if({}.hasOwnProperty.call(a,h)){if(Hx(d).call(d,h)!==-1)continue;l[h]=a[h]}return l}(e,t);if(Gx){var s=Gx(e);for(r=0;r<s.length;r++)n=s[r],Hx(t).call(t,n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}let Kx=class{get localCapabilities(){return Dt(this._localCapabilities)}get rtpCapabilities(){return Dt(this._rtpCapabilities)}get candidates(){return Dt(this._candidates)}get iceParameters(){return Dt(this._iceParameters)}get dtlsParameters(){return Dt(this._dtlsParameters)}constructor(e){I(this,"sessionDesc",void 0),I(this,"_localCapabilities",void 0),I(this,"_rtpCapabilities",void 0),I(this,"_candidates",void 0),I(this,"_iceParameters",void 0),I(this,"_dtlsParameters",void 0),I(this,"setup",void 0),I(this,"currentMidIndex",void 0),I(this,"cname","o/i14u9pJrxRKAsu"),I(this,"firefoxSsrcMidMap",new Map),e=Dt(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,localCapabilities:s,direction:a,setup:d,videoCodec:l,audioCodec:h}=e;let p;this.setup=d,p=a===gr.RECEIVE_ONLY?_r(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):_r(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=i,this._candidates=r,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=s;const _=a===gr.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,m=a===gr.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,g=a===gr.RECEIVE_ONLY?i.send.videoCodecs:Lh(_e.VIDEO,_,m,l),w=a===gr.RECEIVE_ONLY?i.send.audioCodecs:Lh(_e.AUDIO,_,m,h);for(const R of p.mediaDescriptions)R.attributes.iceUfrag=t.iceUfrag,R.attributes.icePwd=t.icePwd,R.attributes.fingerprints=n.fingerprints,R.attributes.candidates=r,R.attributes.setup=this.setup,R.media.mediaType==="application"&&(R.attributes.sctpPort="5000"),R.media.mediaType==="video"&&(R.media.fmts=g.map(y=>y.payloadType.toString(10)),R.attributes.payloads=g,R.attributes.extmaps=_.videoExtensions),R.media.mediaType==="audio"&&(R.media.fmts=w.map(y=>y.payloadType.toString(10)),R.attributes.payloads=w,R.attributes.extmaps=_.audioExtensions,Ll(R));this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}toString(){return Fs(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,n,r,i){n=n.replace(/ /g,"-");const{ssrcs:s,ssrcGroups:a}=Dh(t,this.cname,A("SYNC_GROUP")?n:void 0),d=this.findPreloadMediaDesc(s);if(d){if(Nt()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,d.attributes.mid),i&&(i.twcc||i.remb)){const l=this.sessionDesc.mediaDescriptions.indexOf(d);return this.sessionDesc.mediaDescriptions[l]=this.mungSendMediaDesc(d,i),{mid:d.attributes.mid,needExchangeSDP:!0}}return{mid:d.attributes.mid,needExchangeSDP:!1}}{const l=this.findAvailableMediaIndex(e,s,r);let h;return l===-1?(h=this.createOrRecycleSendMedia(e,s,a,"sendonly",r,i),this.updateBundleMids()):(h=Dt(this.sessionDesc.mediaDescriptions[l]),h.attributes.direction="sendonly",h.attributes.ssrcs=s,h.attributes.ssrcGroups=a,this.sessionDesc.mediaDescriptions[l]=this.mungSendMediaDesc(h,i)),Nt()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,h.attributes.mid),{needExchangeSDP:!0,mid:h.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,n){const r=[];return e.forEach(i=>{const s=i._mediaStreamTrack.kind,a=this.findAvailableRecvMediaIndex(s);let d,l=!1;a===-1?(l=!0,d=this.createOrRecycleRecvMedia(i,[],"recvonly",t,n),this.updateBundleMids()):(d=Dt(this.sessionDesc.mediaDescriptions[a]),d.attributes.direction="recvonly"),r.push({mid:d.attributes.mid,needCreateTransceiver:l})}),r}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:n,address:r,port:i,type:s,relatedAddress:a,relatedPort:d,priority:l}=new RTCIceCandidate(e),h={foundation:t??"",componentId:"1",transport:n??"",priority:l?l+"":"",connectionAddress:r??"",port:i?i+"":"",type:s?s+"":"",relAddr:a??"",relPort:d?d+"":"",extension:{}};this.candidates.some(p=>p.priority===h.priority&&p.connectionAddress===h.connectionAddress&&p.port===h.port)||(this._candidates.push(h),this.sessionDesc.mediaDescriptions.forEach(p=>{p.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,n,r,i){const s=e._mediaStreamTrack.kind,a=this.rtpCapabilities.recv,d=Lh(s,a,this.localCapabilities.send,s===_e.AUDIO?i:r),l=s===_e.VIDEO?a.videoExtensions:a.audioExtensions,h="".concat(++this.currentMidIndex);let p={media:{mediaType:s,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:d.map(m=>m.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:l,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:d,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(h)}};p=this.mungRecvMediaDsec(p,e);const _=this.findFirstClosedMedia(s);if(_){const m=this.sessionDesc.mediaDescriptions.indexOf(_);this.sessionDesc.mediaDescriptions[m]=p}else this.sessionDesc.mediaDescriptions.push(p);return p}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>te(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>te(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,n){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const i=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="sendonly"||r.attributes.direction==="sendrecv")&&r.attributes.ssrcs.length===0;if(Nt()){if(i){const s=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(s||r.attributes.mid!=="0"&&r.attributes.mid!=="1")||!(!s||s!==r.attributes.mid)}return!1}return i&&r.attributes.mid===n})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{const n=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&n})}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}restartICE(e){e=Dt(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,n,r,i,s){const a=this.rtpCapabilities.send,d=e===_e.VIDEO?a.videoCodecs:a.audioCodecs,l=e===_e.VIDEO?a.videoExtensions:a.audioExtensions;Nt()&&(i="".concat(++this.currentMidIndex));let h={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:d.map(_=>_.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:l,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:d,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:i}};h=this.mungSendMediaDesc(h,s);const p=this.findFirstClosedMedia(e);if(p){const _=this.sessionDesc.mediaDescriptions.indexOf(p);this.sessionDesc.mediaDescriptions[_]=h}else this.sessionDesc.mediaDescriptions.push(h);return h}mungRecvMediaDsec(e,t,n){const r=Dt(e);return JR(r),Kc(r,t),QR(r,t),MM(r),gm(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){const n=Dt(e);return gm(n,t,this.localCapabilities.recv),Ll(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===e);if(n!==-1){const r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=r}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return((n=t.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>Nt()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}};const iee=["sdp"];var Pt;function Yx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Va(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Yx(Object(n),!0).forEach(function(r){I(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yx(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let zx=(Pt=class Zl extends EM{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,n,r){super(t,n),I(this,"direction",void 0),I(this,"name",void 0),I(this,"store",void 0),I(this,"spec",void 0),I(this,"peerConnection",void 0),I(this,"initialOffer",void 0),I(this,"transport",void 0),I(this,"statsFilter",void 0),I(this,"localCandidateCount",0),I(this,"_isInRestartIce",!1),I(this,"mutex",void 0),I(this,"onLocalCandidate",void 0),I(this,"remoteSDP",void 0),I(this,"pendingCandidates",[]),I(this,"localCapabilities",void 0),I(this,"isReady",!1),I(this,"restartCnt",0),I(this,"curTurnServerIndex",0),this.store=n,this.spec=t,this.mutex=new bn("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(Zl.resolvePCConfiguration(t,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=r??gr.SEND_ONLY,this.name=this.direction===gr.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=B_(this.peerConnection,A("STATS_UPDATE_INTERVAL"),void 0,Nt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{const n=await $R();if(this.localCapabilities=Ph(n),t){const{sdp:r}=t,i=ree(t,iee),s=function(){const p={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},_=Nh(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),m={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},g={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},w={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(lo(_,p,"videoExtensions",m,g,w),lo(_,p,"videoCodecs",m,g,w),lo(_,p,"audioExtensions",m,g,w),lo(_,p,"audioCodecs",m,g,w),A("RAISE_H264_BASELINE_PRIORITY")){const R=w.videoCodecs.findIndex(y=>y.rtpMap&&y.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&y.fmtp&&y.fmtp.parameters["profile-level-id"]==="42001f");if(R!==-1){const y=w.videoCodecs.findIndex(b=>b.rtpMap&&b.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(y<R){T.debug("raising H264 baseline profile priority");const b=w.videoCodecs[R];w.videoCodecs.splice(R,1),w.videoCodecs.splice(y,0,b)}y!==-1&&A("FILTER_SEND_H264_BASELINE")&&(m.videoCodecs=m.videoCodecs.filter(b=>!(b.rtpMap&&b.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&b.fmtp&&b.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:m,recv:g,sendrecv:w}}({},{},r);this.remoteSDP=new Kx({remoteIceParameters:i.iceParameters,remoteDtlsParameters:i.dtlsParameters,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const a=await this.peerConnection.createAnswer();if(!a.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const d=ps(a.sdp);await this.peerConnection.setLocalDescription(a);const l=await xM({},{},a.sdp);this.localCapabilities=Ph(l);const h=this.peerConnection.getTransceivers()[0];return h!=null&&h.receiver&&h.receiver.transport&&this.tryBindTransportEvents(h.receiver.transport),Va(Va({},d),{},{sdp:a.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=ps(r.sdp);return this.initialOffer=r,Va(Va({},i),{},{sdp:r.sdp})}}catch(n){throw new Y(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:r,dtlsParameters:i}=t,s=await xM({},{},n);this.remoteSDP=new Kx({remoteIceParameters:r,remoteDtlsParameters:i,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const a=this.peerConnection.getTransceivers()[0];a!=null&&a.sender&&a.sender.transport&&this.tryBindTransportEvents(a.sender.transport)}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new Y(O.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(t,n,r){var i=this;return yr(function*(){const s=yield He(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const a=[],d=i.remoteSDP.receive(t,n,r);t.forEach((y,b)=>{if(d[b].needCreateTransceiver){const N=i.peerConnection.addTransceiver(y._mediaStreamTrack,{direction:"sendonly"});a.push(N),y._updateRtpTransceiver(N)}else{const N=i.peerConnection.getTransceivers().find(L=>L.mid===d[b].mid);if(!N)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(d[b].mid));a.push(N),y._updateRtpTransceiver(N)}}),Nt()&&A("SIMULCAST")===!0&&(yield He(i.applySimulcastForFirefox(a,t)));const l=d.map(y=>y.mid),h=yield He(i.peerConnection.createOffer()),p=i.mungSendOfferSDP(h.sdp,t,l),_=_r(p),m=l.map(y=>{const b=_.mediaDescriptions.find(N=>N.attributes.mid===y);if(!b)throw new Error("Cannot extract ssrc from mediaDescription.");return XR(b,A("USE_PUB_RTX"))}),g=a.map((y,b)=>{const N=l[b];return{localSSRC:m[b],id:N}});yield He(i.peerConnection.setLocalDescription({type:"offer",sdp:p}));try{yield g}catch(y){const b=i.remoteSDP.toString();throw yield He(i.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield He(i.peerConnection.setRemoteDescription({type:"answer",sdp:b})),yield He(i.stopSending(l,!0)),y}yield He(i.applySimulcastEncodings(a,t)),yield He(i.applySendEncodings(a,t));const w=i.remoteSDP.toString(),R=i.logSDPExchange(p,"offer","local","send");return R==null||R(w),yield He(i.setRemoteDescription({type:"answer",sdp:w})),a.map((y,b)=>{const N=l[b];return{localSSRC:m[b],id:N}})}catch(a){throw a instanceof Y?a:new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(a.toString()))}finally{s()}})()}async stopSending(t,n){const r=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter(l=>t.indexOf(l.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length (".concat(i.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));i.map(l=>{var h;l.direction="inactive",(h=l.stop)===null||h===void 0||h.call(l)});const s=await this.peerConnection.createOffer(),a=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(t);const d=this.remoteSDP.toString();a==null||a(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(i){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{r&&r()}}async receive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:s,needExchangeSDP:a}=this.remoteSDP.send(t,n,r,i);if(a){const l=this.remoteSDP.toString(),h=this.logSDPExchange(l,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:l});const p=await this.peerConnection.createAnswer(),_=this.mungReceiveAnswerSDP(p.sdp,s,t);h==null||h(_||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:_}),T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const d=this.peerConnection.getTransceivers().find(l=>l.mid===s);if(!d||d.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:d.receiver.track,mid:d.mid,transceiver:d}}catch(s){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async mockReceive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:s,needExchangeSDP:a}=this.remoteSDP.send(t,n,r,i);if(a){const d=this.remoteSDP.toString(),l=this.logSDPExchange(d,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:d});const h=await this.peerConnection.createAnswer(),p=this.mungReceiveAnswerSDP(h.sdp,s,t);l==null||l(p||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:p}),T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(s){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===Lc.Auto&&(this.store.p2pTransport=Lc.SdRtn,qe().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Zl.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,qe().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Zl.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:r}=ps(n.sdp);return this.store.descriptionStart(),this.direction===gr.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),r}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===gr.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:r}=ps(n.sdp);return await this.peerConnection.setLocalDescription(n),r}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const s=this.remoteSDP.toString(),a=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),a==null||a(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new Y(O.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getTransceivers().filter(i=>i.mid===t);r.length===1&&(this.isVP8Simulcast(n)?Nt()||await this.applySimulcastEncodings(r,[n]):await this.applySendEncodings(r,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getTransceivers().find(i=>i.mid===n);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:r,remote:i}=n.getSelectedCandidatePair();return{local:Va(Va({},ro),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:Va(Va({},ro),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,n;te(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var n;t.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i={iceServers:[]};var s;return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Ac(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...Zl.turnServerConfigToIceServers(t.turnServer.servers,n,r)),A("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...Zl.turnServerConfigToIceServers(t.turnServer.serversFromGateway,n,r)),te(s=[Lc.Relay,Lc.SdRtn]).call(s,n)&&(i.iceTransportPolicy="relay"),A("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(i.iceTransportPolicy="relay")}))),A("ENABLE_ENCODED_TRANSFORM")&&qe().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),T.debug("P2PConnection p2pTransport is ".concat(n)),i}static turnServerConfigToIceServers(t,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=[],s=t.filter(d=>d.tcpport);T.debug("P2PConnection turnServers is ".concat(s,", current index is ").concat(r));const a=s.length>r?s[r]:s[0];switch(n){case Lc.SdRtn:const d=t.filter(h=>{var p;return te(p=h.username).call(p,"glb:")&&h.turnServerURL==h.turnServerURL}),l=d.length>r?d[r]:d[0];l&&(i.push({username:l.username,credential:l.password,credentialType:"password",urls:"turn:".concat(co(l.turnServerURL),":").concat(l.tcpport,"?transport=udp")}),i.push({username:l.username,credential:l.password,credentialType:"password",urls:"turns:".concat(co(l.turnServerURL),":").concat(l.tcpport,"?transport=tcp")}));break;case Lc.Relay:a&&(i.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=udp")}),i.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(co(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}));break;default:a&&(i.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=udp")}),i.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(co(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}),i.push({username:a.username,credential:a.password,credentialType:"password",urls:"stun:".concat(a.turnServerURL,":").concat(a.tcpport)}))}return i}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var r;t!=null&&t.state&&((r=this.onDTLSTransportStateChange)===null||r===void 0||r.call(this,t.state))},t.onerror=r=>{var i;(i=this.onDTLSTransportError)===null||i===void 0||i.call(this,"error"in r?r.error:r)};const n=t.iceTransport;n&&(n.onstatechange=()=>{const r=t==null?void 0:t.iceTransport.state;var i;r&&((i=this.onICETransportStateChange)===null||i===void 0||i.call(this,r))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:r,remote:i}=n.getSelectedCandidatePair()||{};if(r&&i){const s=r.address+":"+r.port,a=i.address+":"+i.port;T.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(hs(s)),", remote ").concat(JSON.stringify(hs(a))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var r;if(n||(n=this.peerConnection.getSenders().find(p=>p.track===t._mediaStreamTrack)),!n)return T.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return T.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!qe().supportSetRtpSenderParameters)return T.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const i={},s={};switch(t._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(t._encoderConfig){var a;const{bitrateMax:p,frameRate:_,scaleResolutionDownBy:m}=t._encoderConfig;p&&(s.maxBitrate=1e3*p),te(a=t._hints).call(a,lt.LOW_STREAM)&&(_&&(s.maxFramerate=br(_)),m&&m>=1&&(s.scaleResolutionDownBy=m))}if(A("DSCP_TYPE")&&as()){var d;const p=A("DSCP_TYPE");te(d=["very-low","low","medium","high"]).call(d,p)&&(s.networkPriority=p)}const l=n.getParameters(),h=(r=l.encodings)===null||r===void 0?void 0:r[0];Nt()&&!h&&(i.encodings=[s]),h&&Object.assign(h,s),Object.assign(l,i),T.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(l.encodings))),await n.setParameters(l)}async applySendEncodings(t,n){try{if(!qe().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const i=t[r],s=n[r];s instanceof Ct&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,i.sender)}}catch{T.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,r){const i=_r(t);return n.forEach((s,a)=>{const d=r[a],l=i.mediaDescriptions.find(h=>h.attributes.mid===d);l&&(Kc(l,s),ZR(l,s,this.store.codec))}),Fs(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let l=0;l<t.length;l++){var r,i,s,a,d;const h=t[l],p=n[l];if(p instanceof Ct&&!te(r=p._hints).call(r,lt.LOW_STREAM)&&(i=p._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=p._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(a=p._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((d=p._scalabilityMode)===null||d===void 0?void 0:d.numSpatialLayers)>1&&this.store.codec==="vp8"){const _={},m={high:1e3*(p._encoderConfig.bitrateMax-50),medium:5e4};_.encodings=[{rid:"m",active:!0,maxBitrate:m.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:m.high}];const g=h.sender.getParameters();await h.sender.setParameters(Object.assign(g,_))}}}async applySimulcastEncodings(t,n){if(!Nt()&&t.length===n.length)for(let r=0;r<t.length;r++){const i=n[r];if(i instanceof Ct&&this.isVP8Simulcast(i)){const s=t[r],a={},d={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};a.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:d.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:d.medium,scaleResolutionDownBy:4}];const l=s.sender.getParameters();await s.sender.setParameters(Object.assign(l,a))}}}isVP8Simulcast(t){var n,r,i,s,a;return!!(t instanceof Ct&&A("SIMULCAST")&&this.store.codec==="vp8"&&!te(n=t._hints).call(n,lt.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(s=t._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((a=t._scalabilityMode)===null||a===void 0?void 0:a.numSpatialLayers)>1)}logSDPExchange(t,n,r,i){if(A("SDP_LOGGING"))return T.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(n," SDP during P2PConnection.").concat(i,`
`),t),n==="offer"?s=>{this.logSDPExchange(s,"answer",r==="local"?"remote":"local",i)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(a=>a.mid&&t.indexOf(a.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(a=>{a.direction="inactive"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const s=this.remoteSDP.toString();i==null||i(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(a=>a.mid&&t.indexOf(a.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async a=>{a.direction="sendonly"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t);const s=this.remoteSDP.toString();i==null||i(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(t,n){var r;if(n=n??((r=this.currentRemoteDescription)===null||r===void 0?void 0:r.sdp)){var i;const s=(i=_r(n).mediaDescriptions.find(a=>a.attributes.mid===t))===null||i===void 0?void 0:i.attributes.ssrcs;return s==null?void 0:s[0].ssrcId}}async setRemoteDescription(t){var n;await this.peerConnection.setRemoteDescription(t),te(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,n,r){const i=_r(t),s=i.mediaDescriptions.find(a=>a.attributes.mid===n);return s&&r===_e.AUDIO&&s.media.mediaType==="audio"&&Ll(s),Fs(i)}},ce(Pt.prototype,"establish",[_o],Object.getOwnPropertyDescriptor(Pt.prototype,"establish"),Pt.prototype),ce(Pt.prototype,"connect",[_o],Object.getOwnPropertyDescriptor(Pt.prototype,"connect"),Pt.prototype),ce(Pt.prototype,"receive",[_o],Object.getOwnPropertyDescriptor(Pt.prototype,"receive"),Pt.prototype),ce(Pt.prototype,"mockReceive",[_o],Object.getOwnPropertyDescriptor(Pt.prototype,"mockReceive"),Pt.prototype),ce(Pt.prototype,"stopReceiving",[_o],Object.getOwnPropertyDescriptor(Pt.prototype,"stopReceiving"),Pt.prototype),ce(Pt.prototype,"restartICE",[_o],Object.getOwnPropertyDescriptor(Pt.prototype,"restartICE"),Pt.prototype),ce(Pt.prototype,"close",[_o],Object.getOwnPropertyDescriptor(Pt.prototype,"close"),Pt.prototype),ce(Pt.prototype,"updateEncoderConfig",[_o],Object.getOwnPropertyDescriptor(Pt.prototype,"updateEncoderConfig"),Pt.prototype),ce(Pt.prototype,"updateSendParameters",[_o],Object.getOwnPropertyDescriptor(Pt.prototype,"updateSendParameters"),Pt.prototype),ce(Pt.prototype,"replaceTrack",[_o],Object.getOwnPropertyDescriptor(Pt.prototype,"replaceTrack"),Pt.prototype),ce(Pt.prototype,"muteLocal",[_o],Object.getOwnPropertyDescriptor(Pt.prototype,"muteLocal"),Pt.prototype),ce(Pt.prototype,"unmuteLocal",[_o],Object.getOwnPropertyDescriptor(Pt.prototype,"unmuteLocal"),Pt.prototype),Pt);function _o(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("From P2PConnection.".concat(t));try{for(var a=arguments.length,d=new Array(a),l=0;l<a;l++)d[l]=arguments[l];return await r.apply(this,d)}finally{s()}},n}let Bo=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var qx,Xx,Jx,Qx,Zx,$x,eV,tV,nV,rV,iV,Ft;function oV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function eE(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?oV(Object(n),!0).forEach(function(r){I(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oV(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let oee=(qx=jo(Bo.SEND_ONLY),Xx=jo(Bo.SEND_ONLY),Jx=jo(),Qx=jo(Bo.RECEIVE_ONLY),Zx=jo(Bo.RECEIVE_ONLY),$x=jo(Bo.RECEIVE_ONLY),eV=jo(Bo.RECEIVE_ONLY),tV=jo(Bo.RECEIVE_ONLY),nV=jo(Bo.RECEIVE_ONLY),rV=jo(),iV=jo(Bo.RECEIVE_ONLY),Ft=class extends Vt{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Ce.StateChange,t,this._state)}constructor(e,t){super(),I(this,"isPlanB",!1),I(this,"store",void 0),I(this,"statsUploader",void 0),I(this,"sendConnection",void 0),I(this,"recvConnection",void 0),I(this,"localTrackMap",new Map),I(this,"remoteUserMap",new Map),I(this,"localDataChannels",[]),I(this,"pendingLocalTracks",[]),I(this,"pendingRemoteTracks",[]),I(this,"statsCollector",void 0),I(this,"dtlsFailedCount",0),I(this,"sendMutex",void 0),I(this,"recvMutex",void 0),I(this,"_state",dt.Disconnected),I(this,"_restartStates",["disconnected","failed"]),I(this,"reconnectInterval",void 0),I(this,"uploadUnplinkStarted",!1),I(this,"uploadDownlinkStarted",!1),I(this,"uplinkStateUploadInterval",void 0),I(this,"downlinkStatsUploadInterval",void 0),I(this,"handleMuteLocalTrack",async(n,r,i)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==dt.Connected)return void i(new Y(O.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const l=this.filterTobeMutedTracks(n);if(l.length===0)return void r();const h=l.find(g=>g[0]==="videoLowTrack");h&&h[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(l.map(g=>{let[,{id:w}]=g;return w}));let p=!1;var a,d;n.trackMediaType==="video"?p=!((a=this.localTrackMap.get(ne.LocalAudioTrack))===null||a===void 0||!a.track._muted):p=((d=this.localTrackMap.get(ne.LocalVideoTrack))===null||d===void 0?void 0:d.id)===void 0;const _=this.createMuteMessage(l);await wt(this,Ce.RequestMuteLocal,_);const m=n.trackMediaType==="video"?wa.MUTE_LOCAL_VIDEO:wa.MUTE_LOCAL_AUDIO;await wt(this,Ce.RequestP2PMuteLocal,{action:m,message:_,isMuteAll:p}),r()}catch(l){i(l)}finally{s()}}),I(this,"handleUnmuteLocalTrack",async(n,r,i)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==dt.Connected)return void i(new Y(O.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const a=this.filterTobeUnmutedTracks(n);if(a.length===0)return void r();await this.sendConnection.unmuteLocal(a.map(h=>{let[,{id:p}]=h;return p}));const d=this.createUnmuteMessage(a),l=n.trackMediaType==="video"?wa.UNMUTE_LOCAL_VIDEO:wa.UNMUTE_LOCAL_AUDIO;await wt(this,Ce.RequestP2PMuteLocal,{action:l,message:d}),r()}catch(a){i(a)}finally{s()}}),I(this,"handleUpdateVideoEncoder",async(n,r,i,s)=>{let a;typeof s=="boolean"&&s||(a=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const l=this.localTrackMap.get(ne.LocalVideoTrack);if(!this.sendConnection||!l||l.track!==n||this.state!==dt.Connected)return void r();const{id:h,track:p}=l;h&&(await this.sendConnection.updateSendParameters(h,p),await this.sendConnection.updateEncoderConfig(h,p),this.emit(Ce.UpdateVideoEncoder,p)),r()}catch(l){i(l)}finally{var d;(d=a)===null||d===void 0||d()}}),I(this,"handleUpdateVideoSendParameters",async(n,r,i)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const a=this.localTrackMap.get(ne.LocalVideoTrack);if(!this.sendConnection||!a||a.track!==n||this.state!==dt.Connected)return void r();const{id:d,track:l}=a;d&&await this.sendConnection.updateSendParameters(d,l),r()}catch(a){i(a)}finally{s()}}),I(this,"handleReplaceTrack",async(n,r,i,s)=>{let a;T.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof s=="boolean"&&s||(a=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var d;const h=Array.from(this.localTrackMap.entries()).find(p=>{let[,{track:_}]=p;return n===_});if(!this.sendConnection||!h||h[1].id===void 0||this.state!==dt.Connected)return void r();if(await((d=this.sendConnection)===null||d===void 0?void 0:d.replaceTrack(n,h[1].id)),h[0]===ne.LocalVideoTrack&&qe().supportDualStreamEncoding){const p=this.localTrackMap.get(ne.LocalVideoLowTrack);if(p){const _=n._mediaStreamTrack.clone();p.track._originMediaStreamTrack.stop(),p.track._mediaStreamTrack=_,p.track._originMediaStreamTrack=_,await new ae((m,g)=>{this.handleReplaceTrack(p.track,m,g,!0)})}}r()}catch(h){i(h)}finally{var l;(l=a)===null||l===void 0||l()}}),I(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),I(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),I(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),I(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new SU(e),this.bindStatsUploaderEvents(),this.sendMutex=new bn("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new bn("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},A("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new Y(O.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new Y(O.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let n;try{if(t){this.recvConnection&&(T.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new zx(e,this.store,gr.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const r=await this.recvConnection.establish(t);return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}{this.state=dt.New,this.sendConnection&&(T.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new zx(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const r=await this.sendConnection.establish();return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}}finally{n&&n()}}async p2pConnect(e){if(!this.sendConnection)throw new Y(O.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=dt.Connected}async addRemoteCandidate(e,t){if(t===gr.RECEIVE_ONLY){if(!this.sendConnection)throw new Y(O.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new Y(O.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,n){var r=this;return yr(function*(){const i=yield He(r.sendMutex.lock("From P2PChannel.publish"));try{if(!r.sendConnection||r.state!==dt.Connected){r.throwIfTrackTypeNotMatch(e);const h=e.filter(p=>r.pendingLocalTracks.indexOf(p)===-1);return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(h))}r.store.pubId=r.store.pubId+1,Xn.markPublishStart(r.store.clientId,r.store.pubId);const s=r.filterTobePublishedTracks(e,t,n);if(s.length===0)return void(yield He(r.tryToUnmuteAudio(e)));s.forEach(h=>{let{track:p,type:_}=h;const m=Date.now();r.store.publish(p.getTrackId(),_===ne.LocalAudioTrack?"audio":"video",m)}),r.bindLocalTrackEvents(s);const a=yield He(r.sendConnection.send(s.map(h=>{let{track:p}=h;return p}),r.store.codec,r.store.audioCodec)),d=(yield He(a.next())).value,l=r.createGatewayPublishMessage(s,d);try{yield l}catch(h){throw a.throw(h),(h==null?void 0:h.code)===O.WS_ABORT&&s.forEach(p=>{let{track:_}=p;r.pendingLocalTracks.indexOf(_)===-1&&r.pendingLocalTracks.push(_)}),r.unbindLocalTrackEvents(s),h}yield He(a.next()),s.forEach(h=>{let{type:p}=h;r.statsCollector.addLocalStats(p)}),r.statsUploader.startUploadOutboundStats(),r.assignLocalTracks(s,d),s.forEach(h=>{let{track:p,type:_}=h;const m=Date.now();r.store.publish(p.getTrackId(),_===ne.LocalAudioTrack?"audio":"video",void 0,m)}),r.startUploadUplinkState()}finally{i()}})()}async unpublish(e){if(!this.sendConnection||this.state!==dt.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(i=>!te(e).call(e,i)));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(i=>i[0]==="videoLowTrack");n&&n[1].track.close();const r=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(i=>{let[,{id:s}]=i;return s})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(i=>{let[s,{track:a}]=i;return{type:s,track:a}})),t.forEach(i=>{let[s]=i;this.statsCollector.removeLocalStats(s)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===dt.Connected)return n&&n[1].track.close(),r;e.forEach(i=>{const s=this.pendingLocalTracks.indexOf(i);s!==-1&&this.pendingLocalTracks.splice(s,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const t=[],n=[];Array.from(this.localTrackMap.entries()).forEach(r=>{let[i,{track:s,ssrcs:a}]=r;const d={stream_type:zQ(s,i),ssrcs:a};s._muted||!s._enabled?t.push(d):n.push(d)}),t.length>0&&t.forEach(r=>{wt(this,Ce.RequestMuteLocal,[r])}),n.length>0&&n.forEach(r=>{wt(this,Ce.RequestUnmuteLocal,[r])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return yr(function*(){throw new Y(O.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(T.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await dn(this,Ce.RequestRePublish,this.pendingLocalTracks),this.emit(Ce.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Y(O.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,n,r){var i;if(!this.recvConnection)throw new Y(O.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((i=this.remoteUserMap.get(e))!==null&&i!==void 0&&i.has(t))return;const{track:s,mid:a,transceiver:d}=await this.recvConnection.receive(t,[{ssrcId:n}],String(e.uid),r);t===_e.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(s):(e._audioTrack=new Il(s,e.uid,e._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),d&&e._audioTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=n,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(s):(e._videoTrack=new Cl(s,e.uid,e._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),d&&e._videoTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(e,e._videoTrack));const l=this.remoteUserMap.get(e);l?l.set(t,a):this.remoteUserMap.set(e,new Map([[t,a]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const h=this.pendingRemoteTracks.findIndex(p=>{let{user:_,kind:m}=p;return _.uid===e.uid&&t===m});h!==-1&&(this.pendingRemoteTracks.splice(h,1),this.emit(Ce.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,n,r){if(!this.recvConnection)throw new Y(O.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:n}],String(e.uid),r)}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter(s=>{let{user:a,kind:d}=s;return t!==void 0?a.uid===e.uid&&t===d:a.uid===e.uid});if(r.forEach(s=>{const a=this.pendingRemoteTracks.indexOf(s);this.pendingRemoteTracks.splice(a,1)}),this.recvConnection||n||r.forEach(s=>{let{kind:a}=s;var d;if(a===_e.AUDIO)(d=e._audioTrack)===null||d===void 0||d._destroy(),e._audioTrack=void 0;else if(a===_e.VIDEO){var l;(l=e._videoTrack)===null||l===void 0||l._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const i=this.filterTobeUnSubscribedTracks(e,t);i.length!==0&&(await this.recvConnection.stopReceiving(i.map(s=>{let[,{id:a}]=s;return a})),this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),i.forEach(s=>{let[a,{kind:d}]=s;var l,h;if(d===_e.VIDEO&&a._videoSSRC&&((l=this.recvConnection)===null||l===void 0||l.setStatsRemoteVideoIsReady(a._videoSSRC,!1)),d===_e.VIDEO)this.unbindRemoteTrackEvents(a._videoTrack),n||((h=a._videoTrack)===null||h===void 0||h._destroy(),a._videoTrack=void 0);else if(d===_e.AUDIO){var p;this.unbindRemoteTrackEvents(a._audioTrack),!n&&((p=a._audioTrack)===null||p===void 0||p._destroy(),a._audioTrack=void 0)}}),i.forEach(s=>{let[,{kind:a}]=s;wt(this,Ce.RequestP2PMuteRemote,a)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,n]=t;[_e.VIDEO,_e.AUDIO].forEach(r=>{n.has(r)?wt(this,Ce.RequestP2PUnmuteRemote,r):wt(this,Ce.RequestP2PMuteRemote,r)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new Y(O.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new Y(O.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new Y(O.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new Y(O.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void T.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void T.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===_e.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void T.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||T.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(ne.LocalAudioTrack);if((t==null?void 0:t.track)instanceof fn){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[i]=r;return i!==ne.LocalAudioTrack}).filter(r=>{let[i]=r;return!(e&&i===ne.LocalVideoLowTrack)}).map(r=>{let[,{track:i}]=r;return i}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[r]=n;return!(e&&r===ne.LocalVideoLowTrack)}).map(n=>{let[,{track:r}]=n;return r})}reportPublishEvent(e,t,n,r,i){if(e){const a=this.localTrackMap.get(ne.LocalAudioTrack),d=r?this.localTrackMap.get(ne.LocalVideoLowTrack):this.localTrackMap.get(ne.LocalVideoTrack);Se.publish(this.store.sessionId,{eventElapse:Xn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:a==null?void 0:a.track.getTrackLabel(),videoName:d==null?void 0:d.track.getTrackLabel(),screenshare:(d==null?void 0:d.track._hints.indexOf(lt.SCREEN_TRACK))!==-1,audio:!!a,video:!!d,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var s;n||(n=[]);const a=n.find(l=>l instanceof Xt),d=r?(s=this.localTrackMap.get(ne.LocalVideoTrack))===null||s===void 0?void 0:s.track:n.find(l=>l instanceof Ct);Se.publish(this.store.sessionId,{eventElapse:Xn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:a==null?void 0:a.getTrackLabel(),videoName:d==null?void 0:d.getTrackLabel(),screenshare:(d==null?void 0:d._hints.indexOf(lt.SCREEN_TRACK))!==-1,audio:!!a,video:!!d,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){const i=r===_e.VIDEO?n._videoSSRC:n._audioSSRC;i&&Se.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===_e.VIDEO,audio:r===_e.AUDIO,peerid:n.uid,subscribeRequestid:r===_e.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:Xn.measureFromSubscribeStart(this.store.clientId,i)})}reset(){T.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new bn("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new bn("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(ne.LocalAudioTrack);if((e==null?void 0:e.track)instanceof fn){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=dt.Disconnected}getStats(e){var t,n;return e?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(ne.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(ne.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof Ct||t&&t.track instanceof Xt?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(nr(t=this.remoteUserMap).call(t)).find(r=>r.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[r]=n;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(ne.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Ec(e).call(e,(n,r)=>n.level-r.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(T.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=dt.Reconnecting,A("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:r}]=e;switch(n){case ne.LocalVideoTrack:te(t=r._hints).call(t,lt.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case ne.LocalAudioTrack:r instanceof fn?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case ne.LocalVideoLowTrack:}}),this.emit(Ce.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(nr(n).call(n)).forEach(r=>{this.setPendingRemoteMedia(t,r)}),this.emit(Ce.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),T.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((e instanceof Oa?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let n,r;if(e===gr.SEND_ONLY){if(!this.sendConnection)throw new Y(O.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),r=this.sendConnection}else{if(!this.recvConnection)throw new Y(O.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),r=this.recvConnection}try{if(t){const i=await r.restartICE(t);return r.isInRestartIce=!1,i}{const i=await r.restartICE();if(i){const s=await dn(this,Ce.RequestP2PRestartICE,{direction:gr.RECEIVE_ONLY,iceParameter:i});await r.restartICE(s),r.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(ne.LocalVideoTrack),n=this.localTrackMap.get(ne.LocalAudioTrack),r=e.videoSend.find(g=>{var w;return g.ssrc===(t==null||(w=t.ssrcs)===null||w===void 0?void 0:w[0].ssrcId)}),i=e.audioSend.find(g=>{var w;return g.ssrc===(n==null||(w=n.ssrcs)===null||w===void 0?void 0:w[0].ssrcId)});if(!r||!i)return 1;const s=Zr(this,Ce.NeedSignalRTT),a=r?r.rttMs:void 0,d=i?i.rttMs:void 0,l=a&&d?(a+d)/2:a||d,h=(l&&s?(l+s)/2:l||s)||0,p=100*e.sendPacketLossRate*.7/50+.3*h/1500,_=p<.17?1:p<.36?2:p<.59?3:p<.1?4:5,m=t==null?void 0:t.track;if(m&&m._encoderConfig&&m._hints.indexOf(lt.SCREEN_TRACK)===-1){const g=m._encoderConfig.bitrateMax,w=e.bitrate.actualEncoded;if(g&&w){const R=(1e3*g-w)/(1e3*g);return dM[R<.15?0:R<.3?1:R<.45?2:R<.6?3:4][_]}}return _}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r]=n;const i=r._audioSSRC,s=r._videoSSRC,a=e.audioRecv.find(w=>w.ssrc===i),d=e.videoRecv.find(w=>w.ssrc===s);if(!a&&!d)return void(t+=1);const l=Zr(this,Ce.NeedSignalRTT),h=e.rtt,p=(h&&l?(h+l)/2:h||l)||0,_=a?a.jitterMs:void 0,m=e.recvPacketLossRate;let g=.7*m*100/50+.3*p/1500;_&&(g=.6*m*100/50+.2*p/1500+.2*_/400),t+=g<.1?1:g<.17?2:g<.36?3:g<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new ae((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}filterTobePublishedTracks(e,t,n){const r=[],i=qe(),s=this.getAllTracks();e=ul(e=e.filter(l=>s.indexOf(l)===-1));let a=!1,d=!1;for(const l of e){if(l instanceof Ct&&(this.localTrackMap.has(ne.LocalVideoTrack)||a?new Y(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:l,type:ne.LocalVideoTrack}),a=!0),t)){const h=this.getLowVideoTrack(l,n);r.push({track:h,type:ne.LocalVideoLowTrack})}if(l instanceof Xt){const h=this.localTrackMap.get(ne.LocalAudioTrack);if(h){if(!(h.track instanceof fn))throw new Y(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(l._bypassWebAudio)throw new Y(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");h.track.addAudioTrack(l),this.bindLocalAudioTrackEvents(l,!0)}else if(d){const p=r.find(_=>{let{type:m}=_;return m===ne.LocalAudioTrack});if(!(p.track instanceof fn))throw new Y(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(l._bypassWebAudio)throw new Y(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");p.track.addAudioTrack(l)}else{if(!i.webAudioMediaStreamDest||l instanceof fn||l._bypassWebAudio)r.push({track:l,type:ne.LocalAudioTrack});else{const p=new fn;p.addAudioTrack(l),r.push({track:p,type:ne.LocalAudioTrack})}d=!0}}}return r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=ul(e=e.filter(r=>n.indexOf(r)!==-1));for(const r of e){if(r instanceof Xt){const i=this.localTrackMap.get(ne.LocalAudioTrack);if(!i)continue;i.track instanceof fn?(i.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),i.track.trackList.length===0&&(t.push([ne.LocalAudioTrack,i]),i.track.close())):t.push([ne.LocalAudioTrack,i])}if(r instanceof Ct){const i=this.localTrackMap.get(ne.LocalVideoTrack);if(!i)continue;t.push([ne.LocalVideoTrack,i]);const s=this.localTrackMap.get(ne.LocalVideoLowTrack);s&&t.push([ne.LocalVideoLowTrack,s])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:r}=t;switch(r){case ne.LocalVideoTrack:n.addListener(Te.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Te.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Te.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Te.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Te.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Te.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Te.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Te.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ne.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case ne.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof fn?e.trackList.forEach(n=>{n.addListener(Te.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Te.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Te.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Te.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Te.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Te.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Te.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Te.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Te.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Te.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(Te.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:r}]=t;return{track:r,type:n}})),e.forEach(t=>{let{track:n,type:r}=t;switch(r){case ne.LocalVideoTrack:n.off(Te.GET_STATS,this.handleGetLocalVideoStats),n.off(Te.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Te.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Te.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Te.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Te.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Te.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Te.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ne.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case ne.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof fn?e.trackList.forEach(t=>{t.off(Te.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Te.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Te.GET_STATS,this.handleGetLocalAudioStats),t.off(Te.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Te.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Te.GET_STATS,this.handleGetLocalAudioStats),e.off(Te.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Te.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Te.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Te.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Te.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Cl&&t.addListener(Te.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof Il&&t.addListener(Te.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Te.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(_e.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(_e.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,r)=>{var i;let s,{track:a,type:d}=n;switch(d){case ne.LocalAudioTrack:s=ft.Audio;break;case ne.LocalVideoTrack:s=te(i=a._hints).call(i,lt.SCREEN_TRACK)?ft.Screen:ft.High;break;case ne.LocalVideoLowTrack:s=ft.Low}return{kind:d===ne.LocalAudioTrack?_e.AUDIO:_e.VIDEO,stream_type:s,mid:t[r].id,ssrcs:t[r].localSSRC,isMuted:a.muted||!a.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let r,[i,{track:s,ssrcs:a,id:d}]=t;switch(i){case ne.LocalVideoTrack:r=te(n=s._hints).call(n,lt.SCREEN_TRACK)?ft.Screen:ft.High;break;case ne.LocalAudioTrack:r=ft.Audio;break;case ne.LocalVideoLowTrack:r=ft.Low}return{stream_type:r,ssrcs:a,mid:d}})}assignLocalTracks(e,t){e.forEach((n,r)=>{let{track:i,type:s}=n;this.localTrackMap.set(s,{track:i,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var n;T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(Ce.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),te(n=this._restartStates).call(n,t)&&!e.isInRestartIce&&(t==="disconnected"&&await Tn(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),Se.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:yt.TRACER}).onSuccess(),this.emit(Ce.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const r=Array.from(nr(n=this.remoteUserMap).call(n)).find(s=>s._audioSSRC===t);var i;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(i=r.audioTrack)===null||i===void 0||i.emit(Li.FIRST_FRAME_DECODED),Se.firstRemoteFrame(this.store.sessionId,pn.FIRST_AUDIO_DECODE,Mt.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:Xn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const r=Array.from(nr(n=this.remoteUserMap).call(n)).find(i=>i._audioSSRC===t);r&&Se.firstRemoteFrame(this.store.sessionId,pn.FIRST_AUDIO_RECEIVED,Mt.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:Xn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,r)=>{this.reportVideoFirstFrameDecoded(t,n,r)},e.onFirstVideoReceived=t=>{var n;const r=Array.from(nr(n=this.remoteUserMap).call(n)).find(i=>i._videoSSRC===t);r&&Se.firstRemoteFrame(this.store.sessionId,pn.FIRST_VIDEO_RECEIVED,Mt.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:Xn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{const r=t.candidateType==="relay",i=n.candidateType==="relay";n.candidateType!=="unknown"&&r===i||this.emit(Ce.ConnectionTypeChange,r),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Aa(n))," -> ").concat(JSON.stringify(Aa(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Aa(n))," -> ").concat(JSON.stringify(Aa(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(Ce.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===gr.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,T.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===gr.SEND_ONLY?this.restartICE(e):dn(this,Ce.RequestP2PRestartICE,{direction:gr.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(ne.LocalAudioTrack);if(e instanceof Xt&&(n==null?void 0:n.track)instanceof fn)return n.track.isActive||t.push([ne.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:s}]=i;return e===s});if(r&&(t.push(r),r[0]===ne.LocalVideoTrack)){const i=this.localTrackMap.get(ne.LocalVideoLowTrack);i&&t.push([ne.LocalVideoLowTrack,i])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(ne.LocalAudioTrack);if(e instanceof Xt&&(n==null?void 0:n.track)instanceof fn)return n.track.isActive&&t.push([ne.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:s}]=i;return e===s});if(r)if(r[0]===ne.LocalVideoTrack){t.push(r);const i=this.localTrackMap.get(ne.LocalVideoLowTrack);i&&t.push([ne.LocalVideoLowTrack,i])}else t.push(r);return t}createMuteMessage(e){return e.map(t=>{var n;let r,[i,{track:s,ssrcs:a,id:d}]=t;switch(i){case ne.LocalAudioTrack:r=ft.Audio;break;case ne.LocalVideoTrack:r=te(n=s._hints).call(n,lt.SCREEN_TRACK)?ft.Screen:ft.High;break;case ne.LocalVideoLowTrack:r=ft.Low}return{stream_type:r,ssrcs:a,mid:d}})}createUnmuteMessage(e){return e.map(t=>{var n;let r,[i,{track:s,ssrcs:a,id:d}]=t;switch(i){case ne.LocalAudioTrack:r=ft.Audio;break;case ne.LocalVideoTrack:r=te(n=s._hints).call(n,lt.SCREEN_TRACK)?ft.Screen:ft.High;break;case ne.LocalVideoLowTrack:r=ft.Low}return{stream_type:r,ssrcs:a,mid:d}})}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach(i=>{let[s,a]=i;n.push([e,{kind:s,id:a}])});return n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[r,{kind:i,id:s}]=n;switch(i){case _e.VIDEO:return void(r._videoSSRC&&t.push({stream_type:_e.VIDEO,ssrcId:r._videoSSRC}));case _e.AUDIO:return void(r._audioSSRC&&t.push({stream_type:_e.AUDIO,ssrcId:r._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:r}]=t;const i=this.remoteUserMap.get(n);i&&(i.delete(r),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(ne.LocalVideoTrack),n=this.localTrackMap.get(ne.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new ae((r,i)=>{this.handleUpdateVideoEncoder(t.track,r,i,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new ae((r,i)=>{this.handleUpdateVideoEncoder(n.track,r,i,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof Xt){const n=this.filterTobeUnmutedTracks(e[t]);if(n.length===0)continue;const r=this.createUnmuteMessage(n);return void await wt(this,Ce.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Ce.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Ce.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Tn(U_(this.dtlsFailedCount,nn)),this.emit(Ce.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(ne.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Ct)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof Ct).length>1)throw new Y(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Xt).length>1&&(e.some(t=>t instanceof Xt&&t._bypassWebAudio)||!qe().webAudioMediaStreamDest))throw new Y(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof Ct&&this.pendingLocalTracks.some(n=>n instanceof Ct))throw new Y(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Xt&&this.pendingLocalTracks.some(n=>n instanceof Xt)&&(!qe().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof Xt&&n._bypassWebAudio)))throw new Y(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=!A("DISABLE_DUAL_STREAM_USE_ENCODING")&&qe().supportDualStreamEncoding,r=eE(eE({},{width:160,height:120,framerate:15,bitrate:50}),t);let i;i=n?e._mediaStreamTrack.clone():gy(e,r);const s=ht(8,"track-low-"),a=new Ct(i,eE(eE({},n&&{scaleResolutionDownBy:qR(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,s);return a.on(Uc.TRANSCEIVER_UPDATED,d=>{e._updateRtpTransceiver(d,gl.LOW_STREAM)}),a._hints.push(lt.LOW_STREAM),e.addListener(Te.NEED_CLOSE,()=>{a.close()}),a}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,n,r){var i;const s=Array.from(nr(i=this.remoteUserMap).call(i)).find(a=>a._videoSSRC===e);if(s){r||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const a=this.store.keyMetrics,d=a.subscribe.find(l=>l.userId===s.uid&&l.type==="video");Se.firstRemoteVideoDecode(this.store.sessionId,pn.FIRST_VIDEO_DECODE,Mt.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:t,videoheight:n,subscribeElapse:Xn.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:a.requestAPEnd||0,apStart:a.requestAPStart||0,joinGwEnd:a.joinGatewayEnd||0,joinGwStart:a.joinGatewayStart||0,pcEnd:a.peerConnectionEnd||0,pcStart:a.peerConnectionStart||0,subscriberEnd:(d==null?void 0:d.subscribeEnd)||0,subscriberStart:(d==null?void 0:d.subscribeStart)||0,videoAddNotify:(d==null?void 0:d.streamAdded)||0,state:r?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.recvConnection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const s=await this.recvConnection.getRemoteSSRC(i);return s!==void 0&&s!==n}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new Y(O.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new Y(O.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new Y(O.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new Y(O.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new Y(O.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new Y(O.NOT_SUPPORTED)}async preConnect(e){throw new Y(O.NOT_SUPPORTED)}getEstablishParams(){throw new Y(O.NOT_SUPPORTED)}async reSubscribe(e){throw new Y(O.NOT_SUPPORTED)}reportVideoFirstFrameRender(e){}async updateVideoStreamParameter(e,t){throw new Y(O.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===ne.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,gl.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},ce(Ft.prototype,"p2pConnect",[qx],Object.getOwnPropertyDescriptor(Ft.prototype,"p2pConnect"),Ft.prototype),ce(Ft.prototype,"unpublish",[Xx],Object.getOwnPropertyDescriptor(Ft.prototype,"unpublish"),Ft.prototype),ce(Ft.prototype,"unpublishLowStream",[Jx],Object.getOwnPropertyDescriptor(Ft.prototype,"unpublishLowStream"),Ft.prototype),ce(Ft.prototype,"subscribe",[Qx],Object.getOwnPropertyDescriptor(Ft.prototype,"subscribe"),Ft.prototype),ce(Ft.prototype,"mockSubscribe",[Zx],Object.getOwnPropertyDescriptor(Ft.prototype,"mockSubscribe"),Ft.prototype),ce(Ft.prototype,"unsubscribe",[$x],Object.getOwnPropertyDescriptor(Ft.prototype,"unsubscribe"),Ft.prototype),ce(Ft.prototype,"muteRemote",[eV],Object.getOwnPropertyDescriptor(Ft.prototype,"muteRemote"),Ft.prototype),ce(Ft.prototype,"unmuteRemote",[tV],Object.getOwnPropertyDescriptor(Ft.prototype,"unmuteRemote"),Ft.prototype),ce(Ft.prototype,"hasRemoteMediaWithLock",[nV],Object.getOwnPropertyDescriptor(Ft.prototype,"hasRemoteMediaWithLock"),Ft.prototype),ce(Ft.prototype,"disconnectForReconnect",[rV],Object.getOwnPropertyDescriptor(Ft.prototype,"disconnectForReconnect"),Ft.prototype),ce(Ft.prototype,"remoteMediaSsrcChanged",[iV],Object.getOwnPropertyDescriptor(Ft.prototype,"remoteMediaSsrcChanged"),Ft.prototype),Ft);function jo(e){return function(t,n,r){const i=t[n];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){for(var s=arguments.length,a=new Array(s),d=0;d<s;d++)a[d]=arguments[d];switch(e){case Bo.SEND_ONLY:{const l=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,a)}finally{l()}}case Bo.RECEIVE_ONLY:{const l=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,a)}finally{l()}}default:{const l=await this.sendMutex.lock("From P2PChannel2.".concat(n)),h=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,a)}finally{l(),h()}}}},r}}class rd extends Vt{constructor(t,n){super(),I(this,"signal",void 0),I(this,"token",void 0),I(this,"tokenTimeout",void 0),I(this,"tokenInterval",void 0),I(this,"_sequence",0),I(this,"userMap",new Map),I(this,"encoder",new TextEncoder),this.signal=t,this.token=n;const r=()=>{this.signal.connectionState===Ze.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(r,1e3):this.tokenInterval=window.setTimeout(r,3*A("P2P_TOKEN_INTERVAL"))};r()}async send(t,n,r,i,s){var a;if(this.userMap.size===0)return;const d=Array.from(Xr(a=this.userMap).call(a))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),i=i??ht(6,""),s=s??this._sequence++;const l={_id:i,_type:t,_seq:s,_message:n,token:"".concat(this.token,"_").concat(d)};A("SHOW_P2P_LOG")&&T.debug("send message",l,"noNeedResponse : ".concat(r)),this.splitMessage(JSON.stringify(l)).forEach(p=>{this.signal.request(ye.DATA_STREAM,{payload:Ra(this.encoder.encode(p))})});const h=new ae((p,_)=>{const m=window.setTimeout(()=>{this.off("res-@".concat(i,"_ack"),g),this.off("res-@".concat(i),R),this.off(Nl.ABORT,w),T.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(i)),this.userMap.size===0?_(new Y(O.INVALID_REMOTE_USER)):_(new Y(O.TIMEOUT))},A("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),g=()=>{m&&window.clearTimeout(m),this.off(Nl.ABORT,w),r&&p()},w=()=>{m&&window.clearTimeout(m),this.off("res-@".concat(i,"_ack"),g),this.off("res-@".concat(i),R),_(new Y(O.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(i)))};this.once(Nl.ABORT,w),this.once("res-@".concat(i,"_ack"),g);const R=(b,N)=>{y=!0,m&&window.clearTimeout(m),this.off("res-@".concat(i,"_ack"),g),this.off(Nl.ABORT,w),b==="success"?p(N):_(new Y(O.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(i)))};let y=!1;r||(this.once("res-@".concat(i),R),Tn(A("SIGNAL_REQUEST_TIMEOUT")).then(()=>{y||T.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(i,", ").concat(l))}))});try{return await h}catch(p){if(p.code===O.TIMEOUT)return await this.send(t,n,r,i,s);throw p}}onMessage(t){var n;const{_uid:r}=t;let i,s=this.userMap.get(r);if(s)i=s.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==Zt.CHECK)return;const{token:h}=t;i=new Map,s={uid:r,isStart:!0,token:h,splitMessageMap:i,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(r,s),this.signal.emit(Me.ON_USER_ONLINE,{uid:r}),this.handleUserOnline()}if("id"in t&&"total"in t){var a;const{id:h,total:p}=t,_=(a=i.get(h))!==null&&a!==void 0?a:[];if(_.push(t),i.has(h)||i.set(h,_),_.length!==p)return;{const m=Ec(_).call(_,(g,w)=>g.index-w.index).map(g=>g.payload).join("");i.delete(h),(t=JSON.parse(m))._uid=r}}const{_type:d,token:l}=t;if(te(n=[Zt.ACK,Zt.CHECK]).call(n,d))return d===Zt.CHECK&&this.handleCheckToken(s,l),void this.receiveMessage(t);l==="".concat(s.token,"_").concat(this.token)?this.handleReceivedMessage(t):T.debug('Receive unexpected message", '.concat(l,", cur_token: ").concat(s.token,"_").concat(this.token),t)}check(){const t={_id:ht(6,""),token:this.token,_type:Zt.CHECK};A("SHOW_P2P_LOG")&&T.debug("send message",t),this.signal.request(ye.DATA_STREAM,{payload:Ra(this.encoder.encode(JSON.stringify(t)))})}ack(t){const n={_id:t,_type:Zt.ACK,token:this.token};A("SHOW_P2P_LOG")&&T.debug("send message",n),this.signal.request(ye.DATA_STREAM,{payload:Ra(this.encoder.encode(JSON.stringify(n)))})}response(t,n,r){this.send(Zt.RESPONSE,JSON.stringify({success:!r,message:n}),!0,t)}handleReceivedMessage(t){const n=()=>{this.userMap.forEach(h=>{const{receivedMessagesMap:p,nextExpectedSequenceNumber:_}=h;for(;p.has(_);){const m=p.get(_);p.delete(_),this.receiveMessage(m),h.nextExpectedSequenceNumber++}})};if(!t)return void n();const{_uid:r,_seq:i}=t,s=this.userMap.get(r),{receivedMessagesMap:a,isStart:d,nextExpectedSequenceNumber:l}=s;if(i<l)return this.ack(t._id),void T.debug("[external-signal] receive old message, seq: ".concat(i,", ").concat(t._message));a.set(i,t),d&&i===l&&(this.receiveMessage(t),a.delete(l),s.nextExpectedSequenceNumber++,n())}receiveMessage(t){const{_id:n,_type:r,_message:i,_uid:s}=t;if(A("SHOW_P2P_LOG")&&T.debug("receive message",t),n){let a;switch(t._type!==Zt.ACK&&(i&&(a=JSON.parse(i)),this.ack(t._id)),t._type){case Zt.CANDIDATE:case Zt.CONTROL:this.signal.emit(r,a,s);break;case Zt.PUBLISH:case Zt.UNPUBLISH:case Zt.RESTART_ICE:case Zt.CALL:a.uid=s,dn(this.signal,r,a).then(d=>{this.response(t._id,d)}).catch(()=>{this.response(t._id,void 0,!0)});break;case Zt.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case Zt.RESPONSE:{const{success:d,message:l}=a;this.emit("res-@".concat(n),d?"success":"failed",l);break}}}}splitMessage(t){if(t.length<rd.MAX_MESSAGE_SIZE)return[t];const n=[],{remoteToken:r}=JSON.parse(t),i=ht(6,"");let s=0,a=800;const d=Math.ceil(t.length/a);for(;t.length>0;){s++;const l={id:i,index:s,total:d,payload:t.slice(0,a),token:"".concat(this.token,"_").concat(r)};JSON.stringify(l).length>rd.MAX_MESSAGE_SIZE?a-=50:(n.push(l),t=t.slice(a))}return n.map(l=>JSON.stringify(l))}handleCheckToken(t,n){return t.token!==n?(T.debug("token changed, from ".concat(t.token," to ").concat(n)),this.reset(t.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{T.debug("token timeout, ".concat(n)),this.reset(t.uid)},A("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const t=await dn(this.signal,Zt.CALL,void 0),n=await this.send(Zt.CALL,t);this.signal.emit(ve.P2P_CONNECTION,n,!0)}async reset(t,n){const r=this.userMap.get(t);r&&(this.emit(Nl.ABORT),this.signal.emit(Me.ON_USER_OFFLINE,{uid:r.uid,reason:vQ.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(T.debug("change local token from ".concat(n," to ").concat(n)),this.token=ht(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Nl.ABORT)}}I(rd,"MAX_SIZE",1),I(rd,"MAX_MESSAGE_SIZE",1024);class see extends Vt{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Ze.CONNECTED?this.emit(ve.WS_CONNECTED):t===Ze.RECONNECTING?this.emit(ve.WS_RECONNECTING,this._websocketReconnectReason):t===Ze.CLOSED&&this.emit(ve.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),I(this,"__name__","P2PSignal"),I(this,"_disconnectedReason",void 0),I(this,"_websocketReconnectReason",void 0),I(this,"_connectionState",Ze.CLOSED),I(this,"reconnectToken",void 0),I(this,"p2pToken",void 0),I(this,"websocket",void 0),I(this,"openConnectionTime",void 0),I(this,"clientId",void 0),I(this,"lastMsgTime",Date.now()),I(this,"uploadCache",[]),I(this,"uploadCacheInterval",void 0),I(this,"rttRolling",new Qv(5)),I(this,"pingpongTimer",void 0),I(this,"pingpongTimeoutCount",0),I(this,"joinResponse",void 0),I(this,"multiIpOption",void 0),I(this,"initError",void 0),I(this,"spec",void 0),I(this,"store",void 0),I(this,"_external_signal",void 0),I(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(ve.ON_BINARY_DATA,r.data);const i=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const s="res-@".concat(i._id);this.emit(s,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){switch(i._type){case Me.ON_DATA_STREAM:return void this.handleDataStream(i._message);case Me.MUTE_AUDIO:case Me.MUTE_VIDEO:case Me.ON_P2P_LOST:case Me.ON_USER_ONLINE:return;case Me.ON_USER_OFFLINE:const{uid:s}=i._message;return T.debug("[".concat(this.clientId,"] user-offline uid: ").concat(s)),void this._external_signal.reset(s)}if(this.emit(i._type,i._message),i._type===Me.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===Me.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(Qe.UID_BANNED);break;case 15:this.close(Qe.IP_BANNED);break;case 16:this.close(Qe.CHANNEL_BANNED)}if(i._type===Me.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case Ie.ERR_LICENSE_MISSING:this.close(Qe.LICENSE_MISSING);break;case Ie.ERR_LICENSE_EXPIRED:this.close(Qe.LICENSE_EXPIRED);break;case Ie.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Qe.LICENSE_MINUTES_EXCEEDED);break;case Ie.ERR_LICENSE_PERIOD_INVALID:this.close(Qe.LICENSE_PERIOD_INVALID);break;case Ie.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Qe.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ie.ERR_LICENSE_ILLEGAL:this.close(Qe.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new KR("gateway-".concat(this.clientId),this.spec.retryConfig,!0,A("JOIN_GATEWAY_USE_DUAL_DOMAIN"),A("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Ze.CONNECTED&&this.reconnect("retry",jn.OFFLINE)}),this.p2pToken=ht(6,""),this._external_signal=new rd(this,this.p2pToken)}async request(t,n,r,i){const s=ht(6,""),a={_id:s,_type:t,_message:n},d=this.websocket.connectionID,l=()=>new ae((w,R)=>{if(this.connectionState===Ze.CONNECTED)return w();const y=()=>{this.off(ve.WS_CLOSED,b),w()},b=()=>{this.off(ve.WS_CONNECTED,y),R(new Y(O.WS_ABORT))};this.once(ve.WS_CONNECTED,y),this.once(ve.WS_CLOSED,b)});if(this.connectionState!==Ze.CONNECTING&&this.connectionState!==Ze.RECONNECTING||t===ye.JOIN||t===ye.REJOIN||await l(),this.websocket.sendMessage(a,!0),i)return;const h=new ae((w,R)=>{let y=!1;const b=(L,x)=>{y=!0,w({isSuccess:L==="success",message:x||{}}),this.off(ve.WS_CLOSED,N),this.off(ve.WS_RECONNECTING,N),this.emit(ve.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(s),b);const N=()=>{R(new Y(O.WS_ABORT,"type: ".concat(t))),this.off(ve.WS_CLOSED,N),this.off(ve.WS_RECONNECTING,N),this.off("res-@".concat(s),b)};this.once(ve.WS_CLOSED,N),this.once(ve.WS_RECONNECTING,N),Tn(A("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==d||y||(T.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(ve.REQUEST_TIMEOUT,t,n))})});let p=null;try{p=await h}catch(w){if(this.connectionState===Ze.CLOSED||t===ye.LEAVE)throw new Y(O.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?w.throw():t===ye.JOIN||t===ye.REJOIN?null:(await l(),await this.request(t,n))}if(p.isSuccess)return p.message;const _=Number(p.message.error_code||p.message.code),m=Hc(_),g=new Y(O.UNEXPECTED_RESPONSE,"".concat(m.desc,": ").concat(p.message.error_str),{code:_,data:p.message,desc:m.desc});return m.action==="success"?p.message:(T.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(_,", message: ").concat(m.desc,", action: ").concat(m.action)),_===Ie.ERR_TOO_MANY_BROADCASTERS?((t===ye.JOIN||t===ye.REJOIN)&&(this.initError=g,this.close()),g.throw()):m.action==="failed"?g.throw():m.action==="quit"?(this.initError=g,this.close(),g.throw()):(_===Ie.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=p.message.option,T.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",jn.MULTI_IP)):this.reconnect(m.action,jn.SERVER_ERROR),t===ye.JOIN||t===ye.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new ae(r=>{const i=s=>{(!n||n(s))&&(this.off(t,i),r(s))};this.on(t,i)})}uploadWRTCStats(t){if(!this.store.sessionId)return void T.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Wc.WRTC_STATS,n)}upload(t,n){const r={_type:t,_message:n};try{this.websocket.sendMessage(r)}catch{const s=A("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Ze.CONNECTED)return;const a=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(a._type,a._message)},A("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const r={_type:t,_message:n};this.websocket.sendMessage(r)}async sendExtensionMessage(t,n,r){return await this._external_signal.send(t,n,r)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ae((n,r)=>{this.once(ve.WS_CONNECTED,()=>n(this.joinResponse)),this.once(ve.WS_CLOSED,()=>r(this.initError||new Y(O.WS_ABORT))),this.connectionState=Ze.CONNECTING,this.websocket.init(t).catch(r)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||Qe.LEAVE,this.connectionState=Ze.CLOSED,T.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=ht(6,""),this._external_signal.clear(),this._external_signal=new rd(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(ve.ABORT_P2P_EXECUTION);const t=await dn(this,ve.REQUEST_JOIN_INFO),n=await this.request(ye.JOIN,t);if(!n)return this.emit(ve.REPORT_JOIN_GATEWAY,O.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(ve.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Ze.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}async downgradeCodec(t){return!1}handleDataStream(t){try{var n;const r=Dc(t.payload),i=new TextDecoder().decode(r),s=JSON.parse(i);"total"in s&&"id"in s||te(n=Object.values(Zt)).call(n,s._type)?(s._uid=t.uid,this._external_signal.onMessage(s)):this.emit(Me.ON_DATA_STREAM,t)}catch{this.emit(Me.ON_DATA_STREAM,t)}}handleNotification(t){T.debug("[".concat(this.clientId,"] receive notification: "),t);const n=Hc(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?t.code===Ie.ERR_REPEAT_JOIN_CHANNEL&&A("IGNORE_UID_CHECK")?void this.close(Qe.UID_CONFLICT):(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Qe.UID_BANNED),void this.close()):void this.reconnect(n.action,jn.SERVER_ERROR);T.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=A("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(T.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>A("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",jn.TIMEOUT):this.request(ye.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-n;this.rttRolling.add(r),A("REPORT_STATS")&&this.send(ye.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWebsocketEvents(){this.websocket.on(Be.RECONNECT_CREATE_CONNECTION,t=>{this.emit(ve.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Be.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Be.CLOSED,()=>{this.connectionState=Ze.CLOSED}),this.websocket.on(Be.FAILED,()=>{this._disconnectedReason=Qe.NETWORK_ERROR,this.connectionState=Ze.CLOSED}),this.websocket.on(Be.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Ze.CONNECTED?this.connectionState=Ze.RECONNECTING:this.connectionState=Ze.CONNECTING}),this.websocket.on(Be.WILL_RECONNECT,(t,n,r)=>{t!=="retry"?(T.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):T.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),r(t)}),this.websocket.on(Be.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(ve.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof Y&&t.code===O.UNEXPECTED_RESPONSE&&t.data.code===Ie.ERR_NO_AUTHORIZED)return T.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",jn.SERVER_ERROR);T.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",jn.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(Be.REQUEST_NEW_URLS,(t,n)=>{dn(this,ve.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(Be.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Me.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const aee={name:"P2PChannel",create:function(e){let{store:t,statsCollector:n}=e;return new oee(t,n)},createSubmodule:function(e){let{store:t,spec:n}=e;return new see(n,t)}};function sV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function aV(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?sV(Object(n),!0).forEach(function(r){I(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sV(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class cee{constructor(t){I(this,"sessionDesc",void 0),I(this,"localCapabilities",void 0),I(this,"rtpCapabilities",void 0),I(this,"candidates",void 0),I(this,"_originCandidates",void 0),I(this,"iceParameters",void 0),I(this,"dtlsParameters",void 0),I(this,"setup",void 0),I(this,"currentMidIndex",void 0),I(this,"cname",void 0),t=Dt(t);const{iceParameters:n,dtlsParameters:r,candidates:i,rtpCapabilities:s,setup:a,localCapabilities:d,sdkCodec:l,cname:h}=t,p=_r(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=s,this.candidates=i,this._originCandidates=Dt(i),this.iceParameters=n,this.dtlsParameters=r,this.setup=a,this.localCapabilities=d,this.cname=h;for(let _=0;_<p.mediaDescriptions.length;_++){const m=p.mediaDescriptions[_];if(m.attributes.iceUfrag=n.iceUfrag,m.attributes.icePwd=n.icePwd,m.attributes.fingerprints=r.fingerprints,m.attributes.candidates=i,m.attributes.setup=a,m.media.mediaType==="video"){m.media.fmts=s.videoCodecs.map(R=>R.payloadType.toString(10));const g=s.videoCodecs.filter(R=>{var y,b;return(y=R.rtpMap)===null||y===void 0?void 0:te(b=y.encodingName.toLowerCase()).call(b,l)}),w=s.videoCodecs.filter(R=>!te(g).call(g,R));m.attributes.payloads=[...g,...w],m.attributes.extmaps=s.videoExtensions}m.media.mediaType==="audio"&&(m.media.fmts=s.audioCodecs.map(g=>g.payloadType.toString(10)),m.attributes.payloads=s.audioCodecs,m.attributes.extmaps=s.audioExtensions),p.mediaDescriptions[_]=this.mungMediaDesc(m)}this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}toString(){return Fs(this.sessionDesc)}send(t,n,r){const{ssrcs:i,ssrcGroups:s}=Dh(n,this.cname),a=this.sessionDesc.mediaDescriptions.find(h=>t===_e.VIDEO?h.media.mediaType==="video":h.media.mediaType==="audio"),d=i[0].attributes.label,l=i[0].attributes.mslabel;return a.attributes.ssrcs=a.attributes.ssrcs.concat(i),a.attributes.ssrcGroups=a.attributes.ssrcGroups.concat(s),{id:d,mslabel:l}}batchSend(t){return t.map(n=>{let{kind:r,ssrcMsg:i}=n;return this.send(r,i,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(n=>{const r=[],i=[],s=[];n.attributes.ssrcs.forEach(a=>{te(t).call(t,a.attributes.label||"")?s.push(a):r.push(a)}),n.attributes.ssrcGroups.forEach(a=>{var d;te(d=s.map(l=>l.ssrcId)).call(d,a.ssrcIds[0])||i.push(a)}),n.attributes.ssrcs=r,n.attributes.ssrcGroups=i})}mute(t){const n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(t,n,r){t.forEach((i,s)=>{const a=i._mediaStreamTrack,d=this.sessionDesc.mediaDescriptions.findIndex(h=>h.attributes.mid===a.kind),l=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[d],i);this.sessionDesc.mediaDescriptions[d]=l})}stopReceiving(t){}updateCandidates(t){const n=this._originCandidates.filter(i=>i.transport==="udp"),r=[];if(n.forEach(i=>{r.push(aV(aV({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}),n.length!==0){switch(t){case On.TCP_RELAY:this.candidates=r;break;case On.UDP_TCP_RELAY:case On.RELAY:this.candidates=[...n,...r];break;default:this.candidates=n}for(const i of this.sessionDesc.mediaDescriptions)i.attributes.candidates=this.candidates}}restartICE(t){t=Dt(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const n=[];for(let r=0;r<t;r++)n.push((this.currentMidIndex+r+1).toString(10));return n}mungRecvMediaDsec(t,n){const r=Dt(t);return Kc(r,n),QR(r,n),r}updateRecvMedia(t,n){const r=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===t);if(r!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],n);this.sessionDesc.mediaDescriptions[r]=i}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,n,r){const i=this.sessionDesc.mediaDescriptions.find(a=>t===_e.VIDEO?a.attributes.mid==="video":a.attributes.mid==="audio");if(i){const a=i.attributes.ssrcs.find(d=>d.attributes.label===n);var s;a&&(a.attributes.label=r,(s=a.attributes.msid)===null||s===void 0||s.replace(n,r))}}mungMediaDesc(t){const n=Dt(t);return JR(n),function(r){const i=r.attributes.extmaps.find(s=>Em(s.extensionName));i&&r.attributes.extmaps.splice(r.attributes.extmaps.indexOf(i),1),r.attributes.payloads.forEach(s=>{const a=s.rtcpFeedbacks.findIndex(d=>d.type==="transport-cc");a!==-1&&s.rtcpFeedbacks.splice(a,1)})}(n),n}getSSRC(t){for(const n of this.sessionDesc.mediaDescriptions)for(const r of n.attributes.ssrcs)if(r.attributes.label===t)return[r]}}var At;function cV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function tE(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?cV(Object(n),!0).forEach(function(r){I(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cV(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let dee=(At=class Sp extends hm{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return te(n=Object.keys(kc)).call(n,t)}))]}constructor(t,n){super(t,n),I(this,"store",void 0),I(this,"peerConnection",void 0),I(this,"remoteSDP",void 0),I(this,"initialOffer",void 0),I(this,"statsFilter",void 0),I(this,"useRTX",!1),I(this,"localCapabilities",void 0),I(this,"localCandidateCount",0),I(this,"allCandidatesReceived",!1),I(this,"establishPromise",void 0),I(this,"mutex",void 0),this.store=n,this.mutex=new bn("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(Sp.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=B_(this.peerConnection,A("STATS_UPDATE_INTERVAL"),void 0,Nt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=ps(t.sdp),r=Nh(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:A("FILTER_VIDEO_FEC"),filterAudioFec:A("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=r,this.initialOffer=t,tE(tE({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:r},offerSDP:t.sdp})}catch(t){throw new Y(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new cee(tE(tE({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const n=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteRTPCapabilities(t,n){throw new Y(O.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,n){var r=this;return yr(function*(){const i=yield He(r.mutex.lock());try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const s=t.map(m=>r.peerConnection.addTrack(m._mediaStreamTrack)),a=yield He(r.peerConnection.createOffer()),d=_r(a.sdp),l=t.map(m=>{const g=m._mediaStreamTrack,w=d.mediaDescriptions.find(R=>R.attributes.mid===g.kind);if(!w)throw new Error("Cannot extract ssrc from mediaDescription.");return function(R,y,b){const N=R.attributes.ssrcs.filter(x=>x.attributes.label===y),L=R.attributes.ssrcGroups;if(N.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(L&&N.length>1){const x=L.find(F=>F.ssrcIds.indexOf(N[0].ssrcId)!==-1);return x?[{ssrcId:x.ssrcIds[0],rtx:b?x.ssrcIds[1]:void 0}]:[{ssrcId:N[0].ssrcId}]}return[{ssrcId:N[0].ssrcId}]}(w,g.id,r.useRTX)});let h;try{h=yield l}catch(m){throw s.forEach(g=>{An()&&g.replaceTrack(null),r.peerConnection.removeTrack(g)}),m}const p=r.mungSendOfferSDP(a.sdp,t);r.remoteSDP.receive(t,n,h);const _=r.remoteSDP.toString();return yield He(r.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield He(r.applySendEncodings(s,t)),yield He(r.peerConnection.setRemoteDescription({type:"answer",sdp:_})),t.map((m,g)=>{const w=m._mediaStreamTrack.id;return{localSSRC:l[g],id:w}})}catch(s){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s.toString()))}finally{i()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(s=>{var a;return t.indexOf(((a=s.track)===null||a===void 0?void 0:a.id)||"")!==-1});if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(s=>{An()&&s.replaceTrack(null),this.peerConnection.removeTrack(s)});const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r),this.remoteSDP.stopReceiving(t);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:s,mslabel:a}=this.remoteSDP.send(t,n,i),d=new ae((p,_)=>{const m=setTimeout(()=>{_(new Error("Cannot receive track, id: ".concat(s)))},1e4),g=w=>{const R=rt();if((R.name==="Safari"&&Number(R.version)===11||tr())&&w.track.id!==s&&w.streams[0].id===a){var y;const b=w.streams[0].getTracks()[0];return(y=this.remoteSDP)===null||y===void 0||y.updateTrackLabel(t,s,w.track.id),this.peerConnection.removeEventListener("track",g),clearTimeout(m),void p(b)}if(w.track.id===s)return this.peerConnection.removeEventListener("track",g),clearTimeout(m),void p(w.track)};this.peerConnection.addEventListener("track",g)}),l=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const h=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(h),{track:await d,id:s}}catch(s){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(r)}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(r=>{var i;return t.indexOf(((i=r.track)===null||i===void 0?void 0:i.id)||"")!==-1});if(n.length!==t.length)throw new Error("sender' length doesn't match mids' length.");n.map(r=>{if(An()&&r.track)r.track.enabled=!1;else{const i=r.getParameters();i.encodings.forEach(s=>s.active=!1),r.setParameters(i)}})}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(s=>{var a;return t.indexOf(((a=s.track)===null||a===void 0?void 0:a.id)||"")!==-1});if(n.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async s=>{if(An()&&s.track)s.track.enabled=!0;else{const a=s.getParameters();a.encodings.forEach(d=>d.active=!0),await s.setParameters(a)}});const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return yr(function*(){const r=yield He(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const i=qe().supportPCSetConfiguration;if(t===On.RELAY&&!i)return;if(i){const h=n.peerConnection.getConfiguration(),p=t===On.RELAY?"relay":"all";h.iceTransportPolicy!==p&&(T.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(h.iceTransportPolicy,"] to [").concat(p,"]")),h.iceTransportPolicy=p,n.peerConnection.setConfiguration(h))}t!==On.RELAY&&n.remoteSDP.updateCandidates(t);const s=yield He(n.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const a=ps(s.sdp),{remoteIceParameters:d}=yield a.iceParameters;n.remoteSDP.restartICE(d);const l=n.remoteSDP.toString();yield He(n.peerConnection.setLocalDescription(s)),yield He(n.peerConnection.setRemoteDescription({type:"answer",sdp:l}))}catch(i){T.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),i)}finally{r()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new Y(O.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getSenders().filter(i=>{var s;return((s=i.track)===null||s===void 0?void 0:s.id)===t});r.length===1&&await this.applySendEncodings(r,[n])}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getSenders().find(i=>{var s;return((s=i.track)===null||s===void 0?void 0:s.id)===n});r&&await r.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,n){throw new Y(O.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new Y(O.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},A("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Ac(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...Sp.turnServerConfigToIceServers(t.turnServer.servers)),A("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...Sp.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}async updateRtpSenderEncodings(t,n){var r;if(n||(n=this.peerConnection.getSenders().find(h=>{var p;return((p=h.track)===null||p===void 0?void 0:p.id)===t._mediaStreamTrack.id})),!n)return T.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!qe().supportSetRtpSenderParameters)return T.warn("Browser not support set rtp-sender parameters");const i={},s={};if(t instanceof Ct)switch(t._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(A("DSCP_TYPE")&&as()){var a;const h=A("DSCP_TYPE");te(a=["very-low","low","medium","high"]).call(a,h)&&(s.networkPriority=h)}const d=n.getParameters(),l=(r=d.encodings)===null||r===void 0?void 0:r[0];l&&Object.assign(l,s),Object.assign(d,i),T.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(d.encodings))),await n.setParameters(d)}async applySendEncodings(t,n){try{if(!qe().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const i=t[r],s=n[r];i&&s&&await this.updateRtpSenderEncodings(s,i)}}catch{T.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n){const r=_r(t);return n.forEach((i,s)=>{const a=i._mediaStreamTrack,d=r.mediaDescriptions.find(l=>l.attributes.mid===a.kind);d&&Kc(d,i)}),Fs(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(t).map((s,a)=>{let{id:d,mslabel:l}=s;const{kind:h}=t[a];return new ae((p,_)=>{const m=setTimeout(()=>{_(new Error("Cannot receive track, id: ".concat(d)))},1e4),g=w=>{const R=rt();if(R.name==="Safari"&&Number(R.version)===11&&w.track.id!==d&&w.streams[0].id===l){var y;const b=w.streams[0].getTracks()[0];return(y=this.remoteSDP)===null||y===void 0||y.updateTrackLabel(h,d,w.track.id),this.peerConnection.removeEventListener("track",g),clearTimeout(m),void p({track:b,id:d})}if(w.track.id===d)return this.peerConnection.removeEventListener("track",g),clearTimeout(m),void p({track:w.track,id:d})};this.peerConnection.addEventListener("track",g)})}),r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const i=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(i),await ae.all(n)}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n==null?void 0:n[0].ssrcId}setConfiguration(t){if(qe().supportPCSetConfiguration){const n=Sp.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},ce(At.prototype,"connect",[Fi],Object.getOwnPropertyDescriptor(At.prototype,"connect"),At.prototype),ce(At.prototype,"stopSending",[Fi],Object.getOwnPropertyDescriptor(At.prototype,"stopSending"),At.prototype),ce(At.prototype,"receive",[Fi],Object.getOwnPropertyDescriptor(At.prototype,"receive"),At.prototype),ce(At.prototype,"stopReceiving",[Fi],Object.getOwnPropertyDescriptor(At.prototype,"stopReceiving"),At.prototype),ce(At.prototype,"muteRemote",[Fi],Object.getOwnPropertyDescriptor(At.prototype,"muteRemote"),At.prototype),ce(At.prototype,"unmuteRemote",[Fi],Object.getOwnPropertyDescriptor(At.prototype,"unmuteRemote"),At.prototype),ce(At.prototype,"muteLocal",[Fi],Object.getOwnPropertyDescriptor(At.prototype,"muteLocal"),At.prototype),ce(At.prototype,"unmuteLocal",[Fi],Object.getOwnPropertyDescriptor(At.prototype,"unmuteLocal"),At.prototype),ce(At.prototype,"close",[Fi],Object.getOwnPropertyDescriptor(At.prototype,"close"),At.prototype),ce(At.prototype,"updateEncoderConfig",[Fi],Object.getOwnPropertyDescriptor(At.prototype,"updateEncoderConfig"),At.prototype),ce(At.prototype,"updateSendParameters",[Fi],Object.getOwnPropertyDescriptor(At.prototype,"updateSendParameters"),At.prototype),ce(At.prototype,"replaceTrack",[Fi],Object.getOwnPropertyDescriptor(At.prototype,"replaceTrack"),At.prototype),ce(At.prototype,"getRemoteSSRC",[Fi],Object.getOwnPropertyDescriptor(At.prototype,"getRemoteSSRC"),At.prototype),At);function Fi(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("Locking from P2PConnection.".concat(t));try{for(var a=arguments.length,d=new Array(a),l=0;l<a;l++)d[l]=arguments[l];return await r.apply(this,d)}finally{s()}},n}const lee={name:"PlanBConnection",create:function(e){let{store:t,spec:n}=e;return new dee(n,t)}},uee={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!qe().supportWebRTCEncodedTransform)return void T.warning("browser not support audio encoded transform");if($_.has(e)||!e.track)return;const n={track:e.track};if(xs()){if(!e.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(a){return void T.error("create audio-encoded-streams error",a&&a.message)}const s=new TransformStream({transform(a,d){n.controller||(n.controller=d),e.track&&e.track.id!==n.track.id&&(T.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const l=t.metadata&&t.metadata();l?function(h,p){const{chunk:_,controller:m}=p,g=ya.METADATA;_.data=function(w,R,y){const b=y.byteLength,N=b+bR+tM,L=wR+AR+N,x=new ArrayBuffer(w.byteLength+L),F=new DataView(x);F.setUint8(0,eM),F.setUint16(1,N),F.setUint8(3,R),F.setUint16(4,b);for(let B=0;B<b;B++)F.setUint8(6+B,y[B]);const M=new Uint8Array(F.buffer);return M.set(new Uint8Array(w),L),M.buffer}(_.data,g,h),m.enqueue(_)}(l,{chunk:a,controller:d}):d.enqueue(a)}});i.readable.pipeThrough(s).pipeTo(i.writable)}else if(An()){if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const i=Z_(),s=new MessageChannel;await new ae(d=>i.onmessage=l=>{l.data==="registered"&&d(void 0)});const a=new RTCRtpScriptTransform(i,{name:"audio-metadata-tx",port:s.port2},[s.port2]);e.transform=a,await new ae(d=>i.onmessage=l=>{l.data==="started"&&d(void 0)}),s.port1.onmessage=d=>{var l;if(d.data.transformed&&e.track&&((l=e.track)===null||l===void 0?void 0:l.id)!==n.track.id)T.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r);else if(d.data.getMetadata){const h=t.metadata&&t.metadata();h&&s.port1.postMessage({metadata:h})}},n.worker=i}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}const i=$_.get(e);if(i){$_.delete(e);try{var s,a;(s=i.controller)===null||s===void 0||s.terminate(),(a=i.worker)===null||a===void 0||a.terminate()}catch(d){T.warning(d&&d.message)}}}$_.set(e,n),e.track.addEventListener("ended",r)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!qe().supportWebRTCEncodedTransform)return void T.warning("browser not support audio encoded transform");if(om.has(e))return;const n={track:e.track,onMetadata:t.onMetadata,onPts:t.onPts};if(xs()&&!tr()){if(!e.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");xv(ot.CHROME,87,116)||(t.enableTopn=!1);let i=null;try{i=e.createEncodedStreams()}catch(a){return void T.error("create audio-encoded-streams error",a&&a.message)}const s=new TransformStream({transform(a,d){n.controller||(n.controller=d),e.track&&e.track.id!==n.track.id&&(T.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)),t.enableTopn?function(l,h,p){var _;const m=OR(new DataView(h.data));if(!m)return p.enqueue(h);const g=l.track.id;GJ.set(g,l.track);const w=(_=m.tlv.find(x=>x.tag===ya.AUDIO_LEVEL))===null||_===void 0?void 0:_.value;let R=0;typeof w=="number"&&(R=127-w);const y=Math.round(Math.pow(10,R/60)-1),{selected:b,speaker:N}=function(x,F){let M=wl.get(x);if(M||(M=function(B){const J=new rM;return wl.set(B,J),Po||(Po=new BJ(A("TOPN_SILENCE_THRESHOLD")||500),Po.on("ActiveSpeakerChanged",ee=>{ee!=null&&(nm=ee)})),Po.addSpeakers([J]),J}(x)),wl.size<=iM)return{selected:!0,speaker:M};if(!Po)throw new Error("no active speaker detector");return Po.levelChanged(M.id,F),Bc=Po.loudest.map(B=>B.id),nm&&!te(Bc).call(Bc,nm)&&Bc.length>=iM&&Bc.pop(),{selected:te(Bc).call(Bc,M.id)||M.id===nm,speaker:M}}(l,y),L=function(x,F,M){const B=Lo.get(x)||new jJ(x,F);return B.score=M,Lo.set(x,B),function(J){if(rm.set(J,!0),!im)return void(im=Date.now());const ee=Date.now();ee-im>1e3&&(rm.get(J)?rm.set(J,!1):(oM(J),rm.delete(J)),im=ee)}(x),B}(g,l.track,N.energyScore);L.addSample(b),L.active&&(h.data=m.frame.buffer,p.enqueue(h))}(e,a,d):t.enableMetadata||t.enablePts?function(l,h,p,_){const m=new DataView(l.data),g=m.getUint8(0);let w;if(128&g&&g!==71){const b=function(N){if(N.byteLength<=0)return[];const L=[];let x=0;for(;x<N.byteLength;){const M=(128&N.getUint8(x))>>7,B=127&N.getUint8(x);if(!(M&&x+4<=N.byteLength)){x++;break}{const J=N.getUint32(x,!1),ee=(16776192&J)>>10,pe=1023&J;L.push({pt:B,ts_offset:ee,length:pe,data:new Uint8Array}),x+=4}}let F=N.byteLength-x;for(const M of L){if(M.length>F)return console.warn("Broken red payload"),[];M.length>0&&(M.data=new Uint8Array(N.buffer,N.byteOffset+x,M.length),x+=M.length,F-=M.length)}if(F>0){const M={pt:L.length>0?L[L.length-1].pt:0,ts_offset:0,length:F,data:new Uint8Array(N.buffer,N.byteOffset+x,F)};L.push(M)}return L}(m);if(b.length>0){const N=function(L){let x=0;for(let B=0;B<L.length;B++)x+=B<L.length-1?4:1,x+=L[B].length;const F=new Uint8Array(x);let M=0;for(let B=0;B<L.length;B++)if(B<L.length-1){const J=(2147483648|(127&L[B].pt)<<24|(262143&L[B].ts_offset)<<10|1023&L[B].length)>>>0;F[M++]=J>>24&255,F[M++]=J>>16&255,F[M++]=J>>8&255,F[M++]=255&J}else F[M++]=127&L[B].pt;for(const B of L)F.set(B.data,M),M+=B.length;return F}(b.map(L=>{const x=new Uint8Array(L.length);x.set(L.data);const F=OR(new DataView(x.buffer));return F!=null&&F.frame&&(L.data=F==null?void 0:F.frame),w=F,L}));l.data=N.buffer}}else w=OR(m),w&&(l.data=w.frame.buffer);if(h.enqueue(l),!w)return;const R=w.tlv.find(b=>b.tag===ya.METADATA);R&&p&&R.value instanceof Uint8Array&&p(R.value);const y=w.tlv.find(b=>b.tag===ya.AUDIO_64_BIT_PTS);y&&_&&y.value instanceof Uint8Array&&y.value.length==8&&_(new DataView(y.value.buffer).getBigUint64(0,!0))}(a,d,t.onMetadata,t.onPts):d.enqueue(a)}});i.readable.pipeThrough(s).pipeTo(i.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const i=Z_(),s=new MessageChannel;await new ae(d=>i.onmessage=l=>{l.data==="registered"&&d(void 0)});const a=new RTCRtpScriptTransform(i,{name:"audio-metadata-rx",port:s.port2},[s.port2]);e.transform=a,await new ae(d=>i.onmessage=l=>{l.data==="started"&&d(void 0)}),s.port1.onmessage=d=>{var l;d.data.transformed&&e.track&&((l=e.track)===null||l===void 0?void 0:l.id)!==n.track.id?(T.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)):d.data.metadata&&n.onMetadata?n.onMetadata(d.data.metadata):d.data.pts&&n.onPts&&n.onPts(d.data.pts)},n.worker=i}function r(){e.track.removeEventListener("ended",r),function(i){const s=om.get(i);if(s){(function(l){const h=wl.get(l);h&&(wl.delete(l),Po&&(Po.removeSpeakers([h]),wl.size===0&&(Po.destroy(),Po=null)))})(i),oM(i.track.id),om.delete(i);try{var a,d;(a=s.controller)===null||a===void 0||a.terminate(),(d=s.worker)===null||d===void 0||d.terminate()}catch(l){T.warning(l&&l.message)}}}(e)}om.set(e,n),e.track.addEventListener("ended",r)},interceptLocalVideoFrame:async function(e,t){if(!qe().supportWebRTCEncodedTransform)return void T.warning("browser not support video encoded transform");if(sm.has(e)||!e.track)return;const n={track:e.track};if(xs()){if(!e.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(d){return void T.error("create video-encoded-streams error",d&&d.message)}const s=[];t.on("sei-to-send",d=>{s.push(d)});const a=new TransformStream({transform(d,l){n.controller||(n.controller=l),e.track&&e.track.id!==n.track.id&&(T.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const h=cM(new Uint8Array(d.data)),p=s.shift();if(p){const _=function(m,g,w){switch(w){case LR:return function(R,y){const b=aM(y),N=b.length,L=Math.floor(N/255),x=N%255,F=new Uint8Array(6+L+1+N+R.byteLength);F[0]=0,F[1]=0,F[2]=0,F[3]=1,F[4]=6,F[5]=101;let M=0;for(;M<L;)F[6+M]=255,M++;return F[6+M]=x,M++,F.set(b,6+M),F.set(new Uint8Array(R),6+M+N),F.buffer}(m,g);case kR:return function(R,y){const b=aM(y),N=b.length,L=Math.floor(N/255),x=N%255,F=new Uint8Array(7+L+1+N+1+R.byteLength);F[0]=0,F[1]=0,F[2]=0,F[3]=1,F[4]=78,F[5]=1,F[6]=101;let M=0;for(;M<L;)F[7+M]=255,M++;return F[7+M]=x,M++,F.set(b,7+M),M+=N,F[7+M]=128,M++,F.set(new Uint8Array(R),7+M),F.buffer}(m,g);default:return null}}(d.data,p,h);_&&(d.data=_)}l.enqueue(d)}});i.readable.pipeThrough(a).pipeTo(i.writable)}else{if(!An())return;{if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const i=Z_(),s=new MessageChannel;await new ae(d=>i.onmessage=l=>{l.data==="registered"&&d(void 0)});const a=new RTCRtpScriptTransform(i,{name:"sei-tx",port:s.port2},[s.port2]);e.transform=a,await new ae(d=>i.onmessage=l=>{l.data==="started"&&d(void 0)}),t.on("sei-to-send",d=>{s.port1.postMessage({sei:d})}),s.port1.onmessage=d=>{var l;d.data.transformed&&e.track&&((l=e.track)===null||l===void 0?void 0:l.id)!==n.track.id&&(T.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r))},n.worker=i}}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}const i=sm.get(e);if(i){sm.delete(e);try{var s,a;(s=i.controller)===null||s===void 0||s.terminate(),(a=i.worker)===null||a===void 0||a.terminate()}catch(d){T.warning(d&&d.message)}}}sm.set(e,n),e.track.addEventListener("ended",r)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!qe().supportWebRTCEncodedTransform)return void T.warning("browser not support video encoded transform");if(!e.track)return;if(wh.has(e)){const i=wh.get(e);return void(i&&(i.onSei=t.onSei))}const n={track:e.track,onSei:t.onSei};if(xs()){if(!e.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(a){return void T.error("create video-encoded-streams error",a&&a.message)}const s=new TransformStream({transform(a,d){if(n.controller||(n.controller=d),!n.firstFrameInfo){var l;const p=a.getMetadata()||{};n.firstFrameInfo=Ot({type:a.type,rtpTimestamp:a.timestamp,payloadType:p.payloadType||0,ssrc:p.synchronizationSource||0,length:a.data.byteLength},"mimeType"in p?{mimeType:p.mimeType}:{}),(l=t.onFirstFrame)===null||l===void 0||l.call(t,n.firstFrameInfo)}e.track&&e.track.id!==n.track.id&&(T.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const h=function(p,_){switch(_){case LR:return function(m){const g=new DataView(m.data);let w=0;for(;w+4<m.data.byteLength;){if(g.getUint8(w+0)===0&&g.getUint8(w+1)===0&&g.getUint8(w+2)===0&&g.getUint8(w+3)===1&&g.getUint8(w+4)===6){let R=w+6,y=0,b=0;for(;(b=g.getUint8(R++))===255;)y+=255;y+=b;const N=sM(m.data,R,y);return new Uint8Array(N)}w++}return null}(p);case kR:return function(m){const g=new DataView(m.data);let w=0;for(;w+5<m.data.byteLength;){if(g.getUint8(w+0)===0&&g.getUint8(w+1)===0&&g.getUint8(w+2)===0&&g.getUint8(w+3)===1&&g.getUint8(w+4)===78&&g.getUint8(w+5)===1&&g.getUint8(w+6)===101){let R=w+7,y=0,b=0;for(;(b=g.getUint8(R++))===255;)y+=255;y+=b;const N=sM(m.data,R,y);return new Uint8Array(N)}w++}return null}(p);default:return null}}(a,cM(new Uint8Array(a.data)));h&&n.onSei&&n.onSei(h),d.enqueue(a)}});i.readable.pipeThrough(s).pipeTo(i.writable)}else if(An()){if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const i=Z_(),s=new MessageChannel;await new ae(d=>i.onmessage=l=>{l.data==="registered"&&d(void 0)});const a=new RTCRtpScriptTransform(i,{name:"sei-rx",port:s.port2},[s.port2]);e.transform=a,await new ae(d=>i.onmessage=l=>{l.data==="started"&&d(void 0)}),s.port1.onmessage=d=>{var l;if(d.data.transformed&&e.track&&((l=e.track)===null||l===void 0?void 0:l.id)!==n.track.id)T.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r);else if(d.data.sei&&n.onSei)n.onSei(d.data.sei);else if(d.data.firstFrameInfo&&t.onFirstFrame){var h;(h=t.onFirstFrame)===null||h===void 0||h.call(t,d.data.firstFrameInfo)}},n.worker=i}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}(function(i){const s=wh.get(i);if(s){wh.delete(i);try{var a,d;(a=s.controller)===null||a===void 0||a.terminate(),(d=s.worker)===null||d===void 0||d.terminate()}catch(l){T.warning(l&&l.message)}}})(e)}wh.set(e,n),e.track.addEventListener("ended",r)}},hee={name:"InterceptFrame",create:()=>uee};var tt;function dV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Go(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?dV(Object(n),!0).forEach(function(r){I(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dV(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let pee=(tt=class $l extends hm{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return te(n=Object.keys(kc)).call(n,t)}))]}constructor(t,n,r){super(t,n),I(this,"id",ht(5,"connection-")),I(this,"store",void 0),I(this,"peerConnection",void 0),I(this,"forceTurn",!1),I(this,"remoteSDP",void 0),I(this,"initialOffer",void 0),I(this,"transportEventReceiver",void 0),I(this,"statsFilter",void 0),I(this,"extension",{useXR:A("USE_XR")}),I(this,"localCapabilities",void 0),I(this,"remoteCodecs",void 0),I(this,"localCandidateCount",0),I(this,"allCandidatesReceived",!1),I(this,"isPreallocation",!1),I(this,"preMediaMap",new Map),I(this,"dataStreamChannelMap",new Map),I(this,"establishPromise",void 0),I(this,"recoveredDataChannelIds",[]),I(this,"currentDataChannelId",1),I(this,"supportAV1RtpSpec",!1),I(this,"mutex",void 0),I(this,"qualityLimitationReason",fl.NONE),I(this,"isFirstConnected",!1),this.store=n,this.forceTurn=Ey(t),this.mutex=new bn("NVConnectionExtension-mutex",n.clientId),this.peerConnection=r,this.isFirstConnected=!1,this.statsFilter=B_(this.peerConnection,A("STATS_UPDATE_INTERVAL"),void 0,Nt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,n){if(this.remoteCodecs=n,!this.remoteSDP)return void T.debug("[NVConnectionExtension] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(t,n,this.store.codec)){const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r);const s=this.remoteSDP.toString();i==null||i(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}else T.debug("[NVConnectionExtension] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=ps(n.sdp),i=await $R({filterRTX:!A("USE_PUB_RTX")&&!A("USE_SUB_RTX"),filterVideoFec:A("FILTER_VIDEO_FEC"),filterAudioFec:A("FILTER_AUDIO_FEC"),filterVideoCodec:A("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:A("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:A("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=Ph(i),this.initialOffer=n,A("ENABLE_SVC")&&this.store.codec=="av1"){const a=await UM();var t;a&&(this.supportAV1RtpSpec=!0,(t=i.send)===null||t===void 0||t.videoExtensions.push(a))}let s;return n.sdp&&Sm(n.sdp)&&(s=Dt(i),bM(s)),Go(Go({},r),{},{rtpCapabilities:s||i,offerSDP:n.sdp})}catch(n){throw new Y(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnectionExtension without initial offer.");this.initialOffer.sdp&&Sm(this.initialOffer.sdp)&&OM(t.rtpCapabilities,this.localCapabilities),this.remoteSDP=new aU(Go(Go({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!A("ENABLE_PRE_SUB_WITH_PRE_PC")||!A("PRE_USE_LOCAL_CODECS"))&&yh(this.store),!0),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const n=this.remoteSDP.toString(),r=ey(this.initialOffer.sdp,this.extension),i=this.logSDPExchange(r||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),i==null||i(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n});const s=this.peerConnection.getTransceivers()[0];if(s!=null&&s.receiver&&this.tryBindTransportEvents(s.receiver),yh(this.store))if(t.preallocation&&A("ENABLE_PRE_SUB_WITH_PRE_PC")){const a=A("PRE_SUB_NUM"),{mids:d,preSSRCs:l}=this.remoteSDP.preloadRemoteMedia(a);await Vr(this.peerConnection,this.remoteSDP,this.extension),T.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] preload media, in pre pc,add preload ssrcs ").concat(l)),this.presetMedia(d,l)}else{const{preSSRCs:a=[]}=t,d=a.map(h=>h.ssrcMsg[0].ssrcId);if(a.length===0)return;const{mids:l}=this.remoteSDP.batchSend(a.map(h=>Object.assign({},h)));await Vr(this.peerConnection,this.remoteSDP,this.extension),T.debug("[NVConnectionExtension.connect] preload media, after join, add preload ssrcs ".concat(d)),this.presetMedia(l,d)}}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"NVConnectionExtension.connect failed; ".concat(n.toString()))}}presetMedia(t,n){t.forEach((r,i)=>{this.peerConnection.getTransceivers().forEach(s=>{if(s.mid!=null&&r===s.mid&&s.receiver.track){const a=s.receiver.track;let d;a.kind==="video"&&A("ENABLE_PRE_RENDER")&&(d=new J_({trackId:"track-".concat(a.kind,"-unknown-").concat(this.store.clientId,"_").concat(ht(5,""))},!0),d.updateVideoTrack(a),d.onFirstVideoFrameRender=()=>{var l;const h=this.preMediaMap.get(n[i]);h&&(h.firstVideoRender=Date.now()),(l=this.onFirstVideoRender)===null||l===void 0||l.call(this,n[i])},d.onVideoBufferReady=()=>{var l;(l=this.onFirstVideoBufferReady)===null||l===void 0||l.call(this,n[i])},d.play(this.store.sessionId||void 0)),this.preMediaMap.set(n[i],{mid:r,track:a,player:d,transceiver:s})}}),this.store.peerReceiver()})}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.updateRemoteConnect before remote SDP created");let n=!1;const{rtpCapabilities:r}=t;if([,n]=this.remoteSDP.updateRemoteRTPCapabilities(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const a=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);n=n||a}const{preSSRCs:i=[]}=t,s=i.map(a=>a.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(s)){const a=[],d=[];if(Array.from(this.preMediaMap.entries()).every(l=>{let[h,{mid:p,player:_,track:m}]=l;return a.push(p),d.push(h),this.preMediaMap.delete(h),_&&_.destroy(),!0}),a.length>0&&(this.remoteSDP.stopSending(a),await Vr(this.peerConnection,this.remoteSDP,this.extension),T.warn("[NVConnectionExtension.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(d)),Se.reportApiInvoke(this.store.sessionId,{name:kt.PRELOAD_MEDIA_FAILED,options:[i,d],tag:yt.TRACER}).onSuccess()),i.length>0){const{mids:l}=this.remoteSDP.batchSend(i.map(h=>Object.assign({},h)));await Vr(this.peerConnection,this.remoteSDP,this.extension),T.debug("[NVConnectionExtension.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(s)),this.presetMedia(l,s)}}n?(await Vr(this.peerConnection,this.remoteSDP,this.extension),T.debug("[NVConnectionExtension] updateRemoteConnect by exchanging SDP.")):T.debug("[NVConnectionExtension] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"NVConnectionExtension.updateRemoteConnect failed; ".concat(n.toString()))}}send(t,n,r){var i=this;return yr(function*(){const s=yield He(i.mutex.lock("From NVConnectionExtension.send"));try{if(!i.remoteSDP)throw new Error("Cannot call NVConnectionExtension.send before remote SDP created");const a=[],d=Oh();t.forEach(y=>{const b=i.peerConnection.addTransceiver(y._mediaStreamTrack,Go({direction:"sendonly"},y.trackMediaType==="video"&&i.supportAV1RtpSpec&&d?{sendEncodings:[{scalabilityMode:d}]}:{}));a.push(b),y._updateRtpTransceiver(b)}),Nt()&&A("SIMULCAST")===!0&&(yield He(i.applySimulcastForFirefox(a,t)));const l=yield He(i.peerConnection.createOffer()),h=i.remoteSDP.predictReceivingMids(t.length),p=i.mungSendOfferSDP(l.sdp,t,h),_=_r(p),m=h.map(y=>{const b=_.mediaDescriptions.find(N=>N.attributes.mid===y);if(!b)throw new Error("Cannot extract ssrc from mediaDescription.");return XR(b,A("USE_PUB_RTX"))});let g;try{g=yield m}catch(y){g=[],i.remoteSDP.receive(t,n,r,g);const b=i.remoteSDP.toString();throw yield He(i.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield He(i.peerConnection.setRemoteDescription({type:"answer",sdp:b})),yield He(i.stopSending(h,!0)),y}i.remoteSDP.receive(t,n,r,g);const w=i.remoteSDP.toString(),R=i.logSDPExchange(p,"offer","local","send");return yield He(i.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield He(i.applySimulcastEncodings(a,t)),yield He(i.applySendEncodings(a,t)),R==null||R(w),yield He(i.peerConnection.setRemoteDescription({type:"answer",sdp:w})),a.map((y,b)=>{const N=h[b];return{localSSRC:m[b],id:N,transceiver:y}})}catch(a){throw a instanceof Y?a:new Y(O.EXCHANGE_SDP_FAILED,"NVConnectionExtension.send failed; ".concat(a.toString()))}finally{s()}})()}async createDataChannels(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.createDataChannels before remote SDP created");let r=this.dataStreamChannelMap.get(t);if(r&&r.readyState==="open")T.debug("[NVConnectionExtension] Channels are already available and can be reused directly.");else{const s=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof s!="number")throw new Error("create DataChannel error, because cannot get dc id");r=this.peerConnection.createDataChannel("datastream-channel",{id:s,negotiated:!0,ordered:!1,maxRetransmits:A("DATASTREAM_MAX_RETRANSMITS")}),r.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,r)}n.forEach(s=>{s._updateOriginDataChannel(r)});const{needExchangeSDP:i}=this.remoteSDP.sendDataChannel();if(i){const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const a=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(a),T.debug("[NVConnectionExtension] createDataChannels by exchanging SDP.")}else T.debug("[NVConnectionExtension] createDataChannels no need to exchange SDP.");return}catch(r){throw r instanceof Y?r:new Y(O.EXCHANGE_SDP_FAILED,"NVConnectionExtension.createDataChannels failed; ".concat(r.toString()))}}async stopDataChannels(t){try{const n=this.dataStreamChannelMap.get(t);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(t)}catch(n){throw n instanceof Y?n:new Y(O.DATACHANNEL_FAILED,"NVConnectionExtension.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(t,n){const r=n?void 0:await this.mutex.lock("From NVConnectionExtension.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter(l=>t.indexOf(l.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVConnectionExtension.stopSending.");i.map(l=>{var h;xl(this.id+l.mid,this),l.direction="inactive",(h=l.stop)===null||h===void 0||h.call(l)});const s=await this.peerConnection.createOffer(),a=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(t);const d=this.remoteSDP.toString();a==null||a(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(i){throw new Y(O.EXCHANGE_SDP_FAILED,"NVConnectionExtension.stopSending failed; ".concat(i.toString()))}finally{r&&r()}}async receive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.receive ".concat(t," before remoteSDP created."));const{mid:s,needExchangeSDP:a}=this.remoteSDP.send(t,n,r,i);a&&(await Vr(this.peerConnection,this.remoteSDP,this.extension),T.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] receive ").concat(t," by exchanging SDP.")));const d=this.peerConnection.getTransceivers().find(l=>l.mid===s);if(!d)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:d.receiver.track,id:s,transceiver:d}}catch(s){throw new Y(O.EXCHANGE_SDP_FAILED,"NVConnectionExtension.receive failed; ".concat(s.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:r}=this.remoteSDP.batchSend(t);return r&&(await Vr(this.peerConnection,this.remoteSDP,this.extension),T.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] batchReceive by exchanging SDP."))),n.map(i=>{const s=this.peerConnection.getTransceivers().find(a=>a.mid===i);if(!s)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,id:i,transceiver:s}})}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"NVConnectionExtension.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.stopReceiving before remote SDP created.");t.forEach(s=>{Array.from(this.preMediaMap.entries()).some(a=>{let[d,{mid:l,player:h}]=a;if(l===s)return this.preMediaMap.delete(d),h&&h.destroy(),!0})}),this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"NVConnectionExtension stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"NVConnectionExtension.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"NVConnectionExtension.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(a=>a.mid&&t.indexOf(a.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(a=>{a.direction="inactive"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const s=this.remoteSDP.toString();i==null||i(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"NVConnectionExtension.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(a=>a.mid&&t.indexOf(a.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(a,d)=>{a.direction="sendonly"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);const s=this.remoteSDP.toString();i==null||i(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"NVConnectionExtension.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return yr(function*(){const r=yield He(n.mutex.lock("From NVConnectionExtension.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const i=qe().supportPCSetConfiguration,s=A("FORCE_TURN_TCP")||n.forceTurn;if(t===On.RELAY&&!i)return;if(i&&!s){const _=t===On.RELAY?"relay":"all",m=n.peerConnection.getConfiguration();m.iceTransportPolicy!==_&&(T.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(m.iceTransportPolicy,"] to [").concat(_,"]")),m.iceTransportPolicy=_,n.peerConnection.setConfiguration(m))}n.remoteSDP.updateCandidates(t);const a=yield He(n.peerConnection.createOffer({iceRestart:!0}));if(!a.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=ps(a.sdp),{remoteIceParameters:l}=yield d.iceParameters;n.remoteSDP.restartICE(l);const h=n.remoteSDP.toString(),p=n.logSDPExchange(a.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield He(n.peerConnection.setLocalDescription(a)),p==null||p(h),yield He(n.peerConnection.setRemoteDescription({type:"answer",sdp:h}))}catch(i){T.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),i)}finally{r()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const t=await this.mutex.lock("From NVConnectionExtension.extendCandidate");try{this.remoteSDP.updateCandidates(On.TCP_RELAY),await Vr(this.peerConnection,this.remoteSDP,this.extension)}catch(n){T.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),n)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(n=>{xl(this.id+n.mid,this)}),this.preMediaMap.forEach(n=>{let{player:r}=n;r&&r.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Go(Go({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const s=this.remoteSDP.toString(),a=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),a==null||a(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new Y(O.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getTransceivers().filter(i=>i.mid===t);r.length===1&&(this.isVP8Simulcast(n)?Nt()||await this.applySimulcastEncodings(r,[n]):await this.applySendEncodings(r,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getTransceivers().find(i=>i.mid===n);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:r,remote:i}=n.getSelectedCandidatePair();return{local:Go(Go({},ro),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:Go(Go({},ro),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var n;const r="code: ".concat(t.errorCode,", message: ").concat(t.errorText),i=t.port?"local: ".concat(t.port):"",s=hs(t.url||"");T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: NVConnectionExtension.onICECandidateError(").concat(r,"), url: ").concat(s||"",", host_candidate:").concat(i)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,r)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},A("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]},r=t.cloudProxyServer||"disabled";return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&(Ac(t.turnServer.servers)?n.iceServers=t.turnServer.servers:A("NEW_TURN_MODE")&&n.iceServers&&r==="disabled"?(A("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&n.iceServers.push(...$l.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):n.iceServers.push(...$l.newTurnServerConfigToIceServers(t.turnServer.servers)),A("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(n.iceServers&&n.iceServers.push(...$l.turnServerConfigToIceServers(t.turnServer.servers)),A("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...$l.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),A("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),A("ENABLE_ENCODED_TRANSFORM")&&qe().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(co(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!A("FORCE_TURN_TCP")&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}static newTurnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{const i=A("NEW_TURN_MODE");i===1?n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=udp")}):i===2?n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=tcp")}):i===3?n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(co(r.turnServerURL),":443?transport=tcp")}):i===4&&(n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=udp")}),n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=tcp")}),n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(co(r.turnServerURL),":443?transport=tcp")}))}),n}tryBindTransportEvents(t){const n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var i;n!=null&&n.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,n.state))},n.onerror=i=>{var s;(s=this.onDTLSTransportError)===null||s===void 0||s.call(this,"error"in i?i.error:i)};const r=n.iceTransport;r&&(r.onstatechange=()=>{const i=n==null?void 0:n.iceTransport.state;var s;i&&((s=this.onICETransportStateChange)===null||s===void 0||s.call(this,i))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){const{local:i,remote:s}=r.getSelectedCandidatePair()||{};if(i&&s){const a=i.address+":"+i.port,d=s.address+":"+s.port;T.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(hs(a)),", remote ").concat(JSON.stringify(hs(d))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var r,i;if(n||(n=this.peerConnection.getSenders().find(y=>y.track===t._mediaStreamTrack)),!n)return T.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return T.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!qe().supportSetRtpSenderParameters)return T.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const s={},a={};switch(t._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;case"balanced":s.degradationPreference="balanced"}const d=wM(this.peerConnection,t._mediaStreamTrack),l=_k(t);if(pU(t)&&d&&n&&l&&this.getLocalVideoStats&&te(r=["vp8","vp9"]).call(r,this.store.codec)){var h;const R=s.degradationPreference||(te(h=t._hints).call(h,lt.CUSTOM_TRACK)?A("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");fU(this.id+d.mid,l,this,R,y=>{n&&this.updateAdaptation(n,y)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var p;const{bitrateMax:R,frameRate:y,scaleResolutionDownBy:b}=t._encoderConfig;R&&(a.maxBitrate=1e3*R),(te(p=t._hints).call(p,lt.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(y&&(a.maxFramerate=br(y)),b&&b>=1&&(a.scaleResolutionDownBy=b))}const{maxFramerate:_}=A("ENCODER_CONFIG_LIMIT");if(_&&typeof _=="number"&&(a.maxFramerate=a.maxFramerate?Math.min(a.maxFramerate,_):_),A("DSCP_TYPE")&&as()){var m;const R=A("DSCP_TYPE");te(m=["very-low","low","medium","high"]).call(m,R)&&(a.networkPriority=R)}const g=n.getParameters(),w=(i=g.encodings)===null||i===void 0?void 0:i[0];Nt()&&!w&&(s.encodings=[a]),w&&Object.assign(w,a),Object.assign(g,s),T.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(g.encodings))),await n.setParameters(g),await FM(this.store.codec,n,A("SVC_MODE"))}async updateAdaptation(t,n){var r,i;if(!t)return T.debug("[updateAdaptation] no rtpSender found");if(!qe().supportSetRtpSenderParameters)return T.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const s={},{bitrateMax:a,frameRate:d,scaleResolutionDownBy:l}=n;a&&(s.maxBitrate=1e3*a),d&&(s.maxFramerate=br(d)),l&&l>=1&&te(r=["vp8","vp9"]).call(r,this.store.codec)&&(s.scaleResolutionDownBy=l);const h=t.getParameters(),p=(i=h.encodings)===null||i===void 0?void 0:i[0];p&&Object.assign(p,s),Object.assign(h,{});try{await t.setParameters(h),T.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(h.encodings)))}catch(_){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?T.debug("[updateAdaptation] peerConnection not connected}"):T.debug("[updateAdaptation] updateRtpSenderEncodings failed",_):T.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,n){try{if(!qe().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const i=t[r],s=n[r];s instanceof Ct&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,i.sender)}}catch{T.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,r){const i=_r(t);return n.forEach((s,a)=>{const d=r[a],l=i.mediaDescriptions.find(h=>h.attributes.mid===d);l&&(Kc(l,s),ZR(l,s,this.store.codec))}),Fs(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let l=0;l<t.length;l++){var r,i,s,a,d;const h=t[l],p=n[l];if(p instanceof Ct&&!te(r=p._hints).call(r,lt.LOW_STREAM)&&(i=p._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=p._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(a=p._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((d=p._scalabilityMode)===null||d===void 0?void 0:d.numSpatialLayers)>1&&this.store.codec==="vp8"){const _={},m={high:1e3*(p._encoderConfig.bitrateMax-50),medium:5e4};_.encodings=[{rid:"m",active:!0,maxBitrate:m.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:m.high}];const g=h.sender.getParameters();await h.sender.setParameters(Object.assign(g,_))}}}async applySimulcastEncodings(t,n){if(!Nt()&&t.length===n.length)for(let r=0;r<t.length;r++){const i=n[r];if(i instanceof Ct&&this.isVP8Simulcast(i)){const s=t[r],a={},d={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};a.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:d.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:d.medium,scaleResolutionDownBy:4}];const l=s.sender.getParameters();await s.sender.setParameters(Object.assign(l,a))}}}isVP8Simulcast(t){var n,r,i,s,a;return!!(t instanceof Ct&&A("SIMULCAST")&&this.store.codec==="vp8"&&!te(n=t._hints).call(n,lt.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(s=t._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((a=t._scalabilityMode)===null||a===void 0?void 0:a.numSpatialLayers)>1)}logSDPExchange(t,n,r,i){if(A("SDP_LOGGING"))return T.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(n," SDP during NVConnectionExtension.").concat(i,`
`),t),n==="offer"?s=>{this.logSDPExchange(s,"answer",r==="local"?"remote":"local",i)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(t){if(qe().supportPCSetConfiguration){const n=$l.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}t.isPreallocation&&(this.isPreallocation=!0)}},ce(tt.prototype,"updateRemoteRTPCapabilities",[Dr],Object.getOwnPropertyDescriptor(tt.prototype,"updateRemoteRTPCapabilities"),tt.prototype),ce(tt.prototype,"connect",[Dr],Object.getOwnPropertyDescriptor(tt.prototype,"connect"),tt.prototype),ce(tt.prototype,"updateRemoteConnect",[Dr],Object.getOwnPropertyDescriptor(tt.prototype,"updateRemoteConnect"),tt.prototype),ce(tt.prototype,"createDataChannels",[Dr],Object.getOwnPropertyDescriptor(tt.prototype,"createDataChannels"),tt.prototype),ce(tt.prototype,"receive",[Dr],Object.getOwnPropertyDescriptor(tt.prototype,"receive"),tt.prototype),ce(tt.prototype,"batchReceive",[Dr],Object.getOwnPropertyDescriptor(tt.prototype,"batchReceive"),tt.prototype),ce(tt.prototype,"stopReceiving",[Dr],Object.getOwnPropertyDescriptor(tt.prototype,"stopReceiving"),tt.prototype),ce(tt.prototype,"muteRemote",[Dr],Object.getOwnPropertyDescriptor(tt.prototype,"muteRemote"),tt.prototype),ce(tt.prototype,"unmuteRemote",[Dr],Object.getOwnPropertyDescriptor(tt.prototype,"unmuteRemote"),tt.prototype),ce(tt.prototype,"muteLocal",[Dr],Object.getOwnPropertyDescriptor(tt.prototype,"muteLocal"),tt.prototype),ce(tt.prototype,"unmuteLocal",[Dr],Object.getOwnPropertyDescriptor(tt.prototype,"unmuteLocal"),tt.prototype),ce(tt.prototype,"close",[Dr],Object.getOwnPropertyDescriptor(tt.prototype,"close"),tt.prototype),ce(tt.prototype,"updateEncoderConfig",[Dr],Object.getOwnPropertyDescriptor(tt.prototype,"updateEncoderConfig"),tt.prototype),ce(tt.prototype,"updateSendParameters",[Dr],Object.getOwnPropertyDescriptor(tt.prototype,"updateSendParameters"),tt.prototype),ce(tt.prototype,"replaceTrack",[Dr],Object.getOwnPropertyDescriptor(tt.prototype,"replaceTrack"),tt.prototype),ce(tt.prototype,"updateAdaptation",[Dr],Object.getOwnPropertyDescriptor(tt.prototype,"updateAdaptation"),tt.prototype),ce(tt.prototype,"getRemoteSSRC",[Dr],Object.getOwnPropertyDescriptor(tt.prototype,"getRemoteSSRC"),tt.prototype),tt);function Dr(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("From NVConnectionExtension.".concat(t));try{for(var a=arguments.length,d=new Array(a),l=0;l<a;l++)d[l]=arguments[l];return await r.apply(this,d)}finally{s()}},n}var Et;function lV(e){var t,n,r,i=2;for(typeof Symbol<"u"&&(n=y_,r=Symbol.iterator);i--;){if(n&&(t=e[n])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new nE(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function nE(e){function t(n){if(Object(n)!==n)return ae.reject(new TypeError(n+" is not an object."));var r=n.done;return ae.resolve(n.value).then(function(i){return{value:i,done:r}})}return nE=function(n){this.s=n,this.n=n.next},nE.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?ae.resolve({value:n,done:!0}):t(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?ae.reject(n):t(r.apply(this.s,arguments))}},new nE(e)}let fee=(Et=class BE extends hm{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){return this._p2pConnection.localCodecs}constructor(t,n){super(t,n),I(this,"name","DataChannelConnection"),I(this,"store",void 0),I(this,"peerConnection",void 0),I(this,"cname",void 0),I(this,"mutex",new bn("DataChannelConnection-mutex")),I(this,"dataChannel",void 0),I(this,"_p2pConnection",void 0),I(this,"establishPromise",void 0),I(this,"_nvMedia",void 0),this.store=n,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(BE.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new pee(t,n,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}getPreMedia(t){var n;return(n=this._p2pConnection)===null||n===void 0?void 0:n.getPreMedia(t)}isPreSub(){var t,n;return(t=(n=this._p2pConnection)===null||n===void 0?void 0:n.isPreSub())!==null&&t!==void 0&&t}async establish(){return await this._p2pConnection.establish()}getP2PConnectionParams(){return this._p2pConnection.establishPromise}updateRtpSenderEncodings(t){return this._p2pConnection.updateRtpSenderEncodings(t)}async connect(t){return this.cname=t.cname,await this._p2pConnection.connect(t),await new ae((n,r)=>{const i=setTimeout(()=>{this.closeSignal(),r(new j(O.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(t.candidates))))},A("DC_CONNECTION_TIMEOUT"));this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(i),void n()},this.dataChannel.onerror=s=>{this.closeSignal(),r(s)},this.dataChannel.addEventListener("close",()=>{r(new j(O.DATACHANNEL_CONNECTION_TIMEOUT))})}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}async updateRemoteRTPCapabilities(t,n){return this._p2pConnection.updateRemoteRTPCapabilities(t,n)}send(t,n,r){var i=this;return yr(function*(){const s=yield He(i.mutex.lock("From DataChannelConnection.send"));try{return yield*cl(lV(i._p2pConnection.send(t,n,r)))}finally{s()}})()}async stopSending(t,n){return this._p2pConnection.stopSending(t,n)}async createDataChannels(t,n){return this._p2pConnection.createDataChannels(t,n)}async stopDataChannels(t){return this._p2pConnection.stopDataChannels(t)}async receive(t,n,r,i){return this._nvMedia?(T.debug("[DataChannelConnection] receive ".concat(t," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(t,n,this.cname)):(T.debug("[DataChannelConnection] receive ".concat(t," by WebRTC.")),await this._p2pConnection.receive(t,n,r,i))}async batchReceive(t){return[...await this._p2pConnection.batchReceive(t)]}async stopReceiving(t){return await this._p2pConnection.stopReceiving(t)}async muteRemote(t){return await this._p2pConnection.muteRemote(t)}async unmuteRemote(t){return await this._p2pConnection.unmuteRemote(t)}async muteLocal(t){return await this._p2pConnection.muteLocal(t)}async unmuteLocal(t){return await this._p2pConnection.unmuteLocal(t)}restartICE(t){var n=this;return yr(function*(){return yield*cl(lV(n._p2pConnection.restartICE(t)))})()}close(){var t;(t=this._nvMedia)===null||t===void 0||t.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(t){return this._p2pConnection.getRemoteVideoIsReady(t)}updateRemoteConnect(t){var n;return(n=this._nvMedia)===null||n===void 0||n.setRemoteRtpCapabilities(t),this._p2pConnection.updateRemoteConnect(t)}async updateEncoderConfig(t,n){return await this._p2pConnection.updateEncoderConfig(t,n)}async updateSendParameters(t,n){return await this._p2pConnection.updateSendParameters(t,n)}setStatsRemoteVideoIsReady(t,n){this._p2pConnection.setStatsRemoteVideoIsReady(t,n)}async replaceTrack(t,n){return await this._p2pConnection.replaceTrack(t,n)}async getRemoteSSRC(t){return this._p2pConnection.getRemoteSSRC(t)}logSDPExchange(t,n,r,i){if(A("SDP_LOGGING"))return T.upload("exchanging ".concat(r," ").concat(n," SDP during DataChannelConnection.").concat(i,`
`),t),n==="offer"?s=>{this.logSDPExchange(s,"answer",r==="local"?"remote":"local",i)}:void 0}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Ac(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...BE.turnServerConfigToIceServers(t.turnServer.servers)),A("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...BE.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),A("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),A("ENABLE_ENCODED_TRANSFORM")&&qe().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(co(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!A("FORCE_TURN_TCP")&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=t=>{var n;return(n=this.onICEConnectionStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onConnectionStateChange=t=>{var n;return(n=this.onConnectionStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onDTLSTransportStateChange=t=>{var n;return(n=this.onDTLSTransportStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onDTLSTransportError=t=>{var n;return(n=this.onDTLSTransportError)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onICETransportStateChange=t=>{var n;return(n=this.onICETransportStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstAudioReceived=t=>{var n;return(n=this.onFirstAudioReceived)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoReceived=t=>{var n;return(n=this.onFirstVideoReceived)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstAudioDecoded=t=>{var n;return(n=this.onFirstAudioDecoded)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoRender=t=>{var n;return(n=this.onFirstVideoRender)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoBufferReady=t=>{var n;return(n=this.onFirstVideoBufferReady)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoDecoded=(t,n,r)=>{var i;return(i=this.onFirstVideoDecoded)===null||i===void 0?void 0:i.call(this,t,n,r)},this._p2pConnection.onFirstVideoDecodedTimeout=t=>{var n;return(n=this.onFirstVideoDecodedTimeout)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onSelectedLocalCandidateChanged=(t,n)=>{var r;return(r=this.onSelectedLocalCandidateChanged)===null||r===void 0?void 0:r.call(this,t,n)},this._p2pConnection.onSelectedRemoteCandidateChanged=(t,n)=>{var r;return(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0?void 0:r.call(this,t,n)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0}setConfiguration(t){this._p2pConnection.setConfiguration(t)}},ce(Et.prototype,"connect",[Si],Object.getOwnPropertyDescriptor(Et.prototype,"connect"),Et.prototype),ce(Et.prototype,"updateRemoteRTPCapabilities",[Si],Object.getOwnPropertyDescriptor(Et.prototype,"updateRemoteRTPCapabilities"),Et.prototype),ce(Et.prototype,"createDataChannels",[Si],Object.getOwnPropertyDescriptor(Et.prototype,"createDataChannels"),Et.prototype),ce(Et.prototype,"receive",[Si],Object.getOwnPropertyDescriptor(Et.prototype,"receive"),Et.prototype),ce(Et.prototype,"stopReceiving",[Si],Object.getOwnPropertyDescriptor(Et.prototype,"stopReceiving"),Et.prototype),ce(Et.prototype,"muteRemote",[Si],Object.getOwnPropertyDescriptor(Et.prototype,"muteRemote"),Et.prototype),ce(Et.prototype,"unmuteRemote",[Si],Object.getOwnPropertyDescriptor(Et.prototype,"unmuteRemote"),Et.prototype),ce(Et.prototype,"muteLocal",[Si],Object.getOwnPropertyDescriptor(Et.prototype,"muteLocal"),Et.prototype),ce(Et.prototype,"unmuteLocal",[Si],Object.getOwnPropertyDescriptor(Et.prototype,"unmuteLocal"),Et.prototype),ce(Et.prototype,"close",[Si],Object.getOwnPropertyDescriptor(Et.prototype,"close"),Et.prototype),ce(Et.prototype,"updateEncoderConfig",[Si],Object.getOwnPropertyDescriptor(Et.prototype,"updateEncoderConfig"),Et.prototype),ce(Et.prototype,"updateSendParameters",[Si],Object.getOwnPropertyDescriptor(Et.prototype,"updateSendParameters"),Et.prototype),ce(Et.prototype,"replaceTrack",[Si],Object.getOwnPropertyDescriptor(Et.prototype,"replaceTrack"),Et.prototype),ce(Et.prototype,"getRemoteSSRC",[Si],Object.getOwnPropertyDescriptor(Et.prototype,"getRemoteSSRC"),Et.prototype),Et);function Si(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("From DataChannelConnection.".concat(t));try{for(var a=arguments.length,d=new Array(a),l=0;l<a;l++)d[l]=arguments[l];return await r.apply(this,d)}finally{s()}},n}function uV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}class _ee extends Vt{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var n;te(n=["tryNext","recover"]).call(n,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(mn.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(mn.CONNECTED):this._state==="closed"?this.emit(mn.CLOSED):this._state==="failed"&&this.emit(mn.FAILED))}constructor(t,n,r,i){super(),I(this,"connectionID",0),I(this,"currentURLIndex",0),I(this,"reconnectReason",void 0),I(this,"_reconnectMode","tryNext"),I(this,"_initMutex",void 0),I(this,"_name",void 0),I(this,"_state","closed"),I(this,"_reconnectInterrupter",void 0),I(this,"_url",void 0),I(this,"_retryConfig",void 0),I(this,"_reconnectCount",0),I(this,"_forceCloseTimeout",5e3),I(this,"_onlineReconnectListener",void 0),I(this,"_closeEstablishingTransmitter",()=>{}),I(this,"_store",void 0),I(this,"_joinChannelServiceRecordIndex",void 0),I(this,"_transmitter",void 0),I(this,"_useCompress",void 0),I(this,"_inflateLength",0),I(this,"_deflateLength",0),this._store=i,this._name=t,this._retryConfig=function(s){for(var a=1;a<arguments.length;a++){var d=arguments[a]!=null?arguments[a]:{};a%2?uV(Object(d),!0).forEach(function(l){I(s,l,d[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(d)):uV(Object(d)).forEach(function(l){Object.defineProperty(s,l,Object.getOwnPropertyDescriptor(d,l))})}return s}({},n),this._useCompress=r}resetReconnectCount(t){T.debug("".concat(this._name," reset reconnect count, reason: ").concat(t)),this._reconnectCount=0}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const r=this._transmitter;n?setTimeout(()=>r.close(),500):r.close(),this._transmitter=void 0}this.state=t?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(t,n){if(!this._transmitter)return void T.warning("[".concat(this._name,"] can not reconnect, no websocket"));var r;t!==void 0&&(this.reconnectMode=t),T.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((r=this._store)===null||r===void 0||r.recordJoinChannelService({status:"error",errors:[new Error(n)]},this._joinChannelServiceRecordIndex));const i=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),i&&i.bind(this._transmitter)({code:9999,reason:n})}getInflateData(){const t=this._inflateLength,n=this._deflateLength;return this.clearInflateData(),{inflateLength:t,deflateLength:n}}setInflateData(t){this._deflateLength=this._deflateLength+t.originLength,this._inflateLength=this._inflateLength+t.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}let Wo=function(e){return e[e.Default=0]="Default",e[e.Ack=1]="Ack",e}({});class mee{constructor(t,n,r){I(this,"version",1),I(this,"initialRTO",void 0),I(this,"maxBatchAckCount",void 0),I(this,"maxRTO",void 0),I(this,"initialRTT",void 0),I(this,"ID",void 0),I(this,"rtt",void 0),I(this,"packetNumber",1),I(this,"rtoRatioMap",new Map),I(this,"timeoutMap",new Map),I(this,"unorderedPacketQueue",[]),I(this,"batchAckPacketQueue",[]),I(this,"lastOrderedPacketNumber",0),I(this,"batchAckTimer",void 0),I(this,"sendImpl",void 0),I(this,"receiveImpl",void 0),this.sendImpl=t,this.receiveImpl=n,this.ID=ht(7,"transmitter-"),this.initialRTO=(r==null?void 0:r.initialRTO)!==void 0?r.initialRTO:A("TRANSMITTER_INITIAL_RTO"),this.initialRTT=(r==null?void 0:r.initialRTT)!==void 0?r.initialRTT:A("TRANSMITTER_INITIAL_RTT"),this.rtt=(r==null?void 0:r.initialRTT)!==void 0?r.initialRTT:A("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=(r==null?void 0:r.maxBatchAckCount)!==void 0?r.maxBatchAckCount:A("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=(r==null?void 0:r.maxRTO)!==void 0?r.maxRTO:A("TRANSMITTER_MAX_RTO")}packetize(t,n){return{type:Wo.Default,version:this.version,packetNumber:n,payload:t}}serialize(t){switch(t.type){case Wo.Default:{let n;typeof t.payload=="string"?n=new TextEncoder().encode(t.payload):n=t.payload;const r=new ArrayBuffer(n.length+15),i=new DataView(r);return i.setUint16(0,t.version),i.setUint8(2,t.type),i.setUint32(3,t.packetNumber),lL(i,7,BigInt(t.sendTs)),new Uint8Array(i.buffer).set(n,15),r}case Wo.Ack:{const n=new ArrayBuffer(16),r=new DataView(n);return r.setUint16(0,t.version),r.setUint8(2,t.type),r.setUint32(3,t.maxAckPacketNumber),r.setUint8(7,t.shift),lL(r,8,BigInt(t.ackSendTs)),n}}}deserialize(t){const n=new DataView(t),r=n.getUint16(0),i=n.getUint8(2);switch(i){case Wo.Default:{const s=n.getUint32(3),a=dL(n,7),d=t.slice(15),l=new Uint8Array(d);return{version:r,type:i,packetNumber:s,sendTs:Number(a),payload:l}}case Wo.Ack:{const s=n.getUint32(3),a=n.getUint8(7),d=dL(n,8);return{version:r,type:i,maxAckPacketNumber:s,shift:a,ackSendTs:Number(d)}}default:throw T.error("[".concat(this.ID,"] Unrecognized packet type ").concat(i)),new Error("Unrecognized packet type ".concat(i))}}sendMessage(t){A("DC_DEBUG_LOG")&&typeof t=="string"&&T.debug("[".concat(this.ID,"] sending message packet"),JSON.parse(t));const n=this.packetize(t,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;const r=this.calculateRTO(n),i=window.setTimeout(()=>{this.resendMessage(n)},r);this.timeoutMap.set(n.packetNumber,i),this.sendPacket(n)}onData(t){const n=this.deserialize(t);n.type===Wo.Default?this.ack(n):n.type===Wo.Ack&&(this.updateRTT(n,Math.round(performance.now())),this.clearRTO(n))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(t=>{let[n,r]=t;window.clearTimeout(r)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(t){const n=this.calculateRTO(t),r=window.setTimeout(()=>{A("DC_DEBUG_LOG")&&typeof t.payload=="string"&&T.debug("[".concat(this.ID,"] resending message packet"),JSON.parse(t.payload),"timeout: ".concat(n)),this.resendMessage(t)},n);this.timeoutMap.set(t.packetNumber,r),this.sendPacket(t)}calculateRTO(t){const n=this.rtoRatioMap.get(t.packetNumber);if(n===void 0)return this.rtoRatioMap.set(t.packetNumber,1),this.initialRTO;{const r=9*this.rtt/8*n;return this.rtoRatioMap.set(t.packetNumber,n+1),r>this.maxRTO?this.maxRTO:r}}updateRTT(t,n){const r=t.ackSendTs;this.rtt=this.rtt*(7/8)+(n-r-this.rtt)/8}ack(t){if(t.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(t):(this.batchAckPacketQueue.push(t),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(t.payload);;){const n=this.unorderedPacketQueue[0];if(!n){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(n.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(t.packetNumber<=this.lastOrderedPacketNumber){const n={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:Wo.Ack,version:this.version};A("DC_DEBUG_LOG")&&T.debug("[".concat(this.ID,"] sending ack packet"),n,"packetNumber: ".concat(t.packetNumber)),this.sendPacket(n)}else if(t.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[t.packetNumber-this.lastOrderedPacketNumber-2]=t;const n={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:Wo.Ack,version:this.version};A("DC_DEBUG_LOG")&&T.debug("[".concat(this.ID,"] sending ack packet"),n,"packetNumber: ".concat(t.packetNumber)),this.sendPacket(n)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const t={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:Wo.Ack,version:this.version};A("DC_DEBUG_LOG")&&T.debug("[".concat(this.ID,"] sending batch ack packet"),t,"shift: ".concat(this.batchAckPacketQueue.length-1)),this.sendPacket(t),this.batchAckPacketQueue=[]}sendPacket(t){t.type===Wo.Default&&(t.sendTs=Math.round(performance.now()));const n=this.serialize(t);this.sendImpl(n)}clearRTO(t){for(let n=t.maxAckPacketNumber-t.shift;n<=t.maxAckPacketNumber;n++){const r=this.timeoutMap.get(n);r!==void 0&&window.clearTimeout(r),this.timeoutMap.delete(n),this.rtoRatioMap.delete(n)}}}class hV extends _ee{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),I(this,"_initMutex",void 0),I(this,"_reconnectInterrupter",void 0),I(this,"_url",void 0),I(this,"_transmitter",void 0),I(this,"_addresses",void 0),I(this,"_reliableTransmission",void 0),I(this,"_textEncoder",void 0),I(this,"_textDecoder",void 0),this._textEncoder=new TextEncoder,this._textDecoder=new TextDecoder,this._initMutex=new bn("datachannel");const{timeout:r,timeoutFactor:i}=n,s=Math.max(300,Math.floor(3*r/5)),a=Math.max(1.2,Math.floor(8*i)/10);fr.ONLINE&&(this._retryConfig.timeout=s,this._retryConfig.timeoutFactor=a),Ht.on(bc.NETWORK_STATE_CHANGE,(d,l)=>{d!==l&&(this.resetReconnectCount("network state change: ".concat(l," -> ").concat(d)),d===fr.ONLINE?(this._retryConfig.timeout=s,this._retryConfig.timeoutFactor=a):(this._retryConfig.timeout=r,this._retryConfig.timeoutFactor=i))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=n;const r=(i,s)=>{this._addresses=t,this.currentURLIndex=this._addresses.findIndex(d=>d.fingerprint||A("FINGERPRINT"));const a=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(a).then(i).catch(s),this.once(mn.CLOSED,()=>s(new j(O.WS_DISCONNECT))),this.once(mn.CONNECTED,()=>i())};return this._initMutex.lock().then(i=>new ae((s,a)=>{r(s,a)}).then(()=>{i()}).catch(()=>{i()}))}async sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new j(O.WS_ABORT,"datachannel is not ready");try{n||(t=JSON.stringify(t));const r=this._textEncoder.encode(t),i=b$(r,{raw:!0});this._reliableTransmission.sendMessage(i)}catch(r){throw new j(O.WS_ERR,"send datachannel signal message error"+r.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(t){const n=JSON.stringify(t);return{compressed:n,compressedLength:n.length,origin:t}}sendMessageWithUint8Array(t){return{compressed:t,compressedLength:t.byteLength,origin:t}}createTransmitterConnection(t){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(t.ip,":").concat(t.port),new ae((n,r)=>{var i;const s=()=>{T.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="recover",this.state="connected",this.resetReconnectCount("opened"),n()},a=async p=>{var _;if((_=this._closeEstablishingTransmitter)===null||_===void 0||_.call(this),T.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(p.code,", reason: ").concat(p.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=p.reason,this.state="reconnecting");const m=Zr(this,mn.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,g=await this.reconnectWithAction(m);if(this.state==="closed")return void T.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!g)return r(new j(O.WS_DISCONNECT,"datachannel reconnect failed: ".concat(p.code))),void this.close(!0);n()}else r(new j(O.WS_DISCONNECT,"datachannel close: ".concat(p.code))),this.close()},d=async p=>{try{var _;(_=this._reliableTransmission)===null||_===void 0||_.onData(p.data)}catch(m){console.log(m)}};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),T.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(t)));const l=(i=this._store)===null||i===void 0?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),h=Date.now();dn(this,mn.TO_CONNECT_DATACHANNEL).then(p=>{var _,m;if(!p)throw new Error("transmissonInfo not exist yet");const{transmitter:g,close:w}=p;this._transmitter=g,(_=this._store)===null||_===void 0||_.signalChannelOpen();const R=Date.now()-h;T.debug("[choose dc] dc open cost ".concat(R,"ms")),this._reliableTransmission=new mee(y=>{var b;this._transmitter&&this._transmitter.readyState==="open"&&((b=this._transmitter)===null||b===void 0||b.send(y))},y=>{if(typeof y=="string")this.emit(mn.ON_MESSAGE,y);else{const b=N$(y,{raw:!0}).buffer,N=this._textDecoder.decode(b);this.emit(mn.ON_MESSAGE,N)}}),this._closeEstablishingTransmitter=()=>{var y;(y=this._reliableTransmission)===null||y===void 0||y.close(),this._reliableTransmission=void 0,w()},s&&s(),g.onclose=a,g.onmessage=d,(m=this._store)===null||m===void 0||m.recordJoinChannelService({endTs:Date.now(),status:"success"},l),this._joinChannelServiceRecordIndex=l}).catch(p=>{var _;if((_=this._store)===null||_===void 0||_.recordJoinChannelService({endTs:Date.now(),status:p instanceof j&&p.code===O.WS_ABORT?"aborted":"error",errors:[p]},l),this.state!=="closed"){if(p instanceof j&&p.code===O.WS_ERR){const m=new j(O.WS_ERR,"init datachannel failed! Error: ".concat(p.toString()));return T.error("[".concat(this._name,"]").concat(m)),void r(m)}a&&a(p)}else r(new j(O.WS_DISCONNECT,"datachannel is closed: ".concat(p.toString())))})})}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||Ht.networkState!==fr.OFFLINE||(this._onlineReconnectListener=Ht.onlineWaiter&&Ht.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let r=!0;if(this._reconnectInterrupter=()=>{r=!1},n){const d=U_(this._reconnectCount,this._retryConfig);T.debug("[".concat(this._name,"] wait ").concat(d,"ms to reconnect datachannel, mode: ").concat(t)),await ae.race([Tn(d),this._onlineReconnectListener||new ae(()=>{})])}if(this.state==="closed"||!r)return!1;this._reconnectCount+=1;const i=async(d,l)=>{this.emit(mn.RECONNECT_CREATE_CONNECTION,l),await this.createTransmitterConnection(d)};try{if(t==="retry"){const d=this._addresses[this.currentURLIndex];await i(d,t)}else if(t==="tryNext"){this.currentURLIndex+=1;for(let l=this.currentURLIndex;l<this._addresses.length;l++){if(this._addresses[l].fingerprint||A("FINGERPRINT")){this.currentURLIndex=l;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return T.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);T.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const d=this._addresses[this.currentURLIndex];await i(d,t)}else t==="recover"&&(T.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(mn.FAILBACK));return!0}catch(d){var s,a;return T.error("[".concat(this._name,"] reconnect failed"),d.toString()),d!=null&&(s=d.data)!==null&&s!==void 0&&s.desc&&Array.isArray(d.data.desc)&&d.data.desc.length&&te(a=d.data.desc).call(a,"dynamic key expired")?(this.emit(mn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(t,n)}}}class Eee extends Vt{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Ze.CONNECTED?this.emit(ve.WS_CONNECTED):t===Ze.RECONNECTING?this.emit(ve.WS_RECONNECTING,this._websocketReconnectReason):t===Ze.CLOSED&&this.emit(ve.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}processPendingNotifications(){this.pendingNotifications.length!==0&&(T.debug("[".concat(this.clientId,"] processing ").concat(this.pendingNotifications.length," pending notifications")),this.pendingNotifications.forEach(t=>{let{type:n,message:r}=t;this.emit(n,r),n===Me.ON_NOTIFICATION&&this.handleNotification(r),n===Me.ON_USER_BANNED&&this.handleUserBanned(r)}),this.pendingNotifications=[])}handleUserBanned(t){switch(t.error_code){case 14:this.close(Qe.UID_BANNED);break;case 15:this.close(Qe.IP_BANNED);break;case 16:this.close(Qe.CHANNEL_BANNED)}}constructor(t,n){super(),I(this,"__name__","DataChannelSignal"),I(this,"_disconnectedReason",void 0),I(this,"_websocketReconnectReason",void 0),I(this,"_connectionState",Ze.CLOSED),I(this,"reconnectToken",void 0),I(this,"websocket",void 0),I(this,"openConnectionTime",void 0),I(this,"clientId",void 0),I(this,"lastMsgTime",Date.now()),I(this,"uploadCache",[]),I(this,"uploadCacheInterval",void 0),I(this,"rttRolling",new Qv(5)),I(this,"pingpongTimer",void 0),I(this,"inflateDataTimer",void 0),I(this,"pingpongTimeoutCount",0),I(this,"ortc",void 0),I(this,"joinResponse",void 0),I(this,"multiIpOption",void 0),I(this,"initError",void 0),I(this,"spec",void 0),I(this,"store",void 0),I(this,"isJoining",!1),I(this,"pendingNotifications",[]),I(this,"onWebsocketMessage",r=>{if(r instanceof ArrayBuffer)return void this.emit(ve.ON_BINARY_DATA,r);const i=JSON.parse(r);if(A("DC_DEBUG_LOG")&&T.debug("[datachannel-signal] received packet",i),this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const s="res-@".concat(i._id);this.emit(s,i._result,i._message)}else Object.prototype.hasOwnProperty.call(i,"_type")&&(this.isJoining?i._type===Me.ON_NOTIFICATION||i._type===Me.ON_USER_BANNED?(this.emit(i._type,i._message),i._type===Me.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===Me.ON_USER_BANNED&&this.handleUserBanned(i._message)):(this.pendingNotifications.push({type:i._type,message:i._message}),T.debug("[".concat(this.clientId,"] cached notification during join: ").concat(i._type))):(this.emit(i._type,i._message),i._type===Me.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===Me.ON_USER_BANNED&&this.handleUserBanned(i._message)))}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new hV("gateway-".concat(this.clientId),this.spec.retryConfig,!0,n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Ze.CONNECTED&&this.reconnect("retry",Ia.OFFLINE)})}async request(t,n,r,i){const s=ht(6,""),a={_id:s,_type:t,_message:n},d=this.websocket.connectionID,l=()=>new ae((w,R)=>{if(this.connectionState===Ze.CONNECTED)return w();const y=()=>{this.off(ve.WS_CLOSED,b),w()},b=()=>{this.off(ve.WS_CONNECTED,y),R(new j(O.WS_ABORT))};this.once(ve.WS_CONNECTED,y),this.once(ve.WS_CLOSED,b),t!==ye.PUBLISH&&t!==ye.SUBSCRIBE&&t!==ye.UNSUBSCRIBE&&t!==ye.UNPUBLISH&&t!==ye.CONTROL&&t!==ye.RESTART_ICE||this.once(ve.DISCONNECT_P2P,()=>{R(new j(O.DISCONNECT_P2P))}),t!==ye.PUBLISH&&t!==ye.RESTART_ICE||this.once(ve.ABORT_P2P_EXECUTION,()=>{R(new j(O.DISCONNECT_P2P))})});if(this.connectionState!==Ze.CONNECTING&&this.connectionState!==Ze.RECONNECTING||t===ye.JOIN||t===ye.REJOIN||await l(),t===ye.LEAVE&&(this.websocket.unbindDcCloseEventListener(),i=!0),A("DC_DEBUG_LOG")&&T.debug("[datachannel-signal] sendMessage",a),await this.websocket.sendMessage(a,!0,!1),i)return;const h=new ae((w,R)=>{let y=!1;const b=(L,x)=>{y=!0,w({isSuccess:L==="success",message:x||{}}),this.off(ve.WS_CLOSED,N),this.off(ve.WS_RECONNECTING,N),this.emit(ve.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(s),b);const N=()=>{R(new j(O.WS_ABORT,"type: ".concat(t))),this.off(ve.WS_CLOSED,N),this.off(ve.WS_RECONNECTING,N),this.off("res-@".concat(s),b)};this.once(ve.WS_CLOSED,N),this.once(ve.WS_RECONNECTING,N),Tn(A("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==d||y||(T.warning("dc request timeout, type: ".concat(t)),this.emit(ve.REQUEST_TIMEOUT,t,n))})});let p=null;try{p=await h}catch(w){if(this.connectionState===Ze.CLOSED||t===ye.LEAVE)throw new j(O.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?w.throw():t===ye.JOIN||t===ye.REJOIN?null:(await l(),await this.request(t,n))}if(p.isSuccess)return p.message;const _=Number(p.message.error_code||p.message.code),m=Hc(_),g=new j(O.UNEXPECTED_RESPONSE,"".concat(m.desc,": ").concat(p.message.error_str),{code:_,data:p.message});return m.action==="success"?p.message:(T.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(_,", message: ").concat(m.desc,", action: ").concat(m.action)),_===Ie.ERR_TOO_MANY_BROADCASTERS?((t===ye.JOIN||t===ye.REJOIN)&&(this.initError=g,this.close()),g.throw()):m.action==="failed"?g.throw():m.action==="quit"?(this.initError=g,this.close(),g.throw()):(_===Ie.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=p.message.option,T.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Ia.MULTI_IP)):this.reconnect(m.action,Ia.SERVER_ERROR),t===ye.JOIN||t===ye.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new ae(r=>{const i=s=>{(!n||n(s))&&(this.off(t,i),r(s))};this.on(t,i)})}uploadWRTCStats(t){if(!this.store.sessionId)return void T.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Wc.WRTC_STATS,n)}upload(t,n){const r={_type:t,_message:n};try{this.websocket.sendMessage(r)}catch{const s=A("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Ze.CONNECTED)return;const a=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(a._type,a._message)},A("UPLOAD_CACHE_INTERVAL")||2e3))}}async send(t,n){const r={_type:t,_message:n};await this.websocket.sendMessage(r)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ae((n,r)=>{this.once(ve.WS_CONNECTED,()=>n(this.joinResponse)),this.once(ve.WS_CLOSED,()=>r(this.initError||new j(O.WS_ABORT))),this.connectionState=Ze.CONNECTING,this.websocket.init(t).catch(r),this.websocket.once(mn.FAILBACK,()=>{r(new j(O.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{this.openConnectionTime===void 0&&(T.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),r(new j(O.INIT_DATACHANNEL_TIMEOUT)))},A("DC_JOIN_WITH_FAILBACK"))})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this.isJoining=!1,this.pendingNotifications=[],this._disconnectedReason=t||Qe.LEAVE,this.connectionState=Ze.CLOSED,T.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),t===Qe.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new hV("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),A("DC_PINGPONG_INTERVAL")),!this.joinResponse){this.emit(ve.ABORT_P2P_EXECUTION),this.store.signalConnected();const t=await dn(this,ve.REQUEST_JOIN_INFO);this.store.joinReq(),this.isJoining=!0,this.pendingNotifications=[];const n=await this.request(ye.JOIN,t);if(this.store.joinRep(),this.ortc=t==null?void 0:t.ortc,!n)return this.emit(ve.REPORT_JOIN_GATEWAY,O.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(ve.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Ze.CONNECTED,this.isJoining=!1,this.processPendingNotifications(),!0}async rejoin(){if(!this.reconnectToken)throw new j(O.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=Oc(this,ve.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(ye.REJOIN,t);return!!n&&(this.connectionState=Ze.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),A("DC_PINGPONG_INTERVAL")),n.peers&&n.peers.forEach(r=>{this.emit(Me.ON_USER_ONLINE,{uid:r.uid}),r.audio&&this.emit(Me.ON_ADD_AUDIO_STREAM,{uid:r.uid,uint_id:r.uint_id,audio:!0,ssrcId:r.audio_ssrc}),r.video&&this.emit(Me.ON_ADD_VIDEO_STREAM,{uid:r.uid,uint_id:r.uint_id,video:!0,ssrcId:r.video_ssrc}),r.audio_mute?this.emit(Me.MUTE_AUDIO,{uid:r.uid}):this.emit(Me.UNMUTE_AUDIO,{uid:r.uid}),r.video_mute?this.emit(Me.MUTE_VIDEO,{uid:r.uid}):this.emit(Me.UNMUTE_VIDEO,{uid:r.uid}),r.audio_enable_local?this.emit(Me.ENABLE_LOCAL_AUDIO,{uid:r.uid}):this.emit(Me.DISABLE_LOCAL_AUDIO,{uid:r.uid}),r.video_enable_local?this.emit(Me.ENABLE_LOCAL_VIDEO,{uid:r.uid}):this.emit(Me.DISABLE_LOCAL_VIDEO,{uid:r.uid}),r.audio||r.video||this.emit(Me.ON_REMOVE_STREAM,{uid:r.uid,uint_id:r.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}async downgradeCodec(t){if(!this.ortc)return!1;const n={downgrade_codec:t,ortc:this.ortc};return!!await this.request(ye.DOWNGRADE_CODEC,n)}handleNotification(t){T.debug("[".concat(this.clientId,"] receive notification: "),t);const n=Hc(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Qe.UID_BANNED),void this.close()):void this.reconnect(n.action,Ia.SERVER_ERROR);T.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1,A("DC_DEBUG_LOG")&&console.debug("[datachannel-signal] pingpongTimeoutCount: ".concat(this.pingpongTimeoutCount));const t=A("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(T.warning("[datachannel-signal] PINGPONG Timeout. Last Socket Message: ".concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>A("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("recover",Ia.FALLBACK):this.request(ye.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-n;this.rttRolling.add(r),A("REPORT_STATS")&&this.send(ye.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleInflateData(){const{inflateLength:t,deflateLength:n}=this.websocket.getInflateData();t!==0&&n!==0&&this.upload(Wc.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(mn.RECONNECT_CREATE_CONNECTION,t=>{this.emit(ve.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(mn.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(mn.CLOSED,()=>{this.connectionState=Ze.CLOSED}),this.websocket.on(mn.FAILED,()=>{this._disconnectedReason=Qe.NETWORK_ERROR,this.connectionState=Ze.CLOSED}),this.websocket.on(mn.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Ze.CONNECTED?this.connectionState=Ze.RECONNECTING:this.connectionState=Ze.CONNECTING}),this.websocket.on(mn.WILL_RECONNECT,(t,n)=>{if(Oc(this,ve.IS_P2P_DISCONNECTED)&&t==="retry")return T.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(ve.NEED_RENEW_SESSION),this.emit(ve.DISCONNECT_P2P),n("tryNext");t!=="retry"&&(T.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(ve.NEED_RENEW_SESSION),this.emit(ve.DISCONNECT_P2P)),n(t)}),this.websocket.on(mn.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{T.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",Ia.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(ve.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof j&&t.code===O.UNEXPECTED_RESPONSE&&t.data.code===Ie.ERR_NO_AUTHORIZED)return T.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Ia.SERVER_ERROR);T.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Ia.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(mn.REQUEST_NEW_URLS,(t,n)=>{dn(this,ve.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(mn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Me.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(mn.TO_CONNECT_DATACHANNEL,(t,n)=>{dn(this,ve.PRE_CONNECT_PC).then(t).catch(n)}),this.websocket.on(mn.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(ve.DATACHANNEL_FAILBACK)})}}const gee={name:"DataChannelConnection",create:function(e){let{store:t,spec:n}=e;return new fee(n,t)}},See={name:"DataChannelSignal",create:function(e){let{store:t,spec:n}=e;return new Eee(n,t)}};rR(),St("PROCESS_ID","process-".concat(ht(8,""),"-").concat(ht(4,""),"-").concat(ht(4,""),"-").concat(ht(4,""),"-").concat(ht(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void T.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();T.debug("Loading global parameters from cache",t),Object.keys(t).forEach(r=>{if(Object.prototype.hasOwnProperty.call(pt,r)){const{value:i,expires:s}=t[r];if(s&&s<=n)return;li[r]=i,pt[r]=i}})}catch(t){T.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(li.AREAS)&&li.AREAS.length>0&&iy(li.AREAS,!0);const pV=(e,t,n)=>{T.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),St(e,t,n)};fs(M$,!1),fs(V$,!1),fs(fZ,!1),fs(X$,!1),fs(P$,!1),fs(aee,!1),fs(lee,!1),fs(hee,!1),fs(gee,!1),fs(See,!1);const ln=function(e){const t=new Vt,n=e,r={getListeners:t.getListeners.bind(t),on:(i,s)=>(function(a,d){a===us.SECURITY_POLICY_VIOLATION&&j2(d,!0)}(i,s),t.on.bind(t)(i,s)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return B2(B2({},n),r)}({__TRACK_LIST__:Mc,VERSION:Di,BUILD:sR,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:pV,getParameter:A,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const n=await async function(r){let i;return qe().supportUnifiedPlan?(r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"}),i=(await r.createOffer()).sdp):i=(await r.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,i}(t);if(!n)return e;t.close(),t=null,e=function(r){const i={video:[],audio:[]};return r.match(/ VP8/i)&&i.video.push("VP8"),r.match(/ VP9/i)&&i.video.push("VP9"),r.match(/ AV1/i)&&i.video.push("AV1"),r.match(/ H264/i)&&i.video.push("H264"),r.match(/ H265/i)&&i.video.push("H265"),r.match(/ opus/i)&&i.audio.push("OPUS"),r.match(/ PCMU/i)&&i.audio.push("PCMU"),r.match(/ PCMA/i)&&i.audio.push("PCMA"),r.match(/ G722/i)&&i.audio.push("G722"),i}(n)}catch(t){throw new j(O.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];const t=Se.reportApiInvoke(null,{name:kt.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:yt.TRACER}),n=function(){let s=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0],a=!1;try{const d=window.RTCPeerConnection,l=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,h=window.WebSocket;a=!(!d||!h),s&&!l&&(a=!1),a&&_h()&&ZP(75)&&new d().close()}catch(d){T.error("check system requirement failed: ",d),a=!1}return a}(e),r=mZ();T.debug("checkSystemRequirements, api:",n,"browser",r);const i=n&&r;return t.onSuccess(i),A("IGNORE_RTC_DEVICE_CHECK")?n:i},getDevices:function(e){return _i.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return _i.getRecordingDevices(e)},getCameras:function(e){return _i.getCamerasDevices(e)},getElectronScreenSources:rk,getPlaybackDevices:function(e){return _i.getSpeakers(e)},createClient:x2,createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=A("CAMERA_CAPTURE_CONFIG"),n=ht(8,"track-cam-"),r=Se.reportApiInvoke(null,{id:n,tag:yt.TRACER,name:kt.CREATE_CAM_VIDEO_TRACK,options:[Ot({},e),t]});t&&(e.encoderConfig=t);const i=X_(e);let s=null;T.info("start create camera video track with config",JSON.stringify(e),"trackId",n);try{s=(await fi({video:i},n)).getVideoTracks()[0]||null}catch(d){throw r.onError(d),d}if(!s){const d=new Y(O.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(d),d.throw(T)}if(e.optimizationMode&&IR(n,s,e,oo(e.encoderConfig)),A("USE_STANDARD_BITRATE_DEFAULT")){const d=oo(e.encoderConfig);e.encoderConfig=d,delete d.bitrateMax,delete d.bitrateMin}const a=new Q_(s,e,i,e.scalabiltyMode?K_(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n);return r.onSuccess(a.getTrackId()),T.info("create camera video success, trackId:",n),a},createCustomVideoTrack:function(e){const t=ht(8,"track-cus-"),n=Se.reportApiInvoke(null,{id:t,tag:yt.TRACER,name:kt.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});A("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);const r=new Ct(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?K_(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[lt.CUSTOM_TRACK]);return n.onSuccess(r.getTrackId()),T.info("create custom video track success with config",e,"trackId",r.getTrackId()),r},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=typeof t=="object"?function(m){const g=pk(m);return YL()&&m.suppressLocalAudioPlayback&&(g.suppressLocalAudioPlayback=m.suppressLocalAudioPlayback),zL()&&m.restrictOwnAudio&&(g.restrictOwnAudio=!0),g}(t):void 0;n&&(t="auto");const r=ht(8,"track-scr-v-"),i=Se.reportApiInvoke(null,{id:r,tag:yt.TRACER,name:kt.CREATE_SCREEN_VIDEO_TRACK,options:[Ot({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const s=function(m){const g={};m.screenSourceType&&(g.mediaSource=m.screenSourceType),m.extensionId&&xs()&&(g.extensionId=m.extensionId);const{displaySurface:w,selfBrowserSurface:R,surfaceSwitching:y,systemAudio:b,preferCurrentTab:N,windowAudio:L,monitorTypeSurfaces:x}=m;(No(107)||Ta(107)||wc(93))&&(w&&(tn(w,"displaySurface",["browser","window","monitor"]),g.displaySurface=w),R?(tn(R,"selfBrowserSurface",["exclude","include"]),g.selfBrowserSurface=R):g.selfBrowserSurface="include",y&&(tn(y,"surfaceSwitching",["exclude","include"]),g.surfaceSwitching=y)),(No(105)||Ta(105)||wc(91))&&b&&(tn(b,"systemAudio",["exclude","include"]),g.systemAudio=b),(No(94)||Ta(94)||wc(80))&&N&&(g.preferCurrentTab=!0),(No(141)||Ta(141)||wc(125))&&L&&(tn(L,"windowAudio",["exclude","system"]),g.windowAudio=L),(No(119)||Ta(119)||wc(105))&&x&&(tn(x,"monitorTypeSurfaces",["exclude","include"]),g.monitorTypeSurfaces=x),m.electronScreenSourceId&&(g.sourceId=m.electronScreenSourceId);const F=m.encoderConfig?hR(m.encoderConfig):null;return g.mandatory={chromeMediaSource:"desktop",maxWidth:F?F.width:void 0,maxHeight:F?F.height:void 0},F&&(F.frameRate&&(typeof F.frameRate=="number"?(g.mandatory.maxFrameRate=F.frameRate,g.mandatory.minFrameRate=F.frameRate):(g.mandatory.maxFrameRate=F.frameRate.max||F.frameRate.ideal||F.frameRate.exact||void 0,g.mandatory.minFrameRate=F.frameRate.min||F.frameRate.ideal||F.frameRate.exact||void 0),g.frameRate=F.frameRate),F.width&&(g.width=F.width),F.height&&(g.height=F.height)),g}(e);let a=null,d=null;const l=qe();if(!l.supportShareAudio&&t==="enable"){const m=new Y(O.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return i.onError(m),m.throw(T)}T.info("start create screen video track with config",e,"withAudio",t,"trackId",r);const h=l.supportShareAudio&&t!=="disable";try{const m=await fi({screen:s,screenAudio:h?n||!0:void 0},r);a=m.getVideoTracks()[0]||null,d=m.getAudioTracks()[0]||null}catch(m){throw i.onError(m),m}if(!a){const m=new Y(O.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(m),m.throw(T)}if(!d&&t==="enable"){a&&a.stop();const m=new Y(O.SHARE_AUDIO_NOT_ALLOWED);return i.onError(m),m.throw(T)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(IR(r,a,e,e.encoderConfig&&hR(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const p=new Ct(a,e.encoderConfig?hR(e.encoderConfig):{},e.scalabiltyMode?K_(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r,[lt.SCREEN_TRACK]);if(!d)return i.onSuccess(p.getTrackId()),T.info("create screen video track success","video:",p.getTrackId()),p;const _=new Xt(d,void 0,ht(8,"track-scr-a-"),!1);return i.onSuccess([p.getTrackId(),_.getTrackId()]),T.info("create screen video track success","video:",p.getTrackId(),"audio:",_.getTrackId()),[p,_]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=A("CAMERA_CAPTURE_CONFIG"),r=ht(8,"track-mic-"),i=ht(8,"track-cam-"),s=Se.reportApiInvoke(null,{id:"".concat(r,"-").concat(i),tag:yt.TRACER,name:kt.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,n]});n&&(t.encoderConfig=n);const a=X_(t),d=fk(e);let l=null,h=null;T.info("start create camera video track(".concat(i,") and microphone audio track(").concat(r,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const m=await fi({audio:d,video:a},"".concat(r,"-").concat(i));l=m.getAudioTracks()[0],h=m.getVideoTracks()[0]}catch(m){throw s.onError(m),m}if(!l||!h){const m=new Y(O.UNEXPECTED_ERROR,"can not find tracks in media stream");return s.onError(m),m.throw(T)}if(t.optimizationMode&&IR(i,h,t,oo(t.encoderConfig)),A("USE_STANDARD_BITRATE_DEFAULT")){const m=oo(t.encoderConfig);t.encoderConfig=m,delete m.bitrateMax,delete m.bitrateMin}const p=new Ih(l,e,d,r),_=new Q_(h,t,a,t.scalabiltyMode?K_(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i);return s.onSuccess([p.getTrackId(),_.getTrackId()]),T.info("create camera video track(".concat(i,") and microphone audio track(").concat(r,") success")),[p,_]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=ht(8,"track-mic-"),n=Se.reportApiInvoke(null,{id:t,tag:yt.TRACER,name:kt.CREATE_MIC_AUDIO_TRACK,options:[e]}),r=fk(e);let i=null;T.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{i=(await fi({audio:r},t)).getAudioTracks()[0]||null}catch(a){throw n.onError(a),a}if(!i){const a=new Y(O.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(a),a.throw(T)}const s=new Ih(i,e,r,t);return n.onSuccess(s.getTrackId()),T.info("create microphone audio track success, trackId:",t),s},createCustomAudioTrack:B1,createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:n,encoderConfig:r}=e;let{source:i}=e;const s={source:i instanceof AudioBuffer?"AudioBuffer":i instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":i,cacheOnlineFile:n,encoderConfig:r},a=ht(8,"track-buf-"),d=Se.reportApiInvoke(null,{id:a,tag:yt.TRACER,name:kt.CREATE_BUFFER_AUDIO_TRACK,options:[s]});if(A("DISABLE_WEBAUDIO"))throw new Y(O.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");T.info("start create buffer source audio track with config",JSON.stringify(s),"trackId",a);const l=i;if(!(i instanceof AudioBuffer))try{i=await async function(_,m){let g=null;if(typeof _=="string"){const R=t1.get(_);if(R)return T.debug("use cached audio resource: ",_),R;try{g=(await Do(()=>Cr.get(_,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(y){throw new Y(O.FETCH_AUDIO_FILE_FAILED,y.toString())}}else g=await new ae((y,b)=>{const N=new FileReader;N.onload=L=>{L.target?y(L.target.result):b(new Y(O.READ_LOCAL_AUDIO_FILE_ERROR))},N.onerror=()=>{b(new Y(O.READ_LOCAL_AUDIO_FILE_ERROR))},N.readAsArrayBuffer(_)});const w=await function(R){const y=Rl();return new ae((b,N)=>{y.decodeAudioData(R,L=>{b(L)},L=>{N(new Y(O.DECODE_AUDIO_FILE_FAILED,L.toString()))})})}(g);return typeof _=="string"&&m&&t1.set(_,w),w}(i,n)}catch(_){return d.onError(_),_.throw(T)}const h=new MJ(i),p=new kJ(l,h,r?Y_(r):{},a);return T.info("create buffer source audio track success, trackId:",a),d.onSuccess(p.getTrackId()),p},setAppType:function(e){if(T.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw T.debug("Invalid appType"),new j(O.INVALID_PARAMS,"invalid app type",e);St("APP_TYPE",Math.floor(e))},setLogLevel:function(e){T.setLogLevel(e)},enableLogUpload:function(){A("USE_NEW_LOG")?St("UPLOAD_LOG",!0):T.enableLogUpload()},disableLogUpload:function(){A("USE_NEW_LOG")?St("UPLOAD_LOG",!1):T.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new iU},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=Se.reportApiInvoke(null,{tag:yt.TRACER,name:kt.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Xt||e instanceof Il)){const l=new j(O.INVALID_TRACK,"the parameter is not a audio track");return n.onError(l),l.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof Xt?e.getTrackLabel():"remote_track",i=e.getVolumeLevel();let s=i,a=i;const d=Date.now();return new ae(l=>{const h=setInterval(()=>{const p=e.getVolumeLevel();s=p>s?p:s,a=p<a?p:a;const _=s-a>1e-4,m=Date.now()-d;if(_||m>t){clearInterval(h);const g=_,w={duration:m,deviceLabel:r,maxVolumeLevel:s,result:g};T.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(w))),n.onSuccess(w),l(g)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=Se.reportApiInvoke(null,{tag:yt.TRACER,name:kt.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Ct||e instanceof Cl)){const _=new j(O.INVALID_TRACK,"the parameter is not a video track");return n.onError(_),_.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof Ct?e.getTrackLabel():"remote_track",i=e.getMediaStreamTrack(!0),s=document.createElement("video");s.style.width="1px",s.style.height="1px",s.setAttribute("muted",""),s.muted=!0,s.setAttribute("playsinline",""),s.controls=!1,(An()||L_())&&(s.style.opacity="0.01",s.style.position="fixed",s.style.left="0",s.style.top="0",document.body.appendChild(s)),s.srcObject=new MediaStream([i]),s.play();const a=document.createElement("canvas");a.width=160,a.height=120;let d=0,l=0;try{const _=Date.now();d=await function(m,g,w,R){let y,b=0,N=null;return new ae((L,x)=>{function F(){b>R&&y&&(y(),L(b));const M=w.getContext("2d");if(!M){const ee=new j(O.UNEXPECTED_ERROR,"can not get canvas 2d context.");return T.error(ee.toString()),void x(ee)}M.drawImage(m,0,0,160,120);const B=M.getImageData(0,0,w.width,w.height),J=Math.floor(B.data.length/3);if(N){for(let ee=0;ee<J;ee+=3)if(B.data[ee]!==N[ee])return b+=1,void(N=B.data);N=B.data}else N=B.data}setTimeout(()=>{y&&(y(),L(b))},g),y=gR(()=>{F()},30)})}(s,t,a,4),l=Date.now()-_}catch(_){throw n.onError(_),_}eZ===ot.SAFARI&&(s.pause(),s.remove()),s.srcObject=null;const h=d>4,p={duration:l,changedPicNum:d,deviceLabel:r,result:h};return T.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(p))),n.onSuccess(p),h},setArea:iy,audioElementPlayCenter:or,resumeAudioContext:function(){return or.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){gZ.processExternalMediaAEC(e)},registerExtensions:function(e){const t=A("PLUGIN_INFO")||[];e.forEach(n=>{"name"in n&&!te(t).call(t,n.name)&&t.push(n.name);const r=n;r.__registered__=!0,r.logger.hookLog=T.extLog,r.reporter.hookApiInvoke=Se.extApiInvoke,r.parameters&&Object.keys(r.parameters).forEach(i=>{r.parameters[i]=A(i)})}),pV("PLUGIN_INFO",t)},ChannelMediaRelayError:bl,ChannelMediaRelayEvent:js,ChannelMediaRelayState:xr,RemoteStreamFallbackType:bJ,RemoteStreamType:AJ,ConnectionDisconnectedReason:Qe,AudienceLatencyLevelType:nJ,AREAS:at,preload:async function(e,t,n,r){return wy(e,t,n,r)},startLastmileProbeTest:async function(e,t,n,r){let i={state:"unavailable"};await wy(e,t,n,r);const s=await Ay({appId:e,cname:t,token:n||e,uid:r,cloudProxyServer:"disabled"});if(!s)return i;await by(s);let a,d=x2({mode:"rtc",codec:"vp8"});try{a=await d.join(e,t,n,r,{networkQualityProbe:!0})}catch{return i}const l=new iZ,h=l.createMuteAudioTrack();let p=await B1({mediaStreamTrack:h});await d.publish([p]);let[_,m,g]=await new ae((L,x)=>{const F=setTimeout(()=>{clearTimeout(F),L([!0,null,"audio"])},5e3);d.on("user-published",async(M,B)=>{M.uid===a&&(clearTimeout(F),L([!1,M,B]))})});if(_||!m)return await d.unpublish([p]),await d.leave(),p.close(),l.close(),i;await d.subscribe(m,g),await new ae((L,x)=>{const F=setTimeout(()=>{clearTimeout(F),L(null)},5e3)});let w=d.getRTCStats(),R=d.getLocalAudioStats();const y=w.RTT,b=R.sendJitterMs,N=R.currentPacketLossRate;return i={state:"complete",rtt:y,packetLossRate:N,jitter:b,networkQuality:((L,x,F)=>{let M=1;if(F>0){let Pe=Math.log(100*F)/Math.log(2)+1;Pe=Math.min(5,Math.max(0,Pe)),M=1-Pe/5}let B=1;if(L>0){let Pe=Math.log(L/40)/Math.log(2)+1;Pe=Math.min(5,Math.max(0,Pe)),B=1-Pe/5}let J=1;if(x>0){let Pe=Math.log(x/10)/Math.log(2.5)+1;Pe=Math.min(5,Math.max(0,Pe)),J=1-Pe/5}const ee=.5*M+.3*B+.2*J;let pe=0;return pe=ee>=.8?1:ee>=.6?2:ee>=.4?3:ee>=.2?4:5,pe})(y,b,N)},await d.unsubscribe(m),await d.unpublish([p]),await d.leave(),p.close(),l.close(),await by(s),i}});return Object.defineProperties(ln,{onAudioAutoplayFailed:{get:()=>wr.onAudioAutoplayFailed,set:e=>{wr.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>wr.onAutoplayFailed,set:e=>{wr.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>ln._onSecurityPolicyViolation,set(e){ln._onSecurityPolicyViolation=e,j2(e)}},__CLIENT_LIST__:{get:()=>A("SHOW_GLOBAL_CLIENT_LIST")?jc:[]}}),_i.on(xc.CAMERA_DEVICE_CHANGED,e=>{T.info("camera device changed",JSON.stringify(e)),ln.onCameraChanged&&ln.onCameraChanged(e),ln.safeEmit(us.CAMERA_CHANGED,e)}),_i.on(xc.RECORDING_DEVICE_CHANGED,e=>{T.info("microphone device changed",JSON.stringify(e)),ln.onMicrophoneChanged&&ln.onMicrophoneChanged(e),ln.safeEmit(us.MICROPHONE_CHANGED,e)}),_i.on(xc.PLAYOUT_DEVICE_CHANGED,e=>{T.debug("playout device changed",JSON.stringify(e)),ln.onPlaybackDeviceChanged&&ln.onPlaybackDeviceChanged(e),ln.safeEmit(us.PLAYBACK_DEVICE_CHANGED,e)}),or.onAutoplayFailed=()=>{T.info("detect audio element autoplay failed"),wr.onAudioAutoplayFailed&&wr.onAudioAutoplayFailed()},Tt.on("autoplay-failed",()=>{T.info("detect webaudio autoplay failed"),wr.onAudioAutoplayFailed&&wr.onAudioAutoplayFailed(),ln.safeEmit(us.AUTOPLAY_FAILED)}),Tt.on(Un.STATE_CHANGE,(e,t)=>{T.info("audio context state changed: ".concat(t," => ").concat(e)),ln.onAudioContextStateChanged&&ln.onAudioContextStateChanged(e,t),ln.safeEmit(us.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),Ht.on(bc.NETWORK_STATE_CHANGE,(e,t)=>{T.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=ln),ln})})(z3);var koe=z3.exports;const QF=$F(koe),Moe=o=>{const[c]=Re.useState(()=>QF.createClient({mode:"rtc",codec:"vp8"})),[u,f]=Re.useState(null),[E,S]=Re.useState(null),[C,D]=Re.useState(c.remoteUsers),[k,V]=Re.useState(!1),[G,W]=Re.useState(""),Q=Re.useMemo(()=>async z=>{const de=await Ro.post(`/hangouts/${o}/join`,{joinToken:z}),{agora:he,room:q}=de.data;W(q.title),c.on("user-published",async(Ee,Oe)=>{await c.subscribe(Ee,Oe),D([...c.remoteUsers])}),c.on("user-unpublished",()=>{D([...c.remoteUsers])}),await c.join(he.appId,he.channelName,he.rtcToken,Number(he.uid));const[K,X]=await QF.createMicrophoneAndCameraTracks();f(K),S(X),await c.publish([K,X]),V(!0)},[c,o]),me=Re.useMemo(()=>async()=>{u==null||u.stop(),u==null||u.close(),E==null||E.stop(),E==null||E.close(),await c.leave(),V(!1),D([])},[c,u,E]);return Re.useEffect(()=>()=>{me()},[me]),{join:Q,leave:me,localAudioTrack:u,localVideoTrack:E,remoteUsers:C,isJoined:k,roomTitle:G}},ZF=({track:o,label:c})=>{const u=Re.useRef(null);return Re.useEffect(()=>{if(!(!o||!u.current))return o.play(u.current),()=>{o.stop()}},[o]),se.jsxs("div",{style:{border:"1px solid #444",padding:"0.5rem"},children:[se.jsx("div",{ref:u,style:{width:"320px",height:"240px",background:"#000"}}),se.jsx("div",{children:c})]})},Uoe=()=>{const{roomId:o}=E3(),[c,u]=Re.useState(""),{join:f,leave:E,localVideoTrack:S,remoteUsers:C,isJoined:D,roomTitle:k}=Moe(o),V=async()=>{await f(c||void 0)};return se.jsxs("div",{children:[se.jsxs("h1",{children:["Hangout: ",k||o]}),se.jsx("p",{children:"No grabar ni redistribuir contenido. Participas bajo tu responsabilidad."}),!D&&se.jsxs("div",{children:[se.jsx("input",{placeholder:"Join token (si es privada)",value:c,onChange:G=>u(G.target.value)}),se.jsx("button",{onClick:V,children:"Entrar"})]}),D&&se.jsx("button",{onClick:E,style:{marginBottom:"1rem"},children:"Salir"}),se.jsxs("div",{style:{display:"flex",gap:"1rem",flexWrap:"wrap"},children:[se.jsx(ZF,{track:S,label:"Yo"}),C.map(G=>se.jsx(ZF,{track:G.videoTrack??null,label:`Usuario ${G.uid}`},G.uid))]})]})},xoe=()=>{const[o,c]=Re.useState([]),{role:u}=wd();return Re.useEffect(()=>{(async()=>{const E=await Ro.get("/videorama/collections");c(E.data.collections)})()},[]),se.jsxs("div",{children:[se.jsx("h1",{children:"Videorama"}),u&&(u==="PRIME"||u==="ADMIN")&&se.jsx(ic,{to:"/videorama/create",children:"Crear coleccin"}),se.jsx("div",{style:{display:"grid",gap:"1rem"},children:o.map(f=>se.jsxs("div",{style:{border:"1px solid #ddd",padding:"1rem"},children:[se.jsx("h3",{children:f.title}),se.jsx("p",{children:f.description}),se.jsxs("p",{children:["Visibilidad: ",f.visibility]}),se.jsx(ic,{to:`/videorama/edit/${f.id}`,children:"Editar"})]},f.id))})]})},Voe=()=>{const[o,c]=Re.useState(""),[u,f]=Re.useState(""),[E,S]=Re.useState("PLAYLIST"),[C,D]=Re.useState("PUBLIC"),k=Id(),V=async G=>{G.preventDefault(),await Ro.post("/videorama/collections",{title:o,description:u,type:E,visibility:C,items:[]}),k("/videorama")};return se.jsxs("div",{children:[se.jsx("h1",{children:"Nueva coleccin"}),se.jsxs("form",{onSubmit:V,children:[se.jsxs("label",{children:["Ttulo",se.jsx("input",{value:o,onChange:G=>c(G.target.value),required:!0})]}),se.jsxs("label",{children:["Descripcin",se.jsx("textarea",{value:u,onChange:G=>f(G.target.value)})]}),se.jsxs("label",{children:["Tipo",se.jsxs("select",{value:E,onChange:G=>S(G.target.value),children:[se.jsx("option",{value:"PLAYLIST",children:"Playlist"}),se.jsx("option",{value:"PODCAST",children:"Podcast"})]})]}),se.jsxs("label",{children:["Visibilidad",se.jsxs("select",{value:C,onChange:G=>D(G.target.value),children:[se.jsx("option",{value:"PUBLIC",children:"Public"}),se.jsx("option",{value:"PRIME",children:"Prime"})]})]}),se.jsx("button",{type:"submit",children:"Guardar"})]})]})},Foe=()=>{const{id:o}=E3(),[c,u]=Re.useState(""),[f,E]=Re.useState(""),[S,C]=Re.useState("PUBLIC"),D=Id();Re.useEffect(()=>{(async()=>{const W=(await Ro.get(`/videorama/collections/${o}`)).data.collection;u(W.title),E(W.description),C(W.visibility)})()},[o]);const k=async V=>{V.preventDefault(),await Ro.put(`/videorama/collections/${o}`,{title:c,description:f,visibility:S}),D("/videorama")};return se.jsxs("div",{children:[se.jsx("h1",{children:"Editar coleccin"}),se.jsxs("form",{onSubmit:k,children:[se.jsxs("label",{children:["Ttulo",se.jsx("input",{value:c,onChange:V=>u(V.target.value),required:!0})]}),se.jsxs("label",{children:["Descripcin",se.jsx("textarea",{value:f,onChange:V=>E(V.target.value)})]}),se.jsxs("label",{children:["Visibilidad",se.jsxs("select",{value:S,onChange:V=>C(V.target.value),children:[se.jsx("option",{value:"PUBLIC",children:"Public"}),se.jsx("option",{value:"PRIME",children:"Prime"})]})]}),se.jsx("button",{type:"submit",children:"Actualizar"})]})]})},Boe=()=>{const{refreshMe:o}=wd();return Re.useEffect(()=>{o()},[o]),se.jsx(boe,{children:se.jsxs(Fre,{children:[se.jsx(ws,{path:"/",element:se.jsx(OI,{to:"/hangouts",replace:!0})}),se.jsx(ws,{path:"/login",element:se.jsx(Ooe,{})}),se.jsx(ws,{path:"/terms",element:se.jsx(Doe,{})}),se.jsx(ws,{path:"/hangouts",element:se.jsx(Ql,{children:se.jsx(Poe,{})})}),se.jsx(ws,{path:"/hangouts/create",element:se.jsx(Ql,{requireRole:["PRIME","ADMIN"],children:se.jsx(Loe,{})})}),se.jsx(ws,{path:"/hangouts/room/:roomId",element:se.jsx(Ql,{children:se.jsx(Uoe,{})})}),se.jsx(ws,{path:"/videorama",element:se.jsx(Ql,{children:se.jsx(xoe,{})})}),se.jsx(ws,{path:"/videorama/create",element:se.jsx(Ql,{requireRole:["PRIME","ADMIN"],children:se.jsx(Voe,{})})}),se.jsx(ws,{path:"/videorama/edit/:id",element:se.jsx(Ql,{children:se.jsx(Foe,{})})})]})})};MC.createRoot(document.getElementById("root")).render(se.jsx(BI.StrictMode,{children:se.jsx(Yre,{children:se.jsx(woe,{children:se.jsx(Boe,{})})})}));
